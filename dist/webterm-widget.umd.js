(function(Ze,pe){typeof exports=="object"&&typeof module<"u"?pe(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],pe):(Ze=typeof globalThis<"u"?globalThis:Ze||self,pe(Ze.WebtermWidget={},Ze.Vue))})(this,function(Ze,pe){"use strict";var Dm=Object.defineProperty;var Tm=(Ze,pe,br)=>pe in Ze?Dm(Ze,pe,{enumerable:!0,configurable:!0,writable:!0,value:br}):Ze[pe]=br;var ce=(Ze,pe,br)=>Tm(Ze,typeof pe!="symbol"?pe+"":pe,br);/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */var kf,Bf,Rf;function br(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function qa(e,t=""){if(!Number.isSafeInteger(e)||e<0){const r=t&&`"${t}" `;throw new Error(`${r}expected integer >= 0, got ${e}`)}}function di(e,t,r=""){const i=br(e),s=e==null?void 0:e.length,n=t!==void 0;if(!i||n&&s!==t){const o=r&&`"${r}" `,a=n?` of length ${t}`:"",h=i?`length=${s}`:`type=${typeof e}`;throw new Error(o+"expected Uint8Array"+a+", got "+h)}return e}function Wf(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash must wrapped by utils.createHasher");qa(e.outputLen),qa(e.blockLen)}function pi(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function zf(e,t){di(e,void 0,"digestInto() output");const r=t.outputLen;if(e.length<r)throw new Error('"digestInto() output" expected to be of length >='+r)}function _i(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function ys(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function qf(e,t={}){const r=(s,n)=>e(n).update(s).digest(),i=e(void 0);return r.outputLen=i.outputLen,r.blockLen=i.blockLen,r.create=s=>e(s),Object.assign(r,t),Object.freeze(r)}const jf=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])});class ja{constructor(t,r){ce(this,"oHash");ce(this,"iHash");ce(this,"blockLen");ce(this,"outputLen");ce(this,"finished",!1);ce(this,"destroyed",!1);if(Wf(t),di(r,void 0,"key"),this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?t.create().update(r).digest():r);for(let n=0;n<s.length;n++)s[n]^=54;this.iHash.update(s),this.oHash=t.create();for(let n=0;n<s.length;n++)s[n]^=106;this.oHash.update(s),_i(s)}update(t){return pi(this),this.iHash.update(t),this}digestInto(t){pi(this),di(t,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:s,destroyed:n,blockLen:o,outputLen:a}=this;return t=t,t.finished=s,t.destroyed=n,t.blockLen=o,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=i._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const $a=(e,t,r)=>new ja(e,t).update(r).digest();$a.create=(e,t)=>new ja(e,t);class $f{constructor(t,r,i,s){ce(this,"blockLen");ce(this,"outputLen");ce(this,"padOffset");ce(this,"isLE");ce(this,"buffer");ce(this,"view");ce(this,"finished",!1);ce(this,"length",0);ce(this,"pos",0);ce(this,"destroyed",!1);this.blockLen=t,this.outputLen=r,this.padOffset=i,this.isLE=s,this.buffer=new Uint8Array(t),this.view=ys(this.buffer)}update(t){pi(this),di(t);const{view:r,buffer:i,blockLen:s}=this,n=t.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const h=ys(t);for(;s<=n-o;o+=s)this.process(h,o);continue}i.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){pi(this),zf(t,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;r[o++]=128,_i(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(i,0),o=0);for(let u=o;u<s;u++)r[u]=0;i.setBigUint64(s-8,BigInt(this.length*8),n),this.process(i,0);const a=ys(t),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const l=h/4,c=this.get();if(l>c.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,c[u],n)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const i=t.slice(0,r);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return t.destroyed=o,t.finished=n,t.length=s,t.pos=a,s%r&&t.buffer.set(i),t}clone(){return this._cloneInto()}}const Ke=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),gi=BigInt(2**32-1),Ka=BigInt(32);function Kf(e,t=!1){return t?{h:Number(e&gi),l:Number(e>>Ka&gi)}:{h:Number(e>>Ka&gi)|0,l:Number(e&gi)|0}}function Vf(e,t=!1){const r=e.length;let i=new Uint32Array(r),s=new Uint32Array(r);for(let n=0;n<r;n++){const{h:o,l:a}=Kf(e[n],t);[i[n],s[n]]=[o,a]}return[i,s]}const Va=(e,t,r)=>e>>>r,Ga=(e,t,r)=>e<<32-r|t>>>r,wr=(e,t,r)=>e>>>r|t<<32-r,Sr=(e,t,r)=>e<<32-r|t>>>r,vi=(e,t,r)=>e<<64-r|t>>>r-32,mi=(e,t,r)=>e>>>r-32|t<<64-r;function Tt(e,t,r,i){const s=(t>>>0)+(i>>>0);return{h:e+r+(s/2**32|0)|0,l:s|0}}const Gf=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),Yf=(e,t,r,i)=>t+r+i+(e/2**32|0)|0,Xf=(e,t,r,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0),Jf=(e,t,r,i,s)=>t+r+i+s+(e/2**32|0)|0,Zf=(e,t,r,i,s)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0)+(s>>>0),Qf=(e,t,r,i,s,n)=>t+r+i+s+n+(e/2**32|0)|0,Ya=Vf(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),ed=Ya[0],td=Ya[1],Kt=new Uint32Array(80),Vt=new Uint32Array(80);class rd extends $f{constructor(t){super(128,t,16,!1)}get(){const{Ah:t,Al:r,Bh:i,Bl:s,Ch:n,Cl:o,Dh:a,Dl:h,Eh:l,El:c,Fh:u,Fl:p,Gh:_,Gl:m,Hh:g,Hl:w}=this;return[t,r,i,s,n,o,a,h,l,c,u,p,_,m,g,w]}set(t,r,i,s,n,o,a,h,l,c,u,p,_,m,g,w){this.Ah=t|0,this.Al=r|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=h|0,this.Eh=l|0,this.El=c|0,this.Fh=u|0,this.Fl=p|0,this.Gh=_|0,this.Gl=m|0,this.Hh=g|0,this.Hl=w|0}process(t,r){for(let S=0;S<16;S++,r+=4)Kt[S]=t.getUint32(r),Vt[S]=t.getUint32(r+=4);for(let S=16;S<80;S++){const v=Kt[S-15]|0,k=Vt[S-15]|0,R=wr(v,k,1)^wr(v,k,8)^Va(v,k,7),O=Sr(v,k,1)^Sr(v,k,8)^Ga(v,k,7),N=Kt[S-2]|0,W=Vt[S-2]|0,Q=wr(N,W,19)^vi(N,W,61)^Va(N,W,6),ie=Sr(N,W,19)^mi(N,W,61)^Ga(N,W,6),K=Xf(O,ie,Vt[S-7],Vt[S-16]),H=Jf(K,R,Q,Kt[S-7],Kt[S-16]);Kt[S]=H|0,Vt[S]=K|0}let{Ah:i,Al:s,Bh:n,Bl:o,Ch:a,Cl:h,Dh:l,Dl:c,Eh:u,El:p,Fh:_,Fl:m,Gh:g,Gl:w,Hh:y,Hl:E}=this;for(let S=0;S<80;S++){const v=wr(u,p,14)^wr(u,p,18)^vi(u,p,41),k=Sr(u,p,14)^Sr(u,p,18)^mi(u,p,41),R=u&_^~u&g,O=p&m^~p&w,N=Zf(E,k,O,td[S],Vt[S]),W=Qf(N,y,v,R,ed[S],Kt[S]),Q=N|0,ie=wr(i,s,28)^vi(i,s,34)^vi(i,s,39),K=Sr(i,s,28)^mi(i,s,34)^mi(i,s,39),H=i&n^i&a^n&a,G=s&o^s&h^o&h;y=g|0,E=w|0,g=_|0,w=m|0,_=u|0,m=p|0,{h:u,l:p}=Tt(l|0,c|0,W|0,Q|0),l=a|0,c=h|0,a=n|0,h=o|0,n=i|0,o=s|0;const J=Gf(Q,K,G);i=Yf(J,W,ie,H),s=J|0}({h:i,l:s}=Tt(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:o}=Tt(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:h}=Tt(this.Ch|0,this.Cl|0,a|0,h|0),{h:l,l:c}=Tt(this.Dh|0,this.Dl|0,l|0,c|0),{h:u,l:p}=Tt(this.Eh|0,this.El|0,u|0,p|0),{h:_,l:m}=Tt(this.Fh|0,this.Fl|0,_|0,m|0),{h:g,l:w}=Tt(this.Gh|0,this.Gl|0,g|0,w|0),{h:y,l:E}=Tt(this.Hh|0,this.Hl|0,y|0,E|0),this.set(i,s,n,o,a,h,l,c,u,p,_,m,g,w,y,E)}roundClean(){_i(Kt,Vt)}destroy(){_i(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class id extends rd{constructor(){super(64);ce(this,"Ah",Ke[0]|0);ce(this,"Al",Ke[1]|0);ce(this,"Bh",Ke[2]|0);ce(this,"Bl",Ke[3]|0);ce(this,"Ch",Ke[4]|0);ce(this,"Cl",Ke[5]|0);ce(this,"Dh",Ke[6]|0);ce(this,"Dl",Ke[7]|0);ce(this,"Eh",Ke[8]|0);ce(this,"El",Ke[9]|0);ce(this,"Fh",Ke[10]|0);ce(this,"Fl",Ke[11]|0);ce(this,"Gh",Ke[12]|0);ce(this,"Gl",Ke[13]|0);ce(this,"Hh",Ke[14]|0);ce(this,"Hl",Ke[15]|0)}}const sd=qf(()=>new id,jf(3));/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function nd(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Qe(e,t,r=""){const i=nd(e),s=e==null?void 0:e.length,n=t!==void 0;if(!i||n&&s!==t){const o=r&&`"${r}" `,a=n?` of length ${t}`:"",h=i?`length=${s}`:`type=${typeof e}`;throw new Error(o+"expected Uint8Array"+a+", got "+h)}return e}function yi(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Xa(e,t){Qe(e,void 0,"output");const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function od(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function Lt(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function Pt(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function bi(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}const ad=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ld(e,t){if(e.length!==t.length)return!1;let r=0;for(let i=0;i<e.length;i++)r|=e[i]^t[i];return r===0}const hd=(e,t)=>{function r(i,...s){if(Qe(i,void 0,"key"),!ad)throw new Error("Non little-endian hardware is not yet supported");if(e.nonceLength!==void 0){const c=s[0];Qe(c,e.varSizeNonce?void 0:e.nonceLength,"nonce")}const n=e.tagLength;n&&s[1]!==void 0&&Qe(s[1],void 0,"AAD");const o=t(i,...s),a=(c,u)=>{if(u!==void 0){if(c!==2)throw new Error("cipher output not supported");Qe(u,void 0,"output")}};let h=!1;return{encrypt(c,u){if(h)throw new Error("cannot encrypt() twice with same key + nonce");return h=!0,Qe(c),a(o.encrypt.length,u),o.encrypt(c,u)},decrypt(c,u){if(Qe(c),n&&c.length<n)throw new Error('"ciphertext" expected length bigger than tagLength='+n);return a(o.decrypt.length,u),o.decrypt(c,u)}}}return Object.assign(r,e),r};function cd(e,t,r=!0){if(t===void 0)return new Uint8Array(e);if(t.length!==e)throw new Error('"output" expected Uint8Array of length '+e+", got: "+t.length);if(r&&!wi(t))throw new Error("invalid output, must be aligned");return t}function ud(e,t,r){const i=new Uint8Array(16),s=bi(i);return s.setBigUint64(0,BigInt(t),r),s.setBigUint64(8,BigInt(e),r),i}function wi(e){return e.byteOffset%4===0}function or(e){return Uint8Array.from(e)}const Mt=16,bs=new Uint8Array(16),yt=Lt(bs),fd=225,dd=(e,t,r,i)=>{const s=i&1;return{s3:r<<31|i>>>1,s2:t<<31|r>>>1,s1:e<<31|t>>>1,s0:e>>>1^fd<<24&-(s&1)}},ht=e=>(e>>>0&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255|0;function pd(e){e.reverse();const t=e[15]&1;let r=0;for(let i=0;i<e.length;i++){const s=e[i];e[i]=s>>>1|r,r=(s&1)<<7}return e[0]^=-t&225,e}const _d=e=>e>64*1024?8:e>1024?4:2;class Ja{constructor(t,r){ce(this,"blockLen",Mt);ce(this,"outputLen",Mt);ce(this,"s0",0);ce(this,"s1",0);ce(this,"s2",0);ce(this,"s3",0);ce(this,"finished",!1);ce(this,"t");ce(this,"W");ce(this,"windowSize");Qe(t,16,"key"),t=or(t);const i=bi(t);let s=i.getUint32(0,!1),n=i.getUint32(4,!1),o=i.getUint32(8,!1),a=i.getUint32(12,!1);const h=[];for(let m=0;m<128;m++)h.push({s0:ht(s),s1:ht(n),s2:ht(o),s3:ht(a)}),{s0:s,s1:n,s2:o,s3:a}=dd(s,n,o,a);const l=_d(r||1024);if(![1,2,4,8].includes(l))throw new Error("ghash: invalid window size, expected 2, 4 or 8");this.W=l;const u=128/l,p=this.windowSize=2**l,_=[];for(let m=0;m<u;m++)for(let g=0;g<p;g++){let w=0,y=0,E=0,S=0;for(let v=0;v<l;v++){if(!(g>>>l-v-1&1))continue;const{s0:R,s1:O,s2:N,s3:W}=h[l*m+v];w^=R,y^=O,E^=N,S^=W}_.push({s0:w,s1:y,s2:E,s3:S})}this.t=_}_updateBlock(t,r,i,s){t^=this.s0,r^=this.s1,i^=this.s2,s^=this.s3;const{W:n,t:o,windowSize:a}=this;let h=0,l=0,c=0,u=0;const p=(1<<n)-1;let _=0;for(const m of[t,r,i,s])for(let g=0;g<4;g++){const w=m>>>8*g&255;for(let y=8/n-1;y>=0;y--){const E=w>>>n*y&p,{s0:S,s1:v,s2:k,s3:R}=o[_*a+E];h^=S,l^=v,c^=k,u^=R,_+=1}}this.s0=h,this.s1=l,this.s2=c,this.s3=u}update(t){yi(this),Qe(t),t=or(t);const r=Lt(t),i=Math.floor(t.length/Mt),s=t.length%Mt;for(let n=0;n<i;n++)this._updateBlock(r[n*4+0],r[n*4+1],r[n*4+2],r[n*4+3]);return s&&(bs.set(t.subarray(i*Mt)),this._updateBlock(yt[0],yt[1],yt[2],yt[3]),Pt(yt)),this}destroy(){const{t}=this;for(const r of t)r.s0=0,r.s1=0,r.s2=0,r.s3=0}digestInto(t){yi(this),Xa(t,this),this.finished=!0;const{s0:r,s1:i,s2:s,s3:n}=this,o=Lt(t);return o[0]=r,o[1]=i,o[2]=s,o[3]=n,t}digest(){const t=new Uint8Array(Mt);return this.digestInto(t),this.destroy(),t}}class gd extends Ja{constructor(t,r){Qe(t);const i=pd(or(t));super(i,r),Pt(i)}update(t){yi(this),Qe(t),t=or(t);const r=Lt(t),i=t.length%Mt,s=Math.floor(t.length/Mt);for(let n=0;n<s;n++)this._updateBlock(ht(r[n*4+3]),ht(r[n*4+2]),ht(r[n*4+1]),ht(r[n*4+0]));return i&&(bs.set(t.subarray(s*Mt)),this._updateBlock(ht(yt[3]),ht(yt[2]),ht(yt[1]),ht(yt[0])),Pt(yt)),this}digestInto(t){yi(this),Xa(t,this),this.finished=!0;const{s0:r,s1:i,s2:s,s3:n}=this,o=Lt(t);return o[0]=r,o[1]=i,o[2]=s,o[3]=n,t.reverse()}}function Za(e){const t=(i,s)=>e(s,i.length).update(i).digest(),r=e(new Uint8Array(16),0);return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=(i,s)=>e(i,s),t}const Qa=Za((e,t)=>new Ja(e,t));Za((e,t)=>new gd(e,t));const ws=16,vd=4,Si=new Uint8Array(ws),md=283;function yd(e){if(![16,24,32].includes(e.length))throw new Error('"aes key" expected Uint8Array of length 16/24/32, got length='+e.length)}function Ss(e){return e<<1^md&-(e>>7)}function el(e,t){let r=0;for(;t>0;t>>=1)r^=e&-(t&1),e=Ss(e);return r}const bd=(()=>{const e=new Uint8Array(256);for(let r=0,i=1;r<256;r++,i^=Ss(i))e[r]=i;const t=new Uint8Array(256);t[0]=99;for(let r=0;r<255;r++){let i=e[255-r];i|=i<<8,t[e[r]]=(i^i>>4^i>>5^i>>6^i>>7^99)&255}return Pt(e),t})(),wd=e=>e<<24|e>>>8,Cs=e=>e<<8|e>>>24;function Sd(e,t){if(e.length!==256)throw new Error("Wrong sbox length");const r=new Uint32Array(256).map((l,c)=>t(e[c])),i=r.map(Cs),s=i.map(Cs),n=s.map(Cs),o=new Uint32Array(256*256),a=new Uint32Array(256*256),h=new Uint16Array(256*256);for(let l=0;l<256;l++)for(let c=0;c<256;c++){const u=l*256+c;o[u]=r[l]^i[c],a[u]=s[l]^n[c],h[u]=e[l]<<8|e[c]}return{sbox:e,sbox2:h,T0:r,T1:i,T2:s,T3:n,T01:o,T23:a}}const tl=Sd(bd,e=>el(e,3)<<24|e<<16|e<<8|el(e,2)),Cd=(()=>{const e=new Uint8Array(16);for(let t=0,r=1;t<16;t++,r=Ss(r))e[t]=r;return e})();function Ed(e){Qe(e);const t=e.length;yd(e);const{sbox2:r}=tl,i=[];wi(e)||i.push(e=or(e));const s=Lt(e),n=s.length,o=h=>Wr(r,h,h,h,h),a=new Uint32Array(t+28);a.set(s);for(let h=n;h<a.length;h++){let l=a[h-1];h%n===0?l=o(wd(l))^Cd[h/n-1]:n>6&&h%n===4&&(l=o(l)),a[h]=a[h-n]^l}return Pt(...i),a}function Ci(e,t,r,i,s,n){return e[r<<8&65280|i>>>8&255]^t[s>>>8&65280|n>>>24&255]}function Wr(e,t,r,i,s){return e[t&255|r&65280]|e[i>>>16&255|s>>>16&65280]<<16}function rl(e,t,r,i,s){const{sbox2:n,T01:o,T23:a}=tl;let h=0;t^=e[h++],r^=e[h++],i^=e[h++],s^=e[h++];const l=e.length/4-2;for(let m=0;m<l;m++){const g=e[h++]^Ci(o,a,t,r,i,s),w=e[h++]^Ci(o,a,r,i,s,t),y=e[h++]^Ci(o,a,i,s,t,r),E=e[h++]^Ci(o,a,s,t,r,i);t=g,r=w,i=y,s=E}const c=e[h++]^Wr(n,t,r,i,s),u=e[h++]^Wr(n,r,i,s,t),p=e[h++]^Wr(n,i,s,t,r),_=e[h++]^Wr(n,s,t,r,i);return{s0:c,s1:u,s2:p,s3:_}}function Ei(e,t,r,i,s){Qe(r,ws,"nonce"),Qe(i),s=cd(i.length,s);const n=r,o=Lt(n),a=bi(n),h=Lt(i),l=Lt(s),c=t?0:12,u=i.length;let p=a.getUint32(c,t),{s0:_,s1:m,s2:g,s3:w}=rl(e,o[0],o[1],o[2],o[3]);for(let E=0;E+4<=h.length;E+=4)l[E+0]=h[E+0]^_,l[E+1]=h[E+1]^m,l[E+2]=h[E+2]^g,l[E+3]=h[E+3]^w,p=p+1>>>0,a.setUint32(c,p,t),{s0:_,s1:m,s2:g,s3:w}=rl(e,o[0],o[1],o[2],o[3]);const y=ws*Math.floor(h.length/vd);if(y<u){const E=new Uint32Array([_,m,g,w]),S=od(E);for(let v=y,k=0;v<u;v++,k++)s[v]=i[v]^S[k];Pt(E)}return s}function xd(e,t,r,i,s){const n=s?s.length:0,o=e.create(r,i.length+n);s&&o.update(s);const a=ud(8*i.length,8*n,t);o.update(i),o.update(a);const h=o.digest();return Pt(a),h}const il=hd({blockSize:16,nonceLength:12,tagLength:16,varSizeNonce:!0},function(t,r,i){if(r.length<8)throw new Error("aes/gcm: invalid nonce length");const s=16;function n(a,h,l){const c=xd(Qa,!1,a,l,i);for(let u=0;u<h.length;u++)c[u]^=h[u];return c}function o(){const a=Ed(t),h=Si.slice(),l=Si.slice();if(Ei(a,!1,l,l,h),r.length===12)l.set(r);else{const u=Si.slice();bi(u).setBigUint64(8,BigInt(r.length*8),!1);const _=Qa.create(h).update(r).update(u);_.digestInto(l),_.destroy()}const c=Ei(a,!1,l,Si);return{xk:a,authKey:h,counter:l,tagMask:c}}return{encrypt(a){const{xk:h,authKey:l,counter:c,tagMask:u}=o(),p=new Uint8Array(a.length+s),_=[h,l,c,u];wi(a)||_.push(a=or(a)),Ei(h,!1,c,a,p.subarray(0,a.length));const m=n(l,u,p.subarray(0,p.length-s));return _.push(m),p.set(m,a.length),Pt(..._),p},decrypt(a){const{xk:h,authKey:l,counter:c,tagMask:u}=o(),p=[h,l,u,c];wi(a)||p.push(a=or(a));const _=a.subarray(0,-s),m=a.subarray(-s),g=n(l,u,_);if(p.push(g),!ld(g,m))throw new Error("aes/gcm: invalid ghash tag");const w=Ei(h,!1,c,_);return Pt(...p),w}}});typeof window<"u"&&window.crypto&&!window.crypto.subtle&&(console.warn("[SshTerminal] crypto.subtle unavailable (insecure context). Using polyfill."),window.crypto.subtle={async importKey(e,t,r,i,s){let n;return t instanceof ArrayBuffer?n=new Uint8Array(t):t instanceof Uint8Array?n=new Uint8Array(t):t&&t.buffer?n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):n=new Uint8Array(t),{_raw:n,algorithm:typeof r=="string"?{name:r}:r}},async sign(e,t,r){let i;r instanceof ArrayBuffer?i=new Uint8Array(r):r instanceof Uint8Array?i=r:r&&r.buffer?i=new Uint8Array(r.buffer,r.byteOffset,r.byteLength):i=new Uint8Array(r);const s=$a(sd,t._raw,i);return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)},async encrypt(e,t,r){const i=e.iv instanceof Uint8Array?e.iv:new Uint8Array(e.iv instanceof ArrayBuffer?e.iv:e.iv.buffer||e.iv);let s;r instanceof ArrayBuffer?s=new Uint8Array(r):r instanceof Uint8Array?s=r:r&&r.buffer?s=new Uint8Array(r.buffer,r.byteOffset,r.byteLength):s=new Uint8Array(r);const o=il(t._raw,i).encrypt(s);return o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength)},async decrypt(e,t,r){const i=e.iv instanceof Uint8Array?e.iv:new Uint8Array(e.iv instanceof ArrayBuffer?e.iv:e.iv.buffer||e.iv);let s;r instanceof ArrayBuffer?s=new Uint8Array(r):r instanceof Uint8Array?s=r:r&&r.buffer?s=new Uint8Array(r.buffer,r.byteOffset,r.byteLength):s=new Uint8Array(r);const o=il(t._raw,i).decrypt(s);return o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength)}});function kd(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var sl={exports:{}},Te=sl.exports={},bt,wt;function Es(){throw new Error("setTimeout has not been defined")}function xs(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?bt=setTimeout:bt=Es}catch{bt=Es}try{typeof clearTimeout=="function"?wt=clearTimeout:wt=xs}catch{wt=xs}})();function nl(e){if(bt===setTimeout)return setTimeout(e,0);if((bt===Es||!bt)&&setTimeout)return bt=setTimeout,setTimeout(e,0);try{return bt(e,0)}catch{try{return bt.call(null,e,0)}catch{return bt.call(this,e,0)}}}function Bd(e){if(wt===clearTimeout)return clearTimeout(e);if((wt===xs||!wt)&&clearTimeout)return wt=clearTimeout,clearTimeout(e);try{return wt(e)}catch{try{return wt.call(null,e)}catch{return wt.call(this,e)}}}var Ot=[],Cr=!1,ar,xi=-1;function Rd(){!Cr||!ar||(Cr=!1,ar.length?Ot=ar.concat(Ot):xi=-1,Ot.length&&ol())}function ol(){if(!Cr){var e=nl(Rd);Cr=!0;for(var t=Ot.length;t;){for(ar=Ot,Ot=[];++xi<t;)ar&&ar[xi].run();xi=-1,t=Ot.length}ar=null,Cr=!1,Bd(e)}}Te.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];Ot.push(new al(e,t)),Ot.length===1&&!Cr&&nl(ol)};function al(e,t){this.fun=e,this.array=t}al.prototype.run=function(){this.fun.apply(null,this.array)},Te.title="browser",Te.browser=!0,Te.env={},Te.argv=[],Te.version="",Te.versions={};function It(){}Te.on=It,Te.addListener=It,Te.once=It,Te.off=It,Te.removeListener=It,Te.removeAllListeners=It,Te.emit=It,Te.prependListener=It,Te.prependOnceListener=It,Te.listeners=function(e){return[]},Te.binding=function(e){throw new Error("process.binding is not supported")},Te.cwd=function(){return"/"},Te.chdir=function(e){throw new Error("process.chdir is not supported")},Te.umask=function(){return 0};var Ad=sl.exports;const ae=kd(Ad);async function ll(e,t){const r=await window.crypto.subtle.importKey("raw",e,{name:"HMAC",hash:{name:"SHA-512"}},!1,["sign","verify"]);return window.crypto.subtle.sign(r.algorithm,r,t)}const hl=12,ks=128;function Dd(e){return window.crypto.subtle.importKey("raw",e,{name:"AES-GCM",length:ks},!1,["encrypt","decrypt"])}function Td(e,t,r){return window.crypto.subtle.encrypt({name:"AES-GCM",iv:t,tagLength:ks},e,r)}function Ld(e,t,r){return window.crypto.subtle.decrypt({name:"AES-GCM",iv:t,tagLength:ks},e,r)}function Pd(){return window.crypto.getRandomValues(new Uint8Array(hl))}function cl(e){for(let t=e.length;t>0&&(e[t-1]++,e[t-1]<=0);t--);return e}let ve=class extends Error{constructor(t,r){super(t),this.temporary=r}};const ul=0,fl=1;class Gt{constructor(){this.res=null,this.rej=null,this.pending=[],this.disabled=null}pendings(){return this.pending.length+(this.rej!==null||this.res!==null?1:0)}resolve(t){if(this.res!==null){this.res(t);return}this.pending.push([fl,t])}reject(t){if(this.rej!==null){this.rej(t);return}this.pending.push([ul,t])}subscribe(){if(this.pending.length>0){let r=this.pending.shift();switch(r[0]){case ul:throw r[1];case fl:return r[1];default:throw new ve("Unknown pending type",!1)}}if(this.disabled)throw new ve(this.disabled,!1);let t=this;return new Promise((r,i)=>{t.res=s=>{t.res=null,t.rej=null,r(s)},t.rej=s=>{t.res=null,t.rej=null,i(s)}})}disable(t){this.disabled=t}}let dl=class{constructor(t,r){this.buffer=t,this.used=0,this.onDepleted=r}searchBuffer(t,r){let i=this.remains();i>r&&(i=r);for(let s=0;s<i;s++)if(this.buffer[s+this.used]===t)return s;return-1}indexOf(t){return this.searchBuffer(t,this.remains())}remains(){return this.buffer.length-this.used}buffered(){return this.remains()}export(t){let r=this.remains();if(r<=0)throw new ve("Reader has been depleted",!1);r>t&&(r=t);let i=this.buffer.slice(this.used,this.used+r);return this.used+=i.length,this.remains()<=0&&this.onDepleted(),i}};class Bs{constructor(t){this.reader=null,this.depleted=t,this.subscribe=new Gt,this.closed=!1}feed(t,r){if(this.closed)throw new ve("Reader is closed",!1);if(this.reader===null&&this.subscribe.pendings()<=0){this.reader={reader:t,depleted:r};return}this.subscribe.resolve({reader:t,depleted:r})}searchBuffer(t,r){return this.reader===null?-1:this.reader.reader.searchBuffer(t,r)}indexOf(t){return this.searchBuffer(t,this.buffered())}buffered(){return this.reader==null?0:this.reader.reader.buffered()}close(){return this.closeWithReason("Reader is closed")}closeWithReason(t){this.closed||(this.closed=!0,this.subscribe.reject(new ve(t,!1)),this.subscribe.disable(t))}async export(t){for(;;){if(this.reader!==null){let r=await this.reader.reader.export(t);return this.reader.reader.remains()<=0&&(this.reader.depleted(),this.reader=null),r}this.depleted(this),this.reader=await this.subscribe.subscribe()}}}class Md{constructor(t,r){this.multiple=t,this.buffers=new Gt,this.bufferConverter=r||(i=>i),this.closed=!1}feed(t){if(this.closed)throw new ve("Reader is closed, new data has been deined",!1);this.buffers.resolve(t)}async reader(){if(this.closed)throw new ve("Reader is closed, unable to read",!1);if(this.multiple.buffered()>0)return this.multiple;let t=this,r=await this.bufferConverter(await t.buffers.subscribe());return this.multiple.feed(new dl(r,()=>{}),()=>{}),this.multiple}close(){return this.closeWithReason("Reader is closed")}closeWithReason(t){if(!this.closed)return this.closed=!0,this.buffers.reject(new ve(t,!1)),this.buffers.disable(t),this.multiple.close()}async searchBuffer(t,r){return(await this.reader()).searchBuffer(t,r)}async indexOf(t){return(await this.reader()).indexOf(t)}async buffered(){return(await this.reader()).buffered()}async export(t){return(await this.reader()).export(t)}}async function Nt(e){for(;;){let t=await e.export(1);if(!(t.length<=0))return t}}async function nt(e,t){let r=0,i=new Uint8Array(t);for(;r<t;){let s=await e.export(t-r);i.set(s,r),r+=s.length}return i}class pl{constructor(t,r){this.reader=t,this.remain=r}completed(){return this.remain<=0}searchBuffer(t,r){return this.reader.searchBuffer(t,r>this.remain?this.remain:r)}indexOf(t){return this.reader.searchBuffer(t,this.remain)}remains(){return this.remain}buffered(){let t=this.reader.buffered();return t>this.remain?this.remain:t}async export(t){if(this.completed())throw new ve("Reader already completed",!1);let r=t>this.remain?this.remain:t,i=await this.reader.export(r);return this.remain-=i.length,i}}async function St(e){return await nt(e,e.remains())}async function Od(e,t){let r=await e.indexOf(t),i=await e.buffered();if(r>=0)return{data:await nt(e,r+1),found:!0};if(i<=0){let s=await Nt(e);return{data:s,found:s[0]===t}}return{data:await nt(e,i),found:!1}}let Id=class{constructor(t,r,i,s){this.sender=t,this.maxSegSize=r,this.subscribe=new Gt,this.sendingPoc=this.sending(),this.sendDelay=null,this.bufferFlushDelay=i,this.maxBufferedRequests=s,this.buffer=new Uint8Array(r),this.bufferUsed=0,this.bufferReq=0}setDelay(t){this.bufferFlushDelay=t}async sendData(t,r){try{await this.sender(t);for(let i in r)r[i].resolve()}catch(i){for(let s in r)r[s].reject(i)}}appendBuffer(t){const r=this.buffer.length-this.bufferUsed,i=t.length>r?r:t.length;return this.buffer.set(t.slice(0,i),this.bufferUsed),this.bufferUsed+=i,i}exportBuffer(){const t=this.buffer.slice(0,this.bufferUsed);return this.bufferUsed=0,this.bufferedRequests=0,t}async sending(){let t=[];for(;;){const r=await this.subscribe.subscribe();if(r===!0){if(this.bufferUsed<=0)continue;await this.sendData(this.exportBuffer(),t),t=[];continue}t.push({resolve:r.resolve,reject:r.reject});let i=0;for(;r.data.length>i;){const s=this.appendBuffer(r.data.slice(i,r.data.length));if(this.buffer.length>this.bufferUsed)break;i+=s,await this.sendData(this.exportBuffer(),t),t=[]}}}close(){this.sendDelay!==null&&(clearTimeout(this.sendDelay),this.sendDelay=null),this.buffered=null,this.bufferUsed=0,this.bufferedRequests=0,this.subscribe.reject(new ve("Sender has been cleared",!1)),this.subscribe.disable(),this.sendingPoc.catch(()=>{})}send(t){let r=!1;this.sendDelay!==null&&(clearTimeout(this.sendDelay),this.sendDelay=null,r=!0);const i=this;return new Promise((s,n)=>{if(i.subscribe.resolve({data:t,resolve:s,reject:n}),i.bufferedRequests>=i.maxBufferedRequests){i.bufferedRequests=0,i.subscribe.resolve(!0);return}r&&i.bufferedRequests++,i.sendDelay=setTimeout(()=>{i.sendDelay=null,i.bufferedRequests=0,i.subscribe.resolve(!0)},i.bufferFlushDelay)})}};function Nd(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function Fd(e,t,r){let i=[];for(let s=0;s<e;s++)i.push(Nd(t,r));return i}function Ud(e,t){let r=0,i=[];for(;r<e.length;){let s=e.length-r;if(s<=t)return i.push(e.slice(r,r+s)),i;s=t,i.push(e.slice(r,r+s)),r+=s}}function _l(e){let t=[],r=[];for(let i in e){let s=e.charCodeAt(i);for(;s>255;)r.push(s&255),s>>=8;t.push(s);for(let n=r.length;n>0;n--)t.push(r[n]);r=[]}return new Uint8Array(t)}const ki=0,Bi=64,gl=128,vl=192,ml=0,Hd=1,Wd=2,zd=192,Ri=63,qd=Ri;class lr{constructor(t){this.headerByte=t}type(){return this.headerByte&zd}data(){return this.headerByte&Ri}set(t){if(t>Ri)throw new ve("data must not be greater than 0x3f",!1);this.headerByte|=Ri&t}value(){return this.headerByte}}const yl=8191,jd=7,bl=31;let Ai=class{constructor(t,r){this.headerByte1=t,this.headerByte2=r}marker(){return this.headerByte1>>5}length(){let t=0;return t|=this.headerByte1&bl,t<<=8,t|=this.headerByte2,t}set(t,r){if(t>jd)throw new ve("marker must not be greater than 0x07",!1);if(r>yl)throw new ve("n must not be greater than 0x1fff",!1);this.headerByte1=t<<5|r>>8&bl,this.headerByte2=r&255}buffer(){return new Uint8Array([this.headerByte1,this.headerByte2])}};class Er extends Ai{static maxDataSize(){return 2047}constructor(t,r){super(t,r)}command(){return this.headerByte1>>4}data(){let t=0;return t|=this.headerByte1&7,t<<=8,t|=this.headerByte2&255,t}success(){return(this.headerByte1&8)!=0}set(t,r,i){if(t>15)throw new ve("Command ID must not greater than 0x0f",!1);if(r>Er.maxDataSize())throw new ve("Data must not greater than 0x07ff",!1);let s=r&Er.maxDataSize();i&&(s|=2048),this.headerByte1=0,this.headerByte1|=t<<4,this.headerByte1|=s>>8,this.headerByte2=0,this.headerByte2|=s&255}}function Rs(e){return new lr(e)}class $d{constructor(t,r){this.id=t,this.sender=r,this.closed=!1}send(t,r){if(this.closed)throw new ve("Sender already been closed. No data can be send",!1);let i=new lr(Bi),s=new Ai(0,0),n=new Uint8Array(r.length+3);return i.set(this.id),s.set(t,r.length),n[0]=i.value(),n.set(s.buffer(),1),n.set(r,3),this.sender.send(n)}async sendData(t,r){if(this.closed)throw new ve("Sender already been closed. No data can be send",!1);let i=Ud(r,yl),s=new lr(Bi);s.set(this.id);for(let n in i){let o=new Ai(0,0),a=new Uint8Array(i[n].length+3);o.set(t,i[n].length),a[0]=s.value(),a.set(o.buffer(),1),a.set(i[n],3),await this.sender.send(a)}}signal(t){if(this.closed)throw new ve("Sender already been closed. No signal can be send",!1);let r=new lr(t);return r.set(this.id),this.sender.send(new Uint8Array([r.value()]))}close(){if(this.closed)return;let t=this.signal(gl);return this.closed=!0,t}}class Kd{constructor(t,r,i){this.id=t,this.command=r,this.sender=i}static maxDataLength(){return Er.maxDataSize()}send(t){let r=new lr(Bi),i=new Er(0,0),s=new Uint8Array(t.length+3);return r.set(this.id),i.set(this.command,t.length,!0),s[0]=r.value(),s.set(i.buffer(),1),s.set(t,3),this.sender.send(s)}}class Vd{constructor(t){this.id=t,this.command=null,this.isInitializing=!1,this.isShuttingDown=!1}running(){return this.command!==null}initializing(){return this.isInitializing}clear(){this.command=null,this.isInitializing=!1,this.isShuttingDown=!1}run(t,r,i){if(this.running())throw new ve("Stream already running, cannot accept new commands",!1);return this.isInitializing=!0,this.command=r(new $d(this.id,i)),this.command.run(new Kd(this.id,t,i))}initialize(t){if(!this.running())throw new ve("Cannot initialize a stream that is not running",!1);if(this.isShuttingDown)throw new ve("Cannot initialize a stream that is about to shutdown",!1);if(this.command.initialize(t),!t.success()){this.clear();return}this.isInitializing=!1}tick(t,r){if(!this.running())throw new ve("Cannot tick a stream that is not running",!1);if(this.isShuttingDown)throw new ve("Cannot tick a stream that is about to shutdown",!1);return this.command.tick(t,r)}close(){if(!this.running())throw new ve("Cannot close a stream that is not running",!1);if(this.isShuttingDown)throw new ve("Cannot close a stream that is about to shutdown",!1);this.isShuttingDown=!0,this.command.close()}completed(){if(!this.running())throw new ve("Cannot close a stream that is not running",!1);if(!this.isShuttingDown)throw new ve("Can't complete current stream because Close signal is not received",!1);this.command.completed(),this.clear()}}const wl=-1;class Gd{constructor(t,r){this.stream=t,this.result=r}}class Yd{constructor(t,r,i){this.reader=t,this.sender=r,this.config=i,this.echoTimer=null,this.lastEchoTime=null,this.lastEchoData=null,this.stop=!1,this.streams=[];for(let s=0;s<=qd;s++)this.streams.push(new Vd(s))}async serve(){if(this.echoTimer!==null)throw new ve("Already started",!1);this.echoTimer=setInterval(()=>{this.sendEcho()},this.config.echoInterval),this.stop=!1,this.sendEcho();let t=null;for(;!this.stop&&t===null;)try{await this.tick()}catch(r){r.temporary||(t=r)}if(this.clear(t),t!==null)throw new ve("Streams is closed: "+t,!1)}clear(t){if(!this.stop){this.stop=!0,this.echoTimer!=null&&(clearInterval(this.echoTimer),this.echoTimer=null);for(let r in this.streams)if(this.streams[r].running()){try{this.streams[r].close()}catch{}try{this.streams[r].completed()}catch{}}try{this.sender.close()}catch(r){ae.env.NODE_ENV==="development"&&console.trace(r)}try{this.reader.close()}catch(r){ae.env.NODE_ENV==="development"&&console.trace(r)}this.config.cleared(t)}}pause(){let t=Rs(ki);return t.set(1),this.sender.send(new Uint8Array([t.value(),Hd]))}resume(){let t=Rs(ki);return t.set(1),this.sender.send(new Uint8Array([t.value(),Wd]))}request(t,r){try{for(let i in this.streams)if(!this.streams[i].running())return new Gd(this.streams[i],this.streams[i].run(t,r,this.sender));throw new ve("No stream is currently available",!0)}catch(i){throw new ve("Stream request has failed: "+i,!0)}}sendEcho(){let t=Rs(ki),r=new Uint8Array(Fd(8,0,255));t.set(r.length-1),r[0]=t.value(),r[1]=ml,this.sender.send(r).then(()=>{(this.lastEchoTime!==null||this.lastEchoData!==null)&&(this.lastEchoTime=null,this.lastEchoData=null,this.config.echoUpdater(wl)),this.lastEchoTime=new Date,this.lastEchoData=r.slice(2,r.length)})}async handleControl(t){let r=await Nt(t),i=0,s=null;switch(r[0]){case ml:if(s=await St(t),this.lastEchoTime===null||this.lastEchoData===null||this.lastEchoData.length!==s.length)return;for(let n in this.lastEchoData)if(this.lastEchoData[n]!=s[n]){this.lastEchoTime=null,this.lastEchoData=null,this.config.echoUpdater(wl);return}i=new Date().getTime()-this.lastEchoTime.getTime(),i<0&&(i=0),this.lastEchoTime=null,this.lastEchoData=null,this.config.echoUpdater(i);return}throw await St(t),new ve("Unknown control signal: "+r)}async handleStream(t,r){if(t.data()>=this.streams.length)return;let i=this.streams[t.data()];if(!i.running())throw new ve('Remote is requesting for stream "'+t.data()+'" which is not running',!1);let s=await nt(r,2);if(i.initializing()){let h=new Er(s[0],s[1]);return i.initialize(h)}let n=new Ai(s[0],s[1]),o=new pl(r,n.length()),a=await i.tick(n,o);return await St(o),a}async handleClose(t){if(t.data()>=this.streams.length)return;let r=this.streams[t.data()];if(!r.running())throw new ve('Remote is requesting for stream "'+t.data()+'" to be closed, but the stream is not running',!1);let i=await r.close(),s=new lr(vl);return s.set(t.data()),this.sender.send(new Uint8Array([s.value()])),i}async handleCompleted(t){if(t.data()>=this.streams.length)return;let r=this.streams[t.data()];if(!r.running())throw new ve('Remote is requesting for stream "'+t.data()+'" to be completed, but the stream is not running',!1);return r.completed()}async tick(){let t=await Nt(this.reader),r=new lr(t[0]);switch(r.type()){case ki:return this.handleControl(new pl(this.reader,r.data()));case Bi:return this.handleStream(r,this.reader);case gl:return this.handleClose(r);case vl:return this.handleCompleted(r);default:throw new ve("Unknown header",!1)}}}function Sl(e,t,r){return new Promise((i,s)=>{let n=new XMLHttpRequest;n.addEventListener("readystatechange",()=>{n.readyState===n.DONE&&i(n)}),n.addEventListener("error",o=>{s(o)}),n.addEventListener("timeout",o=>{s(o)}),n.open(e,t,!0);for(let o in r)n.setRequestHeader(o,r[o]);n.send()})}function Xd(e,t){return Sl("GET",e,t)}function Jd(e,t){return Sl("OPTIONS",e,t)}const Cl=200,As=30;class Zd{constructor(t,r,i){this.address=t,this.timeout=r,this.privateKey=i,this.keepAliveTicker=null}connect(t,r){const i=this;return new Promise((s,n)=>{let o=new WebSocket(t.webSocket),a=!1,h=setTimeout(()=>{o.close()},r),l=u=>{if(!a)return clearTimeout(h),a=!0,s(u)},c=u=>{if(!a)return clearTimeout(h),a=!0,n(u)};i.keepAliveTicker||(i.keepAliveTicker=setInterval(()=>{Jd(t.keepAlive,{})},Math.max(i.timeout/2,1e3))),o.addEventListener("open",u=>{l(o)}),o.addEventListener("close",u=>{u.toString=()=>"WebSocket Error ("+u.code+")",c(u),clearInterval(i.keepAliveTicker),i.keepAliveTicker=null}),o.addEventListener("error",u=>{o.close(),clearInterval(i.keepAliveTicker),i.keepAliveTicker=null})})}async buildKeyString(){return this.privateKey.fetch()}async buildKey(){let t=await this.buildKeyString();return await Dd(t)}async dial(t){let r=await this.connect(this.address,this.timeout);try{let i=new Md(new Bs(()=>{}),u=>new Promise(p=>{let _=new FileReader;_.onload=m=>{let g=new Uint8Array(m.target.result);p(g),t.inboundUnpacked(g)},_.readAsArrayBuffer(u)}));r.addEventListener("message",u=>{t.inbound(u.data),i.feed(u.data)}),r.addEventListener("error",u=>{u.toString=()=>"WebSocket Error ("+(u.code?u.code:"Unknown")+")",i.closeWithReason(u)}),r.addEventListener("close",u=>{i.closeWithReason("Connection is closed")});let s=u=>u,n=()=>s,o=new Id(async u=>{try{let p=await n()(u);r.send(p.buffer),t.outbound(p)}catch(p){throw r.close(),i.closeWithReason(p),ae.env.NODE_ENV==="development"&&console.error(p),p}},4032,As,10),a=Pd();o.send(a);let h=await nt(i,hl),l=await this.buildKey();return s=async u=>{let p=await Td(l,a,u);cl(a);let _=new Uint8Array(p.byteLength+2);return _[0]=p.byteLength>>8&255,_[1]=p.byteLength&255,_.set(new Uint8Array(p),2),_},{reader:new Bs(async u=>{try{let p=await nt(i,2),_=0;_=p[0],_<<=8,_|=p[1];let m=await Ld(l,h,await nt(i,_));cl(h),u.feed(new dl(new Uint8Array(m),()=>{}),()=>{})}catch(p){u.closeWithReason(p)}}),sender:o,ws:r}}catch(i){throw r.close(),i}}}class Qd{constructor(t,r,i,s){this.dial=new Zd(t,i,r),this.echoInterval=s,this.streamHandler=null}async get(t){let r=this;if(this.streamHandler)return this.streamHandler;t.connecting();const i=6,s=1024*16;let n=!1,o=0,a=0;const h=()=>o>s&&o>a*i;try{let l=await this.dial.dial({inbound(u){o+=u.size,t.traffic(u.size,0)},inboundUnpacked(u){if(a+=u.length,a>=o&&(a=0,o=0),r.streamHandler!==null){if(n&&!h()){n=!1,r.streamHandler.resume();return}else if(!n&&h()){n=!0,r.streamHandler.pause();return}}},outbound(u){t.traffic(0,u.length)}}),c=new Yd(l.reader,l.sender,{echoInterval:r.echoInterval,echoUpdater(u){const p=u/2;return p>Cl?l.sender.setDelay(Cl):p<As?l.sender.setDelay(As):l.sender.setDelay(p),t.echo(u)},cleared(u){r.streamHandler!==null&&(r.streamHandler=null,l.ws.close(),t.close(u))}});t.connected(),c.serve().catch(u=>{ae.env.NODE_ENV==="development"&&console.trace(u)}),this.streamHandler=c}catch(l){throw t.failed(l),l}return this.streamHandler}}var Oe={},Di={};Di.byteLength=rp,Di.toByteArray=sp,Di.fromByteArray=ap;for(var Ct=[],ct=[],ep=typeof Uint8Array<"u"?Uint8Array:Array,Ds="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",xr=0,tp=Ds.length;xr<tp;++xr)Ct[xr]=Ds[xr],ct[Ds.charCodeAt(xr)]=xr;ct[45]=62,ct[95]=63;function El(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");r===-1&&(r=t);var i=r===t?0:4-r%4;return[r,i]}function rp(e){var t=El(e),r=t[0],i=t[1];return(r+i)*3/4-i}function ip(e,t,r){return(t+r)*3/4-r}function sp(e){var t,r=El(e),i=r[0],s=r[1],n=new ep(ip(e,i,s)),o=0,a=s>0?i-4:i,h;for(h=0;h<a;h+=4)t=ct[e.charCodeAt(h)]<<18|ct[e.charCodeAt(h+1)]<<12|ct[e.charCodeAt(h+2)]<<6|ct[e.charCodeAt(h+3)],n[o++]=t>>16&255,n[o++]=t>>8&255,n[o++]=t&255;return s===2&&(t=ct[e.charCodeAt(h)]<<2|ct[e.charCodeAt(h+1)]>>4,n[o++]=t&255),s===1&&(t=ct[e.charCodeAt(h)]<<10|ct[e.charCodeAt(h+1)]<<4|ct[e.charCodeAt(h+2)]>>2,n[o++]=t>>8&255,n[o++]=t&255),n}function np(e){return Ct[e>>18&63]+Ct[e>>12&63]+Ct[e>>6&63]+Ct[e&63]}function op(e,t,r){for(var i,s=[],n=t;n<r;n+=3)i=(e[n]<<16&16711680)+(e[n+1]<<8&65280)+(e[n+2]&255),s.push(np(i));return s.join("")}function ap(e){for(var t,r=e.length,i=r%3,s=[],n=16383,o=0,a=r-i;o<a;o+=n)s.push(op(e,o,o+n>a?a:o+n));return i===1?(t=e[r-1],s.push(Ct[t>>2]+Ct[t<<4&63]+"==")):i===2&&(t=(e[r-2]<<8)+e[r-1],s.push(Ct[t>>10]+Ct[t>>4&63]+Ct[t<<2&63]+"=")),s.join("")}var Ts={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Ts.read=function(e,t,r,i,s){var n,o,a=s*8-i-1,h=(1<<a)-1,l=h>>1,c=-7,u=r?s-1:0,p=r?-1:1,_=e[t+u];for(u+=p,n=_&(1<<-c)-1,_>>=-c,c+=a;c>0;n=n*256+e[t+u],u+=p,c-=8);for(o=n&(1<<-c)-1,n>>=-c,c+=i;c>0;o=o*256+e[t+u],u+=p,c-=8);if(n===0)n=1-l;else{if(n===h)return o?NaN:(_?-1:1)*(1/0);o=o+Math.pow(2,i),n=n-l}return(_?-1:1)*o*Math.pow(2,n-i)},Ts.write=function(e,t,r,i,s,n){var o,a,h,l=n*8-s-1,c=(1<<l)-1,u=c>>1,p=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,_=i?0:n-1,m=i?1:-1,g=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-o))<1&&(o--,h*=2),o+u>=1?t+=p/h:t+=p*Math.pow(2,1-u),t*h>=2&&(o++,h/=2),o+u>=c?(a=0,o=c):o+u>=1?(a=(t*h-1)*Math.pow(2,s),o=o+u):(a=t*Math.pow(2,u-1)*Math.pow(2,s),o=0));s>=8;e[r+_]=a&255,_+=m,a/=256,s-=8);for(o=o<<s|a,l+=s;l>0;e[r+_]=o&255,_+=m,o/=256,l-=8);e[r+_-m]|=g*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=Di,r=Ts,i=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=c,e.SlowBuffer=k,e.INSPECT_MAX_BYTES=50;const s=2147483647;e.kMaxLength=s;const{Uint8Array:n,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;c.TYPED_ARRAY_SUPPORT=h(),!c.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function h(){try{const b=new n(1),f={foo:function(){return 42}};return Object.setPrototypeOf(f,n.prototype),Object.setPrototypeOf(b,f),b.foo()===42}catch{return!1}}Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}});function l(b){if(b>s)throw new RangeError('The value "'+b+'" is invalid for option "size"');const f=new n(b);return Object.setPrototypeOf(f,c.prototype),f}function c(b,f,d){if(typeof b=="number"){if(typeof f=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(b)}return u(b,f,d)}c.poolSize=8192;function u(b,f,d){if(typeof b=="string")return g(b,f);if(o.isView(b))return y(b);if(b==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof b);if(st(b,o)||b&&st(b.buffer,o)||typeof a<"u"&&(st(b,a)||b&&st(b.buffer,a)))return E(b,f,d);if(typeof b=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const B=b.valueOf&&b.valueOf();if(B!=null&&B!==b)return c.from(B,f,d);const T=S(b);if(T)return T;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof b[Symbol.toPrimitive]=="function")return c.from(b[Symbol.toPrimitive]("string"),f,d);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof b)}c.from=function(b,f,d){return u(b,f,d)},Object.setPrototypeOf(c.prototype,n.prototype),Object.setPrototypeOf(c,n);function p(b){if(typeof b!="number")throw new TypeError('"size" argument must be of type number');if(b<0)throw new RangeError('The value "'+b+'" is invalid for option "size"')}function _(b,f,d){return p(b),b<=0?l(b):f!==void 0?typeof d=="string"?l(b).fill(f,d):l(b).fill(f):l(b)}c.alloc=function(b,f,d){return _(b,f,d)};function m(b){return p(b),l(b<0?0:v(b)|0)}c.allocUnsafe=function(b){return m(b)},c.allocUnsafeSlow=function(b){return m(b)};function g(b,f){if((typeof f!="string"||f==="")&&(f="utf8"),!c.isEncoding(f))throw new TypeError("Unknown encoding: "+f);const d=R(b,f)|0;let B=l(d);const T=B.write(b,f);return T!==d&&(B=B.slice(0,T)),B}function w(b){const f=b.length<0?0:v(b.length)|0,d=l(f);for(let B=0;B<f;B+=1)d[B]=b[B]&255;return d}function y(b){if(st(b,n)){const f=new n(b);return E(f.buffer,f.byteOffset,f.byteLength)}return w(b)}function E(b,f,d){if(f<0||b.byteLength<f)throw new RangeError('"offset" is outside of buffer bounds');if(b.byteLength<f+(d||0))throw new RangeError('"length" is outside of buffer bounds');let B;return f===void 0&&d===void 0?B=new n(b):d===void 0?B=new n(b,f):B=new n(b,f,d),Object.setPrototypeOf(B,c.prototype),B}function S(b){if(c.isBuffer(b)){const f=v(b.length)|0,d=l(f);return d.length===0||b.copy(d,0,0,f),d}if(b.length!==void 0)return typeof b.length!="number"||$t(b.length)?l(0):w(b);if(b.type==="Buffer"&&Array.isArray(b.data))return w(b.data)}function v(b){if(b>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return b|0}function k(b){return+b!=b&&(b=0),c.alloc(+b)}c.isBuffer=function(f){return f!=null&&f._isBuffer===!0&&f!==c.prototype},c.compare=function(f,d){if(st(f,n)&&(f=c.from(f,f.offset,f.byteLength)),st(d,n)&&(d=c.from(d,d.offset,d.byteLength)),!c.isBuffer(f)||!c.isBuffer(d))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(f===d)return 0;let B=f.length,T=d.length;for(let M=0,j=Math.min(B,T);M<j;++M)if(f[M]!==d[M]){B=f[M],T=d[M];break}return B<T?-1:T<B?1:0},c.isEncoding=function(f){switch(String(f).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(f,d){if(!Array.isArray(f))throw new TypeError('"list" argument must be an Array of Buffers');if(f.length===0)return c.alloc(0);let B;if(d===void 0)for(d=0,B=0;B<f.length;++B)d+=f[B].length;const T=c.allocUnsafe(d);let M=0;for(B=0;B<f.length;++B){let j=f[B];if(st(j,n))M+j.length>T.length?(c.isBuffer(j)||(j=c.from(j)),j.copy(T,M)):n.prototype.set.call(T,j,M);else if(c.isBuffer(j))j.copy(T,M);else throw new TypeError('"list" argument must be an Array of Buffers');M+=j.length}return T};function R(b,f){if(c.isBuffer(b))return b.length;if(o.isView(b)||st(b,o))return b.byteLength;if(typeof b!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof b);const d=b.length,B=arguments.length>2&&arguments[2]===!0;if(!B&&d===0)return 0;let T=!1;for(;;)switch(f){case"ascii":case"latin1":case"binary":return d;case"utf8":case"utf-8":return rt(b).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return d*2;case"hex":return d>>>1;case"base64":return mt(b).length;default:if(T)return B?-1:rt(b).length;f=(""+f).toLowerCase(),T=!0}}c.byteLength=R;function O(b,f,d){let B=!1;if((f===void 0||f<0)&&(f=0),f>this.length||((d===void 0||d>this.length)&&(d=this.length),d<=0)||(d>>>=0,f>>>=0,d<=f))return"";for(b||(b="utf8");;)switch(b){case"hex":return L(this,f,d);case"utf8":case"utf-8":return se(this,f,d);case"ascii":return me(this,f,d);case"latin1":case"binary":return ke(this,f,d);case"base64":return ee(this,f,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,f,d);default:if(B)throw new TypeError("Unknown encoding: "+b);b=(b+"").toLowerCase(),B=!0}}c.prototype._isBuffer=!0;function N(b,f,d){const B=b[f];b[f]=b[d],b[d]=B}c.prototype.swap16=function(){const f=this.length;if(f%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let d=0;d<f;d+=2)N(this,d,d+1);return this},c.prototype.swap32=function(){const f=this.length;if(f%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let d=0;d<f;d+=4)N(this,d,d+3),N(this,d+1,d+2);return this},c.prototype.swap64=function(){const f=this.length;if(f%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let d=0;d<f;d+=8)N(this,d,d+7),N(this,d+1,d+6),N(this,d+2,d+5),N(this,d+3,d+4);return this},c.prototype.toString=function(){const f=this.length;return f===0?"":arguments.length===0?se(this,0,f):O.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(f){if(!c.isBuffer(f))throw new TypeError("Argument must be a Buffer");return this===f?!0:c.compare(this,f)===0},c.prototype.inspect=function(){let f="";const d=e.INSPECT_MAX_BYTES;return f=this.toString("hex",0,d).replace(/(.{2})/g,"$1 ").trim(),this.length>d&&(f+=" ... "),"<Buffer "+f+">"},i&&(c.prototype[i]=c.prototype.inspect),c.prototype.compare=function(f,d,B,T,M){if(st(f,n)&&(f=c.from(f,f.offset,f.byteLength)),!c.isBuffer(f))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof f);if(d===void 0&&(d=0),B===void 0&&(B=f?f.length:0),T===void 0&&(T=0),M===void 0&&(M=this.length),d<0||B>f.length||T<0||M>this.length)throw new RangeError("out of range index");if(T>=M&&d>=B)return 0;if(T>=M)return-1;if(d>=B)return 1;if(d>>>=0,B>>>=0,T>>>=0,M>>>=0,this===f)return 0;let j=M-T,ge=B-d;const Ae=Math.min(j,ge),Ce=this.slice(T,M),De=f.slice(d,B);for(let be=0;be<Ae;++be)if(Ce[be]!==De[be]){j=Ce[be],ge=De[be];break}return j<ge?-1:ge<j?1:0};function W(b,f,d,B,T){if(b.length===0)return-1;if(typeof d=="string"?(B=d,d=0):d>2147483647?d=2147483647:d<-2147483648&&(d=-2147483648),d=+d,$t(d)&&(d=T?0:b.length-1),d<0&&(d=b.length+d),d>=b.length){if(T)return-1;d=b.length-1}else if(d<0)if(T)d=0;else return-1;if(typeof f=="string"&&(f=c.from(f,B)),c.isBuffer(f))return f.length===0?-1:Q(b,f,d,B,T);if(typeof f=="number")return f=f&255,typeof n.prototype.indexOf=="function"?T?n.prototype.indexOf.call(b,f,d):n.prototype.lastIndexOf.call(b,f,d):Q(b,[f],d,B,T);throw new TypeError("val must be string, number or Buffer")}function Q(b,f,d,B,T){let M=1,j=b.length,ge=f.length;if(B!==void 0&&(B=String(B).toLowerCase(),B==="ucs2"||B==="ucs-2"||B==="utf16le"||B==="utf-16le")){if(b.length<2||f.length<2)return-1;M=2,j/=2,ge/=2,d/=2}function Ae(De,be){return M===1?De[be]:De.readUInt16BE(be*M)}let Ce;if(T){let De=-1;for(Ce=d;Ce<j;Ce++)if(Ae(b,Ce)===Ae(f,De===-1?0:Ce-De)){if(De===-1&&(De=Ce),Ce-De+1===ge)return De*M}else De!==-1&&(Ce-=Ce-De),De=-1}else for(d+ge>j&&(d=j-ge),Ce=d;Ce>=0;Ce--){let De=!0;for(let be=0;be<ge;be++)if(Ae(b,Ce+be)!==Ae(f,be)){De=!1;break}if(De)return Ce}return-1}c.prototype.includes=function(f,d,B){return this.indexOf(f,d,B)!==-1},c.prototype.indexOf=function(f,d,B){return W(this,f,d,B,!0)},c.prototype.lastIndexOf=function(f,d,B){return W(this,f,d,B,!1)};function ie(b,f,d,B){d=Number(d)||0;const T=b.length-d;B?(B=Number(B),B>T&&(B=T)):B=T;const M=f.length;B>M/2&&(B=M/2);let j;for(j=0;j<B;++j){const ge=parseInt(f.substr(j*2,2),16);if($t(ge))return j;b[d+j]=ge}return j}function K(b,f,d,B){return lt(rt(f,b.length-d),b,d,B)}function H(b,f,d,B){return lt(it(f),b,d,B)}function G(b,f,d,B){return lt(mt(f),b,d,B)}function J(b,f,d,B){return lt(jt(f,b.length-d),b,d,B)}c.prototype.write=function(f,d,B,T){if(d===void 0)T="utf8",B=this.length,d=0;else if(B===void 0&&typeof d=="string")T=d,B=this.length,d=0;else if(isFinite(d))d=d>>>0,isFinite(B)?(B=B>>>0,T===void 0&&(T="utf8")):(T=B,B=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const M=this.length-d;if((B===void 0||B>M)&&(B=M),f.length>0&&(B<0||d<0)||d>this.length)throw new RangeError("Attempt to write outside buffer bounds");T||(T="utf8");let j=!1;for(;;)switch(T){case"hex":return ie(this,f,d,B);case"utf8":case"utf-8":return K(this,f,d,B);case"ascii":case"latin1":case"binary":return H(this,f,d,B);case"base64":return G(this,f,d,B);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return J(this,f,d,B);default:if(j)throw new TypeError("Unknown encoding: "+T);T=(""+T).toLowerCase(),j=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ee(b,f,d){return f===0&&d===b.length?t.fromByteArray(b):t.fromByteArray(b.slice(f,d))}function se(b,f,d){d=Math.min(b.length,d);const B=[];let T=f;for(;T<d;){const M=b[T];let j=null,ge=M>239?4:M>223?3:M>191?2:1;if(T+ge<=d){let Ae,Ce,De,be;switch(ge){case 1:M<128&&(j=M);break;case 2:Ae=b[T+1],(Ae&192)===128&&(be=(M&31)<<6|Ae&63,be>127&&(j=be));break;case 3:Ae=b[T+1],Ce=b[T+2],(Ae&192)===128&&(Ce&192)===128&&(be=(M&15)<<12|(Ae&63)<<6|Ce&63,be>2047&&(be<55296||be>57343)&&(j=be));break;case 4:Ae=b[T+1],Ce=b[T+2],De=b[T+3],(Ae&192)===128&&(Ce&192)===128&&(De&192)===128&&(be=(M&15)<<18|(Ae&63)<<12|(Ce&63)<<6|De&63,be>65535&&be<1114112&&(j=be))}}j===null?(j=65533,ge=1):j>65535&&(j-=65536,B.push(j>>>10&1023|55296),j=56320|j&1023),B.push(j),T+=ge}return le(B)}const Y=4096;function le(b){const f=b.length;if(f<=Y)return String.fromCharCode.apply(String,b);let d="",B=0;for(;B<f;)d+=String.fromCharCode.apply(String,b.slice(B,B+=Y));return d}function me(b,f,d){let B="";d=Math.min(b.length,d);for(let T=f;T<d;++T)B+=String.fromCharCode(b[T]&127);return B}function ke(b,f,d){let B="";d=Math.min(b.length,d);for(let T=f;T<d;++T)B+=String.fromCharCode(b[T]);return B}function L(b,f,d){const B=b.length;(!f||f<0)&&(f=0),(!d||d<0||d>B)&&(d=B);let T="";for(let M=f;M<d;++M)T+=nr[b[M]];return T}function I(b,f,d){const B=b.slice(f,d);let T="";for(let M=0;M<B.length-1;M+=2)T+=String.fromCharCode(B[M]+B[M+1]*256);return T}c.prototype.slice=function(f,d){const B=this.length;f=~~f,d=d===void 0?B:~~d,f<0?(f+=B,f<0&&(f=0)):f>B&&(f=B),d<0?(d+=B,d<0&&(d=0)):d>B&&(d=B),d<f&&(d=f);const T=this.subarray(f,d);return Object.setPrototypeOf(T,c.prototype),T};function U(b,f,d){if(b%1!==0||b<0)throw new RangeError("offset is not uint");if(b+f>d)throw new RangeError("Trying to access beyond buffer length")}c.prototype.readUintLE=c.prototype.readUIntLE=function(f,d,B){f=f>>>0,d=d>>>0,B||U(f,d,this.length);let T=this[f],M=1,j=0;for(;++j<d&&(M*=256);)T+=this[f+j]*M;return T},c.prototype.readUintBE=c.prototype.readUIntBE=function(f,d,B){f=f>>>0,d=d>>>0,B||U(f,d,this.length);let T=this[f+--d],M=1;for(;d>0&&(M*=256);)T+=this[f+--d]*M;return T},c.prototype.readUint8=c.prototype.readUInt8=function(f,d){return f=f>>>0,d||U(f,1,this.length),this[f]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(f,d){return f=f>>>0,d||U(f,2,this.length),this[f]|this[f+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(f,d){return f=f>>>0,d||U(f,2,this.length),this[f]<<8|this[f+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(f,d){return f=f>>>0,d||U(f,4,this.length),(this[f]|this[f+1]<<8|this[f+2]<<16)+this[f+3]*16777216},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(f,d){return f=f>>>0,d||U(f,4,this.length),this[f]*16777216+(this[f+1]<<16|this[f+2]<<8|this[f+3])},c.prototype.readBigUInt64LE=Je(function(f){f=f>>>0,ne(f,"offset");const d=this[f],B=this[f+7];(d===void 0||B===void 0)&&de(f,this.length-8);const T=d+this[++f]*2**8+this[++f]*2**16+this[++f]*2**24,M=this[++f]+this[++f]*2**8+this[++f]*2**16+B*2**24;return BigInt(T)+(BigInt(M)<<BigInt(32))}),c.prototype.readBigUInt64BE=Je(function(f){f=f>>>0,ne(f,"offset");const d=this[f],B=this[f+7];(d===void 0||B===void 0)&&de(f,this.length-8);const T=d*2**24+this[++f]*2**16+this[++f]*2**8+this[++f],M=this[++f]*2**24+this[++f]*2**16+this[++f]*2**8+B;return(BigInt(T)<<BigInt(32))+BigInt(M)}),c.prototype.readIntLE=function(f,d,B){f=f>>>0,d=d>>>0,B||U(f,d,this.length);let T=this[f],M=1,j=0;for(;++j<d&&(M*=256);)T+=this[f+j]*M;return M*=128,T>=M&&(T-=Math.pow(2,8*d)),T},c.prototype.readIntBE=function(f,d,B){f=f>>>0,d=d>>>0,B||U(f,d,this.length);let T=d,M=1,j=this[f+--T];for(;T>0&&(M*=256);)j+=this[f+--T]*M;return M*=128,j>=M&&(j-=Math.pow(2,8*d)),j},c.prototype.readInt8=function(f,d){return f=f>>>0,d||U(f,1,this.length),this[f]&128?(255-this[f]+1)*-1:this[f]},c.prototype.readInt16LE=function(f,d){f=f>>>0,d||U(f,2,this.length);const B=this[f]|this[f+1]<<8;return B&32768?B|4294901760:B},c.prototype.readInt16BE=function(f,d){f=f>>>0,d||U(f,2,this.length);const B=this[f+1]|this[f]<<8;return B&32768?B|4294901760:B},c.prototype.readInt32LE=function(f,d){return f=f>>>0,d||U(f,4,this.length),this[f]|this[f+1]<<8|this[f+2]<<16|this[f+3]<<24},c.prototype.readInt32BE=function(f,d){return f=f>>>0,d||U(f,4,this.length),this[f]<<24|this[f+1]<<16|this[f+2]<<8|this[f+3]},c.prototype.readBigInt64LE=Je(function(f){f=f>>>0,ne(f,"offset");const d=this[f],B=this[f+7];(d===void 0||B===void 0)&&de(f,this.length-8);const T=this[f+4]+this[f+5]*2**8+this[f+6]*2**16+(B<<24);return(BigInt(T)<<BigInt(32))+BigInt(d+this[++f]*2**8+this[++f]*2**16+this[++f]*2**24)}),c.prototype.readBigInt64BE=Je(function(f){f=f>>>0,ne(f,"offset");const d=this[f],B=this[f+7];(d===void 0||B===void 0)&&de(f,this.length-8);const T=(d<<24)+this[++f]*2**16+this[++f]*2**8+this[++f];return(BigInt(T)<<BigInt(32))+BigInt(this[++f]*2**24+this[++f]*2**16+this[++f]*2**8+B)}),c.prototype.readFloatLE=function(f,d){return f=f>>>0,d||U(f,4,this.length),r.read(this,f,!0,23,4)},c.prototype.readFloatBE=function(f,d){return f=f>>>0,d||U(f,4,this.length),r.read(this,f,!1,23,4)},c.prototype.readDoubleLE=function(f,d){return f=f>>>0,d||U(f,8,this.length),r.read(this,f,!0,52,8)},c.prototype.readDoubleBE=function(f,d){return f=f>>>0,d||U(f,8,this.length),r.read(this,f,!1,52,8)};function te(b,f,d,B,T,M){if(!c.isBuffer(b))throw new TypeError('"buffer" argument must be a Buffer instance');if(f>T||f<M)throw new RangeError('"value" argument is out of bounds');if(d+B>b.length)throw new RangeError("Index out of range")}c.prototype.writeUintLE=c.prototype.writeUIntLE=function(f,d,B,T){if(f=+f,d=d>>>0,B=B>>>0,!T){const ge=Math.pow(2,8*B)-1;te(this,f,d,B,ge,0)}let M=1,j=0;for(this[d]=f&255;++j<B&&(M*=256);)this[d+j]=f/M&255;return d+B},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(f,d,B,T){if(f=+f,d=d>>>0,B=B>>>0,!T){const ge=Math.pow(2,8*B)-1;te(this,f,d,B,ge,0)}let M=B-1,j=1;for(this[d+M]=f&255;--M>=0&&(j*=256);)this[d+M]=f/j&255;return d+B},c.prototype.writeUint8=c.prototype.writeUInt8=function(f,d,B){return f=+f,d=d>>>0,B||te(this,f,d,1,255,0),this[d]=f&255,d+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(f,d,B){return f=+f,d=d>>>0,B||te(this,f,d,2,65535,0),this[d]=f&255,this[d+1]=f>>>8,d+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(f,d,B){return f=+f,d=d>>>0,B||te(this,f,d,2,65535,0),this[d]=f>>>8,this[d+1]=f&255,d+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(f,d,B){return f=+f,d=d>>>0,B||te(this,f,d,4,4294967295,0),this[d+3]=f>>>24,this[d+2]=f>>>16,this[d+1]=f>>>8,this[d]=f&255,d+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(f,d,B){return f=+f,d=d>>>0,B||te(this,f,d,4,4294967295,0),this[d]=f>>>24,this[d+1]=f>>>16,this[d+2]=f>>>8,this[d+3]=f&255,d+4};function A(b,f,d,B,T){_e(f,B,T,b,d,7);let M=Number(f&BigInt(4294967295));b[d++]=M,M=M>>8,b[d++]=M,M=M>>8,b[d++]=M,M=M>>8,b[d++]=M;let j=Number(f>>BigInt(32)&BigInt(4294967295));return b[d++]=j,j=j>>8,b[d++]=j,j=j>>8,b[d++]=j,j=j>>8,b[d++]=j,d}function D(b,f,d,B,T){_e(f,B,T,b,d,7);let M=Number(f&BigInt(4294967295));b[d+7]=M,M=M>>8,b[d+6]=M,M=M>>8,b[d+5]=M,M=M>>8,b[d+4]=M;let j=Number(f>>BigInt(32)&BigInt(4294967295));return b[d+3]=j,j=j>>8,b[d+2]=j,j=j>>8,b[d+1]=j,j=j>>8,b[d]=j,d+8}c.prototype.writeBigUInt64LE=Je(function(f,d=0){return A(this,f,d,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeBigUInt64BE=Je(function(f,d=0){return D(this,f,d,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeIntLE=function(f,d,B,T){if(f=+f,d=d>>>0,!T){const Ae=Math.pow(2,8*B-1);te(this,f,d,B,Ae-1,-Ae)}let M=0,j=1,ge=0;for(this[d]=f&255;++M<B&&(j*=256);)f<0&&ge===0&&this[d+M-1]!==0&&(ge=1),this[d+M]=(f/j>>0)-ge&255;return d+B},c.prototype.writeIntBE=function(f,d,B,T){if(f=+f,d=d>>>0,!T){const Ae=Math.pow(2,8*B-1);te(this,f,d,B,Ae-1,-Ae)}let M=B-1,j=1,ge=0;for(this[d+M]=f&255;--M>=0&&(j*=256);)f<0&&ge===0&&this[d+M+1]!==0&&(ge=1),this[d+M]=(f/j>>0)-ge&255;return d+B},c.prototype.writeInt8=function(f,d,B){return f=+f,d=d>>>0,B||te(this,f,d,1,127,-128),f<0&&(f=255+f+1),this[d]=f&255,d+1},c.prototype.writeInt16LE=function(f,d,B){return f=+f,d=d>>>0,B||te(this,f,d,2,32767,-32768),this[d]=f&255,this[d+1]=f>>>8,d+2},c.prototype.writeInt16BE=function(f,d,B){return f=+f,d=d>>>0,B||te(this,f,d,2,32767,-32768),this[d]=f>>>8,this[d+1]=f&255,d+2},c.prototype.writeInt32LE=function(f,d,B){return f=+f,d=d>>>0,B||te(this,f,d,4,2147483647,-2147483648),this[d]=f&255,this[d+1]=f>>>8,this[d+2]=f>>>16,this[d+3]=f>>>24,d+4},c.prototype.writeInt32BE=function(f,d,B){return f=+f,d=d>>>0,B||te(this,f,d,4,2147483647,-2147483648),f<0&&(f=4294967295+f+1),this[d]=f>>>24,this[d+1]=f>>>16,this[d+2]=f>>>8,this[d+3]=f&255,d+4},c.prototype.writeBigInt64LE=Je(function(f,d=0){return A(this,f,d,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeBigInt64BE=Je(function(f,d=0){return D(this,f,d,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function F(b,f,d,B,T,M){if(d+B>b.length)throw new RangeError("Index out of range");if(d<0)throw new RangeError("Index out of range")}function $(b,f,d,B,T){return f=+f,d=d>>>0,T||F(b,f,d,4),r.write(b,f,d,B,23,4),d+4}c.prototype.writeFloatLE=function(f,d,B){return $(this,f,d,!0,B)},c.prototype.writeFloatBE=function(f,d,B){return $(this,f,d,!1,B)};function V(b,f,d,B,T){return f=+f,d=d>>>0,T||F(b,f,d,8),r.write(b,f,d,B,52,8),d+8}c.prototype.writeDoubleLE=function(f,d,B){return V(this,f,d,!0,B)},c.prototype.writeDoubleBE=function(f,d,B){return V(this,f,d,!1,B)},c.prototype.copy=function(f,d,B,T){if(!c.isBuffer(f))throw new TypeError("argument should be a Buffer");if(B||(B=0),!T&&T!==0&&(T=this.length),d>=f.length&&(d=f.length),d||(d=0),T>0&&T<B&&(T=B),T===B||f.length===0||this.length===0)return 0;if(d<0)throw new RangeError("targetStart out of bounds");if(B<0||B>=this.length)throw new RangeError("Index out of range");if(T<0)throw new RangeError("sourceEnd out of bounds");T>this.length&&(T=this.length),f.length-d<T-B&&(T=f.length-d+B);const M=T-B;return this===f&&typeof n.prototype.copyWithin=="function"?this.copyWithin(d,B,T):n.prototype.set.call(f,this.subarray(B,T),d),M},c.prototype.fill=function(f,d,B,T){if(typeof f=="string"){if(typeof d=="string"?(T=d,d=0,B=this.length):typeof B=="string"&&(T=B,B=this.length),T!==void 0&&typeof T!="string")throw new TypeError("encoding must be a string");if(typeof T=="string"&&!c.isEncoding(T))throw new TypeError("Unknown encoding: "+T);if(f.length===1){const j=f.charCodeAt(0);(T==="utf8"&&j<128||T==="latin1")&&(f=j)}}else typeof f=="number"?f=f&255:typeof f=="boolean"&&(f=Number(f));if(d<0||this.length<d||this.length<B)throw new RangeError("Out of range index");if(B<=d)return this;d=d>>>0,B=B===void 0?this.length:B>>>0,f||(f=0);let M;if(typeof f=="number")for(M=d;M<B;++M)this[M]=f;else{const j=c.isBuffer(f)?f:c.from(f,T),ge=j.length;if(ge===0)throw new TypeError('The value "'+f+'" is invalid for argument "value"');for(M=0;M<B-d;++M)this[M+d]=j[M%ge]}return this};const C={};function x(b,f,d){C[b]=class extends d{constructor(){super(),Object.defineProperty(this,"message",{value:f.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${b}]`,this.stack,delete this.name}get code(){return b}set code(T){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:T,writable:!0})}toString(){return`${this.name} [${b}]: ${this.message}`}}}x("ERR_BUFFER_OUT_OF_BOUNDS",function(b){return b?`${b} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),x("ERR_INVALID_ARG_TYPE",function(b,f){return`The "${b}" argument must be of type number. Received type ${typeof f}`},TypeError),x("ERR_OUT_OF_RANGE",function(b,f,d){let B=`The value of "${b}" is out of range.`,T=d;return Number.isInteger(d)&&Math.abs(d)>2**32?T=P(String(d)):typeof d=="bigint"&&(T=String(d),(d>BigInt(2)**BigInt(32)||d<-(BigInt(2)**BigInt(32)))&&(T=P(T)),T+="n"),B+=` It must be ${f}. Received ${T}`,B},RangeError);function P(b){let f="",d=b.length;const B=b[0]==="-"?1:0;for(;d>=B+4;d-=3)f=`_${b.slice(d-3,d)}${f}`;return`${b.slice(0,d)}${f}`}function X(b,f,d){ne(f,"offset"),(b[f]===void 0||b[f+d]===void 0)&&de(f,b.length-(d+1))}function _e(b,f,d,B,T,M){if(b>d||b<f){const j=typeof f=="bigint"?"n":"";let ge;throw f===0||f===BigInt(0)?ge=`>= 0${j} and < 2${j} ** ${(M+1)*8}${j}`:ge=`>= -(2${j} ** ${(M+1)*8-1}${j}) and < 2 ** ${(M+1)*8-1}${j}`,new C.ERR_OUT_OF_RANGE("value",ge,b)}X(B,T,M)}function ne(b,f){if(typeof b!="number")throw new C.ERR_INVALID_ARG_TYPE(f,"number",b)}function de(b,f,d){throw Math.floor(b)!==b?(ne(b,d),new C.ERR_OUT_OF_RANGE("offset","an integer",b)):f<0?new C.ERR_BUFFER_OUT_OF_BOUNDS:new C.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${f}`,b)}const tt=/[^+/0-9A-Za-z-_]/g;function z(b){if(b=b.split("=")[0],b=b.trim().replace(tt,""),b.length<2)return"";for(;b.length%4!==0;)b=b+"=";return b}function rt(b,f){f=f||1/0;let d;const B=b.length;let T=null;const M=[];for(let j=0;j<B;++j){if(d=b.charCodeAt(j),d>55295&&d<57344){if(!T){if(d>56319){(f-=3)>-1&&M.push(239,191,189);continue}else if(j+1===B){(f-=3)>-1&&M.push(239,191,189);continue}T=d;continue}if(d<56320){(f-=3)>-1&&M.push(239,191,189),T=d;continue}d=(T-55296<<10|d-56320)+65536}else T&&(f-=3)>-1&&M.push(239,191,189);if(T=null,d<128){if((f-=1)<0)break;M.push(d)}else if(d<2048){if((f-=2)<0)break;M.push(d>>6|192,d&63|128)}else if(d<65536){if((f-=3)<0)break;M.push(d>>12|224,d>>6&63|128,d&63|128)}else if(d<1114112){if((f-=4)<0)break;M.push(d>>18|240,d>>12&63|128,d>>6&63|128,d&63|128)}else throw new Error("Invalid code point")}return M}function it(b){const f=[];for(let d=0;d<b.length;++d)f.push(b.charCodeAt(d)&255);return f}function jt(b,f){let d,B,T;const M=[];for(let j=0;j<b.length&&!((f-=2)<0);++j)d=b.charCodeAt(j),B=d>>8,T=d%256,M.push(T),M.push(B);return M}function mt(b){return t.toByteArray(z(b))}function lt(b,f,d,B){let T;for(T=0;T<B&&!(T+d>=f.length||T>=b.length);++T)f[T+d]=b[T];return T}function st(b,f){return b instanceof f||b!=null&&b.constructor!=null&&b.constructor.name!=null&&b.constructor.name===f.name}function $t(b){return b!==b}const nr=function(){const b="0123456789abcdef",f=new Array(256);for(let d=0;d<16;++d){const B=d*16;for(let T=0;T<16;++T)f[B+T]=b[d]+b[T]}return f}();function Je(b){return typeof BigInt>"u"?Am:b}function Am(){throw new Error("BigInt not supported")}})(Oe);const lp=Oe.Buffer,hp=Oe.Blob,cp=Oe.BlobOptions,xl=Oe.Buffer,up=Oe.File,fp=Oe.FileOptions,dp=Oe.INSPECT_MAX_BYTES,pp=Oe.SlowBuffer,_p=Oe.TranscodeEncoding,gp=Oe.atob,vp=Oe.btoa,mp=Oe.constants,yp=Oe.isAscii,bp=Oe.isUtf8,wp=Oe.kMaxLength,Sp=Oe.kStringMaxLength,Cp=Oe.resolveObjectURL,Ep=Oe.transcode,xp=Object.freeze(Object.defineProperty({__proto__:null,Blob:hp,BlobOptions:cp,Buffer:xl,File:up,FileOptions:fp,INSPECT_MAX_BYTES:dp,SlowBuffer:pp,TranscodeEncoding:_p,atob:gp,btoa:vp,constants:mp,default:lp,isAscii:yp,isUtf8:bp,kMaxLength:wp,kStringMaxLength:Sp,resolveObjectURL:Cp,transcode:Ep},Symbol.toStringTag,{value:"Module"}));var Yt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function kp(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(r,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}),r}var Ls={exports:{}};const zr=kp(xp);var Ti=zr,kr=Ti.Buffer,ut={},ft;for(ft in Ti)Ti.hasOwnProperty(ft)&&(ft==="SlowBuffer"||ft==="Buffer"||(ut[ft]=Ti[ft]));var Br=ut.Buffer={};for(ft in kr)kr.hasOwnProperty(ft)&&(ft==="allocUnsafe"||ft==="allocUnsafeSlow"||(Br[ft]=kr[ft]));if(ut.Buffer.prototype=kr.prototype,(!Br.from||Br.from===Uint8Array.from)&&(Br.from=function(e,t,r){if(typeof e=="number")throw new TypeError('The "value" argument must not be of type number. Received type '+typeof e);if(e&&typeof e.length>"u")throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);return kr(e,t,r)}),Br.alloc||(Br.alloc=function(e,t,r){if(typeof e!="number")throw new TypeError('The "size" argument must be of type number. Received type '+typeof e);if(e<0||e>=2*(1<<30))throw new RangeError('The value "'+e+'" is invalid for option "size"');var i=kr(e);return!t||t.length===0?i.fill(0):typeof r=="string"?i.fill(t,r):i.fill(t),i}),!ut.kStringMaxLength)try{ut.kStringMaxLength=ae.binding("buffer").kStringMaxLength}catch{}ut.constants||(ut.constants={MAX_LENGTH:ut.kMaxLength},ut.kStringMaxLength&&(ut.constants.MAX_STRING_LENGTH=ut.kStringMaxLength));var Xt=ut,Ps={},kl="\uFEFF";Ps.PrependBOM=Ms;function Ms(e,t){this.encoder=e,this.addBOM=!0}Ms.prototype.write=function(e){return this.addBOM&&(e=kl+e,this.addBOM=!1),this.encoder.write(e)},Ms.prototype.end=function(){return this.encoder.end()},Ps.StripBOM=Os;function Os(e,t){this.decoder=e,this.pass=!1,this.options=t||{}}Os.prototype.write=function(e){var t=this.decoder.write(e);return this.pass||!t||(t[0]===kl&&(t=t.slice(1),typeof this.options.stripBOM=="function"&&this.options.stripBOM()),this.pass=!0),t},Os.prototype.end=function(){return this.decoder.end()};var Bp=typeof Object.hasOwn>"u"?Function.call.bind(Object.prototype.hasOwnProperty):Object.hasOwn;function Rp(e,t){for(var r in t)Bp(t,r)&&(e[r]=t[r])}var Bl=Rp,Is={},Ns={},Li={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var Rl;function Ap(){return Rl||(Rl=1,function(e,t){var r=zr,i=r.Buffer;function s(o,a){for(var h in o)a[h]=o[h]}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(s(r,t),t.Buffer=n);function n(o,a,h){return i(o,a,h)}n.prototype=Object.create(i.prototype),s(i,n),n.from=function(o,a,h){if(typeof o=="number")throw new TypeError("Argument must not be a number");return i(o,a,h)},n.alloc=function(o,a,h){if(typeof o!="number")throw new TypeError("Argument must be a number");var l=i(o);return a!==void 0?typeof h=="string"?l.fill(a,h):l.fill(a):l.fill(0),l},n.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return i(o)},n.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return r.SlowBuffer(o)}}(Li,Li.exports)),Li.exports}var Al;function Fs(){if(Al)return Ns;Al=1;var e=Ap().Buffer,t=e.isEncoding||function(y){switch(y=""+y,y&&y.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function r(y){if(!y)return"utf8";for(var E;;)switch(y){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return y;default:if(E)return;y=(""+y).toLowerCase(),E=!0}}function i(y){var E=r(y);if(typeof E!="string"&&(e.isEncoding===t||!t(y)))throw new Error("Unknown encoding: "+y);return E||y}Ns.StringDecoder=s;function s(y){this.encoding=i(y);var E;switch(this.encoding){case"utf16le":this.text=u,this.end=p,E=4;break;case"utf8":this.fillLast=h,E=4;break;case"base64":this.text=_,this.end=m,E=3;break;default:this.write=g,this.end=w;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=e.allocUnsafe(E)}s.prototype.write=function(y){if(y.length===0)return"";var E,S;if(this.lastNeed){if(E=this.fillLast(y),E===void 0)return"";S=this.lastNeed,this.lastNeed=0}else S=0;return S<y.length?E?E+this.text(y,S):this.text(y,S):E||""},s.prototype.end=c,s.prototype.text=l,s.prototype.fillLast=function(y){if(this.lastNeed<=y.length)return y.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);y.copy(this.lastChar,this.lastTotal-this.lastNeed,0,y.length),this.lastNeed-=y.length};function n(y){return y<=127?0:y>>5===6?2:y>>4===14?3:y>>3===30?4:y>>6===2?-1:-2}function o(y,E,S){var v=E.length-1;if(v<S)return 0;var k=n(E[v]);return k>=0?(k>0&&(y.lastNeed=k-1),k):--v<S||k===-2?0:(k=n(E[v]),k>=0?(k>0&&(y.lastNeed=k-2),k):--v<S||k===-2?0:(k=n(E[v]),k>=0?(k>0&&(k===2?k=0:y.lastNeed=k-3),k):0))}function a(y,E,S){if((E[0]&192)!==128)return y.lastNeed=0,"";if(y.lastNeed>1&&E.length>1){if((E[1]&192)!==128)return y.lastNeed=1,"";if(y.lastNeed>2&&E.length>2&&(E[2]&192)!==128)return y.lastNeed=2,""}}function h(y){var E=this.lastTotal-this.lastNeed,S=a(this,y);if(S!==void 0)return S;if(this.lastNeed<=y.length)return y.copy(this.lastChar,E,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);y.copy(this.lastChar,E,0,y.length),this.lastNeed-=y.length}function l(y,E){var S=o(this,y,E);if(!this.lastNeed)return y.toString("utf8",E);this.lastTotal=S;var v=y.length-(S-this.lastNeed);return y.copy(this.lastChar,0,v),y.toString("utf8",E,v)}function c(y){var E=y&&y.length?this.write(y):"";return this.lastNeed?E+"":E}function u(y,E){if((y.length-E)%2===0){var S=y.toString("utf16le",E);if(S){var v=S.charCodeAt(S.length-1);if(v>=55296&&v<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=y[y.length-2],this.lastChar[1]=y[y.length-1],S.slice(0,-1)}return S}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=y[y.length-1],y.toString("utf16le",E,y.length-1)}function p(y){var E=y&&y.length?this.write(y):"";if(this.lastNeed){var S=this.lastTotal-this.lastNeed;return E+this.lastChar.toString("utf16le",0,S)}return E}function _(y,E){var S=(y.length-E)%3;return S===0?y.toString("base64",E):(this.lastNeed=3-S,this.lastTotal=3,S===1?this.lastChar[0]=y[y.length-1]:(this.lastChar[0]=y[y.length-2],this.lastChar[1]=y[y.length-1]),y.toString("base64",E,y.length-S))}function m(y){var E=y&&y.length?this.write(y):"";return this.lastNeed?E+this.lastChar.toString("base64",0,3-this.lastNeed):E}function g(y){return y.toString(this.encoding)}function w(y){return y&&y.length?this.write(y):""}return Ns}var Us,Dl;function Dp(){if(Dl)return Us;Dl=1;var e=Xt.Buffer;Us={utf8:{type:"_internal",bomAware:!0},cesu8:{type:"_internal",bomAware:!0},unicode11utf8:"utf8",ucs2:{type:"_internal",bomAware:!0},utf16le:"ucs2",binary:{type:"_internal"},base64:{type:"_internal"},hex:{type:"_internal"},_internal:t};function t(l,c){this.enc=l.encodingName,this.bomAware=l.bomAware,this.enc==="base64"?this.encoder=n:this.enc==="utf8"?this.encoder=h:this.enc==="cesu8"&&(this.enc="utf8",this.encoder=o,e.from("eda0bdedb2a9","hex").toString()!==""&&(this.decoder=a,this.defaultCharUnicode=c.defaultCharUnicode))}t.prototype.encoder=s,t.prototype.decoder=i;var r=Fs().StringDecoder;function i(l,c){this.decoder=new r(c.enc)}i.prototype.write=function(l){return e.isBuffer(l)||(l=e.from(l)),this.decoder.write(l)},i.prototype.end=function(){return this.decoder.end()};function s(l,c){this.enc=c.enc}s.prototype.write=function(l){return e.from(l,this.enc)},s.prototype.end=function(){};function n(l,c){this.prevStr=""}n.prototype.write=function(l){l=this.prevStr+l;var c=l.length-l.length%4;return this.prevStr=l.slice(c),l=l.slice(0,c),e.from(l,"base64")},n.prototype.end=function(){return e.from(this.prevStr,"base64")};function o(l,c){}o.prototype.write=function(l){for(var c=e.alloc(l.length*3),u=0,p=0;p<l.length;p++){var _=l.charCodeAt(p);_<128?c[u++]=_:_<2048?(c[u++]=192+(_>>>6),c[u++]=128+(_&63)):(c[u++]=224+(_>>>12),c[u++]=128+(_>>>6&63),c[u++]=128+(_&63))}return c.slice(0,u)},o.prototype.end=function(){};function a(l,c){this.acc=0,this.contBytes=0,this.accBytes=0,this.defaultCharUnicode=c.defaultCharUnicode}a.prototype.write=function(l){for(var c=this.acc,u=this.contBytes,p=this.accBytes,_="",m=0;m<l.length;m++){var g=l[m];(g&192)!==128?(u>0&&(_+=this.defaultCharUnicode,u=0),g<128?_+=String.fromCharCode(g):g<224?(c=g&31,u=1,p=1):g<240?(c=g&15,u=2,p=1):_+=this.defaultCharUnicode):u>0?(c=c<<6|g&63,u--,p++,u===0&&(p===2&&c<128&&c>0?_+=this.defaultCharUnicode:p===3&&c<2048?_+=this.defaultCharUnicode:_+=String.fromCharCode(c))):_+=this.defaultCharUnicode}return this.acc=c,this.contBytes=u,this.accBytes=p,_},a.prototype.end=function(){var l=0;return this.contBytes>0&&(l+=this.defaultCharUnicode),l};function h(l,c){this.highSurrogate=""}return h.prototype.write=function(l){if(this.highSurrogate&&(l=this.highSurrogate+l,this.highSurrogate=""),l.length>0){var c=l.charCodeAt(l.length-1);c>=55296&&c<56320&&(this.highSurrogate=l[l.length-1],l=l.slice(0,l.length-1))}return e.from(l,this.enc)},h.prototype.end=function(){if(this.highSurrogate){var l=this.highSurrogate;return this.highSurrogate="",e.from(l,this.enc)}},Us}var Ft={},Tl;function Tp(){if(Tl)return Ft;Tl=1;var e=Xt.Buffer;Ft._utf32=t;function t(l,c){this.iconv=c,this.bomAware=!0,this.isLE=l.isLE}Ft.utf32le={type:"_utf32",isLE:!0},Ft.utf32be={type:"_utf32",isLE:!1},Ft.ucs4le="utf32le",Ft.ucs4be="utf32be",t.prototype.encoder=r,t.prototype.decoder=i;function r(l,c){this.isLE=c.isLE,this.highSurrogate=0}r.prototype.write=function(l){for(var c=e.from(l,"ucs2"),u=e.alloc(c.length*2),p=this.isLE?u.writeUInt32LE:u.writeUInt32BE,_=0,m=0;m<c.length;m+=2){var g=c.readUInt16LE(m),w=g>=55296&&g<56320,y=g>=56320&&g<57344;if(this.highSurrogate)if(w||!y)p.call(u,this.highSurrogate,_),_+=4;else{var E=(this.highSurrogate-55296<<10|g-56320)+65536;p.call(u,E,_),_+=4,this.highSurrogate=0;continue}w?this.highSurrogate=g:(p.call(u,g,_),_+=4,this.highSurrogate=0)}return _<u.length&&(u=u.slice(0,_)),u},r.prototype.end=function(){if(this.highSurrogate){var l=e.alloc(4);return this.isLE?l.writeUInt32LE(this.highSurrogate,0):l.writeUInt32BE(this.highSurrogate,0),this.highSurrogate=0,l}};function i(l,c){this.isLE=c.isLE,this.badChar=c.iconv.defaultCharUnicode.charCodeAt(0),this.overflow=[]}i.prototype.write=function(l){if(l.length===0)return"";var c=0,u=0,p=e.alloc(l.length+4),_=0,m=this.isLE,g=this.overflow,w=this.badChar;if(g.length>0){for(;c<l.length&&g.length<4;c++)g.push(l[c]);g.length===4&&(m?u=g[c]|g[c+1]<<8|g[c+2]<<16|g[c+3]<<24:u=g[c+3]|g[c+2]<<8|g[c+1]<<16|g[c]<<24,g.length=0,_=s(p,_,u,w))}for(;c<l.length-3;c+=4)m?u=l[c]|l[c+1]<<8|l[c+2]<<16|l[c+3]<<24:u=l[c+3]|l[c+2]<<8|l[c+1]<<16|l[c]<<24,_=s(p,_,u,w);for(;c<l.length;c++)g.push(l[c]);return p.slice(0,_).toString("ucs2")};function s(l,c,u,p){if((u<0||u>1114111)&&(u=p),u>=65536){u-=65536;var _=55296|u>>10;l[c++]=_&255,l[c++]=_>>8;var u=56320|u&1023}return l[c++]=u&255,l[c++]=u>>8,c}i.prototype.end=function(){this.overflow.length=0},Ft.utf32=n,Ft.ucs4="utf32";function n(l,c){this.iconv=c}n.prototype.encoder=o,n.prototype.decoder=a;function o(l,c){l=l||{},l.addBOM===void 0&&(l.addBOM=!0),this.encoder=c.iconv.getEncoder(l.defaultEncoding||"utf-32le",l)}o.prototype.write=function(l){return this.encoder.write(l)},o.prototype.end=function(){return this.encoder.end()};function a(l,c){this.decoder=null,this.initialBufs=[],this.initialBufsLen=0,this.options=l||{},this.iconv=c.iconv}a.prototype.write=function(l){if(!this.decoder){if(this.initialBufs.push(l),this.initialBufsLen+=l.length,this.initialBufsLen<32)return"";var c=h(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(c,this.options);for(var u="",p=0;p<this.initialBufs.length;p++)u+=this.decoder.write(this.initialBufs[p]);return this.initialBufs.length=this.initialBufsLen=0,u}return this.decoder.write(l)},a.prototype.end=function(){if(!this.decoder){var l=h(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(l,this.options);for(var c="",u=0;u<this.initialBufs.length;u++)c+=this.decoder.write(this.initialBufs[u]);var p=this.decoder.end();return p&&(c+=p),this.initialBufs.length=this.initialBufsLen=0,c}return this.decoder.end()};function h(l,c){var u=[],p=0,_=0,m=0,g=0,w=0;e:for(var y=0;y<l.length;y++)for(var E=l[y],S=0;S<E.length;S++)if(u.push(E[S]),u.length===4){if(p===0){if(u[0]===255&&u[1]===254&&u[2]===0&&u[3]===0)return"utf-32le";if(u[0]===0&&u[1]===0&&u[2]===254&&u[3]===255)return"utf-32be"}if((u[0]!==0||u[1]>16)&&m++,(u[3]!==0||u[2]>16)&&_++,u[0]===0&&u[1]===0&&(u[2]!==0||u[3]!==0)&&w++,(u[0]!==0||u[1]!==0)&&u[2]===0&&u[3]===0&&g++,u.length=0,p++,p>=100)break e}return w-m>g-_?"utf-32be":w-m<g-_?"utf-32le":c||"utf-32le"}return Ft}var Pi={},Ll;function Lp(){if(Ll)return Pi;Ll=1;var e=Xt.Buffer;Pi.utf16be=t;function t(){}t.prototype.encoder=r,t.prototype.decoder=i,t.prototype.bomAware=!0;function r(){}r.prototype.write=function(h){for(var l=e.from(h,"ucs2"),c=0;c<l.length;c+=2){var u=l[c];l[c]=l[c+1],l[c+1]=u}return l},r.prototype.end=function(){};function i(){this.overflowByte=-1}i.prototype.write=function(h){if(h.length==0)return"";var l=e.alloc(h.length+1),c=0,u=0;for(this.overflowByte!==-1&&(l[0]=h[0],l[1]=this.overflowByte,c=1,u=2);c<h.length-1;c+=2,u+=2)l[u]=h[c+1],l[u+1]=h[c];return this.overflowByte=c==h.length-1?h[h.length-1]:-1,l.slice(0,u).toString("ucs2")},i.prototype.end=function(){this.overflowByte=-1},Pi.utf16=s;function s(h,l){this.iconv=l}s.prototype.encoder=n,s.prototype.decoder=o;function n(h,l){h=h||{},h.addBOM===void 0&&(h.addBOM=!0),this.encoder=l.iconv.getEncoder("utf-16le",h)}n.prototype.write=function(h){return this.encoder.write(h)},n.prototype.end=function(){return this.encoder.end()};function o(h,l){this.decoder=null,this.initialBufs=[],this.initialBufsLen=0,this.options=h||{},this.iconv=l.iconv}o.prototype.write=function(h){if(!this.decoder){if(this.initialBufs.push(h),this.initialBufsLen+=h.length,this.initialBufsLen<16)return"";var l=a(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(l,this.options);for(var c="",u=0;u<this.initialBufs.length;u++)c+=this.decoder.write(this.initialBufs[u]);return this.initialBufs.length=this.initialBufsLen=0,c}return this.decoder.write(h)},o.prototype.end=function(){if(!this.decoder){var h=a(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(h,this.options);for(var l="",c=0;c<this.initialBufs.length;c++)l+=this.decoder.write(this.initialBufs[c]);var u=this.decoder.end();return u&&(l+=u),this.initialBufs.length=this.initialBufsLen=0,l}return this.decoder.end()};function a(h,l){var c=[],u=0,p=0,_=0;e:for(var m=0;m<h.length;m++)for(var g=h[m],w=0;w<g.length;w++)if(c.push(g[w]),c.length===2){if(u===0){if(c[0]===255&&c[1]===254)return"utf-16le";if(c[0]===254&&c[1]===255)return"utf-16be"}if(c[0]===0&&c[1]!==0&&_++,c[0]!==0&&c[1]===0&&p++,c.length=0,u++,u>=100)break e}return _>p?"utf-16be":_<p?"utf-16le":l||"utf-16le"}return Pi}var qr={},Pl;function Pp(){if(Pl)return qr;Pl=1;var e=Xt.Buffer;qr.utf7=t,qr.unicode11utf7="utf7";function t(g,w){this.iconv=w}t.prototype.encoder=i,t.prototype.decoder=s,t.prototype.bomAware=!0;var r=/[^A-Za-z0-9'\(\),-\.\/:\? \n\r\t]+/g;function i(g,w){this.iconv=w.iconv}i.prototype.write=function(g){return e.from(g.replace(r,(function(w){return"+"+(w==="+"?"":this.iconv.encode(w,"utf16-be").toString("base64").replace(/=+$/,""))+"-"}).bind(this)))},i.prototype.end=function(){};function s(g,w){this.iconv=w.iconv,this.inBase64=!1,this.base64Accum=""}for(var n=/[A-Za-z0-9\/+]/,o=[],a=0;a<256;a++)o[a]=n.test(String.fromCharCode(a));var h=43,l=45,c=38;s.prototype.write=function(g){for(var w="",y=0,E=this.inBase64,S=this.base64Accum,v=0;v<g.length;v++)if(!E)g[v]==h&&(w+=this.iconv.decode(g.slice(y,v),"ascii"),y=v+1,E=!0);else if(!o[g[v]]){if(v==y&&g[v]==l)w+="+";else{var k=S+this.iconv.decode(g.slice(y,v),"ascii");w+=this.iconv.decode(e.from(k,"base64"),"utf16-be")}g[v]!=l&&v--,y=v+1,E=!1,S=""}if(!E)w+=this.iconv.decode(g.slice(y),"ascii");else{var k=S+this.iconv.decode(g.slice(y),"ascii"),R=k.length-k.length%8;S=k.slice(R),k=k.slice(0,R),w+=this.iconv.decode(e.from(k,"base64"),"utf16-be")}return this.inBase64=E,this.base64Accum=S,w},s.prototype.end=function(){var g="";return this.inBase64&&this.base64Accum.length>0&&(g=this.iconv.decode(e.from(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",g},qr.utf7imap=u;function u(g,w){this.iconv=w}u.prototype.encoder=p,u.prototype.decoder=_,u.prototype.bomAware=!0;function p(g,w){this.iconv=w.iconv,this.inBase64=!1,this.base64Accum=e.alloc(6),this.base64AccumIdx=0}p.prototype.write=function(g){for(var w=this.inBase64,y=this.base64Accum,E=this.base64AccumIdx,S=e.alloc(g.length*5+10),v=0,k=0;k<g.length;k++){var R=g.charCodeAt(k);R>=32&&R<=126?(w&&(E>0&&(v+=S.write(y.slice(0,E).toString("base64").replace(/\//g,",").replace(/=+$/,""),v),E=0),S[v++]=l,w=!1),w||(S[v++]=R,R===c&&(S[v++]=l))):(w||(S[v++]=c,w=!0),w&&(y[E++]=R>>8,y[E++]=R&255,E==y.length&&(v+=S.write(y.toString("base64").replace(/\//g,","),v),E=0)))}return this.inBase64=w,this.base64AccumIdx=E,S.slice(0,v)},p.prototype.end=function(){var g=e.alloc(10),w=0;return this.inBase64&&(this.base64AccumIdx>0&&(w+=g.write(this.base64Accum.slice(0,this.base64AccumIdx).toString("base64").replace(/\//g,",").replace(/=+$/,""),w),this.base64AccumIdx=0),g[w++]=l,this.inBase64=!1),g.slice(0,w)};function _(g,w){this.iconv=w.iconv,this.inBase64=!1,this.base64Accum=""}var m=o.slice();return m[44]=!0,_.prototype.write=function(g){for(var w="",y=0,E=this.inBase64,S=this.base64Accum,v=0;v<g.length;v++)if(!E)g[v]==c&&(w+=this.iconv.decode(g.slice(y,v),"ascii"),y=v+1,E=!0);else if(!m[g[v]]){if(v==y&&g[v]==l)w+="&";else{var k=S+this.iconv.decode(g.slice(y,v),"ascii").replace(/,/g,"/");w+=this.iconv.decode(e.from(k,"base64"),"utf16-be")}g[v]!=l&&v--,y=v+1,E=!1,S=""}if(!E)w+=this.iconv.decode(g.slice(y),"ascii");else{var k=S+this.iconv.decode(g.slice(y),"ascii").replace(/,/g,"/"),R=k.length-k.length%8;S=k.slice(R),k=k.slice(0,R),w+=this.iconv.decode(e.from(k,"base64"),"utf16-be")}return this.inBase64=E,this.base64Accum=S,w},_.prototype.end=function(){var g="";return this.inBase64&&this.base64Accum.length>0&&(g=this.iconv.decode(e.from(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",g},qr}var Hs={},Ml;function Mp(){if(Ml)return Hs;Ml=1;var e=Xt.Buffer;Hs._sbcs=t;function t(s,n){if(!s)throw new Error("SBCS codec is called without the data.");if(!s.chars||s.chars.length!==128&&s.chars.length!==256)throw new Error("Encoding '"+s.type+"' has incorrect 'chars' (must be of len 128 or 256)");if(s.chars.length===128){for(var o="",a=0;a<128;a++)o+=String.fromCharCode(a);s.chars=o+s.chars}this.decodeBuf=e.from(s.chars,"ucs2");for(var h=e.alloc(65536,n.defaultCharSingleByte.charCodeAt(0)),a=0;a<s.chars.length;a++)h[s.chars.charCodeAt(a)]=a;this.encodeBuf=h}t.prototype.encoder=r,t.prototype.decoder=i;function r(s,n){this.encodeBuf=n.encodeBuf}r.prototype.write=function(s){for(var n=e.alloc(s.length),o=0;o<s.length;o++)n[o]=this.encodeBuf[s.charCodeAt(o)];return n},r.prototype.end=function(){};function i(s,n){this.decodeBuf=n.decodeBuf}return i.prototype.write=function(s){for(var n=this.decodeBuf,o=e.alloc(s.length*2),a=0,h=0,l=0;l<s.length;l++)a=s[l]*2,h=l*2,o[h]=n[a],o[h+1]=n[a+1];return o.toString("ucs2")},i.prototype.end=function(){},Hs}var Ws,Ol;function Op(){return Ol||(Ol=1,Ws={10029:"maccenteuro",maccenteuro:{type:"_sbcs",chars:""},808:"cp808",ibm808:"cp808",cp808:{type:"_sbcs",chars:""},mik:{type:"_sbcs",chars:""},cp720:{type:"_sbcs",chars:""},ascii8bit:"ascii",usascii:"ascii",ansix34:"ascii",ansix341968:"ascii",ansix341986:"ascii",csascii:"ascii",cp367:"ascii",ibm367:"ascii",isoir6:"ascii",iso646us:"ascii",iso646irv:"ascii",us:"ascii",latin1:"iso88591",latin2:"iso88592",latin3:"iso88593",latin4:"iso88594",latin5:"iso88599",latin6:"iso885910",latin7:"iso885913",latin8:"iso885914",latin9:"iso885915",latin10:"iso885916",csisolatin1:"iso88591",csisolatin2:"iso88592",csisolatin3:"iso88593",csisolatin4:"iso88594",csisolatincyrillic:"iso88595",csisolatinarabic:"iso88596",csisolatingreek:"iso88597",csisolatinhebrew:"iso88598",csisolatin5:"iso88599",csisolatin6:"iso885910",l1:"iso88591",l2:"iso88592",l3:"iso88593",l4:"iso88594",l5:"iso88599",l6:"iso885910",l7:"iso885913",l8:"iso885914",l9:"iso885915",l10:"iso885916",isoir14:"iso646jp",isoir57:"iso646cn",isoir100:"iso88591",isoir101:"iso88592",isoir109:"iso88593",isoir110:"iso88594",isoir144:"iso88595",isoir127:"iso88596",isoir126:"iso88597",isoir138:"iso88598",isoir148:"iso88599",isoir157:"iso885910",isoir166:"tis620",isoir179:"iso885913",isoir199:"iso885914",isoir203:"iso885915",isoir226:"iso885916",cp819:"iso88591",ibm819:"iso88591",cyrillic:"iso88595",arabic:"iso88596",arabic8:"iso88596",ecma114:"iso88596",asmo708:"iso88596",greek:"iso88597",greek8:"iso88597",ecma118:"iso88597",elot928:"iso88597",hebrew:"iso88598",hebrew8:"iso88598",turkish:"iso88599",turkish8:"iso88599",thai:"iso885911",thai8:"iso885911",celtic:"iso885914",celtic8:"iso885914",isoceltic:"iso885914",tis6200:"tis620",tis62025291:"tis620",tis62025330:"tis620",1e4:"macroman",10006:"macgreek",10007:"maccyrillic",10079:"maciceland",10081:"macturkish",cspc8codepage437:"cp437",cspc775baltic:"cp775",cspc850multilingual:"cp850",cspcp852:"cp852",cspc862latinhebrew:"cp862",cpgr:"cp869",msee:"cp1250",mscyrl:"cp1251",msansi:"cp1252",msgreek:"cp1253",msturk:"cp1254",mshebr:"cp1255",msarab:"cp1256",winbaltrim:"cp1257",cp20866:"koi8r",20866:"koi8r",ibm878:"koi8r",cskoi8r:"koi8r",cp21866:"koi8u",21866:"koi8u",ibm1168:"koi8u",strk10482002:"rk1048",tcvn5712:"tcvn",tcvn57121:"tcvn",gb198880:"iso646cn",cn:"iso646cn",csiso14jisc6220ro:"iso646jp",jisc62201969ro:"iso646jp",jp:"iso646jp",cshproman8:"hproman8",r8:"hproman8",roman8:"hproman8",xroman8:"hproman8",ibm1051:"hproman8",mac:"macintosh",csmacintosh:"macintosh"}),Ws}var zs,Il;function Ip(){return Il||(Il=1,zs={437:"cp437",737:"cp737",775:"cp775",850:"cp850",852:"cp852",855:"cp855",856:"cp856",857:"cp857",858:"cp858",860:"cp860",861:"cp861",862:"cp862",863:"cp863",864:"cp864",865:"cp865",866:"cp866",869:"cp869",874:"windows874",922:"cp922",1046:"cp1046",1124:"cp1124",1125:"cp1125",1129:"cp1129",1133:"cp1133",1161:"cp1161",1162:"cp1162",1163:"cp1163",1250:"windows1250",1251:"windows1251",1252:"windows1252",1253:"windows1253",1254:"windows1254",1255:"windows1255",1256:"windows1256",1257:"windows1257",1258:"windows1258",28591:"iso88591",28592:"iso88592",28593:"iso88593",28594:"iso88594",28595:"iso88595",28596:"iso88596",28597:"iso88597",28598:"iso88598",28599:"iso88599",28600:"iso885910",28601:"iso885911",28603:"iso885913",28604:"iso885914",28605:"iso885915",28606:"iso885916",windows874:{type:"_sbcs",chars:""},win874:"windows874",cp874:"windows874",windows1250:{type:"_sbcs",chars:""},win1250:"windows1250",cp1250:"windows1250",windows1251:{type:"_sbcs",chars:""},win1251:"windows1251",cp1251:"windows1251",windows1252:{type:"_sbcs",chars:""},win1252:"windows1252",cp1252:"windows1252",windows1253:{type:"_sbcs",chars:""},win1253:"windows1253",cp1253:"windows1253",windows1254:{type:"_sbcs",chars:""},win1254:"windows1254",cp1254:"windows1254",windows1255:{type:"_sbcs",chars:""},win1255:"windows1255",cp1255:"windows1255",windows1256:{type:"_sbcs",chars:""},win1256:"windows1256",cp1256:"windows1256",windows1257:{type:"_sbcs",chars:""},win1257:"windows1257",cp1257:"windows1257",windows1258:{type:"_sbcs",chars:""},win1258:"windows1258",cp1258:"windows1258",iso88591:{type:"_sbcs",chars:""},cp28591:"iso88591",iso88592:{type:"_sbcs",chars:""},cp28592:"iso88592",iso88593:{type:"_sbcs",chars:""},cp28593:"iso88593",iso88594:{type:"_sbcs",chars:""},cp28594:"iso88594",iso88595:{type:"_sbcs",chars:""},cp28595:"iso88595",iso88596:{type:"_sbcs",chars:""},cp28596:"iso88596",iso88597:{type:"_sbcs",chars:""},cp28597:"iso88597",iso88598:{type:"_sbcs",chars:""},cp28598:"iso88598",iso88599:{type:"_sbcs",chars:""},cp28599:"iso88599",iso885910:{type:"_sbcs",chars:""},cp28600:"iso885910",iso885911:{type:"_sbcs",chars:""},cp28601:"iso885911",iso885913:{type:"_sbcs",chars:""},cp28603:"iso885913",iso885914:{type:"_sbcs",chars:""},cp28604:"iso885914",iso885915:{type:"_sbcs",chars:""},cp28605:"iso885915",iso885916:{type:"_sbcs",chars:""},cp28606:"iso885916",cp437:{type:"_sbcs",chars:""},ibm437:"cp437",csibm437:"cp437",cp737:{type:"_sbcs",chars:""},ibm737:"cp737",csibm737:"cp737",cp775:{type:"_sbcs",chars:""},ibm775:"cp775",csibm775:"cp775",cp850:{type:"_sbcs",chars:""},ibm850:"cp850",csibm850:"cp850",cp852:{type:"_sbcs",chars:""},ibm852:"cp852",csibm852:"cp852",cp855:{type:"_sbcs",chars:""},ibm855:"cp855",csibm855:"cp855",cp856:{type:"_sbcs",chars:""},ibm856:"cp856",csibm856:"cp856",cp857:{type:"_sbcs",chars:""},ibm857:"cp857",csibm857:"cp857",cp858:{type:"_sbcs",chars:""},ibm858:"cp858",csibm858:"cp858",cp860:{type:"_sbcs",chars:""},ibm860:"cp860",csibm860:"cp860",cp861:{type:"_sbcs",chars:""},ibm861:"cp861",csibm861:"cp861",cp862:{type:"_sbcs",chars:""},ibm862:"cp862",csibm862:"cp862",cp863:{type:"_sbcs",chars:""},ibm863:"cp863",csibm863:"cp863",cp864:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#$&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}~`},ibm864:"cp864",csibm864:"cp864",cp865:{type:"_sbcs",chars:""},ibm865:"cp865",csibm865:"cp865",cp866:{type:"_sbcs",chars:""},ibm866:"cp866",csibm866:"cp866",cp869:{type:"_sbcs",chars:""},ibm869:"cp869",csibm869:"cp869",cp922:{type:"_sbcs",chars:""},ibm922:"cp922",csibm922:"cp922",cp1046:{type:"_sbcs",chars:""},ibm1046:"cp1046",csibm1046:"cp1046",cp1124:{type:"_sbcs",chars:""},ibm1124:"cp1124",csibm1124:"cp1124",cp1125:{type:"_sbcs",chars:""},ibm1125:"cp1125",csibm1125:"cp1125",cp1129:{type:"_sbcs",chars:""},ibm1129:"cp1129",csibm1129:"cp1129",cp1133:{type:"_sbcs",chars:""},ibm1133:"cp1133",csibm1133:"cp1133",cp1161:{type:"_sbcs",chars:""},ibm1161:"cp1161",csibm1161:"cp1161",cp1162:{type:"_sbcs",chars:""},ibm1162:"cp1162",csibm1162:"cp1162",cp1163:{type:"_sbcs",chars:""},ibm1163:"cp1163",csibm1163:"cp1163",maccroatian:{type:"_sbcs",chars:""},maccyrillic:{type:"_sbcs",chars:""},macgreek:{type:"_sbcs",chars:""},maciceland:{type:"_sbcs",chars:""},macroman:{type:"_sbcs",chars:""},macromania:{type:"_sbcs",chars:""},macthai:{type:"_sbcs",chars:"\uFEFF"},macturkish:{type:"_sbcs",chars:""},macukraine:{type:"_sbcs",chars:""},koi8r:{type:"_sbcs",chars:""},koi8u:{type:"_sbcs",chars:""},koi8ru:{type:"_sbcs",chars:""},koi8t:{type:"_sbcs",chars:""},armscii8:{type:"_sbcs",chars:")(.,-"},rk1048:{type:"_sbcs",chars:""},tcvn:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}~`},georgianacademy:{type:"_sbcs",chars:""},georgianps:{type:"_sbcs",chars:""},pt154:{type:"_sbcs",chars:""},viscii:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}~`},iso646cn:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}`},iso646jp:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_\`abcdefghijklmnopqrstuvwxyz{|}`},hproman8:{type:"_sbcs",chars:""},macintosh:{type:"_sbcs",chars:""},ascii:{type:"_sbcs",chars:""},tis620:{type:"_sbcs",chars:""}}),zs}var qs={},Nl;function Np(){if(Nl)return qs;Nl=1;var e=Xt.Buffer;qs._dbcs=h;for(var t=-1,r=-2,i=-10,s=-1e3,n=new Array(256),o=-1,a=0;a<256;a++)n[a]=t;function h(p,_){if(this.encodingName=p.encodingName,!p)throw new Error("DBCS codec is called without the data.");if(!p.table)throw new Error("Encoding '"+this.encodingName+"' has no data.");var m=p.table();this.decodeTables=[],this.decodeTables[0]=n.slice(0),this.decodeTableSeq=[];for(var g=0;g<m.length;g++)this._addDecodeChunk(m[g]);if(typeof p.gb18030=="function"){this.gb18030=p.gb18030();var w=this.decodeTables.length;this.decodeTables.push(n.slice(0));var y=this.decodeTables.length;this.decodeTables.push(n.slice(0));for(var E=this.decodeTables[0],g=129;g<=254;g++)for(var S=this.decodeTables[s-E[g]],v=48;v<=57;v++){if(S[v]===t)S[v]=s-w;else if(S[v]>s)throw new Error("gb18030 decode tables conflict at byte 2");for(var k=this.decodeTables[s-S[v]],R=129;R<=254;R++){if(k[R]===t)k[R]=s-y;else{if(k[R]===s-y)continue;if(k[R]>s)throw new Error("gb18030 decode tables conflict at byte 3")}for(var O=this.decodeTables[s-k[R]],N=48;N<=57;N++)O[N]===t&&(O[N]=r)}}}this.defaultCharUnicode=_.defaultCharUnicode,this.encodeTable=[],this.encodeTableSeq=[];var W={};if(p.encodeSkipVals)for(var g=0;g<p.encodeSkipVals.length;g++){var Q=p.encodeSkipVals[g];if(typeof Q=="number")W[Q]=!0;else for(var v=Q.from;v<=Q.to;v++)W[v]=!0}if(this._fillEncodeTable(0,0,W),p.encodeAdd)for(var ie in p.encodeAdd)Object.prototype.hasOwnProperty.call(p.encodeAdd,ie)&&this._setEncodeChar(ie.charCodeAt(0),p.encodeAdd[ie]);this.defCharSB=this.encodeTable[0][_.defaultCharSingleByte.charCodeAt(0)],this.defCharSB===t&&(this.defCharSB=this.encodeTable[0]["?"]),this.defCharSB===t&&(this.defCharSB=63)}h.prototype.encoder=l,h.prototype.decoder=c,h.prototype._getDecodeTrieNode=function(p){for(var _=[];p>0;p>>>=8)_.push(p&255);_.length==0&&_.push(0);for(var m=this.decodeTables[0],g=_.length-1;g>0;g--){var w=m[_[g]];if(w==t)m[_[g]]=s-this.decodeTables.length,this.decodeTables.push(m=n.slice(0));else if(w<=s)m=this.decodeTables[s-w];else throw new Error("Overwrite byte in "+this.encodingName+", addr: "+p.toString(16))}return m},h.prototype._addDecodeChunk=function(p){var _=parseInt(p[0],16),m=this._getDecodeTrieNode(_);_=_&255;for(var g=1;g<p.length;g++){var w=p[g];if(typeof w=="string")for(var y=0;y<w.length;){var E=w.charCodeAt(y++);if(E>=55296&&E<56320){var S=w.charCodeAt(y++);if(S>=56320&&S<57344)m[_++]=65536+(E-55296)*1024+(S-56320);else throw new Error("Incorrect surrogate pair in "+this.encodingName+" at chunk "+p[0])}else if(E>4080&&E<=4095){for(var v=4095-E+2,k=[],R=0;R<v;R++)k.push(w.charCodeAt(y++));m[_++]=i-this.decodeTableSeq.length,this.decodeTableSeq.push(k)}else m[_++]=E}else if(typeof w=="number")for(var O=m[_-1]+1,y=0;y<w;y++)m[_++]=O++;else throw new Error("Incorrect type '"+typeof w+"' given in "+this.encodingName+" at chunk "+p[0])}if(_>255)throw new Error("Incorrect chunk in "+this.encodingName+" at addr "+p[0]+": too long"+_)},h.prototype._getEncodeBucket=function(p){var _=p>>8;return this.encodeTable[_]===void 0&&(this.encodeTable[_]=n.slice(0)),this.encodeTable[_]},h.prototype._setEncodeChar=function(p,_){var m=this._getEncodeBucket(p),g=p&255;m[g]<=i?this.encodeTableSeq[i-m[g]][o]=_:m[g]==t&&(m[g]=_)},h.prototype._setEncodeSequence=function(p,_){var m=p[0],g=this._getEncodeBucket(m),w=m&255,y;g[w]<=i?y=this.encodeTableSeq[i-g[w]]:(y={},g[w]!==t&&(y[o]=g[w]),g[w]=i-this.encodeTableSeq.length,this.encodeTableSeq.push(y));for(var E=1;E<p.length-1;E++){var S=y[m];typeof S=="object"?y=S:(y=y[m]={},S!==void 0&&(y[o]=S))}m=p[p.length-1],y[m]=_},h.prototype._fillEncodeTable=function(p,_,m){for(var g=this.decodeTables[p],w=!1,y={},E=0;E<256;E++){var S=g[E],v=_+E;if(!m[v])if(S>=0)this._setEncodeChar(S,v),w=!0;else if(S<=s){var k=s-S;if(!y[k]){var R=v<<8>>>0;this._fillEncodeTable(k,R,m)?w=!0:y[k]=!0}}else S<=i&&(this._setEncodeSequence(this.decodeTableSeq[i-S],v),w=!0)}return w};function l(p,_){this.leadSurrogate=-1,this.seqObj=void 0,this.encodeTable=_.encodeTable,this.encodeTableSeq=_.encodeTableSeq,this.defaultCharSingleByte=_.defCharSB,this.gb18030=_.gb18030}l.prototype.write=function(p){for(var _=e.alloc(p.length*(this.gb18030?4:3)),m=this.leadSurrogate,g=this.seqObj,w=-1,y=0,E=0;;){if(w===-1){if(y==p.length)break;var S=p.charCodeAt(y++)}else{var S=w;w=-1}if(S>=55296&&S<57344)if(S<56320)if(m===-1){m=S;continue}else m=S,S=t;else m!==-1?(S=65536+(m-55296)*1024+(S-56320),m=-1):S=t;else m!==-1&&(w=S,S=t,m=-1);var v=t;if(g!==void 0&&S!=t){var k=g[S];if(typeof k=="object"){g=k;continue}else typeof k=="number"?v=k:k==null&&(k=g[o],k!==void 0&&(v=k,w=S));g=void 0}else if(S>=0){var R=this.encodeTable[S>>8];if(R!==void 0&&(v=R[S&255]),v<=i){g=this.encodeTableSeq[i-v];continue}if(v==t&&this.gb18030){var O=u(this.gb18030.uChars,S);if(O!=-1){var v=this.gb18030.gbChars[O]+(S-this.gb18030.uChars[O]);_[E++]=129+Math.floor(v/12600),v=v%12600,_[E++]=48+Math.floor(v/1260),v=v%1260,_[E++]=129+Math.floor(v/10),v=v%10,_[E++]=48+v;continue}}}v===t&&(v=this.defaultCharSingleByte),v<256?_[E++]=v:v<65536?(_[E++]=v>>8,_[E++]=v&255):v<16777216?(_[E++]=v>>16,_[E++]=v>>8&255,_[E++]=v&255):(_[E++]=v>>>24,_[E++]=v>>>16&255,_[E++]=v>>>8&255,_[E++]=v&255)}return this.seqObj=g,this.leadSurrogate=m,_.slice(0,E)},l.prototype.end=function(){if(!(this.leadSurrogate===-1&&this.seqObj===void 0)){var p=e.alloc(10),_=0;if(this.seqObj){var m=this.seqObj[o];m!==void 0&&(m<256?p[_++]=m:(p[_++]=m>>8,p[_++]=m&255)),this.seqObj=void 0}return this.leadSurrogate!==-1&&(p[_++]=this.defaultCharSingleByte,this.leadSurrogate=-1),p.slice(0,_)}},l.prototype.findIdx=u;function c(p,_){this.nodeIdx=0,this.prevBytes=[],this.decodeTables=_.decodeTables,this.decodeTableSeq=_.decodeTableSeq,this.defaultCharUnicode=_.defaultCharUnicode,this.gb18030=_.gb18030}c.prototype.write=function(p){for(var _=e.alloc(p.length*2),m=this.nodeIdx,g=this.prevBytes,w=this.prevBytes.length,y=-this.prevBytes.length,E,S=0,v=0;S<p.length;S++){var k=S>=0?p[S]:g[S+w],E=this.decodeTables[m][k];if(!(E>=0))if(E===t)E=this.defaultCharUnicode.charCodeAt(0),S=y;else if(E===r){if(S>=3)var R=(p[S-3]-129)*12600+(p[S-2]-48)*1260+(p[S-1]-129)*10+(k-48);else var R=(g[S-3+w]-129)*12600+((S-2>=0?p[S-2]:g[S-2+w])-48)*1260+((S-1>=0?p[S-1]:g[S-1+w])-129)*10+(k-48);var O=u(this.gb18030.gbChars,R);E=this.gb18030.uChars[O]+R-this.gb18030.gbChars[O]}else if(E<=s){m=s-E;continue}else if(E<=i){for(var N=this.decodeTableSeq[i-E],W=0;W<N.length-1;W++)E=N[W],_[v++]=E&255,_[v++]=E>>8;E=N[N.length-1]}else throw new Error("iconv-lite internal error: invalid decoding table value "+E+" at "+m+"/"+k);if(E>=65536){E-=65536;var Q=55296|E>>10;_[v++]=Q&255,_[v++]=Q>>8,E=56320|E&1023}_[v++]=E&255,_[v++]=E>>8,m=0,y=S+1}return this.nodeIdx=m,this.prevBytes=y>=0?Array.prototype.slice.call(p,y):g.slice(y+w).concat(Array.prototype.slice.call(p)),_.slice(0,v).toString("ucs2")},c.prototype.end=function(){for(var p="";this.prevBytes.length>0;){p+=this.defaultCharUnicode;var _=this.prevBytes.slice(1);this.prevBytes=[],this.nodeIdx=0,_.length>0&&(p+=this.write(_))}return this.prevBytes=[],this.nodeIdx=0,p};function u(p,_){if(p[0]>_)return-1;for(var m=0,g=p.length;m<g-1;){var w=m+(g-m+1>>1);p[w]<=_?m=w:g=w}return m}return qs}const Fp=[["0","\0",128],["a1","",62],["8140","",9,""],["8180",""],["81b8",""],["81c8",""],["81da",""],["81f0",""],["81fc",""],["824f","",9],["8260","",25],["8281","",25],["829f","",82],["8340","",62],["8380","",22],["839f","",16,"",6],["83bf","",16,"",6],["8440","",5,"",25],["8470","",5,"",7],["8480","",17],["849f",""],["8740","",19,"",9],["875f",""],["877e",""],["8780","",4,""],["889f",""],["8940",""],["8980",""],["8a40",""],["8a80",""],["8b40",""],["8b80",""],["8c40",""],["8c80",""],["8d40",""],["8d80",""],["8e40",""],["8e80",""],["8f40",""],["8f80",""],["9040",""],["9080",""],["9140",""],["9180",""],["9240",""],["9280",""],["9340",""],["9380",""],["9440",""],["9480",""],["9540",""],["9580",""],["9640",""],["9680",""],["9740",""],["9780",""],["9840",""],["989f",""],["9940",""],["9980",""],["9a40",""],["9a80",""],["9b40",""],["9b80",""],["9c40",""],["9c80",""],["9d40",""],["9d80",""],["9e40",""],["9e80",""],["9f40",""],["9f80",""],["e040",""],["e080",""],["e140",""],["e180",""],["e240",""],["e280",""],["e340",""],["e380",""],["e440",""],["e480",""],["e540",""],["e580",""],["e640",""],["e680",""],["e740",""],["e780",""],["e840",""],["e880",""],["e940",""],["e980",""],["ea40",""],["ea80",""],["ed40",""],["ed80",""],["ee40",""],["ee80",""],["eeef","",9,""],["f040","",62],["f080","",124],["f140","",62],["f180","",124],["f240","",62],["f280","",124],["f340","",62],["f380","",124],["f440","",62],["f480","",124],["f540","",62],["f580","",124],["f640","",62],["f680","",124],["f740","",62],["f780","",124],["f840","",62],["f880","",124],["f940",""],["fa40","",9,"",9,""],["fa80",""],["fb40",""],["fb80",""],["fc40",""]],Up=[["0","\0",127],["8ea1","",62],["a1a1","",9,""],["a2a1",""],["a2ba",""],["a2ca",""],["a2dc",""],["a2f2",""],["a2fe",""],["a3b0","",9],["a3c1","",25],["a3e1","",25],["a4a1","",82],["a5a1","",85],["a6a1","",16,"",6],["a6c1","",16,"",6],["a7a1","",5,"",25],["a7d1","",5,"",25],["a8a1",""],["ada1","",19,"",9],["adc0",""],["addf","",4,""],["b0a1",""],["b1a1",""],["b2a1",""],["b3a1",""],["b4a1",""],["b5a1",""],["b6a1",""],["b7a1",""],["b8a1",""],["b9a1",""],["baa1",""],["bba1",""],["bca1",""],["bda1",""],["bea1",""],["bfa1",""],["c0a1",""],["c1a1",""],["c2a1",""],["c3a1",""],["c4a1",""],["c5a1",""],["c6a1",""],["c7a1",""],["c8a1",""],["c9a1",""],["caa1",""],["cba1",""],["cca1",""],["cda1",""],["cea1",""],["cfa1",""],["d0a1",""],["d1a1",""],["d2a1",""],["d3a1",""],["d4a1",""],["d5a1",""],["d6a1",""],["d7a1",""],["d8a1",""],["d9a1",""],["daa1",""],["dba1",""],["dca1",""],["dda1",""],["dea1",""],["dfa1",""],["e0a1",""],["e1a1",""],["e2a1",""],["e3a1",""],["e4a1",""],["e5a1",""],["e6a1",""],["e7a1",""],["e8a1",""],["e9a1",""],["eaa1",""],["eba1",""],["eca1",""],["eda1",""],["eea1",""],["efa1",""],["f0a1",""],["f1a1",""],["f2a1",""],["f3a1",""],["f4a1",""],["f9a1",""],["faa1",""],["fba1",""],["fca1",""],["fcf1","",9,""],["8fa2af",""],["8fa2c2",""],["8fa2eb",""],["8fa6e1",""],["8fa6e7",""],["8fa6e9",""],["8fa6ec",""],["8fa6f1",""],["8fa7c2","",10,""],["8fa7f2","",10,""],["8fa9a1",""],["8fa9a4",""],["8fa9a6",""],["8fa9a8",""],["8fa9ab",""],["8fa9af",""],["8fa9c1",""],["8faaa1",""],["8faaba",""],["8faba1",""],["8fabbd",""],["8fabc5",""],["8fb0a1",""],["8fb1a1",""],["8fb2a1","",4,""],["8fb3a1",""],["8fb4a1",""],["8fb5a1",""],["8fb6a1","",5,"",4,""],["8fb7a1","",4,""],["8fb8a1",""],["8fb9a1",""],["8fbaa1","",4,""],["8fbba1",""],["8fbca1","",4,""],["8fbda1","",4,""],["8fbea1","",4,""],["8fbfa1",""],["8fc0a1",""],["8fc1a1",""],["8fc2a1",""],["8fc3a1","",4,""],["8fc4a1",""],["8fc5a1",""],["8fc6a1",""],["8fc7a1",""],["8fc8a1",""],["8fc9a1","",4,"",4,""],["8fcaa1",""],["8fcba1",""],["8fcca1","",9,""],["8fcda1","",5,""],["8fcea1","",6,""],["8fcfa1",""],["8fd0a1",""],["8fd1a1",""],["8fd2a1","",5],["8fd3a1",""],["8fd4a1","",4,""],["8fd5a1",""],["8fd6a1",""],["8fd7a1",""],["8fd8a1",""],["8fd9a1","",4,"",6,""],["8fdaa1","",4,""],["8fdba1","",6,""],["8fdca1","",4,""],["8fdda1","",4,""],["8fdea1","",4,""],["8fdfa1",""],["8fe0a1",""],["8fe1a1","",4,""],["8fe2a1",""],["8fe3a1","",5,"",4,""],["8fe4a1","",4,""],["8fe5a1","",4,""],["8fe6a1",""],["8fe7a1",""],["8fe8a1","",4,""],["8fe9a1","",4],["8feaa1","",4,""],["8feba1","",4,""],["8feca1",""],["8feda1","",4,"",4,""]],js=[["0","\0",127,""],["8140","",5,"",9,"",6,""],["8180","",6,"",4,"",4,"",5,""],["8240","",4,"",8,"",4,"",11],["8280","",10,"",4,"",7,"",5,"",8,"",20,"",4,"",6,""],["8340","",17,"",5,"",10,"",4,"",9,""],["8380","",5,"",13,"",28,"",4,"",4,"",5],["8440","",5,"",5,""],["8480","",9,"",4,"",6,"",6,"",9,"",5,"",10,"",7,""],["8540","",9,""],["8580","",4,"",6,"",4,"",4,"",7,""],["8640","",4,"",5,"",4,"",5,""],["8680","",4,"",4,"",5,"",6,"",8,"",4,"",4,"",4,""],["8740","",7,"",11,"",4,"",4],["8780","",7,"",6,"",14,"",10,"",6,"",12,"",8,"",5,"",6],["8840","",9,"",4,"",4,""],["8880","",4,"",6,"",8,"",6,"",7,"",4,"",4,"",7],["8940","",5,"",6,"",4,"",5,"",4,"",16,""],["8980","",4,"",4,"",7,"",17,"",10,"",13,"",5,"",7,"",4,""],["8a40","",4,"",12,""],["8a80","",5,"",6,"",4,"",11,"",6,"",4,"",4,"",9,"",5],["8b40","",8,"",17,"",6,"",13,""],["8b80","",4,"",4,"",5,"",4,"",4,"",22,"",11,"",25,"",7,"",6],["8c40","",7,""],["8c80","",8,"",4,"",6,"",6,"",6,"",4,"",4,"",4],["8d40","",5,"",5,"",5,"",6,"",9,"",4],["8d80","",5,"",4,"",4,"",4,"",7,"",7,"",10,"",10,"",12,"",21,""],["8e40","",21,"",12,"",6,"",12,""],["8e80","",4,"",7,"",4,"",4,"",5,"",6,"",4,"",14,"",4,"",4,"",6],["8f40","",5,"",11,"",8,""],["8f80","",6,"",14,"",5,"",5,"",4,""],["9040","",4,"",4,"",6,""],["9080","",7,"",4,"",4,"",4,"",4,"",18,"",6],["9140","",6,"",6,"",18,"",4,""],["9180","",6,"",8,"",9,"",5,"",4,"",4,"",16,"",13,"",8,"",5,"",4,""],["9240","",6,"",5,""],["9280","",5,"",7,"",6,""],["9340","",6,"",4,"",4,"",5,""],["9380","",5,"",4,"",6,"",4,"",7,"",9,"",6,"",8,"",4,"",6,""],["9440","",24,"",7,"",7,"",4,"",8],["9480","",4,"",4,"",14,"",7,"",7,""],["9540","",4,"",4,"",6,""],["9580","",4,"",4,"",8,"",4,"",4,"",25,"",7,"",5,""],["9640","",5,"",4,""],["9680","",7,"",9,"",7,"",4,"",6,"",6,"",5],["9740","",7,"",8,"",7,"",9,""],["9780","",6,"",5,"",4,"",9,"",4,"",11,"",7,"",16,""],["9840","",4,"",5,"",9,""],["9880","",7,"",5,"",11,"",9,"",9,"",11,"",5,"",5,"",6,"",4,"",7,"",6,""],["9940","",4,"",10,"",6,"",8,"",4,"",7,"",5],["9980","",114,"",6],["9a40","",11,"",7,"",13,""],["9a80","",4,"",7,"",7,"",6,"",4,"",4,"",7,"",6,"",4,"",4,""],["9b40","",4,""],["9b80","",5,"",4,"",4,"",5,""],["9c40","",7,""],["9c80","",7,"",7,"",10,"",14,"",4,"",6,"",5],["9d40","",7,"",4,"",9,"",6,""],["9d80","",9,"",5,"",6,"",12,"",4,"",10,"",5,"",5,"",6,"",10,""],["9e40","",7,"",32,"",7,"",6,"",6],["9e80","",9,"",17,"",13,"",11,"",12,"",12,""],["9f40","",6,"",10,"",4,"",10,"",7,""],["9f80","",13,"",12,"",4,"",4,"",5,"",4,"",4,"",6,"",5,"",8,"",9,"",4],["a040","",9,"",5,"",9,"",11,"",19],["a080","",9,"",6,"",4,"",11,"",11,"",6,""],["a1a1","",7,""],["a2a1","",9],["a2b1","",19,"",19,"",9],["a2e5","",9],["a2f1","",11],["a3a1","",88,""],["a4a1","",82],["a5a1","",85],["a6a1","",16,"",6],["a6c1","",16,"",6],["a6e0",""],["a6ee",""],["a6f4",""],["a7a1","",5,"",25],["a7d1","",5,"",25],["a840","",35,"",6],["a880","",7,""],["a8a1",""],["a8bd",""],["a8c0",""],["a8c5","",36],["a940","",8,""],["a959",""],["a95c",""],["a960","",9,"",8],["a980","",4,""],["a996",""],["a9a4","",75],["aa40","",5,"",5,"",8],["aa80","",7,"",10,""],["ab40","",11,"",4,"",5,"",4],["ab80","",6,"",4],["ac40","",10,"",8,"",5,"",4,"",11],["ac80","",6,"",12,"",4,""],["ad40","",10,"",7,"",15,"",12],["ad80","",9,"",8,"",6,""],["ae40","",6,"",7,"",4,""],["ae80","",7,"",6,"",4,""],["af40","",4,""],["af80",""],["b040","",6,"",5,"",4,"",6,"",7,""],["b080","",7,"",8,"",9,""],["b140","",4,"",7,"",10,""],["b180","",4,"",7,"",7,""],["b240","",11,"",5,"",11,"",4],["b280","",12,"",8,"",4,""],["b340","",5,""],["b380","",11,"",7,"",6,""],["b440","",7,"",9],["b480","",4,"",5,"",6,""],["b540","",5,"",9,"",4,"",14,"",4,"",8,""],["b580","",6,"",4,""],["b640","",6,"",11,"",10,"",4,"",5,""],["b680","",6,"",4,""],["b740","",14,"",5,"",9,"",4,"",16],["b780","",6,""],["b840","",4,"",10,"",10,"",9,"",5,""],["b880","",4,""],["b940","",5,"",10,"",6,""],["b980","",7,""],["ba40","",4,"",4,"",7,"",5,""],["ba80","",4,"",5,"",12,"",5,""],["bb40","",9,"",36,"",5,"",9],["bb80","",6,"",4,""],["bc40","",6,"",6,"",5,"",7,"",13,"",5],["bc80","",14,"",6,""],["bd40","",54,"",7],["bd80","",32,""],["be40","",12,"",6,"",42],["be80","",32,""],["bf40","",62],["bf80","",4,"",4,"",21,""],["c040","",35,"",23,""],["c080","",6,"",9,""],["c140","",4,"",7,"",4,"",4,"",6,""],["c180","",4,"",4,"",5,""],["c240","",6,"",5,""],["c280","",13,"",5,"",11,""],["c340","",5,"",4,"",6,""],["c380","",12,"",4,""],["c440","",5,"",4,"",4,"",5,"",4,""],["c480","",7,"",5,"",6,""],["c540","",14,"",4,"",5,"",4,"",5,""],["c580","",7,"",7,""],["c640",""],["c680","",4,"",9,""],["c740","",4,"",4,"",6,"",6,"",6,""],["c780",""],["c840","",4,"",5,"",5,"",7,"",5,"",7,""],["c880","",6,"",4,"",4,""],["c940","",4,"",7,"",12,""],["c980","",4,"",4,"",10,""],["ca40","",8,"",8,"",9,"",4,"",10],["ca80","",4,"",8,""],["cb40","",6,"",10,"",6,"",5,"",6,"",6,"",4,""],["cb80","",5,"",6,"",14,""],["cc40","",4,"",10,"",15,"",13,""],["cc80","",11,"",4,"",7,""],["cd40","",6,"",6,"",4,"",5,"",4,"",4,""],["cd80",""],["ce40","",6,"",5,"",7,""],["ce80","",4,"",6,"",4,""],["cf40","",4,"",4,"",6,"",9],["cf80","",5,"",7,"",4,""],["d040","",13,"",5,"",5,"",5,"",6,""],["d080","",4,"",4,"",5,""],["d140","",4,"",4,"",6,"",5],["d180","",4,"",4,"",4,""],["d240","",8,"",24,"",5,"",19,""],["d280","",26,""],["d340","",30,"",6],["d380","",4,"",5,"",21,""],["d440","",31,"",8,"",21],["d480","",25,"",6,""],["d540","",7,"",7,"",46],["d580","",32,""],["d640","",34,"",27],["d680","",30,""],["d740","",31,"",4,"",25],["d780","",24,""],["d840","",8,"",7,"",5,"",6,"",6,"",6,""],["d880","",6,"",20,""],["d940","",62],["d980","",32,""],["da40","",14,"",8,"",4,"",9,""],["da80","",12,""],["db40","",6,"",7,"",4,""],["db80","",4,"",5,"",11,""],["dc40","",4,"",6,"",6,"",11,"",6,"",7],["dc80","",10,"",21,""],["dd40","",62],["dd80","",32,""],["de40","",32,""],["de80","",4,""],["df40","",5,"",4,"",4,"",5,"",4,"",6,""],["df80","",4,""],["e040","",19,""],["e080","",10,"",6,"",8,""],["e140","",4,"",6,"",5,"",5,""],["e180","",10,"",9,"",8,""],["e240","",62],["e280","",32,"",5,""],["e340","",45,"",16],["e380","",7,"",24,""],["e440","",5,"",24,"",31],["e480","",32,""],["e540","",51,"",10],["e580","",31,""],["e640","",34,"",27],["e680","",29,""],["e740","",7,"",54],["e780","",32,"",6,"",4,""],["e840","",14,"",43,""],["e880","",20,""],["e940","",7,"",42],["e980","",32,""],["ea40","",27,"",6,""],["ea80","",4,"",12,""],["eb40","",9,"",7,"",9,"",6,""],["eb80","",4,""],["ec40","",8,"",4,"",18,"",7],["ec80","",4,"",7,"",4,"",4,""],["ed40","",6,"",46],["ed80","",4,"",23,""],["ee40","",62],["ee80","",32,"",4,"",6,""],["ef40","",5,"",37,"",4],["ef80","",30,"",4,"",8,""],["f040","",4,"",28,"",26],["f080","",9,"",12,"",4,"",6,""],["f140","",10,"",47],["f180","",32,""],["f240","",62],["f280","",32,""],["f340","",17,"",6,"",4,""],["f380","",8,"",6,""],["f440","",5,"",10,"",10,"",7,"",5],["f480","",32,""],["f540","",62],["f580","",32,""],["f640","",62],["f680","",32,"",5,"",5,"",4,"",7,""],["f740","",62],["f780","",4,"",4,""],["f840","",62],["f880","",32],["f940","",62],["f980","",32],["fa40","",62],["fa80","",32],["fb40","",27,"",9,""],["fb80","",5,"",8,"",5,""],["fc40","",8,"",4,"",8,"",6],["fc80","",4,"",5,"",8,""],["fd40","",4,"",4,"",10,"",38],["fd80","",5,"",11,"",4,""],["fe40",""]],Fl=[["a140","",62],["a180","",32],["a240","",62],["a280","",32],["a2ab","",5],["a2e3",""],["a2ef",""],["a2fd",""],["a340","",62],["a380","",31,""],["a440","",62],["a480","",32],["a4f4","",10],["a540","",62],["a580","",32],["a5f7","",7],["a640","",62],["a680","",32],["a6b9","",7],["a6d9","",6],["a6ec",""],["a6f3",""],["a6f6","",8],["a740","",62],["a780","",32],["a7c2","",14],["a7f2","",12],["a896","",10],["a8bc",""],["a8bf",""],["a8c1",""],["a8ea","",20],["a958",""],["a95b",""],["a95d",""],["a989","",11],["a997","",12],["a9f0","",14],["aaa1","",93],["aba1","",93],["aca1","",93],["ada1","",93],["aea1","",93],["afa1","",93],["d7fa","",4],["f8a1","",93],["f9a1","",93],["faa1","",93],["fba1","",93],["fca1","",93],["fda1","",93],["fe50",""],["fe80","",6,"",93],["8135f437",""]],Hp={uChars:[128,165,169,178,184,216,226,235,238,244,248,251,253,258,276,284,300,325,329,334,364,463,465,467,469,471,473,475,477,506,594,610,712,716,730,930,938,962,970,1026,1104,1106,8209,8215,8218,8222,8231,8241,8244,8246,8252,8365,8452,8454,8458,8471,8482,8556,8570,8596,8602,8713,8720,8722,8726,8731,8737,8740,8742,8748,8751,8760,8766,8777,8781,8787,8802,8808,8816,8854,8858,8870,8896,8979,9322,9372,9548,9588,9616,9622,9634,9652,9662,9672,9676,9680,9702,9735,9738,9793,9795,11906,11909,11913,11917,11928,11944,11947,11951,11956,11960,11964,11979,12284,12292,12312,12319,12330,12351,12436,12447,12535,12543,12586,12842,12850,12964,13200,13215,13218,13253,13263,13267,13270,13384,13428,13727,13839,13851,14617,14703,14801,14816,14964,15183,15471,15585,16471,16736,17208,17325,17330,17374,17623,17997,18018,18212,18218,18301,18318,18760,18811,18814,18820,18823,18844,18848,18872,19576,19620,19738,19887,40870,59244,59336,59367,59413,59417,59423,59431,59437,59443,59452,59460,59478,59493,63789,63866,63894,63976,63986,64016,64018,64021,64025,64034,64037,64042,65074,65093,65107,65112,65127,65132,65375,65510,65536],gbChars:[0,36,38,45,50,81,89,95,96,100,103,104,105,109,126,133,148,172,175,179,208,306,307,308,309,310,311,312,313,341,428,443,544,545,558,741,742,749,750,805,819,820,7922,7924,7925,7927,7934,7943,7944,7945,7950,8062,8148,8149,8152,8164,8174,8236,8240,8262,8264,8374,8380,8381,8384,8388,8390,8392,8393,8394,8396,8401,8406,8416,8419,8424,8437,8439,8445,8482,8485,8496,8521,8603,8936,8946,9046,9050,9063,9066,9076,9092,9100,9108,9111,9113,9131,9162,9164,9218,9219,11329,11331,11334,11336,11346,11361,11363,11366,11370,11372,11375,11389,11682,11686,11687,11692,11694,11714,11716,11723,11725,11730,11736,11982,11989,12102,12336,12348,12350,12384,12393,12395,12397,12510,12553,12851,12962,12973,13738,13823,13919,13933,14080,14298,14585,14698,15583,15847,16318,16434,16438,16481,16729,17102,17122,17315,17320,17402,17418,17859,17909,17911,17915,17916,17936,17939,17961,18664,18703,18814,18962,19043,33469,33470,33471,33484,33485,33490,33497,33501,33505,33513,33520,33536,33550,37845,37921,37948,38029,38038,38064,38065,38066,38069,38075,38076,38078,39108,39109,39113,39114,39115,39116,39265,39394,189e3]},Wp=[["0","\0",127],["8141","",4,"",6,""],["8161","",9,"",5,""],["8181","",18,"",4,"",6,"",5,"",6,"",7,"",7,"",4,"",4,""],["8241","",7,"",5],["8261","",6,"",5,""],["8281","",7,"",7,"",4,"",10,"",5,"",17,"",7,"",6,"",7,"",18],["8341","",5,"",5,"",7],["8361","",18,""],["8381","",4,"",6,"",5,"",5,"",46,"",6,"",5,"",8],["8441","",5,"",8],["8461","",18],["8481","",7,"",6,"",5,"",10,"",5,"",18,"",5,"",6,"",5,"",26,""],["8541","",5,"",4,"",6,"",4],["8561","",5,"",5,"",6,""],["8581","",6,"",6,"",9,"",26,"",29,"",6,"",5,""],["8641","",6,"",5,""],["8661","",6,"",10],["8681","",22,"",4,"",6,"",5,"",6,"",22,"",4,""],["8741","",9,"",15],["8761","",18,""],["8781","",5,"",7,"",7,"",5,"",6,"",5,"",18,"",6,"",26,"",6,"",4],["8841","",4,"",5,"",6,"",4],["8861","",4,""],["8881","",15,"",4,"",6,"",5,"",54,""],["8941","",6,"",5,""],["8961","",10,"",5,""],["8981","",21,"",18,"",18,"",6,"",6,"",7,"",15],["8a41","",10,"",6,""],["8a61","",4,"",18,""],["8a81","",4,"",19,"",5,"",7,"",5,"",6,"",5,"",4,"",5,"",26,""],["8b41","",5,"",4,"",6,""],["8b61","",6,"",8],["8b81","",52,"",4,"",6,"",5,"",18,"",18],["8c41","",15,"",4],["8c61","",6,"",5,"",6,"",5],["8c81","",12,"",26,"",50,"",5,"",16],["8d41","",16,"",8],["8d61","",17,""],["8d81","",4,"",33,"",6,"",7,"",6,"",9,"",6,"",5,"",6,""],["8e41","",6,"",5,"",8],["8e61","",4,"",19],["8e81","",13,"",6,"",4,"",6,"",5,"",6,"",5,"",11,"",7,"",6,"",5,"",7],["8f41","",7,"",17],["8f61","",7,"",6,"",4],["8f81","",5,"",7,"",5,"",6,"",5,"",18,"",6,"",26,"",6,"",5],["9041","",6,"",5,""],["9061","",5,"",15],["9081","",12,"",6,"",5,"",4,"",6,"",4,"",5,"",11,"",33,""],["9141","",6,"",5],["9161","",9,"",5],["9181","",20,"",4,"",5,"",14,"",33,"",7,"",5,"",6],["9241","",7,"",4,""],["9261","",7,"",7,"",4],["9281","",21,"",18,"",6,"",7,"",6,"",35,""],["9341","",4,""],["9361","",6,"",8],["9381","",37,"",4,"",4,"",6,"",5,"",7,"",22,""],["9441","",5,"",5,"",8],["9461","",5,"",6,"",12],["9481","",5,"",6,"",6,"",9,"",22,"",4,"",6,"",10,"",6,"",24],["9541","",11,"",5,""],["9561","",6,"",5,""],["9581","",6,"",35,"",4,"",4,"",4,"",6,"",5,"",13,"",14],["9641","",23,""],["9661","",6,"",5,"",8],["9681","",10,"",5,"",13,"",33,"",6,"",44],["9741","",16,"",8],["9761","",17,"",7],["9781","",11,"",5,"",6,"",89,""],["9841","",16,"",5,""],["9861","",6,"",15],["9881","",21,"",6,"",5,"",4,"",6,"",5,"",6,"",5,"",6,"",5,""],["9941","",6,"",5,""],["9961","",6,"",5,""],["9981","",8,"",5,"",4,"",11,"",5,"",6,"",6,"",6,"",7,"",6,"",5,""],["9a41","",16],["9a61","",6,"",6,""],["9a81","",4,"",6,"",5,"",5,"",6,"",5,"",5,"",33,"",5,"",6,""],["9b41","",6,"",8],["9b61","",17,"",7],["9b81","",25,"",4,"",5,"",50,"",22,""],["9c41","",4,"",5,"",5],["9c61","",8,"",6,"",9],["9c81","",8,"",6,"",6,"",9,"",26,"",6,"",5,"",18,"",6,"",12],["9d41","",13,"",8],["9d61","",25],["9d81","",8,"",5,"",9,"",6,"",10,"",6,"",5,"",6,"",5,""],["9e41","",7,"",9,""],["9e61","",4,"",6,""],["9e81","",6,"",6,"",6,"",5,"",10,"",5,"",6,"",5,"",6,""],["9f41","",5,"",4,"",5,""],["9f61","",6,"",5,""],["9f81","",4,"",5,"",6,"",5,"",6,"",4,"",6,"",7,"",4,"",4,""],["a041","",5,"",6,""],["a061","",5,"",13],["a081","",4,"",4,"",4,"",6,"",5,"",6,"",5,"",26,"",4,"",5,"",7,""],["a141","",18,""],["a161","",6,"",5,""],["a181","",14,"",5,"",4,"",9,""],["a241","",5,"",18],["a261","",6,"",18],["a281","",7,"",6,"",7,""],["a341","",6,"",10,""],["a361","",6,"",16],["a381","",16,"",4,"",58,"",32,""],["a441","",5,""],["a461","",5,"",12],["a481","",28,"",93],["a541","",4,"",6,"",5,""],["a561","",17,"",5,""],["a581","",16,"",14,"",9],["a5b0","",9],["a5c1","",16,"",6],["a5e1","",16,"",6],["a641","",19,""],["a661","",5,"",5,"",6],["a681","",6,"",18,"",7],["a741","",4,"",6,"",7],["a761","",22,""],["a781","",6,"",5,"",7,"",9,"",9,"",4,"",5,"",4,""],["a841","",10,"",14],["a861","",18,"",6],["a881","",19,"",11,""],["a8a6",""],["a8a8",""],["a8b1","",27,"",25,"",14,""],["a941","",14,"",10],["a961","",18],["a981","",14,"",6,"",27,"",25,"",14,""],["aa41","",6,"",4,""],["aa61","",4,"",5,"",6,""],["aa81","",29,"",82],["ab41","",6,"",5,""],["ab61","",6,"",5,"",5],["ab81","",8,"",6,"",12,"",85],["ac41","",5,"",6,""],["ac61","",11,"",4],["ac81","",28,"",5,"",25],["acd1","",5,"",25],["ad41","",6,"",5,"",7],["ad61","",6,"",10,""],["ad81","",5,"",18,""],["ae41","",5,"",16],["ae61","",5,"",6,"",4],["ae81","",6,"",5,""],["af41","",19],["af61","",13,"",5,""],["af81","",5,"",6,"",5,""],["b041","",5,"",5,"",12],["b061","",5,"",19],["b081","",13,"",6,"",5,"",7,"",4,""],["b141","",6,"",5,""],["b161","",6,"",5,"",11],["b181","",14,"",6,""],["b241","",6,"",5,""],["b261","",18,"",5,""],["b281","",5,"",18,"",6,""],["b341","",19,""],["b361","",5,"",5,"",5],["b381","",5,"",5,"",19,"",4,""],["b441","",5,"",6,"",5],["b461","",6,"",10,""],["b481","",6,"",18,"",4,"",4,""],["b541","",14,"",5],["b561","",5,"",5,"",4],["b581","",6,"",5,"",11,""],["b641","",7,"",17],["b661","",15,""],["b681","",5,"",6,"",5,""],["b741","",13,"",6,""],["b761","",20,""],["b781","",6,"",14,""],["b841","",7,"",17],["b861","",8,"",13],["b881","",5,"",24,"",4,""],["b941","",6,"",5,""],["b961","",14,"",6,""],["b981","",22,"",4,"",4,""],["ba41","",5,"",6,""],["ba61","",5,"",4,"",5],["ba81","",6,"",9,""],["bb41","",4,"",5,"",4,""],["bb61","",6,"",5,""],["bb81","",31,""],["bc41","",17,""],["bc61","",5,"",6,""],["bc81","",4,"",6,"",5,"",5,"",4,""],["bd41","",7,"",7,""],["bd61","",5,"",13],["bd81","",5,"",25,""],["be41","",7,"",14],["be61","",7,"",7,""],["be81","",4,"",4,"",5,"",8,"",6,""],["bf41","",10,"",14],["bf61","",18,""],["bf81","",5,"",7,"",6,"",5,""],["c041","",5,"",6,"",5],["c061","",25],["c081","",6,"",5,"",7,""],["c141","",5,"",6,""],["c161","",19,""],["c181","",31,""],["c241","",4,"",5,""],["c261","",4,"",5,"",6,""],["c281","",5,"",7,"",9,""],["c341","",4],["c361","",4,"",5,"",11],["c381","",5,"",7,"",5,""],["c441","",7,"",7,""],["c461","",5,"",4],["c481","",5,"",11,""],["c541","",6,"",5,""],["c561","",6,"",5,"",4],["c581","",6,"",5,""],["c641","",6,"",5],["c6a1",""],["c7a1",""],["c8a1",""],["caa1",""],["cba1",""],["cca1",""],["cda1",""],["cea1",""],["cfa1",""],["d0a1",""],["d1a1","",5,"",4,""],["d2a1","",4,"",5,"",10,"",7,"",5,""],["d3a1",""],["d4a1",""],["d5a1",""],["d6a1",""],["d7a1",""],["d8a1",""],["d9a1",""],["daa1",""],["dba1",""],["dca1",""],["dda1",""],["dea1",""],["dfa1",""],["e0a1",""],["e1a1",""],["e2a1",""],["e3a1",""],["e4a1",""],["e5a1",""],["e6a1",""],["e7a1",""],["e8a1",""],["e9a1",""],["eaa1",""],["eba1",""],["eca1",""],["eda1",""],["eea1",""],["efa1",""],["f0a1",""],["f1a1",""],["f2a1",""],["f3a1",""],["f4a1",""],["f5a1",""],["f6a1",""],["f7a1",""],["f8a1",""],["f9a1",""],["faa1",""],["fba1",""],["fca1",""],["fda1",""]],Ul=[["0","\0",127],["a140",""],["a1a1","",4,""],["a240","",7,""],["a2a1","",9,"",9,"",8,"",25,"",21],["a340","",16,"",6,"",16,"",6,"",10],["a3a1","",25,""],["a3e1",""],["a440",""],["a4a1",""],["a540",""],["a5a1",""],["a640",""],["a6a1",""],["a740",""],["a7a1",""],["a840",""],["a8a1",""],["a940",""],["a9a1",""],["aa40",""],["aaa1",""],["ab40",""],["aba1",""],["ac40",""],["aca1",""],["ad40",""],["ada1",""],["ae40",""],["aea1",""],["af40",""],["afa1",""],["b040",""],["b0a1",""],["b140",""],["b1a1",""],["b240",""],["b2a1",""],["b340",""],["b3a1",""],["b440",""],["b4a1",""],["b540",""],["b5a1",""],["b640",""],["b6a1",""],["b740",""],["b7a1",""],["b840",""],["b8a1",""],["b940",""],["b9a1",""],["ba40",""],["baa1",""],["bb40",""],["bba1",""],["bc40",""],["bca1",""],["bd40",""],["bda1",""],["be40",""],["bea1",""],["bf40",""],["bfa1",""],["c040",""],["c0a1",""],["c140",""],["c1a1",""],["c240",""],["c2a1",""],["c340",""],["c3a1",""],["c440",""],["c4a1",""],["c540",""],["c5a1",""],["c640",""],["c940",""],["c9a1",""],["ca40",""],["caa1",""],["cb40",""],["cba1",""],["cc40",""],["cca1",""],["cd40",""],["cda1",""],["ce40",""],["cea1",""],["cf40",""],["cfa1",""],["d040",""],["d0a1",""],["d140",""],["d1a1",""],["d240",""],["d2a1",""],["d340",""],["d3a1",""],["d440",""],["d4a1",""],["d540",""],["d5a1",""],["d640",""],["d6a1",""],["d740",""],["d7a1",""],["d840",""],["d8a1",""],["d940",""],["d9a1",""],["da40",""],["daa1",""],["db40",""],["dba1",""],["dc40",""],["dca1",""],["dd40",""],["dda1",""],["de40",""],["dea1",""],["df40",""],["dfa1",""],["e040",""],["e0a1",""],["e140",""],["e1a1",""],["e240",""],["e2a1",""],["e340",""],["e3a1",""],["e440",""],["e4a1",""],["e540",""],["e5a1",""],["e640",""],["e6a1",""],["e740",""],["e7a1",""],["e840",""],["e8a1",""],["e940",""],["e9a1",""],["ea40",""],["eaa1",""],["eb40",""],["eba1",""],["ec40",""],["eca1",""],["ed40",""],["eda1",""],["ee40",""],["eea1",""],["ef40",""],["efa1",""],["f040",""],["f0a1",""],["f140",""],["f1a1",""],["f240",""],["f2a1",""],["f340",""],["f3a1",""],["f440",""],["f4a1",""],["f540",""],["f5a1",""],["f640",""],["f6a1",""],["f740",""],["f7a1",""],["f840",""],["f8a1",""],["f940",""],["f9a1",""]],zp=[["8740",""],["8767",""],["87a1",""],["8840","",4,""],["88a1",""],["8940",""],["8943",""],["8946",""],["894c",""],["89a1",""],["89ab",""],["89b0",""],["89b5",""],["89c1",""],["89c5",""],["8a40",""],["8a43",""],["8a64",""],["8a76",""],["8aa1",""],["8aac",""],["8ab2",""],["8abb",""],["8ac9",""],["8ace",""],["8adf",""],["8af6",""],["8b40",""],["8b55",""],["8ba1",""],["8bde",""],["8c40",""],["8ca1",""],["8ca7",""],["8cc9",""],["8cce",""],["8ce6",""],["8d40",""],["8d42",""],["8da1",""],["8e40",""],["8ea1",""],["8f40",""],["8fa1",""],["9040",""],["90a1",""],["9140",""],["91a1",""],["9240",""],["92a1",""],["9340",""],["93a1",""],["9440",""],["94a1",""],["9540",""],["95a1",""],["9640",""],["96a1",""],["9740",""],["97a1",""],["9840",""],["98a1",""],["9940",""],["99a1",""],["9a40",""],["9aa1",""],["9b40",""],["9b62",""],["9ba1",""],["9c40",""],["9ca1",""],["9d40",""],["9da1",""],["9e40",""],["9ea1",""],["9ead",""],["9ec5",""],["9ef5",""],["9f40",""],["9f4f",""],["9fa1",""],["9fae",""],["9fb2",""],["9fc1",""],["9fc9",""],["9fdb",""],["9fe7",""],["9feb",""],["9ff0",""],["a040",""],["a055",""],["a058",""],["a05b",""],["a063",""],["a073",""],["a0a1",""],["a0a6",""],["a0ae",""],["a0b0",""],["a0d4",""],["a0e2",""],["a3c0","",31,""],["c6a1","",9,"",9,"",9,"",23],["c740","",58,""],["c7a1","",81,"",5,"",4],["c840","",26,"",25,""],["c8a1",""],["c8cd",""],["c8f5",""],["f9fe",""],["fa40",""],["faa1",""],["fb40",""],["fba1",""],["fc40",""],["fca1",""],["fd40",""],["fda1",""],["fe40",""],["fea1",""]];var $s,Hl;function qp(){return Hl||(Hl=1,$s={shiftjis:{type:"_dbcs",table:function(){return Fp},encodeAdd:{"":92,"":126},encodeSkipVals:[{from:60736,to:63808}]},csshiftjis:"shiftjis",mskanji:"shiftjis",sjis:"shiftjis",windows31j:"shiftjis",ms31j:"shiftjis",xsjis:"shiftjis",windows932:"shiftjis",ms932:"shiftjis",932:"shiftjis",cp932:"shiftjis",eucjp:{type:"_dbcs",table:function(){return Up},encodeAdd:{"":92,"":126}},gb2312:"cp936",gb231280:"cp936",gb23121980:"cp936",csgb2312:"cp936",csiso58gb231280:"cp936",euccn:"cp936",windows936:"cp936",ms936:"cp936",936:"cp936",cp936:{type:"_dbcs",table:function(){return js}},gbk:{type:"_dbcs",table:function(){return js.concat(Fl)}},xgbk:"gbk",isoir58:"gbk",gb18030:{type:"_dbcs",table:function(){return js.concat(Fl)},gb18030:function(){return Hp},encodeSkipVals:[128],encodeAdd:{"":41699}},chinese:"gb18030",windows949:"cp949",ms949:"cp949",949:"cp949",cp949:{type:"_dbcs",table:function(){return Wp}},cseuckr:"cp949",csksc56011987:"cp949",euckr:"cp949",isoir149:"cp949",korean:"cp949",ksc56011987:"cp949",ksc56011989:"cp949",ksc5601:"cp949",windows950:"cp950",ms950:"cp950",950:"cp950",cp950:{type:"_dbcs",table:function(){return Ul}},big5:"big5hkscs",big5hkscs:{type:"_dbcs",table:function(){return Ul.concat(zp)},encodeSkipVals:[36457,36463,36478,36523,36532,36557,36560,36695,36713,36718,36811,36862,36973,36986,37060,37084,37105,37311,37551,37552,37553,37554,37585,37959,38090,38361,38652,39285,39798,39800,39803,39878,39902,39916,39926,40002,40019,40034,40040,40043,40055,40124,40125,40144,40279,40282,40388,40431,40443,40617,40687,40701,40800,40907,41079,41180,41183,36812,37576,38468,38637,41636,41637,41639,41638,41676,41678]},cnbig5:"big5hkscs",csbig5:"big5hkscs",xxbig5:"big5hkscs"}),$s}var Wl;function jp(){return Wl||(Wl=1,function(e){for(var t=Bl,r=[Dp(),Tp(),Lp(),Pp(),Mp(),Op(),Ip(),Np(),qp()],i=0;i<r.length;i++){var s=r[i];t(e,s)}}(Is)),Is}var Ks,zl;function $p(){if(zl)return Ks;zl=1;var e=Xt.Buffer;return Ks=function(t){var r=t.Transform;function i(n,o){this.conv=n,o=o||{},o.decodeStrings=!1,r.call(this,o)}i.prototype=Object.create(r.prototype,{constructor:{value:i}}),i.prototype._transform=function(n,o,a){if(typeof n!="string")return a(new Error("Iconv encoding stream needs strings as its input."));try{var h=this.conv.write(n);h&&h.length&&this.push(h),a()}catch(l){a(l)}},i.prototype._flush=function(n){try{var o=this.conv.end();o&&o.length&&this.push(o),n()}catch(a){n(a)}},i.prototype.collect=function(n){var o=[];return this.on("error",n),this.on("data",function(a){o.push(a)}),this.on("end",function(){n(null,e.concat(o))}),this};function s(n,o){this.conv=n,o=o||{},o.encoding=this.encoding="utf8",r.call(this,o)}return s.prototype=Object.create(r.prototype,{constructor:{value:s}}),s.prototype._transform=function(n,o,a){if(!e.isBuffer(n)&&!(n instanceof Uint8Array))return a(new Error("Iconv decoding stream needs buffers as its input."));try{var h=this.conv.write(n);h&&h.length&&this.push(h,this.encoding),a()}catch(l){a(l)}},s.prototype._flush=function(n){try{var o=this.conv.end();o&&o.length&&this.push(o,this.encoding),n()}catch(a){n(a)}},s.prototype.collect=function(n){var o="";return this.on("error",n),this.on("data",function(a){o+=a}),this.on("end",function(){n(null,o)}),this},{IconvLiteEncoderStream:i,IconvLiteDecoderStream:s}},Ks}var Mi={exports:{}},ql;function Vs(){if(ql)return Mi.exports;ql=1;var e=typeof Reflect=="object"?Reflect:null,t=e&&typeof e.apply=="function"?e.apply:function(k,R,O){return Function.prototype.apply.call(k,R,O)},r;e&&typeof e.ownKeys=="function"?r=e.ownKeys:Object.getOwnPropertySymbols?r=function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:r=function(k){return Object.getOwnPropertyNames(k)};function i(v){console&&console.warn&&console.warn(v)}var s=Number.isNaN||function(k){return k!==k};function n(){n.init.call(this)}Mi.exports=n,Mi.exports.once=y,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var o=10;function a(v){if(typeof v!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof v)}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(v){if(typeof v!="number"||v<0||s(v))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+v+".");o=v}}),n.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(k){if(typeof k!="number"||k<0||s(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this};function h(v){return v._maxListeners===void 0?n.defaultMaxListeners:v._maxListeners}n.prototype.getMaxListeners=function(){return h(this)},n.prototype.emit=function(k){for(var R=[],O=1;O<arguments.length;O++)R.push(arguments[O]);var N=k==="error",W=this._events;if(W!==void 0)N=N&&W.error===void 0;else if(!N)return!1;if(N){var Q;if(R.length>0&&(Q=R[0]),Q instanceof Error)throw Q;var ie=new Error("Unhandled error."+(Q?" ("+Q.message+")":""));throw ie.context=Q,ie}var K=W[k];if(K===void 0)return!1;if(typeof K=="function")t(K,this,R);else for(var H=K.length,G=m(K,H),O=0;O<H;++O)t(G[O],this,R);return!0};function l(v,k,R,O){var N,W,Q;if(a(R),W=v._events,W===void 0?(W=v._events=Object.create(null),v._eventsCount=0):(W.newListener!==void 0&&(v.emit("newListener",k,R.listener?R.listener:R),W=v._events),Q=W[k]),Q===void 0)Q=W[k]=R,++v._eventsCount;else if(typeof Q=="function"?Q=W[k]=O?[R,Q]:[Q,R]:O?Q.unshift(R):Q.push(R),N=h(v),N>0&&Q.length>N&&!Q.warned){Q.warned=!0;var ie=new Error("Possible EventEmitter memory leak detected. "+Q.length+" "+String(k)+" listeners added. Use emitter.setMaxListeners() to increase limit");ie.name="MaxListenersExceededWarning",ie.emitter=v,ie.type=k,ie.count=Q.length,i(ie)}return v}n.prototype.addListener=function(k,R){return l(this,k,R,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(k,R){return l(this,k,R,!0)};function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(v,k,R){var O={fired:!1,wrapFn:void 0,target:v,type:k,listener:R},N=c.bind(O);return N.listener=R,O.wrapFn=N,N}n.prototype.once=function(k,R){return a(R),this.on(k,u(this,k,R)),this},n.prototype.prependOnceListener=function(k,R){return a(R),this.prependListener(k,u(this,k,R)),this},n.prototype.removeListener=function(k,R){var O,N,W,Q,ie;if(a(R),N=this._events,N===void 0)return this;if(O=N[k],O===void 0)return this;if(O===R||O.listener===R)--this._eventsCount===0?this._events=Object.create(null):(delete N[k],N.removeListener&&this.emit("removeListener",k,O.listener||R));else if(typeof O!="function"){for(W=-1,Q=O.length-1;Q>=0;Q--)if(O[Q]===R||O[Q].listener===R){ie=O[Q].listener,W=Q;break}if(W<0)return this;W===0?O.shift():g(O,W),O.length===1&&(N[k]=O[0]),N.removeListener!==void 0&&this.emit("removeListener",k,ie||R)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(k){var R,O,N;if(O=this._events,O===void 0)return this;if(O.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):O[k]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete O[k]),this;if(arguments.length===0){var W=Object.keys(O),Q;for(N=0;N<W.length;++N)Q=W[N],Q!=="removeListener"&&this.removeAllListeners(Q);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(R=O[k],typeof R=="function")this.removeListener(k,R);else if(R!==void 0)for(N=R.length-1;N>=0;N--)this.removeListener(k,R[N]);return this};function p(v,k,R){var O=v._events;if(O===void 0)return[];var N=O[k];return N===void 0?[]:typeof N=="function"?R?[N.listener||N]:[N]:R?w(N):m(N,N.length)}n.prototype.listeners=function(k){return p(this,k,!0)},n.prototype.rawListeners=function(k){return p(this,k,!1)},n.listenerCount=function(v,k){return typeof v.listenerCount=="function"?v.listenerCount(k):_.call(v,k)},n.prototype.listenerCount=_;function _(v){var k=this._events;if(k!==void 0){var R=k[v];if(typeof R=="function")return 1;if(R!==void 0)return R.length}return 0}n.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]};function m(v,k){for(var R=new Array(k),O=0;O<k;++O)R[O]=v[O];return R}function g(v,k){for(;k+1<v.length;k++)v[k]=v[k+1];v.pop()}function w(v){for(var k=new Array(v.length),R=0;R<k.length;++R)k[R]=v[R].listener||v[R];return k}function y(v,k){return new Promise(function(R,O){function N(Q){v.removeListener(k,W),O(Q)}function W(){typeof v.removeListener=="function"&&v.removeListener("error",N),R([].slice.call(arguments))}S(v,k,W,{once:!0}),k!=="error"&&E(v,N,{once:!0})})}function E(v,k,R){typeof v.on=="function"&&S(v,"error",k,R)}function S(v,k,R,O){if(typeof v.on=="function")O.once?v.once(k,R):v.on(k,R);else if(typeof v.addEventListener=="function")v.addEventListener(k,function N(W){O.once&&v.removeEventListener(k,N),R(W)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof v)}return Mi.exports}var Oi={exports:{}},jl;function hr(){return jl||(jl=1,typeof Object.create=="function"?Oi.exports=function(t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:Oi.exports=function(t,r){if(r){t.super_=r;var i=function(){};i.prototype=r.prototype,t.prototype=new i,t.prototype.constructor=t}}),Oi.exports}var Gs,$l;function Kl(){return $l||($l=1,Gs=Vs().EventEmitter),Gs}var Ys={},Xs={},Js,Vl;function Gl(){return Vl||(Vl=1,Js=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},r=Symbol("test"),i=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var s=42;t[r]=s;for(var n in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,r);if(a.value!==s||a.enumerable!==!0)return!1}return!0}),Js}var Zs,Yl;function Ii(){if(Yl)return Zs;Yl=1;var e=Gl();return Zs=function(){return e()&&!!Symbol.toStringTag},Zs}var Qs,Xl;function Jl(){return Xl||(Xl=1,Qs=Object),Qs}var en,Zl;function Kp(){return Zl||(Zl=1,en=Error),en}var tn,Ql;function Vp(){return Ql||(Ql=1,tn=EvalError),tn}var rn,eh;function Gp(){return eh||(eh=1,rn=RangeError),rn}var sn,th;function Yp(){return th||(th=1,sn=ReferenceError),sn}var nn,rh;function ih(){return rh||(rh=1,nn=SyntaxError),nn}var on,sh;function jr(){return sh||(sh=1,on=TypeError),on}var an,nh;function Xp(){return nh||(nh=1,an=URIError),an}var ln,oh;function Jp(){return oh||(oh=1,ln=Math.abs),ln}var hn,ah;function Zp(){return ah||(ah=1,hn=Math.floor),hn}var cn,lh;function Qp(){return lh||(lh=1,cn=Math.max),cn}var un,hh;function e_(){return hh||(hh=1,un=Math.min),un}var fn,ch;function t_(){return ch||(ch=1,fn=Math.pow),fn}var dn,uh;function r_(){return uh||(uh=1,dn=Math.round),dn}var pn,fh;function i_(){return fh||(fh=1,pn=Number.isNaN||function(t){return t!==t}),pn}var _n,dh;function s_(){if(dh)return _n;dh=1;var e=i_();return _n=function(r){return e(r)||r===0?r:r<0?-1:1},_n}var gn,ph;function n_(){return ph||(ph=1,gn=Object.getOwnPropertyDescriptor),gn}var vn,_h;function Rr(){if(_h)return vn;_h=1;var e=n_();if(e)try{e([],"length")}catch{e=null}return vn=e,vn}var mn,gh;function Ni(){if(gh)return mn;gh=1;var e=Object.defineProperty||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return mn=e,mn}var yn,vh;function o_(){if(vh)return yn;vh=1;var e=typeof Symbol<"u"&&Symbol,t=Gl();return yn=function(){return typeof e!="function"||typeof Symbol!="function"||typeof e("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},yn}var bn,mh;function yh(){return mh||(mh=1,bn=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),bn}var wn,bh;function wh(){if(bh)return wn;bh=1;var e=Jl();return wn=e.getPrototypeOf||null,wn}var Sn,Sh;function a_(){if(Sh)return Sn;Sh=1;var e="Function.prototype.bind called on incompatible ",t=Object.prototype.toString,r=Math.max,i="[object Function]",s=function(h,l){for(var c=[],u=0;u<h.length;u+=1)c[u]=h[u];for(var p=0;p<l.length;p+=1)c[p+h.length]=l[p];return c},n=function(h,l){for(var c=[],u=l,p=0;u<h.length;u+=1,p+=1)c[p]=h[u];return c},o=function(a,h){for(var l="",c=0;c<a.length;c+=1)l+=a[c],c+1<a.length&&(l+=h);return l};return Sn=function(h){var l=this;if(typeof l!="function"||t.apply(l)!==i)throw new TypeError(e+l);for(var c=n(arguments,1),u,p=function(){if(this instanceof u){var y=l.apply(this,s(c,arguments));return Object(y)===y?y:this}return l.apply(h,s(c,arguments))},_=r(0,l.length-c.length),m=[],g=0;g<_;g++)m[g]="$"+g;if(u=Function("binder","return function ("+o(m,",")+"){ return binder.apply(this,arguments); }")(p),l.prototype){var w=function(){};w.prototype=l.prototype,u.prototype=new w,w.prototype=null}return u},Sn}var Cn,Ch;function $r(){if(Ch)return Cn;Ch=1;var e=a_();return Cn=Function.prototype.bind||e,Cn}var En,Eh;function xn(){return Eh||(Eh=1,En=Function.prototype.call),En}var kn,xh;function Bn(){return xh||(xh=1,kn=Function.prototype.apply),kn}var Rn,kh;function l_(){return kh||(kh=1,Rn=typeof Reflect<"u"&&Reflect&&Reflect.apply),Rn}var An,Bh;function Rh(){if(Bh)return An;Bh=1;var e=$r(),t=Bn(),r=xn(),i=l_();return An=i||e.call(r,t),An}var Dn,Ah;function Tn(){if(Ah)return Dn;Ah=1;var e=$r(),t=jr(),r=xn(),i=Rh();return Dn=function(n){if(n.length<1||typeof n[0]!="function")throw new t("a function is required");return i(e,r,n)},Dn}var Ln,Dh;function h_(){if(Dh)return Ln;Dh=1;var e=Tn(),t=Rr(),r;try{r=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var i=!!r&&t&&t(Object.prototype,"__proto__"),s=Object,n=s.getPrototypeOf;return Ln=i&&typeof i.get=="function"?e([i.get]):typeof n=="function"?function(a){return n(a==null?a:s(a))}:!1,Ln}var Pn,Th;function Mn(){if(Th)return Pn;Th=1;var e=yh(),t=wh(),r=h_();return Pn=e?function(s){return e(s)}:t?function(s){if(!s||typeof s!="object"&&typeof s!="function")throw new TypeError("getProto: not an object");return t(s)}:r?function(s){return r(s)}:null,Pn}var On,Lh;function Ph(){if(Lh)return On;Lh=1;var e=Function.prototype.call,t=Object.prototype.hasOwnProperty,r=$r();return On=r.call(e,t),On}var In,Mh;function Oh(){if(Mh)return In;Mh=1;var e,t=Jl(),r=Kp(),i=Vp(),s=Gp(),n=Yp(),o=ih(),a=jr(),h=Xp(),l=Jp(),c=Zp(),u=Qp(),p=e_(),_=t_(),m=r_(),g=s_(),w=Function,y=function($){try{return w('"use strict"; return ('+$+").constructor;")()}catch{}},E=Rr(),S=Ni(),v=function(){throw new a},k=E?function(){try{return arguments.callee,v}catch{try{return E(arguments,"callee").get}catch{return v}}}():v,R=o_()(),O=Mn(),N=wh(),W=yh(),Q=Bn(),ie=xn(),K={},H=typeof Uint8Array>"u"||!O?e:O(Uint8Array),G={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?e:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?e:ArrayBuffer,"%ArrayIteratorPrototype%":R&&O?O([][Symbol.iterator]()):e,"%AsyncFromSyncIteratorPrototype%":e,"%AsyncFunction%":K,"%AsyncGenerator%":K,"%AsyncGeneratorFunction%":K,"%AsyncIteratorPrototype%":K,"%Atomics%":typeof Atomics>"u"?e:Atomics,"%BigInt%":typeof BigInt>"u"?e:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?e:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?e:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?e:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":r,"%eval%":eval,"%EvalError%":i,"%Float16Array%":typeof Float16Array>"u"?e:Float16Array,"%Float32Array%":typeof Float32Array>"u"?e:Float32Array,"%Float64Array%":typeof Float64Array>"u"?e:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?e:FinalizationRegistry,"%Function%":w,"%GeneratorFunction%":K,"%Int8Array%":typeof Int8Array>"u"?e:Int8Array,"%Int16Array%":typeof Int16Array>"u"?e:Int16Array,"%Int32Array%":typeof Int32Array>"u"?e:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":R&&O?O(O([][Symbol.iterator]())):e,"%JSON%":typeof JSON=="object"?JSON:e,"%Map%":typeof Map>"u"?e:Map,"%MapIteratorPrototype%":typeof Map>"u"||!R||!O?e:O(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":t,"%Object.getOwnPropertyDescriptor%":E,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?e:Promise,"%Proxy%":typeof Proxy>"u"?e:Proxy,"%RangeError%":s,"%ReferenceError%":n,"%Reflect%":typeof Reflect>"u"?e:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?e:Set,"%SetIteratorPrototype%":typeof Set>"u"||!R||!O?e:O(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?e:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":R&&O?O(""[Symbol.iterator]()):e,"%Symbol%":R?Symbol:e,"%SyntaxError%":o,"%ThrowTypeError%":k,"%TypedArray%":H,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?e:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?e:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?e:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?e:Uint32Array,"%URIError%":h,"%WeakMap%":typeof WeakMap>"u"?e:WeakMap,"%WeakRef%":typeof WeakRef>"u"?e:WeakRef,"%WeakSet%":typeof WeakSet>"u"?e:WeakSet,"%Function.prototype.call%":ie,"%Function.prototype.apply%":Q,"%Object.defineProperty%":S,"%Object.getPrototypeOf%":N,"%Math.abs%":l,"%Math.floor%":c,"%Math.max%":u,"%Math.min%":p,"%Math.pow%":_,"%Math.round%":m,"%Math.sign%":g,"%Reflect.getPrototypeOf%":W};if(O)try{null.error}catch($){var J=O(O($));G["%Error.prototype%"]=J}var ee=function $(V){var C;if(V==="%AsyncFunction%")C=y("async function () {}");else if(V==="%GeneratorFunction%")C=y("function* () {}");else if(V==="%AsyncGeneratorFunction%")C=y("async function* () {}");else if(V==="%AsyncGenerator%"){var x=$("%AsyncGeneratorFunction%");x&&(C=x.prototype)}else if(V==="%AsyncIteratorPrototype%"){var P=$("%AsyncGenerator%");P&&O&&(C=O(P.prototype))}return G[V]=C,C},se={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Y=$r(),le=Ph(),me=Y.call(ie,Array.prototype.concat),ke=Y.call(Q,Array.prototype.splice),L=Y.call(ie,String.prototype.replace),I=Y.call(ie,String.prototype.slice),U=Y.call(ie,RegExp.prototype.exec),te=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,A=/\\(\\)?/g,D=function(V){var C=I(V,0,1),x=I(V,-1);if(C==="%"&&x!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(x==="%"&&C!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var P=[];return L(V,te,function(X,_e,ne,de){P[P.length]=ne?L(de,A,"$1"):_e||X}),P},F=function(V,C){var x=V,P;if(le(se,x)&&(P=se[x],x="%"+P[0]+"%"),le(G,x)){var X=G[x];if(X===K&&(X=ee(x)),typeof X>"u"&&!C)throw new a("intrinsic "+V+" exists, but is not available. Please file an issue!");return{alias:P,name:x,value:X}}throw new o("intrinsic "+V+" does not exist!")};return In=function(V,C){if(typeof V!="string"||V.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof C!="boolean")throw new a('"allowMissing" argument must be a boolean');if(U(/^%?[^%]*%?$/,V)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var x=D(V),P=x.length>0?x[0]:"",X=F("%"+P+"%",C),_e=X.name,ne=X.value,de=!1,tt=X.alias;tt&&(P=tt[0],ke(x,me([0,1],tt)));for(var z=1,rt=!0;z<x.length;z+=1){var it=x[z],jt=I(it,0,1),mt=I(it,-1);if((jt==='"'||jt==="'"||jt==="`"||mt==='"'||mt==="'"||mt==="`")&&jt!==mt)throw new o("property names with quotes must have matching quotes");if((it==="constructor"||!rt)&&(de=!0),P+="."+it,_e="%"+P+"%",le(G,_e))ne=G[_e];else if(ne!=null){if(!(it in ne)){if(!C)throw new a("base intrinsic for "+V+" exists, but the property is not available.");return}if(E&&z+1>=x.length){var lt=E(ne,it);rt=!!lt,rt&&"get"in lt&&!("originalValue"in lt.get)?ne=lt.get:ne=ne[it]}else rt=le(ne,it),ne=ne[it];rt&&!de&&(G[_e]=ne)}}return ne},In}var Nn,Ih;function Kr(){if(Ih)return Nn;Ih=1;var e=Oh(),t=Tn(),r=t([e("%String.prototype.indexOf%")]);return Nn=function(s,n){var o=e(s,!!n);return typeof o=="function"&&r(s,".prototype.")>-1?t([o]):o},Nn}var Fn,Nh;function c_(){if(Nh)return Fn;Nh=1;var e=Ii()(),t=Kr(),r=t("Object.prototype.toString"),i=function(a){return e&&a&&typeof a=="object"&&Symbol.toStringTag in a?!1:r(a)==="[object Arguments]"},s=function(a){return i(a)?!0:a!==null&&typeof a=="object"&&"length"in a&&typeof a.length=="number"&&a.length>=0&&r(a)!=="[object Array]"&&"callee"in a&&r(a.callee)==="[object Function]"},n=function(){return i(arguments)}();return i.isLegacyArguments=s,Fn=n?i:s,Fn}var Un,Fh;function u_(){if(Fh)return Un;Fh=1;var e=Kr(),t=Ii()(),r=Ph(),i=Rr(),s;if(t){var n=e("RegExp.prototype.exec"),o={},a=function(){throw o},h={toString:a,valueOf:a};typeof Symbol.toPrimitive=="symbol"&&(h[Symbol.toPrimitive]=a),s=function(p){if(!p||typeof p!="object")return!1;var _=i(p,"lastIndex"),m=_&&r(_,"value");if(!m)return!1;try{n(p,h)}catch(g){return g===o}}}else{var l=e("Object.prototype.toString"),c="[object RegExp]";s=function(p){return!p||typeof p!="object"&&typeof p!="function"?!1:l(p)===c}}return Un=s,Un}var Hn,Uh;function f_(){if(Uh)return Hn;Uh=1;var e=Kr(),t=u_(),r=e("RegExp.prototype.exec"),i=jr();return Hn=function(n){if(!t(n))throw new i("`regex` must be a RegExp");return function(a){return r(n,a)!==null}},Hn}var Wn,Hh;function d_(){if(Hh)return Wn;Hh=1;const e=(function*(){}).constructor;return Wn=()=>e,Wn}var zn,Wh;function p_(){if(Wh)return zn;Wh=1;var e=Kr(),t=f_(),r=t(/^\s*(?:function)?\*/),i=Ii()(),s=Mn(),n=e("Object.prototype.toString"),o=e("Function.prototype.toString"),a=d_();return zn=function(l){if(typeof l!="function")return!1;if(r(o(l)))return!0;if(!i){var c=n(l);return c==="[object GeneratorFunction]"}if(!s)return!1;var u=a();return u&&s(l)===u.prototype},zn}var qn,zh;function __(){if(zh)return qn;zh=1;var e=Function.prototype.toString,t=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,r,i;if(typeof t=="function"&&typeof Object.defineProperty=="function")try{r=Object.defineProperty({},"length",{get:function(){throw i}}),i={},t(function(){throw 42},null,r)}catch(E){E!==i&&(t=null)}else t=null;var s=/^\s*class\b/,n=function(S){try{var v=e.call(S);return s.test(v)}catch{return!1}},o=function(S){try{return n(S)?!1:(e.call(S),!0)}catch{return!1}},a=Object.prototype.toString,h="[object Object]",l="[object Function]",c="[object GeneratorFunction]",u="[object HTMLAllCollection]",p="[object HTML document.all class]",_="[object HTMLCollection]",m=typeof Symbol=="function"&&!!Symbol.toStringTag,g=!(0 in[,]),w=function(){return!1};if(typeof document=="object"){var y=document.all;a.call(y)===a.call(document.all)&&(w=function(S){if((g||!S)&&(typeof S>"u"||typeof S=="object"))try{var v=a.call(S);return(v===u||v===p||v===_||v===h)&&S("")==null}catch{}return!1})}return qn=t?function(S){if(w(S))return!0;if(!S||typeof S!="function"&&typeof S!="object")return!1;try{t(S,null,r)}catch(v){if(v!==i)return!1}return!n(S)&&o(S)}:function(S){if(w(S))return!0;if(!S||typeof S!="function"&&typeof S!="object")return!1;if(m)return o(S);if(n(S))return!1;var v=a.call(S);return v!==l&&v!==c&&!/^\[object HTML/.test(v)?!1:o(S)},qn}var jn,qh;function g_(){if(qh)return jn;qh=1;var e=__(),t=Object.prototype.toString,r=Object.prototype.hasOwnProperty,i=function(h,l,c){for(var u=0,p=h.length;u<p;u++)r.call(h,u)&&(c==null?l(h[u],u,h):l.call(c,h[u],u,h))},s=function(h,l,c){for(var u=0,p=h.length;u<p;u++)c==null?l(h.charAt(u),u,h):l.call(c,h.charAt(u),u,h)},n=function(h,l,c){for(var u in h)r.call(h,u)&&(c==null?l(h[u],u,h):l.call(c,h[u],u,h))};function o(a){return t.call(a)==="[object Array]"}return jn=function(h,l,c){if(!e(l))throw new TypeError("iterator must be a function");var u;arguments.length>=3&&(u=c),o(h)?i(h,l,u):typeof h=="string"?s(h,l,u):n(h,l,u)},jn}var $n,jh;function v_(){return jh||(jh=1,$n=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]),$n}var Kn,$h;function m_(){if($h)return Kn;$h=1;var e=v_(),t=typeof globalThis>"u"?Yt:globalThis;return Kn=function(){for(var i=[],s=0;s<e.length;s++)typeof t[e[s]]=="function"&&(i[i.length]=e[s]);return i},Kn}var Vn={exports:{}},Gn,Kh;function y_(){if(Kh)return Gn;Kh=1;var e=Ni(),t=ih(),r=jr(),i=Rr();return Gn=function(n,o,a){if(!n||typeof n!="object"&&typeof n!="function")throw new r("`obj` must be an object or a function`");if(typeof o!="string"&&typeof o!="symbol")throw new r("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new r("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new r("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new r("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new r("`loose`, if provided, must be a boolean");var h=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,u=arguments.length>6?arguments[6]:!1,p=!!i&&i(n,o);if(e)e(n,o,{configurable:c===null&&p?p.configurable:!c,enumerable:h===null&&p?p.enumerable:!h,value:a,writable:l===null&&p?p.writable:!l});else if(u||!h&&!l&&!c)n[o]=a;else throw new t("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Gn}var Yn,Vh;function b_(){if(Vh)return Yn;Vh=1;var e=Ni(),t=function(){return!!e};return t.hasArrayLengthDefineBug=function(){if(!e)return null;try{return e([],"length",{value:1}).length!==1}catch{return!0}},Yn=t,Yn}var Xn,Gh;function w_(){if(Gh)return Xn;Gh=1;var e=Oh(),t=y_(),r=b_()(),i=Rr(),s=jr(),n=e("%Math.floor%");return Xn=function(a,h){if(typeof a!="function")throw new s("`fn` is not a function");if(typeof h!="number"||h<0||h>4294967295||n(h)!==h)throw new s("`length` must be a positive 32-bit integer");var l=arguments.length>2&&!!arguments[2],c=!0,u=!0;if("length"in a&&i){var p=i(a,"length");p&&!p.configurable&&(c=!1),p&&!p.writable&&(u=!1)}return(c||u||!l)&&(r?t(a,"length",h,!0,!0):t(a,"length",h)),a},Xn}var Jn,Yh;function S_(){if(Yh)return Jn;Yh=1;var e=$r(),t=Bn(),r=Rh();return Jn=function(){return r(e,t,arguments)},Jn}var Xh;function C_(){return Xh||(Xh=1,function(e){var t=w_(),r=Ni(),i=Tn(),s=S_();e.exports=function(o){var a=i(arguments),h=o.length-(arguments.length-1);return t(a,1+(h>0?h:0),!0)},r?r(e.exports,"apply",{value:s}):e.exports.apply=s}(Vn)),Vn.exports}var Zn,Jh;function Zh(){if(Jh)return Zn;Jh=1;var e=g_(),t=m_(),r=C_(),i=Kr(),s=Rr(),n=Mn(),o=i("Object.prototype.toString"),a=Ii()(),h=typeof globalThis>"u"?Yt:globalThis,l=t(),c=i("String.prototype.slice"),u=i("Array.prototype.indexOf",!0)||function(w,y){for(var E=0;E<w.length;E+=1)if(w[E]===y)return E;return-1},p={__proto__:null};a&&s&&n?e(l,function(g){var w=new h[g];if(Symbol.toStringTag in w&&n){var y=n(w),E=s(y,Symbol.toStringTag);if(!E&&y){var S=n(y);E=s(S,Symbol.toStringTag)}if(E&&E.get){var v=r(E.get);p["$"+g]=v}}}):e(l,function(g){var w=new h[g],y=w.slice||w.set;if(y){var E=r(y);p["$"+g]=E}});var _=function(w){var y=!1;return e(p,function(E,S){if(!y)try{"$"+E(w)===S&&(y=c(S,1))}catch{}}),y},m=function(w){var y=!1;return e(p,function(E,S){if(!y)try{E(w),y=c(S,1)}catch{}}),y};return Zn=function(w){if(!w||typeof w!="object")return!1;if(!a){var y=c(o(w),8,-1);return u(l,y)>-1?y:y!=="Object"?!1:m(w)}return s?_(w):null},Zn}var Qn,Qh;function E_(){if(Qh)return Qn;Qh=1;var e=Zh();return Qn=function(r){return!!e(r)},Qn}var ec;function x_(){return ec||(ec=1,function(e){var t=c_(),r=p_(),i=Zh(),s=E_();function n(z){return z.call.bind(z)}var o=typeof BigInt<"u",a=typeof Symbol<"u",h=n(Object.prototype.toString),l=n(Number.prototype.valueOf),c=n(String.prototype.valueOf),u=n(Boolean.prototype.valueOf);if(o)var p=n(BigInt.prototype.valueOf);if(a)var _=n(Symbol.prototype.valueOf);function m(z,rt){if(typeof z!="object")return!1;try{return rt(z),!0}catch{return!1}}e.isArgumentsObject=t,e.isGeneratorFunction=r,e.isTypedArray=s;function g(z){return typeof Promise<"u"&&z instanceof Promise||z!==null&&typeof z=="object"&&typeof z.then=="function"&&typeof z.catch=="function"}e.isPromise=g;function w(z){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(z):s(z)||I(z)}e.isArrayBufferView=w;function y(z){return i(z)==="Uint8Array"}e.isUint8Array=y;function E(z){return i(z)==="Uint8ClampedArray"}e.isUint8ClampedArray=E;function S(z){return i(z)==="Uint16Array"}e.isUint16Array=S;function v(z){return i(z)==="Uint32Array"}e.isUint32Array=v;function k(z){return i(z)==="Int8Array"}e.isInt8Array=k;function R(z){return i(z)==="Int16Array"}e.isInt16Array=R;function O(z){return i(z)==="Int32Array"}e.isInt32Array=O;function N(z){return i(z)==="Float32Array"}e.isFloat32Array=N;function W(z){return i(z)==="Float64Array"}e.isFloat64Array=W;function Q(z){return i(z)==="BigInt64Array"}e.isBigInt64Array=Q;function ie(z){return i(z)==="BigUint64Array"}e.isBigUint64Array=ie;function K(z){return h(z)==="[object Map]"}K.working=typeof Map<"u"&&K(new Map);function H(z){return typeof Map>"u"?!1:K.working?K(z):z instanceof Map}e.isMap=H;function G(z){return h(z)==="[object Set]"}G.working=typeof Set<"u"&&G(new Set);function J(z){return typeof Set>"u"?!1:G.working?G(z):z instanceof Set}e.isSet=J;function ee(z){return h(z)==="[object WeakMap]"}ee.working=typeof WeakMap<"u"&&ee(new WeakMap);function se(z){return typeof WeakMap>"u"?!1:ee.working?ee(z):z instanceof WeakMap}e.isWeakMap=se;function Y(z){return h(z)==="[object WeakSet]"}Y.working=typeof WeakSet<"u"&&Y(new WeakSet);function le(z){return Y(z)}e.isWeakSet=le;function me(z){return h(z)==="[object ArrayBuffer]"}me.working=typeof ArrayBuffer<"u"&&me(new ArrayBuffer);function ke(z){return typeof ArrayBuffer>"u"?!1:me.working?me(z):z instanceof ArrayBuffer}e.isArrayBuffer=ke;function L(z){return h(z)==="[object DataView]"}L.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&L(new DataView(new ArrayBuffer(1),0,1));function I(z){return typeof DataView>"u"?!1:L.working?L(z):z instanceof DataView}e.isDataView=I;var U=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function te(z){return h(z)==="[object SharedArrayBuffer]"}function A(z){return typeof U>"u"?!1:(typeof te.working>"u"&&(te.working=te(new U)),te.working?te(z):z instanceof U)}e.isSharedArrayBuffer=A;function D(z){return h(z)==="[object AsyncFunction]"}e.isAsyncFunction=D;function F(z){return h(z)==="[object Map Iterator]"}e.isMapIterator=F;function $(z){return h(z)==="[object Set Iterator]"}e.isSetIterator=$;function V(z){return h(z)==="[object Generator]"}e.isGeneratorObject=V;function C(z){return h(z)==="[object WebAssembly.Module]"}e.isWebAssemblyCompiledModule=C;function x(z){return m(z,l)}e.isNumberObject=x;function P(z){return m(z,c)}e.isStringObject=P;function X(z){return m(z,u)}e.isBooleanObject=X;function _e(z){return o&&m(z,p)}e.isBigIntObject=_e;function ne(z){return a&&m(z,_)}e.isSymbolObject=ne;function de(z){return x(z)||P(z)||X(z)||_e(z)||ne(z)}e.isBoxedPrimitive=de;function tt(z){return typeof Uint8Array<"u"&&(ke(z)||A(z))}e.isAnyArrayBuffer=tt,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(z){Object.defineProperty(e,z,{enumerable:!1,value:function(){throw new Error(z+" is not supported in userland")}})})}(Xs)),Xs}var eo,tc;function k_(){return tc||(tc=1,eo=function(t){return t&&typeof t=="object"&&typeof t.copy=="function"&&typeof t.fill=="function"&&typeof t.readUInt8=="function"}),eo}var rc;function ic(){return rc||(rc=1,function(e){var t=Object.getOwnPropertyDescriptors||function(I){for(var U=Object.keys(I),te={},A=0;A<U.length;A++)te[U[A]]=Object.getOwnPropertyDescriptor(I,U[A]);return te},r=/%[sdj%]/g;e.format=function(L){if(!k(L)){for(var I=[],U=0;U<arguments.length;U++)I.push(o(arguments[U]));return I.join(" ")}for(var U=1,te=arguments,A=te.length,D=String(L).replace(r,function($){if($==="%%")return"%";if(U>=A)return $;switch($){case"%s":return String(te[U++]);case"%d":return Number(te[U++]);case"%j":try{return JSON.stringify(te[U++])}catch{return"[Circular]"}default:return $}}),F=te[U];U<A;F=te[++U])E(F)||!W(F)?D+=" "+F:D+=" "+o(F);return D},e.deprecate=function(L,I){if(typeof ae<"u"&&ae.noDeprecation===!0)return L;if(typeof ae>"u")return function(){return e.deprecate(L,I).apply(this,arguments)};var U=!1;function te(){if(!U){if(ae.throwDeprecation)throw new Error(I);ae.traceDeprecation?console.trace(I):console.error(I),U=!0}return L.apply(this,arguments)}return te};var i={},s=/^$/;if(ae.env.NODE_DEBUG){var n=ae.env.NODE_DEBUG;n=n.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),s=new RegExp("^"+n+"$","i")}e.debuglog=function(L){if(L=L.toUpperCase(),!i[L])if(s.test(L)){var I=ae.pid;i[L]=function(){var U=e.format.apply(e,arguments);console.error("%s %d: %s",L,I,U)}}else i[L]=function(){};return i[L]};function o(L,I){var U={seen:[],stylize:h};return arguments.length>=3&&(U.depth=arguments[2]),arguments.length>=4&&(U.colors=arguments[3]),y(I)?U.showHidden=I:I&&e._extend(U,I),O(U.showHidden)&&(U.showHidden=!1),O(U.depth)&&(U.depth=2),O(U.colors)&&(U.colors=!1),O(U.customInspect)&&(U.customInspect=!0),U.colors&&(U.stylize=a),c(U,L,U.depth)}e.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function a(L,I){var U=o.styles[I];return U?"\x1B["+o.colors[U][0]+"m"+L+"\x1B["+o.colors[U][1]+"m":L}function h(L,I){return L}function l(L){var I={};return L.forEach(function(U,te){I[U]=!0}),I}function c(L,I,U){if(L.customInspect&&I&&K(I.inspect)&&I.inspect!==e.inspect&&!(I.constructor&&I.constructor.prototype===I)){var te=I.inspect(U,L);return k(te)||(te=c(L,te,U)),te}var A=u(L,I);if(A)return A;var D=Object.keys(I),F=l(D);if(L.showHidden&&(D=Object.getOwnPropertyNames(I)),ie(I)&&(D.indexOf("message")>=0||D.indexOf("description")>=0))return p(I);if(D.length===0){if(K(I)){var $=I.name?": "+I.name:"";return L.stylize("[Function"+$+"]","special")}if(N(I))return L.stylize(RegExp.prototype.toString.call(I),"regexp");if(Q(I))return L.stylize(Date.prototype.toString.call(I),"date");if(ie(I))return p(I)}var V="",C=!1,x=["{","}"];if(w(I)&&(C=!0,x=["[","]"]),K(I)){var P=I.name?": "+I.name:"";V=" [Function"+P+"]"}if(N(I)&&(V=" "+RegExp.prototype.toString.call(I)),Q(I)&&(V=" "+Date.prototype.toUTCString.call(I)),ie(I)&&(V=" "+p(I)),D.length===0&&(!C||I.length==0))return x[0]+V+x[1];if(U<0)return N(I)?L.stylize(RegExp.prototype.toString.call(I),"regexp"):L.stylize("[Object]","special");L.seen.push(I);var X;return C?X=_(L,I,U,F,D):X=D.map(function(_e){return m(L,I,U,F,_e,C)}),L.seen.pop(),g(X,V,x)}function u(L,I){if(O(I))return L.stylize("undefined","undefined");if(k(I)){var U="'"+JSON.stringify(I).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return L.stylize(U,"string")}if(v(I))return L.stylize(""+I,"number");if(y(I))return L.stylize(""+I,"boolean");if(E(I))return L.stylize("null","null")}function p(L){return"["+Error.prototype.toString.call(L)+"]"}function _(L,I,U,te,A){for(var D=[],F=0,$=I.length;F<$;++F)Y(I,String(F))?D.push(m(L,I,U,te,String(F),!0)):D.push("");return A.forEach(function(V){V.match(/^\d+$/)||D.push(m(L,I,U,te,V,!0))}),D}function m(L,I,U,te,A,D){var F,$,V;if(V=Object.getOwnPropertyDescriptor(I,A)||{value:I[A]},V.get?V.set?$=L.stylize("[Getter/Setter]","special"):$=L.stylize("[Getter]","special"):V.set&&($=L.stylize("[Setter]","special")),Y(te,A)||(F="["+A+"]"),$||(L.seen.indexOf(V.value)<0?(E(U)?$=c(L,V.value,null):$=c(L,V.value,U-1),$.indexOf(`
`)>-1&&(D?$=$.split(`
`).map(function(C){return"  "+C}).join(`
`).slice(2):$=`
`+$.split(`
`).map(function(C){return"   "+C}).join(`
`))):$=L.stylize("[Circular]","special")),O(F)){if(D&&A.match(/^\d+$/))return $;F=JSON.stringify(""+A),F.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(F=F.slice(1,-1),F=L.stylize(F,"name")):(F=F.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),F=L.stylize(F,"string"))}return F+": "+$}function g(L,I,U){var te=L.reduce(function(A,D){return D.indexOf(`
`)>=0,A+D.replace(/\u001b\[\d\d?m/g,"").length+1},0);return te>60?U[0]+(I===""?"":I+`
 `)+" "+L.join(`,
  `)+" "+U[1]:U[0]+I+" "+L.join(", ")+" "+U[1]}e.types=x_();function w(L){return Array.isArray(L)}e.isArray=w;function y(L){return typeof L=="boolean"}e.isBoolean=y;function E(L){return L===null}e.isNull=E;function S(L){return L==null}e.isNullOrUndefined=S;function v(L){return typeof L=="number"}e.isNumber=v;function k(L){return typeof L=="string"}e.isString=k;function R(L){return typeof L=="symbol"}e.isSymbol=R;function O(L){return L===void 0}e.isUndefined=O;function N(L){return W(L)&&G(L)==="[object RegExp]"}e.isRegExp=N,e.types.isRegExp=N;function W(L){return typeof L=="object"&&L!==null}e.isObject=W;function Q(L){return W(L)&&G(L)==="[object Date]"}e.isDate=Q,e.types.isDate=Q;function ie(L){return W(L)&&(G(L)==="[object Error]"||L instanceof Error)}e.isError=ie,e.types.isNativeError=ie;function K(L){return typeof L=="function"}e.isFunction=K;function H(L){return L===null||typeof L=="boolean"||typeof L=="number"||typeof L=="string"||typeof L=="symbol"||typeof L>"u"}e.isPrimitive=H,e.isBuffer=k_();function G(L){return Object.prototype.toString.call(L)}function J(L){return L<10?"0"+L.toString(10):L.toString(10)}var ee=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function se(){var L=new Date,I=[J(L.getHours()),J(L.getMinutes()),J(L.getSeconds())].join(":");return[L.getDate(),ee[L.getMonth()],I].join(" ")}e.log=function(){console.log("%s - %s",se(),e.format.apply(e,arguments))},e.inherits=hr(),e._extend=function(L,I){if(!I||!W(I))return L;for(var U=Object.keys(I),te=U.length;te--;)L[U[te]]=I[U[te]];return L};function Y(L,I){return Object.prototype.hasOwnProperty.call(L,I)}var le=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;e.promisify=function(I){if(typeof I!="function")throw new TypeError('The "original" argument must be of type Function');if(le&&I[le]){var U=I[le];if(typeof U!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(U,le,{value:U,enumerable:!1,writable:!1,configurable:!0}),U}function U(){for(var te,A,D=new Promise(function(V,C){te=V,A=C}),F=[],$=0;$<arguments.length;$++)F.push(arguments[$]);F.push(function(V,C){V?A(V):te(C)});try{I.apply(this,F)}catch(V){A(V)}return D}return Object.setPrototypeOf(U,Object.getPrototypeOf(I)),le&&Object.defineProperty(U,le,{value:U,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(U,t(I))},e.promisify.custom=le;function me(L,I){if(!L){var U=new Error("Promise was rejected with a falsy value");U.reason=L,L=U}return I(L)}function ke(L){if(typeof L!="function")throw new TypeError('The "original" argument must be of type Function');function I(){for(var U=[],te=0;te<arguments.length;te++)U.push(arguments[te]);var A=U.pop();if(typeof A!="function")throw new TypeError("The last argument must be of type Function");var D=this,F=function(){return A.apply(D,arguments)};L.apply(this,U).then(function($){ae.nextTick(F.bind(null,null,$))},function($){ae.nextTick(me.bind(null,$,F))})}return Object.setPrototypeOf(I,Object.getPrototypeOf(L)),Object.defineProperties(I,t(L)),I}e.callbackify=ke}(Ys)),Ys}var to,sc;function B_(){if(sc)return to;sc=1;function e(m,g){var w=Object.keys(m);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(m);g&&(y=y.filter(function(E){return Object.getOwnPropertyDescriptor(m,E).enumerable})),w.push.apply(w,y)}return w}function t(m){for(var g=1;g<arguments.length;g++){var w=arguments[g]!=null?arguments[g]:{};g%2?e(Object(w),!0).forEach(function(y){r(m,y,w[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(w)):e(Object(w)).forEach(function(y){Object.defineProperty(m,y,Object.getOwnPropertyDescriptor(w,y))})}return m}function r(m,g,w){return g=o(g),g in m?Object.defineProperty(m,g,{value:w,enumerable:!0,configurable:!0,writable:!0}):m[g]=w,m}function i(m,g){if(!(m instanceof g))throw new TypeError("Cannot call a class as a function")}function s(m,g){for(var w=0;w<g.length;w++){var y=g[w];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(m,o(y.key),y)}}function n(m,g,w){return g&&s(m.prototype,g),Object.defineProperty(m,"prototype",{writable:!1}),m}function o(m){var g=a(m,"string");return typeof g=="symbol"?g:String(g)}function a(m,g){if(typeof m!="object"||m===null)return m;var w=m[Symbol.toPrimitive];if(w!==void 0){var y=w.call(m,g);if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(m)}var h=zr,l=h.Buffer,c=ic(),u=c.inspect,p=u&&u.custom||"inspect";function _(m,g,w){l.prototype.copy.call(m,g,w)}return to=function(){function m(){i(this,m),this.head=null,this.tail=null,this.length=0}return n(m,[{key:"push",value:function(w){var y={data:w,next:null};this.length>0?this.tail.next=y:this.head=y,this.tail=y,++this.length}},{key:"unshift",value:function(w){var y={data:w,next:this.head};this.length===0&&(this.tail=y),this.head=y,++this.length}},{key:"shift",value:function(){if(this.length!==0){var w=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,w}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(w){if(this.length===0)return"";for(var y=this.head,E=""+y.data;y=y.next;)E+=w+y.data;return E}},{key:"concat",value:function(w){if(this.length===0)return l.alloc(0);for(var y=l.allocUnsafe(w>>>0),E=this.head,S=0;E;)_(E.data,y,S),S+=E.data.length,E=E.next;return y}},{key:"consume",value:function(w,y){var E;return w<this.head.data.length?(E=this.head.data.slice(0,w),this.head.data=this.head.data.slice(w)):w===this.head.data.length?E=this.shift():E=y?this._getString(w):this._getBuffer(w),E}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(w){var y=this.head,E=1,S=y.data;for(w-=S.length;y=y.next;){var v=y.data,k=w>v.length?v.length:w;if(k===v.length?S+=v:S+=v.slice(0,w),w-=k,w===0){k===v.length?(++E,y.next?this.head=y.next:this.head=this.tail=null):(this.head=y,y.data=v.slice(k));break}++E}return this.length-=E,S}},{key:"_getBuffer",value:function(w){var y=l.allocUnsafe(w),E=this.head,S=1;for(E.data.copy(y),w-=E.data.length;E=E.next;){var v=E.data,k=w>v.length?v.length:w;if(v.copy(y,y.length-w,0,k),w-=k,w===0){k===v.length?(++S,E.next?this.head=E.next:this.head=this.tail=null):(this.head=E,E.data=v.slice(k));break}++S}return this.length-=S,y}},{key:p,value:function(w,y){return u(this,t(t({},y),{},{depth:0,customInspect:!1}))}}]),m}(),to}var ro,nc;function oc(){if(nc)return ro;nc=1;function e(o,a){var h=this,l=this._readableState&&this._readableState.destroyed,c=this._writableState&&this._writableState.destroyed;return l||c?(a?a(o):o&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,ae.nextTick(s,this,o)):ae.nextTick(s,this,o)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(o||null,function(u){!a&&u?h._writableState?h._writableState.errorEmitted?ae.nextTick(r,h):(h._writableState.errorEmitted=!0,ae.nextTick(t,h,u)):ae.nextTick(t,h,u):a?(ae.nextTick(r,h),a(u)):ae.nextTick(r,h)}),this)}function t(o,a){s(o,a),r(o)}function r(o){o._writableState&&!o._writableState.emitClose||o._readableState&&!o._readableState.emitClose||o.emit("close")}function i(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function s(o,a){o.emit("error",a)}function n(o,a){var h=o._readableState,l=o._writableState;h&&h.autoDestroy||l&&l.autoDestroy?o.destroy(a):o.emit("error",a)}return ro={destroy:e,undestroy:i,errorOrDestroy:n},ro}var io={},ac;function Ar(){if(ac)return io;ac=1;function e(a,h){a.prototype=Object.create(h.prototype),a.prototype.constructor=a,a.__proto__=h}var t={};function r(a,h,l){l||(l=Error);function c(p,_,m){return typeof h=="string"?h:h(p,_,m)}var u=function(p){e(_,p);function _(m,g,w){return p.call(this,c(m,g,w))||this}return _}(l);u.prototype.name=l.name,u.prototype.code=a,t[a]=u}function i(a,h){if(Array.isArray(a)){var l=a.length;return a=a.map(function(c){return String(c)}),l>2?"one of ".concat(h," ").concat(a.slice(0,l-1).join(", "),", or ")+a[l-1]:l===2?"one of ".concat(h," ").concat(a[0]," or ").concat(a[1]):"of ".concat(h," ").concat(a[0])}else return"of ".concat(h," ").concat(String(a))}function s(a,h,l){return a.substr(0,h.length)===h}function n(a,h,l){return(l===void 0||l>a.length)&&(l=a.length),a.substring(l-h.length,l)===h}function o(a,h,l){return typeof l!="number"&&(l=0),l+h.length>a.length?!1:a.indexOf(h,l)!==-1}return r("ERR_INVALID_OPT_VALUE",function(a,h){return'The value "'+h+'" is invalid for option "'+a+'"'},TypeError),r("ERR_INVALID_ARG_TYPE",function(a,h,l){var c;typeof h=="string"&&s(h,"not ")?(c="must not be",h=h.replace(/^not /,"")):c="must be";var u;if(n(a," argument"))u="The ".concat(a," ").concat(c," ").concat(i(h,"type"));else{var p=o(a,".")?"property":"argument";u='The "'.concat(a,'" ').concat(p," ").concat(c," ").concat(i(h,"type"))}return u+=". Received type ".concat(typeof l),u},TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",function(a){return"The "+a+" method is not implemented"}),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",function(a){return"Cannot call "+a+" after a stream was destroyed"}),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",function(a){return"Unknown encoding: "+a},TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),io.codes=t,io}var so,lc;function hc(){if(lc)return so;lc=1;var e=Ar().codes.ERR_INVALID_OPT_VALUE;function t(i,s,n){return i.highWaterMark!=null?i.highWaterMark:s?i[n]:null}function r(i,s,n,o){var a=t(s,o,n);if(a!=null){if(!(isFinite(a)&&Math.floor(a)===a)||a<0){var h=o?n:"highWaterMark";throw new e(h,a)}return Math.floor(a)}return i.objectMode?16:16*1024}return so={getHighWaterMark:r},so}var no,cc;function R_(){if(cc)return no;cc=1,no=e;function e(r,i){if(t("noDeprecation"))return r;var s=!1;function n(){if(!s){if(t("throwDeprecation"))throw new Error(i);t("traceDeprecation")?console.trace(i):console.warn(i),s=!0}return r.apply(this,arguments)}return n}function t(r){try{if(!Yt.localStorage)return!1}catch{return!1}var i=Yt.localStorage[r];return i==null?!1:String(i).toLowerCase()==="true"}return no}var oo,uc;function fc(){if(uc)return oo;uc=1,oo=N;function e(A){var D=this;this.next=null,this.entry=null,this.finish=function(){te(D,A)}}var t;N.WritableState=R;var r={deprecate:R_()},i=Kl(),s=zr.Buffer,n=(typeof Yt<"u"?Yt:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function o(A){return s.from(A)}function a(A){return s.isBuffer(A)||A instanceof n}var h=oc(),l=hc(),c=l.getHighWaterMark,u=Ar().codes,p=u.ERR_INVALID_ARG_TYPE,_=u.ERR_METHOD_NOT_IMPLEMENTED,m=u.ERR_MULTIPLE_CALLBACK,g=u.ERR_STREAM_CANNOT_PIPE,w=u.ERR_STREAM_DESTROYED,y=u.ERR_STREAM_NULL_VALUES,E=u.ERR_STREAM_WRITE_AFTER_END,S=u.ERR_UNKNOWN_ENCODING,v=h.errorOrDestroy;hr()(N,i);function k(){}function R(A,D,F){t=t||Dr(),A=A||{},typeof F!="boolean"&&(F=D instanceof t),this.objectMode=!!A.objectMode,F&&(this.objectMode=this.objectMode||!!A.writableObjectMode),this.highWaterMark=c(this,A,"writableHighWaterMark",F),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var $=A.decodeStrings===!1;this.decodeStrings=!$,this.defaultEncoding=A.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(V){ee(D,V)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=A.emitClose!==!1,this.autoDestroy=!!A.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new e(this)}R.prototype.getBuffer=function(){for(var D=this.bufferedRequest,F=[];D;)F.push(D),D=D.next;return F},function(){try{Object.defineProperty(R.prototype,"buffer",{get:r.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var O;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(O=Function.prototype[Symbol.hasInstance],Object.defineProperty(N,Symbol.hasInstance,{value:function(D){return O.call(this,D)?!0:this!==N?!1:D&&D._writableState instanceof R}})):O=function(D){return D instanceof this};function N(A){t=t||Dr();var D=this instanceof t;if(!D&&!O.call(N,this))return new N(A);this._writableState=new R(A,this,D),this.writable=!0,A&&(typeof A.write=="function"&&(this._write=A.write),typeof A.writev=="function"&&(this._writev=A.writev),typeof A.destroy=="function"&&(this._destroy=A.destroy),typeof A.final=="function"&&(this._final=A.final)),i.call(this)}N.prototype.pipe=function(){v(this,new g)};function W(A,D){var F=new E;v(A,F),ae.nextTick(D,F)}function Q(A,D,F,$){var V;return F===null?V=new y:typeof F!="string"&&!D.objectMode&&(V=new p("chunk",["string","Buffer"],F)),V?(v(A,V),ae.nextTick($,V),!1):!0}N.prototype.write=function(A,D,F){var $=this._writableState,V=!1,C=!$.objectMode&&a(A);return C&&!s.isBuffer(A)&&(A=o(A)),typeof D=="function"&&(F=D,D=null),C?D="buffer":D||(D=$.defaultEncoding),typeof F!="function"&&(F=k),$.ending?W(this,F):(C||Q(this,$,A,F))&&($.pendingcb++,V=K(this,$,C,A,D,F)),V},N.prototype.cork=function(){this._writableState.corked++},N.prototype.uncork=function(){var A=this._writableState;A.corked&&(A.corked--,!A.writing&&!A.corked&&!A.bufferProcessing&&A.bufferedRequest&&le(this,A))},N.prototype.setDefaultEncoding=function(D){if(typeof D=="string"&&(D=D.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((D+"").toLowerCase())>-1))throw new S(D);return this._writableState.defaultEncoding=D,this},Object.defineProperty(N.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function ie(A,D,F){return!A.objectMode&&A.decodeStrings!==!1&&typeof D=="string"&&(D=s.from(D,F)),D}Object.defineProperty(N.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function K(A,D,F,$,V,C){if(!F){var x=ie(D,$,V);$!==x&&(F=!0,V="buffer",$=x)}var P=D.objectMode?1:$.length;D.length+=P;var X=D.length<D.highWaterMark;if(X||(D.needDrain=!0),D.writing||D.corked){var _e=D.lastBufferedRequest;D.lastBufferedRequest={chunk:$,encoding:V,isBuf:F,callback:C,next:null},_e?_e.next=D.lastBufferedRequest:D.bufferedRequest=D.lastBufferedRequest,D.bufferedRequestCount+=1}else H(A,D,!1,P,$,V,C);return X}function H(A,D,F,$,V,C,x){D.writelen=$,D.writecb=x,D.writing=!0,D.sync=!0,D.destroyed?D.onwrite(new w("write")):F?A._writev(V,D.onwrite):A._write(V,C,D.onwrite),D.sync=!1}function G(A,D,F,$,V){--D.pendingcb,F?(ae.nextTick(V,$),ae.nextTick(I,A,D),A._writableState.errorEmitted=!0,v(A,$)):(V($),A._writableState.errorEmitted=!0,v(A,$),I(A,D))}function J(A){A.writing=!1,A.writecb=null,A.length-=A.writelen,A.writelen=0}function ee(A,D){var F=A._writableState,$=F.sync,V=F.writecb;if(typeof V!="function")throw new m;if(J(F),D)G(A,F,$,D,V);else{var C=me(F)||A.destroyed;!C&&!F.corked&&!F.bufferProcessing&&F.bufferedRequest&&le(A,F),$?ae.nextTick(se,A,F,C,V):se(A,F,C,V)}}function se(A,D,F,$){F||Y(A,D),D.pendingcb--,$(),I(A,D)}function Y(A,D){D.length===0&&D.needDrain&&(D.needDrain=!1,A.emit("drain"))}function le(A,D){D.bufferProcessing=!0;var F=D.bufferedRequest;if(A._writev&&F&&F.next){var $=D.bufferedRequestCount,V=new Array($),C=D.corkedRequestsFree;C.entry=F;for(var x=0,P=!0;F;)V[x]=F,F.isBuf||(P=!1),F=F.next,x+=1;V.allBuffers=P,H(A,D,!0,D.length,V,"",C.finish),D.pendingcb++,D.lastBufferedRequest=null,C.next?(D.corkedRequestsFree=C.next,C.next=null):D.corkedRequestsFree=new e(D),D.bufferedRequestCount=0}else{for(;F;){var X=F.chunk,_e=F.encoding,ne=F.callback,de=D.objectMode?1:X.length;if(H(A,D,!1,de,X,_e,ne),F=F.next,D.bufferedRequestCount--,D.writing)break}F===null&&(D.lastBufferedRequest=null)}D.bufferedRequest=F,D.bufferProcessing=!1}N.prototype._write=function(A,D,F){F(new _("_write()"))},N.prototype._writev=null,N.prototype.end=function(A,D,F){var $=this._writableState;return typeof A=="function"?(F=A,A=null,D=null):typeof D=="function"&&(F=D,D=null),A!=null&&this.write(A,D),$.corked&&($.corked=1,this.uncork()),$.ending||U(this,$,F),this},Object.defineProperty(N.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function me(A){return A.ending&&A.length===0&&A.bufferedRequest===null&&!A.finished&&!A.writing}function ke(A,D){A._final(function(F){D.pendingcb--,F&&v(A,F),D.prefinished=!0,A.emit("prefinish"),I(A,D)})}function L(A,D){!D.prefinished&&!D.finalCalled&&(typeof A._final=="function"&&!D.destroyed?(D.pendingcb++,D.finalCalled=!0,ae.nextTick(ke,A,D)):(D.prefinished=!0,A.emit("prefinish")))}function I(A,D){var F=me(D);if(F&&(L(A,D),D.pendingcb===0&&(D.finished=!0,A.emit("finish"),D.autoDestroy))){var $=A._readableState;(!$||$.autoDestroy&&$.endEmitted)&&A.destroy()}return F}function U(A,D,F){D.ending=!0,I(A,D),F&&(D.finished?ae.nextTick(F):A.once("finish",F)),D.ended=!0,A.writable=!1}function te(A,D,F){var $=A.entry;for(A.entry=null;$;){var V=$.callback;D.pendingcb--,V(F),$=$.next}D.corkedRequestsFree.next=A}return Object.defineProperty(N.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(D){this._writableState&&(this._writableState.destroyed=D)}}),N.prototype.destroy=h.destroy,N.prototype._undestroy=h.undestroy,N.prototype._destroy=function(A,D){D(A)},oo}var ao,dc;function Dr(){if(dc)return ao;dc=1;var e=Object.keys||function(l){var c=[];for(var u in l)c.push(u);return c};ao=o;var t=mc(),r=fc();hr()(o,t);for(var i=e(r.prototype),s=0;s<i.length;s++){var n=i[s];o.prototype[n]||(o.prototype[n]=r.prototype[n])}function o(l){if(!(this instanceof o))return new o(l);t.call(this,l),r.call(this,l),this.allowHalfOpen=!0,l&&(l.readable===!1&&(this.readable=!1),l.writable===!1&&(this.writable=!1),l.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",a)))}Object.defineProperty(o.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(o.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(o.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function a(){this._writableState.ended||ae.nextTick(h,this)}function h(l){l.end()}return Object.defineProperty(o.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(c){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=c,this._writableState.destroyed=c)}}),ao}var lo,pc;function ho(){if(pc)return lo;pc=1;var e=Ar().codes.ERR_STREAM_PREMATURE_CLOSE;function t(n){var o=!1;return function(){if(!o){o=!0;for(var a=arguments.length,h=new Array(a),l=0;l<a;l++)h[l]=arguments[l];n.apply(this,h)}}}function r(){}function i(n){return n.setHeader&&typeof n.abort=="function"}function s(n,o,a){if(typeof o=="function")return s(n,null,o);o||(o={}),a=t(a||r);var h=o.readable||o.readable!==!1&&n.readable,l=o.writable||o.writable!==!1&&n.writable,c=function(){n.writable||p()},u=n._writableState&&n._writableState.finished,p=function(){l=!1,u=!0,h||a.call(n)},_=n._readableState&&n._readableState.endEmitted,m=function(){h=!1,_=!0,l||a.call(n)},g=function(S){a.call(n,S)},w=function(){var S;if(h&&!_)return(!n._readableState||!n._readableState.ended)&&(S=new e),a.call(n,S);if(l&&!u)return(!n._writableState||!n._writableState.ended)&&(S=new e),a.call(n,S)},y=function(){n.req.on("finish",p)};return i(n)?(n.on("complete",p),n.on("abort",w),n.req?y():n.on("request",y)):l&&!n._writableState&&(n.on("end",c),n.on("close",c)),n.on("end",m),n.on("finish",p),o.error!==!1&&n.on("error",g),n.on("close",w),function(){n.removeListener("complete",p),n.removeListener("abort",w),n.removeListener("request",y),n.req&&n.req.removeListener("finish",p),n.removeListener("end",c),n.removeListener("close",c),n.removeListener("finish",p),n.removeListener("end",m),n.removeListener("error",g),n.removeListener("close",w)}}return lo=s,lo}var co,_c;function A_(){if(_c)return co;_c=1;var e;function t(S,v,k){return v=r(v),v in S?Object.defineProperty(S,v,{value:k,enumerable:!0,configurable:!0,writable:!0}):S[v]=k,S}function r(S){var v=i(S,"string");return typeof v=="symbol"?v:String(v)}function i(S,v){if(typeof S!="object"||S===null)return S;var k=S[Symbol.toPrimitive];if(k!==void 0){var R=k.call(S,v);if(typeof R!="object")return R;throw new TypeError("@@toPrimitive must return a primitive value.")}return(v==="string"?String:Number)(S)}var s=ho(),n=Symbol("lastResolve"),o=Symbol("lastReject"),a=Symbol("error"),h=Symbol("ended"),l=Symbol("lastPromise"),c=Symbol("handlePromise"),u=Symbol("stream");function p(S,v){return{value:S,done:v}}function _(S){var v=S[n];if(v!==null){var k=S[u].read();k!==null&&(S[l]=null,S[n]=null,S[o]=null,v(p(k,!1)))}}function m(S){ae.nextTick(_,S)}function g(S,v){return function(k,R){S.then(function(){if(v[h]){k(p(void 0,!0));return}v[c](k,R)},R)}}var w=Object.getPrototypeOf(function(){}),y=Object.setPrototypeOf((e={get stream(){return this[u]},next:function(){var v=this,k=this[a];if(k!==null)return Promise.reject(k);if(this[h])return Promise.resolve(p(void 0,!0));if(this[u].destroyed)return new Promise(function(W,Q){ae.nextTick(function(){v[a]?Q(v[a]):W(p(void 0,!0))})});var R=this[l],O;if(R)O=new Promise(g(R,this));else{var N=this[u].read();if(N!==null)return Promise.resolve(p(N,!1));O=new Promise(this[c])}return this[l]=O,O}},t(e,Symbol.asyncIterator,function(){return this}),t(e,"return",function(){var v=this;return new Promise(function(k,R){v[u].destroy(null,function(O){if(O){R(O);return}k(p(void 0,!0))})})}),e),w),E=function(v){var k,R=Object.create(y,(k={},t(k,u,{value:v,writable:!0}),t(k,n,{value:null,writable:!0}),t(k,o,{value:null,writable:!0}),t(k,a,{value:null,writable:!0}),t(k,h,{value:v._readableState.endEmitted,writable:!0}),t(k,c,{value:function(N,W){var Q=R[u].read();Q?(R[l]=null,R[n]=null,R[o]=null,N(p(Q,!1))):(R[n]=N,R[o]=W)},writable:!0}),k));return R[l]=null,s(v,function(O){if(O&&O.code!=="ERR_STREAM_PREMATURE_CLOSE"){var N=R[o];N!==null&&(R[l]=null,R[n]=null,R[o]=null,N(O)),R[a]=O;return}var W=R[n];W!==null&&(R[l]=null,R[n]=null,R[o]=null,W(p(void 0,!0))),R[h]=!0}),v.on("readable",m.bind(null,R)),R};return co=E,co}var uo,gc;function D_(){return gc||(gc=1,uo=function(){throw new Error("Readable.from is not available in the browser")}),uo}var fo,vc;function mc(){if(vc)return fo;vc=1,fo=W;var e;W.ReadableState=N,Vs().EventEmitter;var t=function(x,P){return x.listeners(P).length},r=Kl(),i=zr.Buffer,s=(typeof Yt<"u"?Yt:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function n(C){return i.from(C)}function o(C){return i.isBuffer(C)||C instanceof s}var a=ic(),h;a&&a.debuglog?h=a.debuglog("stream"):h=function(){};var l=B_(),c=oc(),u=hc(),p=u.getHighWaterMark,_=Ar().codes,m=_.ERR_INVALID_ARG_TYPE,g=_.ERR_STREAM_PUSH_AFTER_EOF,w=_.ERR_METHOD_NOT_IMPLEMENTED,y=_.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,E,S,v;hr()(W,r);var k=c.errorOrDestroy,R=["error","close","destroy","pause","resume"];function O(C,x,P){if(typeof C.prependListener=="function")return C.prependListener(x,P);!C._events||!C._events[x]?C.on(x,P):Array.isArray(C._events[x])?C._events[x].unshift(P):C._events[x]=[P,C._events[x]]}function N(C,x,P){e=e||Dr(),C=C||{},typeof P!="boolean"&&(P=x instanceof e),this.objectMode=!!C.objectMode,P&&(this.objectMode=this.objectMode||!!C.readableObjectMode),this.highWaterMark=p(this,C,"readableHighWaterMark",P),this.buffer=new l,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=C.emitClose!==!1,this.autoDestroy=!!C.autoDestroy,this.destroyed=!1,this.defaultEncoding=C.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,C.encoding&&(E||(E=Fs().StringDecoder),this.decoder=new E(C.encoding),this.encoding=C.encoding)}function W(C){if(e=e||Dr(),!(this instanceof W))return new W(C);var x=this instanceof e;this._readableState=new N(C,this,x),this.readable=!0,C&&(typeof C.read=="function"&&(this._read=C.read),typeof C.destroy=="function"&&(this._destroy=C.destroy)),r.call(this)}Object.defineProperty(W.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(x){this._readableState&&(this._readableState.destroyed=x)}}),W.prototype.destroy=c.destroy,W.prototype._undestroy=c.undestroy,W.prototype._destroy=function(C,x){x(C)},W.prototype.push=function(C,x){var P=this._readableState,X;return P.objectMode?X=!0:typeof C=="string"&&(x=x||P.defaultEncoding,x!==P.encoding&&(C=i.from(C,x),x=""),X=!0),Q(this,C,x,!1,X)},W.prototype.unshift=function(C){return Q(this,C,null,!0,!1)};function Q(C,x,P,X,_e){h("readableAddChunk",x);var ne=C._readableState;if(x===null)ne.reading=!1,ee(C,ne);else{var de;if(_e||(de=K(ne,x)),de)k(C,de);else if(ne.objectMode||x&&x.length>0)if(typeof x!="string"&&!ne.objectMode&&Object.getPrototypeOf(x)!==i.prototype&&(x=n(x)),X)ne.endEmitted?k(C,new y):ie(C,ne,x,!0);else if(ne.ended)k(C,new g);else{if(ne.destroyed)return!1;ne.reading=!1,ne.decoder&&!P?(x=ne.decoder.write(x),ne.objectMode||x.length!==0?ie(C,ne,x,!1):le(C,ne)):ie(C,ne,x,!1)}else X||(ne.reading=!1,le(C,ne))}return!ne.ended&&(ne.length<ne.highWaterMark||ne.length===0)}function ie(C,x,P,X){x.flowing&&x.length===0&&!x.sync?(x.awaitDrain=0,C.emit("data",P)):(x.length+=x.objectMode?1:P.length,X?x.buffer.unshift(P):x.buffer.push(P),x.needReadable&&se(C)),le(C,x)}function K(C,x){var P;return!o(x)&&typeof x!="string"&&x!==void 0&&!C.objectMode&&(P=new m("chunk",["string","Buffer","Uint8Array"],x)),P}W.prototype.isPaused=function(){return this._readableState.flowing===!1},W.prototype.setEncoding=function(C){E||(E=Fs().StringDecoder);var x=new E(C);this._readableState.decoder=x,this._readableState.encoding=this._readableState.decoder.encoding;for(var P=this._readableState.buffer.head,X="";P!==null;)X+=x.write(P.data),P=P.next;return this._readableState.buffer.clear(),X!==""&&this._readableState.buffer.push(X),this._readableState.length=X.length,this};var H=1073741824;function G(C){return C>=H?C=H:(C--,C|=C>>>1,C|=C>>>2,C|=C>>>4,C|=C>>>8,C|=C>>>16,C++),C}function J(C,x){return C<=0||x.length===0&&x.ended?0:x.objectMode?1:C!==C?x.flowing&&x.length?x.buffer.head.data.length:x.length:(C>x.highWaterMark&&(x.highWaterMark=G(C)),C<=x.length?C:x.ended?x.length:(x.needReadable=!0,0))}W.prototype.read=function(C){h("read",C),C=parseInt(C,10);var x=this._readableState,P=C;if(C!==0&&(x.emittedReadable=!1),C===0&&x.needReadable&&((x.highWaterMark!==0?x.length>=x.highWaterMark:x.length>0)||x.ended))return h("read: emitReadable",x.length,x.ended),x.length===0&&x.ended?F(this):se(this),null;if(C=J(C,x),C===0&&x.ended)return x.length===0&&F(this),null;var X=x.needReadable;h("need readable",X),(x.length===0||x.length-C<x.highWaterMark)&&(X=!0,h("length less than watermark",X)),x.ended||x.reading?(X=!1,h("reading or ended",X)):X&&(h("do read"),x.reading=!0,x.sync=!0,x.length===0&&(x.needReadable=!0),this._read(x.highWaterMark),x.sync=!1,x.reading||(C=J(P,x)));var _e;return C>0?_e=D(C,x):_e=null,_e===null?(x.needReadable=x.length<=x.highWaterMark,C=0):(x.length-=C,x.awaitDrain=0),x.length===0&&(x.ended||(x.needReadable=!0),P!==C&&x.ended&&F(this)),_e!==null&&this.emit("data",_e),_e};function ee(C,x){if(h("onEofChunk"),!x.ended){if(x.decoder){var P=x.decoder.end();P&&P.length&&(x.buffer.push(P),x.length+=x.objectMode?1:P.length)}x.ended=!0,x.sync?se(C):(x.needReadable=!1,x.emittedReadable||(x.emittedReadable=!0,Y(C)))}}function se(C){var x=C._readableState;h("emitReadable",x.needReadable,x.emittedReadable),x.needReadable=!1,x.emittedReadable||(h("emitReadable",x.flowing),x.emittedReadable=!0,ae.nextTick(Y,C))}function Y(C){var x=C._readableState;h("emitReadable_",x.destroyed,x.length,x.ended),!x.destroyed&&(x.length||x.ended)&&(C.emit("readable"),x.emittedReadable=!1),x.needReadable=!x.flowing&&!x.ended&&x.length<=x.highWaterMark,A(C)}function le(C,x){x.readingMore||(x.readingMore=!0,ae.nextTick(me,C,x))}function me(C,x){for(;!x.reading&&!x.ended&&(x.length<x.highWaterMark||x.flowing&&x.length===0);){var P=x.length;if(h("maybeReadMore read 0"),C.read(0),P===x.length)break}x.readingMore=!1}W.prototype._read=function(C){k(this,new w("_read()"))},W.prototype.pipe=function(C,x){var P=this,X=this._readableState;switch(X.pipesCount){case 0:X.pipes=C;break;case 1:X.pipes=[X.pipes,C];break;default:X.pipes.push(C);break}X.pipesCount+=1,h("pipe count=%d opts=%j",X.pipesCount,x);var _e=(!x||x.end!==!1)&&C!==ae.stdout&&C!==ae.stderr,ne=_e?tt:$t;X.endEmitted?ae.nextTick(ne):P.once("end",ne),C.on("unpipe",de);function de(nr,Je){h("onunpipe"),nr===P&&Je&&Je.hasUnpiped===!1&&(Je.hasUnpiped=!0,it())}function tt(){h("onend"),C.end()}var z=ke(P);C.on("drain",z);var rt=!1;function it(){h("cleanup"),C.removeListener("close",lt),C.removeListener("finish",st),C.removeListener("drain",z),C.removeListener("error",mt),C.removeListener("unpipe",de),P.removeListener("end",tt),P.removeListener("end",$t),P.removeListener("data",jt),rt=!0,X.awaitDrain&&(!C._writableState||C._writableState.needDrain)&&z()}P.on("data",jt);function jt(nr){h("ondata");var Je=C.write(nr);h("dest.write",Je),Je===!1&&((X.pipesCount===1&&X.pipes===C||X.pipesCount>1&&V(X.pipes,C)!==-1)&&!rt&&(h("false write response, pause",X.awaitDrain),X.awaitDrain++),P.pause())}function mt(nr){h("onerror",nr),$t(),C.removeListener("error",mt),t(C,"error")===0&&k(C,nr)}O(C,"error",mt);function lt(){C.removeListener("finish",st),$t()}C.once("close",lt);function st(){h("onfinish"),C.removeListener("close",lt),$t()}C.once("finish",st);function $t(){h("unpipe"),P.unpipe(C)}return C.emit("pipe",P),X.flowing||(h("pipe resume"),P.resume()),C};function ke(C){return function(){var P=C._readableState;h("pipeOnDrain",P.awaitDrain),P.awaitDrain&&P.awaitDrain--,P.awaitDrain===0&&t(C,"data")&&(P.flowing=!0,A(C))}}W.prototype.unpipe=function(C){var x=this._readableState,P={hasUnpiped:!1};if(x.pipesCount===0)return this;if(x.pipesCount===1)return C&&C!==x.pipes?this:(C||(C=x.pipes),x.pipes=null,x.pipesCount=0,x.flowing=!1,C&&C.emit("unpipe",this,P),this);if(!C){var X=x.pipes,_e=x.pipesCount;x.pipes=null,x.pipesCount=0,x.flowing=!1;for(var ne=0;ne<_e;ne++)X[ne].emit("unpipe",this,{hasUnpiped:!1});return this}var de=V(x.pipes,C);return de===-1?this:(x.pipes.splice(de,1),x.pipesCount-=1,x.pipesCount===1&&(x.pipes=x.pipes[0]),C.emit("unpipe",this,P),this)},W.prototype.on=function(C,x){var P=r.prototype.on.call(this,C,x),X=this._readableState;return C==="data"?(X.readableListening=this.listenerCount("readable")>0,X.flowing!==!1&&this.resume()):C==="readable"&&!X.endEmitted&&!X.readableListening&&(X.readableListening=X.needReadable=!0,X.flowing=!1,X.emittedReadable=!1,h("on readable",X.length,X.reading),X.length?se(this):X.reading||ae.nextTick(I,this)),P},W.prototype.addListener=W.prototype.on,W.prototype.removeListener=function(C,x){var P=r.prototype.removeListener.call(this,C,x);return C==="readable"&&ae.nextTick(L,this),P},W.prototype.removeAllListeners=function(C){var x=r.prototype.removeAllListeners.apply(this,arguments);return(C==="readable"||C===void 0)&&ae.nextTick(L,this),x};function L(C){var x=C._readableState;x.readableListening=C.listenerCount("readable")>0,x.resumeScheduled&&!x.paused?x.flowing=!0:C.listenerCount("data")>0&&C.resume()}function I(C){h("readable nexttick read 0"),C.read(0)}W.prototype.resume=function(){var C=this._readableState;return C.flowing||(h("resume"),C.flowing=!C.readableListening,U(this,C)),C.paused=!1,this};function U(C,x){x.resumeScheduled||(x.resumeScheduled=!0,ae.nextTick(te,C,x))}function te(C,x){h("resume",x.reading),x.reading||C.read(0),x.resumeScheduled=!1,C.emit("resume"),A(C),x.flowing&&!x.reading&&C.read(0)}W.prototype.pause=function(){return h("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(h("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function A(C){var x=C._readableState;for(h("flow",x.flowing);x.flowing&&C.read()!==null;);}W.prototype.wrap=function(C){var x=this,P=this._readableState,X=!1;C.on("end",function(){if(h("wrapped end"),P.decoder&&!P.ended){var de=P.decoder.end();de&&de.length&&x.push(de)}x.push(null)}),C.on("data",function(de){if(h("wrapped data"),P.decoder&&(de=P.decoder.write(de)),!(P.objectMode&&de==null)&&!(!P.objectMode&&(!de||!de.length))){var tt=x.push(de);tt||(X=!0,C.pause())}});for(var _e in C)this[_e]===void 0&&typeof C[_e]=="function"&&(this[_e]=function(tt){return function(){return C[tt].apply(C,arguments)}}(_e));for(var ne=0;ne<R.length;ne++)C.on(R[ne],this.emit.bind(this,R[ne]));return this._read=function(de){h("wrapped _read",de),X&&(X=!1,C.resume())},this},typeof Symbol=="function"&&(W.prototype[Symbol.asyncIterator]=function(){return S===void 0&&(S=A_()),S(this)}),Object.defineProperty(W.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(W.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(W.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(x){this._readableState&&(this._readableState.flowing=x)}}),W._fromList=D,Object.defineProperty(W.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function D(C,x){if(x.length===0)return null;var P;return x.objectMode?P=x.buffer.shift():!C||C>=x.length?(x.decoder?P=x.buffer.join(""):x.buffer.length===1?P=x.buffer.first():P=x.buffer.concat(x.length),x.buffer.clear()):P=x.buffer.consume(C,x.decoder),P}function F(C){var x=C._readableState;h("endReadable",x.endEmitted),x.endEmitted||(x.ended=!0,ae.nextTick($,x,C))}function $(C,x){if(h("endReadableNT",C.endEmitted,C.length),!C.endEmitted&&C.length===0&&(C.endEmitted=!0,x.readable=!1,x.emit("end"),C.autoDestroy)){var P=x._writableState;(!P||P.autoDestroy&&P.finished)&&x.destroy()}}typeof Symbol=="function"&&(W.from=function(C,x){return v===void 0&&(v=D_()),v(W,C,x)});function V(C,x){for(var P=0,X=C.length;P<X;P++)if(C[P]===x)return P;return-1}return fo}var po,yc;function bc(){if(yc)return po;yc=1,po=a;var e=Ar().codes,t=e.ERR_METHOD_NOT_IMPLEMENTED,r=e.ERR_MULTIPLE_CALLBACK,i=e.ERR_TRANSFORM_ALREADY_TRANSFORMING,s=e.ERR_TRANSFORM_WITH_LENGTH_0,n=Dr();hr()(a,n);function o(c,u){var p=this._transformState;p.transforming=!1;var _=p.writecb;if(_===null)return this.emit("error",new r);p.writechunk=null,p.writecb=null,u!=null&&this.push(u),_(c);var m=this._readableState;m.reading=!1,(m.needReadable||m.length<m.highWaterMark)&&this._read(m.highWaterMark)}function a(c){if(!(this instanceof a))return new a(c);n.call(this,c),this._transformState={afterTransform:o.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,c&&(typeof c.transform=="function"&&(this._transform=c.transform),typeof c.flush=="function"&&(this._flush=c.flush)),this.on("prefinish",h)}function h(){var c=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(u,p){l(c,u,p)}):l(this,null,null)}a.prototype.push=function(c,u){return this._transformState.needTransform=!1,n.prototype.push.call(this,c,u)},a.prototype._transform=function(c,u,p){p(new t("_transform()"))},a.prototype._write=function(c,u,p){var _=this._transformState;if(_.writecb=p,_.writechunk=c,_.writeencoding=u,!_.transforming){var m=this._readableState;(_.needTransform||m.needReadable||m.length<m.highWaterMark)&&this._read(m.highWaterMark)}},a.prototype._read=function(c){var u=this._transformState;u.writechunk!==null&&!u.transforming?(u.transforming=!0,this._transform(u.writechunk,u.writeencoding,u.afterTransform)):u.needTransform=!0},a.prototype._destroy=function(c,u){n.prototype._destroy.call(this,c,function(p){u(p)})};function l(c,u,p){if(u)return c.emit("error",u);if(p!=null&&c.push(p),c._writableState.length)throw new s;if(c._transformState.transforming)throw new i;return c.push(null)}return po}var _o,wc;function T_(){if(wc)return _o;wc=1,_o=t;var e=bc();hr()(t,e);function t(r){if(!(this instanceof t))return new t(r);e.call(this,r)}return t.prototype._transform=function(r,i,s){s(null,r)},_o}var go,Sc;function L_(){if(Sc)return go;Sc=1;var e;function t(p){var _=!1;return function(){_||(_=!0,p.apply(void 0,arguments))}}var r=Ar().codes,i=r.ERR_MISSING_ARGS,s=r.ERR_STREAM_DESTROYED;function n(p){if(p)throw p}function o(p){return p.setHeader&&typeof p.abort=="function"}function a(p,_,m,g){g=t(g);var w=!1;p.on("close",function(){w=!0}),e===void 0&&(e=ho()),e(p,{readable:_,writable:m},function(E){if(E)return g(E);w=!0,g()});var y=!1;return function(E){if(!w&&!y){if(y=!0,o(p))return p.abort();if(typeof p.destroy=="function")return p.destroy();g(E||new s("pipe"))}}}function h(p){p()}function l(p,_){return p.pipe(_)}function c(p){return!p.length||typeof p[p.length-1]!="function"?n:p.pop()}function u(){for(var p=arguments.length,_=new Array(p),m=0;m<p;m++)_[m]=arguments[m];var g=c(_);if(Array.isArray(_[0])&&(_=_[0]),_.length<2)throw new i("streams");var w,y=_.map(function(E,S){var v=S<_.length-1,k=S>0;return a(E,v,k,function(R){w||(w=R),R&&y.forEach(h),!v&&(y.forEach(h),g(w))})});return _.reduce(l)}return go=u,go}var vo,Cc;function P_(){if(Cc)return vo;Cc=1,vo=r;var e=Vs().EventEmitter,t=hr();t(r,e),r.Readable=mc(),r.Writable=fc(),r.Duplex=Dr(),r.Transform=bc(),r.PassThrough=T_(),r.finished=ho(),r.pipeline=L_(),r.Stream=r;function r(){e.call(this)}return r.prototype.pipe=function(i,s){var n=this;function o(_){i.writable&&i.write(_)===!1&&n.pause&&n.pause()}n.on("data",o);function a(){n.readable&&n.resume&&n.resume()}i.on("drain",a),!i._isStdio&&(!s||s.end!==!1)&&(n.on("end",l),n.on("close",c));var h=!1;function l(){h||(h=!0,i.end())}function c(){h||(h=!0,typeof i.destroy=="function"&&i.destroy())}function u(_){if(p(),e.listenerCount(this,"error")===0)throw _}n.on("error",u),i.on("error",u);function p(){n.removeListener("data",o),i.removeListener("drain",a),n.removeListener("end",l),n.removeListener("close",c),n.removeListener("error",u),i.removeListener("error",u),n.removeListener("end",p),n.removeListener("close",p),i.removeListener("close",p)}return n.on("end",p),n.on("close",p),i.on("close",p),i.emit("pipe",n),i},vo}Ls.exports,function(e){var t=Xt.Buffer,r=Ps,i=Bl;e.exports.encodings=null,e.exports.defaultCharUnicode="",e.exports.defaultCharSingleByte="?",e.exports.encode=function(o,a,h){o=""+(o||"");var l=e.exports.getEncoder(a,h),c=l.write(o),u=l.end();return u&&u.length>0?t.concat([c,u]):c},e.exports.decode=function(o,a,h){typeof o=="string"&&(e.exports.skipDecodeWarning||(console.error("Iconv-lite warning: decode()-ing strings is deprecated. Refer to https://github.com/ashtuchkin/iconv-lite/wiki/Use-Buffers-when-decoding"),e.exports.skipDecodeWarning=!0),o=t.from(""+(o||""),"binary"));var l=e.exports.getDecoder(a,h),c=l.write(o),u=l.end();return u?c+u:c},e.exports.encodingExists=function(o){try{return e.exports.getCodec(o),!0}catch{return!1}},e.exports.toEncoding=e.exports.encode,e.exports.fromEncoding=e.exports.decode,e.exports._codecDataCache={__proto__:null},e.exports.getCodec=function(o){if(!e.exports.encodings){var a=jp();e.exports.encodings={__proto__:null},i(e.exports.encodings,a)}for(var h=e.exports._canonicalizeEncoding(o),l={};;){var c=e.exports._codecDataCache[h];if(c)return c;var u=e.exports.encodings[h];switch(typeof u){case"string":h=u;break;case"object":for(var p in u)l[p]=u[p];l.encodingName||(l.encodingName=h),h=u.type;break;case"function":return l.encodingName||(l.encodingName=h),c=new u(l,e.exports),e.exports._codecDataCache[l.encodingName]=c,c;default:throw new Error("Encoding not recognized: '"+o+"' (searched as: '"+h+"')")}}},e.exports._canonicalizeEncoding=function(n){return(""+n).toLowerCase().replace(/:\d{4}$|[^0-9a-z]/g,"")},e.exports.getEncoder=function(o,a){var h=e.exports.getCodec(o),l=new h.encoder(a,h);return h.bomAware&&a&&a.addBOM&&(l=new r.PrependBOM(l,a)),l},e.exports.getDecoder=function(o,a){var h=e.exports.getCodec(o),l=new h.decoder(a,h);return h.bomAware&&!(a&&a.stripBOM===!1)&&(l=new r.StripBOM(l,a)),l},e.exports.enableStreamingAPI=function(o){if(!e.exports.supportsStreams){var a=$p()(o);e.exports.IconvLiteEncoderStream=a.IconvLiteEncoderStream,e.exports.IconvLiteDecoderStream=a.IconvLiteDecoderStream,e.exports.encodeStream=function(l,c){return new e.exports.IconvLiteEncoderStream(e.exports.getEncoder(l,c),c)},e.exports.decodeStream=function(l,c){return new e.exports.IconvLiteDecoderStream(e.exports.getDecoder(l,c),c)},e.exports.supportsStreams=!0}};var s;try{s=P_()}catch{}s&&s.Transform?e.exports.enableStreamingAPI(s):e.exports.encodeStream=e.exports.decodeStream=function(){throw new Error("iconv-lite Streaming API is not enabled. Use iconv.enableStreamingAPI(require('stream')); to enable it.")}}(Ls);var Vr=Ls.exports;class oe extends Error{constructor(t){super(t)}}const Fi=["utf-8","ibm866","iso-8859-2","iso-8859-3","iso-8859-4","iso-8859-5","iso-8859-6","iso-8859-7","iso-8859-8","iso-8859-10","iso-8859-13","iso-8859-14","iso-8859-15","iso-8859-16","koi8-r","koi8-u","macintosh","windows-874","windows-1250","windows-1251","windows-1252","windows-1253","windows-1254","windows-1255","windows-1256","windows-1257","windows-1258","gbk","gb18030","big5","euc-jp","shift-jis","euc-kr","utf-16be","utf-16le"],Ec=128,xc="...",Tr=(()=>{let e=[];for(let t in Fi)try{if(!Vr.encodingExists(Fi[t]))continue;new TextDecoder(Fi[t]),e.push(Fi[t])}catch{}return e})(),M_={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0},O_={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,a:!0,b:!0,c:!0,d:!0,e:!0,f:!0};function kc(e){for(let t=0;t<e.length;t++)if(!M_[e[t]])return!1;return!0}function I_(e){let t=e.toLowerCase();for(let r=0;r<t.length;r++)if(!O_[t[r]])return!1;return!0}function N_(e){for(let t=0;t<e.length;t++){const r=e.charCodeAt(t);if(!(r>=32&&r<=126)&&r!==128&&!(r>=130&&r<=140)&&r!==142&&!(r>=145&&r<=156)&&!(r>=158&&r<=159)&&!(r>=161&&r<=255))return!1}return!0}function F_(e){let r=e.split(".");if(r.length!=4)throw new oe("Invalid address");let i=new Uint8Array(4);for(let s in r){if(!kc(r[s]))throw new oe("Invalid address");let n=parseInt(r[s],10);if(isNaN(n))throw new oe("Invalid address");if(n>255)throw new oe("Invalid address");i[s]=n}return i}function U_(e){let r=e.split(":");if(r.length>8||r.length<=1)throw new oe("Invalid address");if(r[0].charAt(0)==="["){r[0]=r[0].substring(1,r[0].length);let n=r.length-1;if(r[n].charAt(r[n].length-1)!=="]")throw new oe("Invalid address");r[n]=r[n].substring(0,r[n].length-1)}let i=new Uint8Array(8*2),s=0;for(let n=0;n<r.length;n++){if(r[n].length<=0){s=8-r.length;continue}if(!I_(r[n]))throw new oe("Invalid address");let o=parseInt(r[n],16);if(isNaN(o))throw new oe("Invalid address");if(o>65535)throw new oe("Invalid address");let a=(s+n)*2;i[a]=o>>8,i[a+1]=o&255}return i}function Bc(e){let t=new Uint8Array(e.length);for(let r=0,i=e.length;r<i;r++)t[r]=e.charCodeAt(r);return t}function Rc(e){return new Uint8Array(xl.from(e,"binary").buffer)}const H_=new RegExp("^([0-9A-Za-z_.-]+)$");function W_(e){if(e.length<=0)throw new oe("Invalid address");if(!N_(e))throw new oe("Invalid address");if(!H_.test(e))throw new oe("Invalid address");return Bc(e)}function Ac(e){try{return{type:"IPv4",data:F_(e)}}catch{}try{return{type:"IPv6",data:new Uint8Array(U_(e).buffer)}}catch{}return{type:"Hostname",data:W_(e)}}function mo(e,t){let r=e.lastIndexOf(":"),i=e.indexOf(":"),s=e.indexOf("[");if((r<0||r!=i)&&s<0){let l=Ac(e);return{type:l.type,addr:l.data,port:t}}if(s>0)throw new oe("Invalid address");if(s===0){let l=e.lastIndexOf("]");if(l<=s||l+1!=r)throw new oe("Invalid address")}let n=e.slice(0,r),o=e.slice(r+1,e.length);if(!kc(o))throw new oe("Invalid address");let a=parseInt(o,10),h=Ac(n);return{type:h.type,addr:h.data,port:a}}const Ui=0,Hi=1,Wi=2,zi=3,Lr=255;class qi{static async read(t){let r=await nt(t,3),i=0,s=Ui,n=null;switch(i|=r[0],i<<=8,i|=r[1],s=r[2],s){case Ui:break;case Hi:n=await nt(t,4);break;case Wi:n=await nt(t,16);break;case zi:n=await nt(t,1),n=await nt(t,n[0]);break;default:throw new oe("Unknown address type")}return new qi(s,n,i)}constructor(t,r,i){this.addrType=t,this.addrData=r,this.addrPort=i}type(){return this.addrType}address(){return this.addrData}port(){return this.addrPort}buffer(){switch(this.type()){case Ui:return new Uint8Array([this.addrPort>>8,this.addrPort&255,Ui]);case Hi:if(this.addrData.length!=4)throw new oe("Invalid address length");return new Uint8Array([this.addrPort>>8,this.addrPort&255,Hi,this.addrData[0],this.addrData[1],this.addrData[2],this.addrData[3]]);case Wi:if(this.addrData.length!=16)throw new oe("Invalid address length");return new Uint8Array([this.addrPort>>8,this.addrPort&255,Wi,this.addrData[0],this.addrData[1],this.addrData[2],this.addrData[3],this.addrData[4],this.addrData[5],this.addrData[6],this.addrData[7],this.addrData[8],this.addrData[9],this.addrData[10],this.addrData[11],this.addrData[12],this.addrData[13],this.addrData[14],this.addrData[15]]);case zi:if(this.addrData.length>Lr)throw new oe("Host name cannot longer than "+Lr);{let t=new Uint8Array(this.addrData.length+4);return t[0]=this.addrPort>>8&255,t[1]=this.addrPort&255,t[2]=zi,t[3]=this.addrData.length&255,t.set(this.addrData,4),t}default:throw new oe("Unknown address type")}}}function Dc(e,t){let r=mo(e,t),i=zi;switch(r.type){case"IPv4":i=Hi;break;case"IPv6":i=Wi;break;case"Hostname":break;default:throw new oe("Invalid address type")}return{type:i,address:r.addr,port:r.port}}const Pr={title:"",type:"",host:"",tab_color:"",meta:{}};function z_(e){for(let t in e.meta)if(typeof e.meta[t]!="string")throw new oe('The data type of meta field "'+t+'" was "'+typeof e.meta[t]+'" instead of expected "string"')}function q_(e){let t={};for(let r in Pr)t[r]=Pr[r];for(let r in Pr){if(typeof Pr[r]==typeof e[r]){t[r]=e[r];continue}if(typeof e[r]>"u"||!e[r]){t[r]=Pr[r];continue}throw new oe('Expecting the data type of "'+r+'" is "'+typeof Pr[r]+'", received data of "'+typeof e[r]+'" type instead')}return z_(t.meta),t}let j_=class{constructor(t){this.preset=q_(t)}title(){return this.preset.title}type(){return this.preset.type}host(){return this.preset.host}tabColor(){return this.preset.tab_color}meta(t){if(typeof this.preset.meta[t]!="string")throw new oe('Meta "'+t+'" was undefined');return this.preset.meta[t]}metaDefault(t,r){try{return this.meta(t)}catch{return r}}insertMeta(t,r){if(typeof this.preset.meta[t]<"u")throw new oe('Meta "'+t+'" has already been defined');this.preset.meta[t]=r}metaKeys(){let t=[];for(let r in this.preset.meta)t.push(r);return t}};function Tc(){return new j_({title:"Default",type:"Default",host:"",tab_color:"",meta:{}})}const yo=1,bo=2,ji=3;class Lc{constructor(t,r,i,s){this.name=t,this.info=r,this.control=i,this.ui=s}}class $_{constructor(t){this.s=!!t.success,this.d=t.successData,this.errorTitle=t.errorTitle,this.errorMessage=t.errorMessage}error(){return this.errorTitle}message(){return this.errorMessage}success(){return this.s}data(){return this.d}}class K_{constructor(t){this.t=t.title,this.m=t.message}title(){return this.t}message(){return this.m}}const V_={name:"",description:"",type:"",value:"",example:"",readonly:!1,suggestions(e){return[]},verify(e){return""}};function Pc(e,t){let r={};for(let i in e)r[i]=e[i];for(let i in t){if(typeof r[i]==typeof t[i]){r[i]=t[i];continue}throw new oe('Field data type for "'+i+'" was unmatched. Expecting "'+typeof r[i]+'", got "'+typeof t[i]+'" instead')}if(!r.name)throw new oe('Field "name" must be specified');return r}function Mc(e,t){let r=[];for(let i in t){if(!t[i].name)throw new oe('Field "name" must be specified');if(!e[t[i].name])throw new oe('Undefined field "'+t[i].name+'"');r.push(Pc(e[t[i].name],t[i]))}return r}function wo(e,t,r,i){let s=Mc(e,t);for(let n in s)try{s[n].value=r.meta(s[n].name),s[n].readonly=!0,i(s[n].name)}catch{}return s}class G_{constructor(t){this.t=t.title,this.m=t.message,this.a=t.actionText,this.r=t.respond,this.c=t.cancel,this.i=[],this.f={};for(let r in t.inputs){let i=Pc(V_,t.inputs[r]);this.i.push(i),this.f[t.inputs[r].name.toLowerCase()]={value:i.value,verify:i.verify}}}title(){return this.t}message(){return this.m}inputs(){let t=[];for(let r in this.i)t.push(this.i[r]);return t}actionText(){return this.a}submit(t){let r={};for(let i in this.f)r[i]=this.f[i].value;for(let i in t){let s=i.toLowerCase();if(typeof r[s]>"u")throw new oe('Field "'+s+'" is undefined');try{this.f[s].verify(t[i])}catch(n){throw new oe('Field "'+s+'" is invalid: '+n)}r[s]=t[i]}return this.r(r)}cancel(){return this.c()}}function So(e,t){return{type(){return e},data(){return t}}}function $i(e,t,r,i){return So(ji,{success:e,successData:t,errorTitle:r,errorMessage:i})}function Ut(e,t){return So(bo,{title:e,message:t})}function Ki(e,t,r,i,s,n){return So(yo,{title:e,message:t,actionText:r,inputs:n,respond:i,cancel:s})}class Y_{constructor(t){this.t=t.type(),this.d=t.data()}type(){return this.t}data(){switch(this.type()){case yo:return new G_(this.d);case bo:return new K_(this.d);case ji:return new $_(this.d);default:throw new oe("Unknown data type")}}}let Co=class{constructor(t,r,i){this.built=t,this.subs=r,this.done=i,this.closed=!1,this.built.run()}async next(){if(this.closed)throw new oe("Wizard already closed, no next step is available");let t=await this.subs.subscribe();return t.type()===ji&&(this.close(),this.done(t)),new Y_(t)}started(){return this.built.started()}control(){return this.built.control()}close(){if(!this.closed)return this.closed=!0,this.built.close()}};class Eo{constructor(t){this.type=t.name(),this.info=t.description(),this.tcolor=t.color()}name(){return this.type}description(){return this.info}color(){return this.tcolor}}class X_{constructor(t){this.cid=t.id(),this.represeter=r=>t.represet(r),this.wizarder=(r,i,s,n,o,a,h,l)=>t.wizard(r,i,s,n,o,a,h,l),this.executer=(r,i,s,n,o,a,h,l)=>t.execute(r,i,s,n,o,a,h,l),this.launchCmd=(r,i,s,n,o,a)=>t.launch(r,i,s,n,o,a),this.launcherCmd=r=>t.launcher(r),this.type=t.name(),this.info=t.description(),this.tcolor=t.color()}id(){return this.cid}name(){return this.type}description(){return this.info}color(){return this.tcolor}wizard(t,r,i,s,n,o,a){let h=new Gt;return new Co(this.wizarder(new Eo(this),s,n,o,t,h,r,i),h,a)}execute(t,r,i,s,n,o,a){let h=new Gt;return new Co(this.executer(new Eo(this),s,n,o,t,h,r,i),h,a)}launch(t,r,i,s,n){let o=new Gt;return new Co(this.launchCmd(new Eo(this),decodeURI(s),t,o,r,i),o,n)}launcher(t){return this.name()+":"+encodeURI(this.launcherCmd(t))}represet(t){return this.represeter(t)}}class J_{constructor(t,r){this.preset=t,this.command=r}}class Z_{constructor(t){this.commands=[];for(let r=0;r<t.length;r++)this.commands.push(new X_(t[r]))}all(){return this.commands}select(t){return this.commands[t]}mergePresets(t){let r=[];for(let i=0;i<this.commands.length;i++){const s=t.fetch(this.commands[i].name());for(let n=0;n<s.length;n++)r.push(new J_(this.commands[i].represet(s[n]),this.commands[i]))}return r}}class Q_{constructor(t){this.controls={};for(let r in t){let i=t[r].type();if(typeof this.controls[i]=="object")throw new oe('Control "'+i+'" already been defined');this.controls[i]=t[r]}}get(t){if(typeof this.controls[t]!="object")throw new oe('Control "'+t+'" was undefined');return this.controls[t]}}class Oc{constructor(t,r){this.events={},this.placeHolders={};for(let i in t){if(typeof r[t[i]]!="function")throw new oe('Unknown event type for "'+t[i]+'". Expecting "function" got "'+typeof r[t[i]]+'" instead.');let s=t[i];s.indexOf("@")===0&&(s=s.substring(1),this.placeHolders[s]=null),this.events[s]=r[t[i]]}}place(t,r){if(this.placeHolders[t]!==null)throw new oe('Event type "'+t+'" cannot be appended. It maybe unregistered or already been acquired');if(typeof r!="function")throw new oe('Unknown event type for "'+t+'". Expecting "function" got "'+typeof r+'" instead.');delete this.placeHolders[t],this.events[t]=r}fire(t,...r){if(!this.events[t]&&this.placeHolders[t]!==null)throw new oe("Unknown event type: "+t);return this.events[t](...r)}}function Ic(e,t){if(!e||typeof e!="object"||e.length<0)return null;let r={},i=0;for(let s in e)t[e[s]]&&(r[e[s]]=t[e[s]],i++);return i<=0?null:r}function e0(e,t,r){switch(typeof e[t]){case"string":return e[t].indexOf(r)>=0;default:return!1}}class t0{constructor(t,r,i){this.records=t,this.maxItems=i,this.saver=r}indexOf(t){for(let r in this.records)if(this.records[r].uname===t)return r;return-1}save(t,r,i,s,n,o,a){const h=this.indexOf(t);h>=0&&this.records.splice(h,1),this.records.push({uname:t,title:r,type:s.name(),color:s.color(),last:i.getTime(),data:n,session:o,keptSessions:a}),this.records.length>this.maxItems&&(this.records=this.records.slice(this.records.length-this.maxItems,this.records.length)),this.store()}store(){this.saver(this,this.export())}del(t){for(let r in this.records)if(this.records[r].uname===t){this.records.splice(r,1);break}this.saver(this,this.records)}clearSession(t){for(let r in this.records)if(this.records[r].uname===t){this.records[r].session=null,this.records[r].keptSessions=[];break}this.store()}all(){let t=[];for(let r in this.records)t.push({uid:this.records[r].uname,title:this.records[r].title,type:this.records[r].type,color:this.records[r].color,last:new Date(this.records[r].last),data:this.records[r].data,session:this.records[r].session,keptSessions:this.records[r].keptSessions});return t}export(){let t=[];for(let r in this.records)t.push({uname:this.records[r].uname,title:this.records[r].title,type:this.records[r].type,color:this.records[r].color,last:this.records[r].last,data:this.records[r].data,session:Ic(this.records[r].keptSessions,this.records[r].session),keptSessions:this.records[r].keptSessions});return t}import(t){for(let r in t)this.indexOf(t[r].uname)>=0||this.records.push({uname:t[r].uname,title:t[r].title,type:t[r].type,color:t[r].color,last:t[r].last,data:t[r].data,session:Ic(t[r].keptSessions,t[r].session),keptSessions:t[r].keptSessions});this.store()}search(t,r,i,s){let n=s>this.records.length?this.records.length:s,o=[];n<0&&(n=this.records.length);for(let a=0;a<this.records.length&&o.length<n;a++)this.records[a].type===t&&this.records[a].data&&e0(this.records[a].data,r,i)&&o.push(this.records[a]);return o}}const r0=16383,i0=2,Nc=128,Vi=127;class Fc{constructor(t){this.num=t}marshal(){if(this.num>r0)throw new oe("Integer number cannot be greater than 0x3fff");return this.num<=Vi?new Uint8Array([this.num&Vi]):new Uint8Array([this.num>>7|Nc,this.num&Vi])}async unmarshal(t){for(let r=0;r<i0;r++){let i=await Nt(t);if(this.num|=i[0]&Vi,!(Nc&i[0]))return;this.num<<=7}}value(){return this.num}}let s0=class Af{static async read(t){let r=new Fc(0);return await r.unmarshal(t),new Af(await nt(t,r.value()))}constructor(t){this.str=t}data(){return this.str}buffer(){let t=new Fc(this.str.length).marshal(),r=new Uint8Array(t.length+this.str.length);return r.set(t,0),r.set(this.str,t.length),r}};function Uc(e,t,r){return e.length<=t?e:e.substring(0,t)+r}const n0=0,Hc=1,Wc=2,xo=1,zc=127,Gi=4096,qc=22,o0=0,a0=1,l0=2,h0=3,c0=4,u0=5,f0=6,d0=0,p0=1,ko=2,jc=3,_0=1,g0=2,v0=3,$c=0,m0=1,Kc=2,y0=3;let b0=class{constructor(t,r,i){this.sender=t,this.config=r,this.connected=!1,this.events=new Oc(["initialization.failed","initialized","hook.before_connected","connect.failed","connect.succeed","connect.fingerprint","connect.credential","@stdout","@stderr","close","@completed"],i)}run(t){let r=new s0(this.config.user),i=r.buffer(),s=new qi(this.config.host.type,this.config.host.address,this.config.host.port),n=s.buffer(),o=new Uint8Array([this.config.auth]),a=new Uint8Array(i.length+n.length+1);a.set(i,0),a.set(n,i.length),a.set(o,i.length+n.length),t.send(a)}initialize(t){if(!t.success()){this.events.fire("initialization.failed",t);return}this.events.fire("initialized",t)}tick(t,r){switch(t.marker()){case f0:if(!this.connected)return this.events.fire("connect.credential",r,this.sender);break;case u0:if(!this.connected)return this.events.fire("connect.fingerprint",r,this.sender);break;case c0:if(!this.connected)return this.connected=!0,this.events.fire("connect.succeed",r,this);break;case h0:if(!this.connected)return this.events.fire("connect.failed",r);break;case l0:if(!this.connected)return this.events.fire("hook.before_connected",r);break;case a0:if(this.connected)return this.events.fire("stderr",r);break;case o0:if(this.connected)return this.events.fire("stdout",r);break}throw new oe("Unknown stream header marker")}async sendClose(){return await this.sender.close()}async sendData(t){return this.sender.sendData(d0,t)}async sendResize(t,r){let i=new DataView(new ArrayBuffer(4));return i.setUint16(0,t),i.setUint16(2,r),this.sender.send(p0,new Uint8Array(i.buffer))}async close(){return await this.sendClose(),this.events.fire("close")}completed(){return this.events.fire("completed")}};const cr={Host:{name:"Host",description:"",type:"text",value:"",example:"ssh.nirui.org:22",readonly:!1,suggestions(e){return[]},verify(e){if(e.length<=0)throw new Error("Hostname must be specified");let t=mo(e,qc);if(t.addr.length<=0)throw new Error("Cannot be empty");if(t.addr.length>Lr)throw new Error("Can no longer than "+Lr+" bytes");if(t.port<=0)throw new Error("Port must be specified");return"Look like "+t.type+" address"}},User:{name:"User",description:"",type:"text",value:"",example:"guest",readonly:!1,suggestions(e){return[]},verify(e){if(e.length<=0)throw new Error("Username must be specified");if(e.length>zc)throw new Error("Username must not longer than "+zc+" bytes");return`We'll login as user "`+e+'"'}},Encoding:{name:"Encoding",description:"The character encoding of the server",type:"select",value:"utf-8",example:Tr.join(","),readonly:!1,suggestions(e){return[]},verify(e){for(let t in Tr)if(Tr[t]===e)return"";throw new Error('The character encoding "'+e+'" is not supported')}},Notice:{name:"Notice",description:"",type:"textdata",value:"SSH session is handled by the backend. Traffic will be decrypted on the backend server and then transmit back to your client.",example:"",readonly:!1,suggestions(e){return[]},verify(e){return""}},Password:{name:"Password",description:"",type:"password",value:"",example:"----------",readonly:!1,suggestions(e){return[]},verify(e){if(e.length<=0)throw new Error("Password must be specified");if(e.length>Gi)throw new Error("It's too long, make it shorter than "+Gi+" bytes");return"We'll login with this password"}},"Private Key":{name:"Private Key",description:'Like the one inside <i style="color: #fff; font-style: normal;">~/.ssh/id_rsa</i>, can&apos;t be encrypted<br /><br />To decrypt the Private Key, use command: <i style="color: #fff; font-style: normal;">ssh-keygen -f /path/to/private_key -p</i><br /><br />It is strongly recommended to use one Private Key per SSH server if the Private Key will be submitted to Sshwifty. To generate a new SSH key pair, use command <i style="color: #fff; font-style: normal;">ssh-keygen -o -f /path/to/my_server_key</i> and then deploy the generated <i style="color: #fff; font-style: normal;">/path/to/my_server_key.pub</i> file onto the target SSH server',type:"textfile",value:"",example:"",readonly:!1,suggestions(e){return[]},verify(e){if(e.length<=0)throw new Error("Private Key must be specified");if(e.length>Gi)throw new Error("It's too long, make it shorter than "+Gi+" bytes");const t=e.trim().split(`
`);let r=!1;for(let i in t){if(!r){if(t[i].indexOf("-")===0&&(r=!0,t[i].indexOf("RSA")<=0))break;continue}if(t[i].indexOf("Proc-Type: 4,ENCRYPTED")===0)throw new Error("Cannot use encrypted Private Key file");if(!(t[i].indexOf(":")>0)){if(t[i].indexOf("MII")<0)throw new Error("Cannot use encrypted Private Key file");break}}return"We'll login with this Private Key"}},Authentication:{name:"Authentication",description:"Please make sure the authentication method that you selected is supported by the server, otherwise it will be ignored and likely cause the login to fail",type:"radio",value:"",example:"Password,Private Key,None",readonly:!1,suggestions(e){return[]},verify(e){switch(e){case"Password":case"Private Key":case"None":return"";default:throw new Error("Authentication method must be specified")}}},Fingerprint:{name:"Fingerprint",description:"Please carefully verify the fingerprint. DO NOT continue if the fingerprint is unknown to you, otherwise you maybe giving your own secrets to an imposter",type:"textdata",value:"",example:"",readonly:!1,suggestions(e){return[]},verify(e){return""}}};function w0(e){switch(e){case"None":return n0;case"Password":return Hc;case"Private Key":return Wc;default:throw new oe("Unknown Auth method")}}let Vc=class{constructor(t,r,i,s,n,o,a,h){this.info=t,this.preset=r,this.hasStarted=!1,this.streams=n,this.session=i||{credential:""},this.keptSessions=s,this.step=o,this.controls=a.get("SSH"),this.history=h}run(){this.step.resolve(this.stepInitialPrompt())}started(){return this.hasStarted}control(){return this.controls}close(){this.step.resolve(this.stepErrorDone("Action cancelled","Action has been cancelled without reach any success"))}stepErrorDone(t,r){return $i(!1,null,t,r)}stepSuccessfulDone(t){return $i(!0,t,"Success!","We have connected to the remote")}stepWaitForAcceptWait(){return Ut("Requesting","Waiting for the request to be accepted by the backend")}stepWaitForEstablishWait(t){return Ut("Connecting to "+t,"Establishing connection with the remote host, may take a while")}stepContinueWaitForEstablishWait(){return Ut("Connecting","Establishing connection with the remote host, may take a while")}buildCommand(t,r,i){let s=this,n={user:Bc(r.user),auth:w0(r.authentication),charset:r.charset,credential:i.credential,host:Dc(r.host,qc),fingerprint:r.fingerprint},o=s.keptSessions?[].concat(...s.keptSessions):[];return new b0(t,n,{"initialization.failed"(a){switch(a.data()){case _0:s.step.resolve(s.stepErrorDone("Request failed","Invalid username"));return;case g0:s.step.resolve(s.stepErrorDone("Request failed","Invalid address"));return;case v0:s.step.resolve(s.stepErrorDone("Request failed","Invalid authication method"));return}s.step.resolve(s.stepErrorDone("Request failed","Unknown error: "+a.data()))},initialized(a){s.step.resolve(s.stepWaitForEstablishWait(r.host))},async"connect.failed"(a){let h=new TextDecoder("utf-8").decode(await St(a));s.step.resolve(s.stepErrorDone("Connection failed",h))},async"hook.before_connected"(a){const h=new TextDecoder("utf-8").decode(await St(a));s.step.resolve(s.stepHookOutputPrompt("Waiting for server hook",h))},"connect.succeed"(a,h){s.connectionSucceed=!0,s.step.resolve(s.stepSuccessfulDone(new Lc(r.user+"@"+r.host,s.info,s.controls.build({charset:r.charset,tabColor:r.tabColor,send(l){return h.sendData(l)},close(){return h.sendClose()},resize(l,c){return h.sendResize(l,c)},events:h.events}),s.controls.ui()))),s.history.save(s.info.name()+":"+r.user+"@"+r.host,r.user+"@"+r.host,new Date,s.info,r,i,o)},async"connect.fingerprint"(a,h){s.step.resolve(await s.stepFingerprintPrompt(a,h,l=>r.fingerprint?r.fingerprint===l?$c:Kc:m0,l=>{r.fingerprint=l}))},async"connect.credential"(a,h){s.step.resolve(s.stepCredentialPrompt(a,h,n,(l,c)=>{i.credential=l,c&&o.indexOf("credential")<0&&o.push("credential")}))},"@stdout"(a){},"@stderr"(a){},close(){},"@completed"(){s.step.resolve(s.stepErrorDone("Operation has failed","Connection has been cancelled"))}})}stepInitialPrompt(){let t=this;return Ki("SSH","Secure Shell Host","Connect",r=>{t.hasStarted=!0,t.streams.request(xo,i=>t.buildCommand(i,{user:r.user,authentication:r.authentication,host:r.host,charset:r.encoding,tabColor:t.preset?t.preset.tabColor():"",fingerprint:t.preset?t.preset.metaDefault("Fingerprint",""):""},t.session)),t.step.resolve(t.stepWaitForAcceptWait())},()=>{},wo(cr,[{name:"Host",suggestions(r){const i=t.history.search("SSH","host",r,y0);let s=[];for(let n=0;n<i.length;n++)s.push({title:i[n].title,value:i[n].data.host,meta:{User:i[n].data.user,Authentication:i[n].data.authentication,Encoding:i[n].data.charset}});return s}},{name:"User"},{name:"Authentication"},{name:"Encoding"},{name:"Notice"}],t.preset,r=>{}))}async stepFingerprintPrompt(t,r,i,s){const n=this;let o=new TextDecoder("utf-8").decode(await St(t)),a=!1;switch(i(o)){case $c:return r.send(ko,new Uint8Array([0])),n.stepContinueWaitForEstablishWait();case Kc:a=!0}return Ki(a?"Danger! Server fingerprint has changed!":"Do you recognize this server?",a?"It's very unusual. Please verify the new server fingerprint below":"Verify server fingerprint displayed below",a?"I'm aware of the change":"Yes, I do",h=>{s(o),r.send(ko,new Uint8Array([0])),n.step.resolve(n.stepContinueWaitForEstablishWait())},()=>{r.send(ko,new Uint8Array([1])),n.step.resolve(Ut("Rejecting","Sending rejection to the backend"))},Mc(cr,[{name:"Fingerprint",value:o}]))}stepHookOutputPrompt(t,r){return Ut(t,Uc(r,Ec,xc))}async stepCredentialPrompt(t,r,i,s){const n=this;let o=[];if(i.credential.length>0)return r.send(jc,new TextEncoder().encode(i.credential)),n.stepContinueWaitForEstablishWait();switch(i.auth){case Hc:o=[{name:"Password"}];break;case Wc:o=[{name:"Private Key"}];break;default:throw new oe('Auth method "'+i.auth+'" was unsupported')}let a=!1;const h=wo(cr,o,n.preset,l=>{l===o[0].name&&(a=!0)});return Ki("Provide credential","Please input your credential","Login",l=>{let c=l[o[0].name.toLowerCase()];r.send(jc,new TextEncoder().encode(c)),s(c,a),n.step.resolve(n.stepContinueWaitForEstablishWait())},()=>{r.close(),n.step.resolve(Ut("Cancelling login","Cancelling login request, please wait"))},h)}};class S0 extends Vc{constructor(t,r,i,s,n,o,a,h){super(t,Tc(),i,s,n,o,a,h),this.config=r}stepInitialPrompt(){const t=this;return t.hasStarted=!0,t.streams.request(xo,r=>t.buildCommand(r,{user:t.config.user,authentication:t.config.authentication,host:t.config.host,charset:t.config.charset?t.config.charset:"utf-8",tabColor:t.config.tabColor?t.config.tabColor:"",fingerprint:t.config.fingerprint},t.session)),t.stepWaitForAcceptWait()}}let C0=class{constructor(){}id(){return xo}name(){return"SSH"}description(){return"Secure Shell Host"}color(){return"#3c8"}wizard(t,r,i,s,n,o,a,h){return new Vc(t,r,i,s,n,o,a,h)}execute(t,r,i,s,n,o,a,h){return new S0(t,r,i,s,n,o,a,h)}launch(t,r,i,s,n,o){const a=r.split("|",3);if(a.length<2)throw new oe('Given launcher "'+r+'" was invalid');const h=a[0].match(new RegExp("^(.*)\\@(.*)$"));if(!h||h.length!==3)throw new oe('Given launcher "'+r+'" was malformed');let l=h[1],c=h[2],u=a[1],p=a.length>=3&&a[2]?a[2]:"utf-8";try{cr.User.verify(l),cr.Host.verify(c),cr.Authentication.verify(u),cr.Encoding.verify(p)}catch(_){throw new oe('Given launcher "'+r+'" was malformed '+_)}return this.execute(t,{user:l,host:c,authentication:u,charset:p},null,null,i,s,n,o)}launcher(t){return t.user+"@"+t.host+"|"+t.authentication+"|"+(t.charset?t.charset:"utf-8")}represet(t){const r=t.host();return r.length>0&&t.insertMeta("Host",r),t}};const Bo=0,E0=1,x0=0,k0=1,B0=2,R0=3,Gc=23,A0=3;let D0=class{constructor(t,r,i){this.sender=t,this.config=r,this.connected=!1,this.events=new Oc(["initialization.failed","initialized","hook.before_connected","connect.failed","connect.succeed","@inband","close","@completed"],i)}run(t){let r=new qi(this.config.host.type,this.config.host.address,this.config.host.port),i=r.buffer(),s=new Uint8Array(i.length);s.set(i,0),t.send(s)}initialize(t){if(!t.success()){this.events.fire("initialization.failed",t);return}this.events.fire("initialized",t)}tick(t,r){switch(t.marker()){case R0:if(!this.connected)return this.connected=!0,this.events.fire("connect.succeed",r,this);break;case B0:if(!this.connected)return this.events.fire("connect.failed",r);break;case k0:if(!this.connected)return this.events.fire("hook.before_connected",r);break;case x0:if(this.connected)return this.events.fire("inband",r);break}throw new oe("Unknown stream header marker")}sendClose(){return this.sender.close()}sendData(t){return this.sender.sendData(0,t)}close(){return this.sendClose(),this.events.fire("close")}completed(){return this.events.fire("completed")}};const Ro={Host:{name:"Host",description:'Looking for server to connect&quest; Checkout <a href="http://www.telnet.org/htm/places.htm" target="blank">telnet.org</a> for public servers.',type:"text",value:"",example:"telnet.nirui.org:23",readonly:!1,suggestions(e){return[]},verify(e){if(e.length<=0)throw new Error("Hostname must be specified");let t=mo(e,Gc);if(t.addr.length<=0)throw new Error("Cannot be empty");if(t.addr.length>Lr)throw new Error("Can no longer than "+Lr+" bytes");if(t.port<=0)throw new Error("Port must be specified");return"Look like "+t.type+" address"}},Encoding:{name:"Encoding",description:"The character encoding of the server",type:"select",value:"utf-8",example:Tr.join(","),readonly:!1,suggestions(e){return[]},verify(e){for(let t in Tr)if(Tr[t]===e)return"";throw new Error('The character encoding "'+e+'" is not supported')}}};class Yc{constructor(t,r,i,s,n,o,a,h){this.info=t,this.preset=r,this.hasStarted=!1,this.streams=n,this.session=i,this.keptSessions=s,this.step=o,this.controls=a.get("Telnet"),this.history=h}run(){this.step.resolve(this.stepInitialPrompt())}started(){return this.hasStarted}control(){return this.controls}close(){this.step.resolve(this.stepErrorDone("Action cancelled","Action has been cancelled without reach any success"))}stepErrorDone(t,r){return $i(!1,null,t,r)}stepHookOutputPrompt(t,r){return Ut(t,Uc(r,Ec,xc))}stepSuccessfulDone(t){return $i(!0,t,"Success!","We have connected to the remote")}stepWaitForAcceptWait(){return Ut("Requesting","Waiting for the request to be accepted by the backend")}stepWaitForEstablishWait(t){return Ut("Connecting to "+t,"Establishing connection with the remote host, may take a while")}buildCommand(t,r,i){let s=this,n={host:Dc(r.host,Gc),charset:r.charset},o=s.keptSessions?[].concat(...s.keptSessions):[];return new D0(t,n,{"initialization.failed"(a){switch(a.data()){case E0:s.step.resolve(s.stepErrorDone("Request rejected","Invalid address"));return}s.step.resolve(s.stepErrorDone("Request rejected","Unknown error code: "+a.data()))},initialized(a){s.step.resolve(s.stepWaitForEstablishWait(r.host))},async"hook.before_connected"(a){const h=new TextDecoder("utf-8").decode(await St(a));s.step.resolve(s.stepHookOutputPrompt("Waiting for server hook",h))},"connect.succeed"(a,h){s.step.resolve(s.stepSuccessfulDone(new Lc(r.host,s.info,s.controls.build({charset:n.charset,tabColor:r.tabColor,send(l){return h.sendData(l)},close(){return h.sendClose()},events:h.events}),s.controls.ui()))),s.history.save(s.info.name()+":"+r.host,r.host,new Date,s.info,r,i,o)},async"connect.failed"(a){let h=await St(a),l=new TextDecoder("utf-8").decode(h.buffer);s.step.resolve(s.stepErrorDone("Connection failed",l))},"@inband"(a){},close(){},"@completed"(){}})}stepInitialPrompt(){const t=this;return Ki("Telnet","Teletype Network","Connect",r=>{t.hasStarted=!0,t.streams.request(Bo,i=>t.buildCommand(i,{host:r.host,charset:r.encoding,tabColor:t.preset?t.preset.tabColor():""},t.session)),t.step.resolve(t.stepWaitForAcceptWait())},()=>{},wo(Ro,[{name:"Host",suggestions(r){const i=t.history.search("Telnet","host",r,A0);let s=[];for(let n=0;n<i.length;n++)s.push({title:i[n].title,value:i[n].data.host,meta:{Encoding:i[n].data.charset}});return s}},{name:"Encoding"}],t.preset,r=>{}))}}class T0 extends Yc{constructor(t,r,i,s,n,o,a,h){super(t,Tc(),i,s,n,o,a,h),this.config=r}stepInitialPrompt(){const t=this;return t.hasStarted=!0,t.streams.request(Bo,r=>t.buildCommand(r,{host:t.config.host,charset:t.config.charset?t.config.charset:"utf-8",tabColor:t.config.tabColor?t.config.tabColor:""},t.session)),t.stepWaitForAcceptWait()}}class L0{constructor(){}id(){return Bo}name(){return"Telnet"}description(){return"Teletype Network"}color(){return"#6ac"}wizard(t,r,i,s,n,o,a,h){return new Yc(t,r,i,s,n,o,a,h)}execute(t,r,i,s,n,o,a,h){return new T0(t,r,i,s,n,o,a,h)}launch(t,r,i,s,n,o){const a=r.split("|",2);if(a.length<=0)throw new oe('Given launcher "'+r+'" was invalid');try{Ro.Host.verify(a[0])}catch(l){throw new oe('Given launcher "'+r+'" was invalid: '+l)}let h="utf-8";if(a.length>1)try{Ro.Encoding.verify(a[1]),h=a[1]}catch(l){throw new oe('Given launcher "'+r+'" was invalid: '+l)}return this.execute(t,{host:a[0],charset:h},null,null,i,s,n,o)}launcher(t){return t.host+"|"+(t.charset?t.charset:"utf-8")}represet(t){const r=t.host();return r.length>0&&t.insertMeta("Host",r),t}}function Ao(e){let t=Math.round(e).toString(16);return t.length%2===0?t:"0"+t}function Do(e){return Math.round(parseInt(e,16))}const P0="^([a-f0-9]+)$";function M0(e){if(!e.toLowerCase().match(P0))return"";switch(e.length){case 6:return e;case 5:return e+e[4];case 4:return e[0]+e[1]+e[2]+e[2]+e[3]+e[3];case 3:return e[0]+e[0]+e[1]+e[1]+e[2]+e[2];case 2:return e[0]+e[0]+e[1]+e[1]+e[1]+e[1];case 1:return e[0]+e[0]+e[0]+e[0]+e[0]+e[0];case 0:return"";default:return e.slice(0,6)}}class Xc{constructor(t,r,i){this.r=t,this.g=r,this.b=i}hex(){return"#"+Ao(this.r)+Ao(this.g)+Ao(this.b)}}function To(e,t){return e+Math.random()*(t-e)}function O0(e,t){return new Xc(To(e,t),To(e,t),To(e,t))}class I0{constructor(t){this.color=t}hex(){return this.color.hex()}forget(){}}class N0{constructor(t,r){this.color=t,this.returner=r}hex(){return this.color.hex()}forget(){this.returner.forget(this)}}const F0=17,U0=34;class H0{constructor(){this.assignedColors={}}dispense(){let r=0;for(;;){let i=O0(F0,U0),s=i.hex();if(!(this.assignedColors[s]&&(r++,r<10)))return this.assignedColors[s]=!0,new N0(i,this)}}forget(t){delete this.assignedColors[t.hex()]}get(t){return t=M0(t),t.length<=0?this.dispense():new I0(new Xc(Do(t[0]+t[1]),Do(t[2]+t[3]),Do(t[4]+t[5])))}}let W0=class{constructor(t,r){this.background=r,this.charset=t.charset,this.charsetDecoder=s=>Vr.decode(s,this.charset),this.charsetEncoder=s=>Vr.encode(s,this.charset),this.enable=!1,this.sender=t.send,this.closer=t.close,this.resizer=t.resize,this.subs=new Gt;let i=this;t.events.place("stdout",async s=>{try{i.subs.resolve(i.charsetDecoder(await St(s)))}catch{}}),t.events.place("stderr",async s=>{try{i.subs.resolve(i.charsetDecoder(await St(s)))}catch{}}),t.events.place("completed",()=>{i.closed=!0,i.background.forget(),i.subs.reject("Remote connection has been terminated")})}echo(){return!1}resize(t){this.closed||this.resizer(t.rows,t.cols)}enabled(){this.enable=!0}disabled(){this.enable=!1}retap(t){}receive(){return this.subs.subscribe()}send(t){if(!this.closed)return this.sender(this.charsetEncoder(t))}sendBinary(t){if(!this.closed)return this.sender(Rc(t))}color(){return this.background.hex()}close(){if(this.closer===null)return;let t=this.closer;return this.closer=null,t()}};class z0{constructor(t){this.colors=t}type(){return"SSH"}ui(){return"Console"}build(t){return new W0(t,this.colors.get(t.tabColor))}}const Lo=240,q0=249,Po=250,Jt=251,ur=252,Zt=253,Mr=254,Et=255,j0=1,$0=3,Mo=24,Yi=31,K0=0,V0=1,G0=new Uint8Array([K0,88,84,69,82,77]);class Y0{constructor(t,r,i){this.sender=t,this.flusher=r,this.callbacks=i,this.reader=new Bs(()=>{}),this.options={echoEnabled:!1,suppressGoAhead:!1,nawsAccpeted:!1},this.current=0}sendNego(t,r){return this.sender(new Uint8Array([Et,t,r]))}sendDeny(t,r){switch(t){case Zt:return this.sendNego(ur,r);case ur:return this.sendNego(Mr,r)}}sendWillSubNego(t,r,i){let s=new Uint8Array(6+r.length+2);return s.set([Et,t,i,Et,Po,i],0),s.set(r,6),s.set([Et,Lo],r.length+6),this.sender(s)}sendSubNego(t,r){let i=new Uint8Array(3+t.length+2);return i.set([Et,Po,r],0),i.set(t,3),i.set([Et,Lo],t.length+3),this.sender(i)}async handleTermTypeSubNego(t){if((await Nt(t))[0]!==V0)return null;let i=this;return()=>{i.sendSubNego(G0,Mo)}}async handleSubNego(t){let r=null;for(;;){switch((await Nt(t))[0]){case Mo:r=await this.handleTermTypeSubNego(t);continue;case Et:break;default:continue}if((await Nt(t))[0]===Lo){r!==null&&r();return}}}handleOption(t,r,i,s){switch(t){case Jt:i||this.sendNego(Zt,r),s(!0,Jt);return;case ur:i&&this.sendNego(Mr,r),s(!1,ur);return;case Zt:i||this.sendNego(Jt,r),s(!0,Zt);return;case Mr:i&&this.sendNego(ur,r),s(!1,Mr);return}}async handleCmd(t){let r=await Nt(t);switch(r[0]){case Jt:case ur:case Zt:case Mr:break;case Et:this.flusher(r);return;case q0:return;case Po:await this.handleSubNego(t);return;default:throw new oe("Unknown command")}let i=await Nt(t);switch(i[0]){case j0:return this.handleOption(r[0],i[0],this.options.echoEnabled,(s,n)=>{switch(this.options.echoEnabled=s,n){case Jt:case Mr:this.callbacks.setEcho(!1);break;case ur:case Zt:this.callbacks.setEcho(!0);break}});case $0:return this.handleOption(r[0],i[0],this.options.suppressGoAhead,(s,n)=>{this.options.suppressGoAhead=s});case Yi:if(r[0]!==Zt){this.sendDeny(r[0],i[0]);return}{let s=this.callbacks.getWindowDim(),n=new DataView(new ArrayBuffer(4));n.setUint16(0,s.cols),n.setUint16(2,s.rows);let o=new Uint8Array(n.buffer);if(this.options.nawsAccpeted){this.sendSubNego(o,Yi);return}this.options.nawsAccpeted=!0,this.sendWillSubNego(Jt,o,Yi)}return;case Mo:if(r[0]!==Zt){this.sendDeny(r[0],i[0]);return}this.sendNego(Jt,i[0]);return}this.sendDeny(r[0],i[0])}requestWindowResize(){this.options.nawsAccpeted=!0,this.sendNego(Jt,Yi)}async run(){try{for(;;){let t=await Od(this.reader,Et);if(!t.found){this.flusher(t.data);continue}t.data.length>1&&this.flusher(t.data.slice(0,t.data.length-1)),await this.handleCmd(this.reader)}}catch{}}feed(t,r){this.reader.feed(t,r)}close(){this.reader.close()}}class X0{constructor(t,r){this.background=r,this.charset=t.charset,this.charsetDecoder=n=>Vr.decode(n,this.charset),this.charsetEncoder=n=>Vr.encode(n,this.charset),this.sender=t.send,this.closer=t.close,this.closed=!1,this.localEchoEnabled=!0,this.subs=new Gt,this.enable=!1,this.windowDim={cols:65535,rows:65535};let i=this;this.parser=new Y0(this.sender,n=>{i.subs.resolve(this.charsetDecoder(n))},{setEcho(n){i.localEchoEnabled=n},getWindowDim(){return i.windowDim}});let s=this.parser.run();t.events.place("inband",n=>new Promise((o,a)=>{i.parser.feed(n,()=>{o(!0)})})),t.events.place("completed",async()=>{i.parser.close(),i.closed=!0,i.background.forget(),await s,i.subs.reject("Remote connection has been terminated")})}echo(){return this.localEchoEnabled}resize(t){this.closed||(this.windowDim.cols=t.cols,this.windowDim.rows=t.rows,this.parser.requestWindowResize())}enabled(){this.enable=!0}disabled(){this.enable=!1}retap(t){}receive(){return this.subs.subscribe()}searchNextIAC(t,r){for(let i=t;i<r.length;i++)if(r[i]===Et)return i;return-1}sendSeg(t){let r=0;for(;r<t.length;){const i=this.searchNextIAC(r,t);if(i<0){this.sender(t.slice(r,t.length));return}this.sender(t.slice(r,i+1)),this.sender(t.slice(i,i+1)),r=i+1}}send(t){this.closed||this.sendSeg(this.charsetEncoder(t))}sendBinary(t){if(!this.closed)return this.sendSeg(Rc(t))}color(){return this.background.hex()}close(){if(this.closer===null)return;let t=this.closer;return this.closer=null,t()}}class J0{constructor(t){this.colors=t}type(){return"Telnet"}ui(){return"Console"}build(t){return new X0(t,this.colors.get(t.tabColor))}}const Oo="/sshwifty/socket",Z0=Oo+"/verify",Q0=100*1e3;function eg(){return Number(Math.trunc(new Date().getTime()/Q0)).toString()}async function tg(e){return new Uint8Array(await ll(_l(e),_l(eg()))).slice(0,16)}async function rg(e){const t=new TextEncoder,r=Number(Math.trunc(new Date().getTime()/1e5)),i=e.length<=0?"DEFAULT VERIFY KEY":e;return new Uint8Array(await ll(t.encode(i),t.encode(String(r)))).slice(0,32)}async function Io(e,t,r){let i=null;t&&r&&(i=await rg(t));const s=i?btoa(String.fromCharCode.apply(null,i)):"",n=await Xd(e+Z0,{"X-Key":s});return{status:n.status,mixerKey:n.getResponseHeader("X-Key")||"",timeout:parseFloat(n.getResponseHeader("X-Timeout")||"120"),heartbeat:parseFloat(n.getResponseHeader("X-Heartbeat")||"15"),data:n.responseText}}function ig(e){const t=e.replace(/\/$/,""),r=t.startsWith("https")?"wss":"ws";return{webSocket:t.replace(/^https?/,r)+Oo,keepAlive:t+Oo}}function sg(e,t,r,i){const s=ig(e),n={async fetch(){const o=await Io(e,t,!!t);if(o.status!==200)throw new Error("Auth refresh failed: status "+o.status);const a=atob(o.mixerKey),h=t?a+"+"+t:a+"+";return await tg(h)}};return new Qd(s,n,r*1e3,i*1e3)}class ng{constructor(){this.sessions=new Map}createSession(t,r){this.sessions.set(t,{state:"idle",statusMsg:"Initializing...",errorMsg:"",config:r,socketInstance:null,sshControl:null,destroyed:!1,dataCallbacks:[],binaryCallbacks:[],resizeCallbacks:[],stateChangeCallbacks:[]})}getSession(t){return this.sessions.get(t)||null}getSessionState(t){const r=this.sessions.get(t);return r?r.state:"idle"}getSessionStatus(t){const r=this.sessions.get(t);return r?r.statusMsg:""}getSessionError(t){const r=this.sessions.get(t);return r?r.errorMsg:""}registerStateChangeCallback(t,r){const i=this.sessions.get(t);i&&i.stateChangeCallbacks.push(r)}updateSessionState(t,r){const i=this.sessions.get(t);i&&(i.state=r,i.stateChangeCallbacks.forEach(s=>s()))}updateSessionStatus(t,r){const i=this.sessions.get(t);i&&(i.statusMsg=r,i.stateChangeCallbacks.forEach(s=>s()))}updateSessionError(t,r){const i=this.sessions.get(t);i&&(i.errorMsg=r,i.stateChangeCallbacks.forEach(s=>s()))}async connect(t){const r=this.sessions.get(t);if(!r)throw new Error("Session not found: "+t);if(!r.destroyed){this.updateSessionState(t,"connecting"),this.updateSessionStatus(t,"Authenticating..."),this.updateSessionError(t,"");try{const{config:i}=r,{backendUrl:s,sharedKey:n}=i;let o=await Io(s||"","",!1);if(o.status===403){if(!n)throw new Error("Backend requires SharedKey (web access password) but it was not provided");if(o=await Io(s||"",n,!0),o.status!==200)throw new Error("Authentication failed (status "+o.status+")")}else if(o.status!==200)throw new Error("Backend returned status "+o.status);if(r.destroyed)return;this.updateSessionStatus(t,"Connecting to backend...");const a=sg(s||"",n||"",o.timeout,o.heartbeat);r.socketInstance=a;const h={connecting:()=>{this.updateSessionStatus(t,"Opening WebSocket...")},connected:()=>{this.updateSessionStatus(t,"WebSocket connected, requesting SSH stream...")},traffic:()=>{},echo:()=>{},close:S=>{!r.destroyed&&r.state==="connected"&&(this.updateSessionState(t,"error"),this.updateSessionError(t,"Connection closed"+(S?": "+S:"")))},failed:S=>{r.destroyed||(this.updateSessionState(t,"error"),this.updateSessionError(t,"Connection failed: "+S))}},l=await a.get(h);if(r.destroyed)return;this.updateSessionStatus(t,"Starting SSH session...");const c=new H0,u=new Q_([new J0(c),new z0(c)]),p=new Z_([new L0,new C0]),_=new t0([],()=>{},0),m=p.select(1),g=i.authMethod==="Password"?i.password:i.authMethod==="Private Key"?i.privateKey:"",w=m.execute(l,u,_,{user:i.username,host:i.host,authentication:i.authMethod,charset:i.encoding,tabColor:"",fingerprint:""},{credential:g},[],()=>{});let y=null;for(;;){if(r.destroyed){w.close();return}const S=await w.next(),v=S.type(),k=S.data();if(v===bo){this.updateSessionStatus(t,k.title()+"...");continue}if(v===yo){const R=k.inputs();if(R.some(Q=>Q.name==="Fingerprint"))if(i.acceptFingerprint){this.updateSessionStatus(t,"Accepting server fingerprint..."),k.submit({});continue}else{const Q=R.find(K=>K.name==="Fingerprint"),ie=Q?Q.value:"";throw k.cancel(),new Error("Server fingerprint not accepted (auto-accept disabled): "+ie)}const N=R.some(Q=>Q.name==="Password"),W=R.some(Q=>Q.name==="Private Key");if(N&&i.password){k.submit({Password:i.password});continue}if(W&&i.privateKey){k.submit({"Private Key":i.privateKey});continue}throw k.cancel(),new Error("Unexpected prompt from server: "+k.title())}if(v===ji){if(!k.success())throw new Error(k.error()+": "+k.message());y=k.data();break}}if(r.destroyed||!y)return;const E=y.control;r.sshControl=E,this.updateSessionState(t,"connected"),(async()=>{try{for(;!r.destroyed;){const S=await E.receive();r.dataCallbacks.forEach(v=>v(S))}}catch(S){r.destroyed||(this.updateSessionState(t,"error"),this.updateSessionError(t,"Connection lost: "+S))}})()}catch(i){r.destroyed||(this.updateSessionState(t,"error"),this.updateSessionError(t,String(i)))}}}async disconnect(t){const r=this.sessions.get(t);if(r){if(r.sshControl)try{await r.sshControl.close()}catch{}r.sshControl=null,this.updateSessionState(t,"idle")}}sendData(t,r){const i=this.sessions.get(t);i!=null&&i.sshControl&&!i.destroyed&&i.sshControl.send(r)}sendBinary(t,r){const i=this.sessions.get(t);i!=null&&i.sshControl&&!i.destroyed&&i.sshControl.sendBinary(r)}resize(t,r,i){const s=this.sessions.get(t);s!=null&&s.sshControl&&!s.destroyed&&r&&i&&s.sshControl.resize({rows:r,cols:i})}registerDataCallback(t,r){const i=this.sessions.get(t);i&&i.dataCallbacks.push(r)}registerBinaryCallback(t,r){const i=this.sessions.get(t);i&&i.binaryCallbacks.push(r)}registerResizeCallback(t,r){const i=this.sessions.get(t);i&&i.resizeCallbacks.push(r)}destroySession(t){const r=this.sessions.get(t);r&&(r.destroyed=!0,this.disconnect(t),this.sessions.delete(t))}}/**
 * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
 * @license MIT
 *
 * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
 * @license MIT
 *
 * Originally forked from (with the author's permission):
 *   Fabrice Bellard's javascript vt100 for jslinux:
 *   http://bellard.org/jslinux/
 *   Copyright (c) 2011 Fabrice Bellard
 */var Jc=Object.defineProperty,og=Object.getOwnPropertyDescriptor,ag=(e,t)=>{for(var r in t)Jc(e,r,{get:t[r],enumerable:!0})},Be=(e,t,r,i)=>{for(var s=i>1?void 0:i?og(t,r):t,n=e.length-1,o;n>=0;n--)(o=e[n])&&(s=(i?o(t,r,s):o(s))||s);return i&&s&&Jc(t,r,s),s},re=(e,t)=>(r,i)=>t(r,i,e),Zc="Terminal input",No={get:()=>Zc,set:e=>Zc=e},Qc="Too much output to announce, navigate to rows manually to read",Fo={get:()=>Qc,set:e=>Qc=e};function lg(e){return e.replace(/\r?\n/g,"\r")}function hg(e,t){return t?"\x1B[200~"+e+"\x1B[201~":e}function cg(e,t){e.clipboardData&&e.clipboardData.setData("text/plain",t.selectionText),e.preventDefault()}function ug(e,t,r,i){if(e.stopPropagation(),e.clipboardData){let s=e.clipboardData.getData("text/plain");eu(s,t,r,i)}}function eu(e,t,r,i){e=lg(e),e=hg(e,r.decPrivateModes.bracketedPasteMode&&i.rawOptions.ignoreBracketedPasteMode!==!0),r.triggerDataEvent(e,!0),t.value=""}function tu(e,t,r){let i=r.getBoundingClientRect(),s=e.clientX-i.left-10,n=e.clientY-i.top-10;t.style.width="20px",t.style.height="20px",t.style.left=`${s}px`,t.style.top=`${n}px`,t.style.zIndex="1000",t.focus()}function ru(e,t,r,i,s){tu(e,t,r),s&&i.rightClickSelect(e),t.value=i.selectionText,t.select()}function Qt(e){return e>65535?(e-=65536,String.fromCharCode((e>>10)+55296)+String.fromCharCode(e%1024+56320)):String.fromCharCode(e)}function Xi(e,t=0,r=e.length){let i="";for(let s=t;s<r;++s){let n=e[s];n>65535?(n-=65536,i+=String.fromCharCode((n>>10)+55296)+String.fromCharCode(n%1024+56320)):i+=String.fromCharCode(n)}return i}var fg=class{constructor(){this._interim=0}clear(){this._interim=0}decode(e,t){let r=e.length;if(!r)return 0;let i=0,s=0;if(this._interim){let n=e.charCodeAt(s++);56320<=n&&n<=57343?t[i++]=(this._interim-55296)*1024+n-56320+65536:(t[i++]=this._interim,t[i++]=n),this._interim=0}for(let n=s;n<r;++n){let o=e.charCodeAt(n);if(55296<=o&&o<=56319){if(++n>=r)return this._interim=o,i;let a=e.charCodeAt(n);56320<=a&&a<=57343?t[i++]=(o-55296)*1024+a-56320+65536:(t[i++]=o,t[i++]=a);continue}o!==65279&&(t[i++]=o)}return i}},dg=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(e,t){let r=e.length;if(!r)return 0;let i=0,s,n,o,a,h=0,l=0;if(this.interim[0]){let p=!1,_=this.interim[0];_&=(_&224)===192?31:(_&240)===224?15:7;let m=0,g;for(;(g=this.interim[++m]&63)&&m<4;)_<<=6,_|=g;let w=(this.interim[0]&224)===192?2:(this.interim[0]&240)===224?3:4,y=w-m;for(;l<y;){if(l>=r)return 0;if(g=e[l++],(g&192)!==128){l--,p=!0;break}else this.interim[m++]=g,_<<=6,_|=g&63}p||(w===2?_<128?l--:t[i++]=_:w===3?_<2048||_>=55296&&_<=57343||_===65279||(t[i++]=_):_<65536||_>1114111||(t[i++]=_)),this.interim.fill(0)}let c=r-4,u=l;for(;u<r;){for(;u<c&&!((s=e[u])&128)&&!((n=e[u+1])&128)&&!((o=e[u+2])&128)&&!((a=e[u+3])&128);)t[i++]=s,t[i++]=n,t[i++]=o,t[i++]=a,u+=4;if(s=e[u++],s<128)t[i++]=s;else if((s&224)===192){if(u>=r)return this.interim[0]=s,i;if(n=e[u++],(n&192)!==128){u--;continue}if(h=(s&31)<<6|n&63,h<128){u--;continue}t[i++]=h}else if((s&240)===224){if(u>=r)return this.interim[0]=s,i;if(n=e[u++],(n&192)!==128){u--;continue}if(u>=r)return this.interim[0]=s,this.interim[1]=n,i;if(o=e[u++],(o&192)!==128){u--;continue}if(h=(s&15)<<12|(n&63)<<6|o&63,h<2048||h>=55296&&h<=57343||h===65279)continue;t[i++]=h}else if((s&248)===240){if(u>=r)return this.interim[0]=s,i;if(n=e[u++],(n&192)!==128){u--;continue}if(u>=r)return this.interim[0]=s,this.interim[1]=n,i;if(o=e[u++],(o&192)!==128){u--;continue}if(u>=r)return this.interim[0]=s,this.interim[1]=n,this.interim[2]=o,i;if(a=e[u++],(a&192)!==128){u--;continue}if(h=(s&7)<<18|(n&63)<<12|(o&63)<<6|a&63,h<65536||h>1114111)continue;t[i++]=h}}return i}},iu="",er=" ",Gr=class Df{constructor(){this.fg=0,this.bg=0,this.extended=new Ji}static toColorRGB(t){return[t>>>16&255,t>>>8&255,t&255]}static fromColorRGB(t){return(t[0]&255)<<16|(t[1]&255)<<8|t[2]&255}clone(){let t=new Df;return t.fg=this.fg,t.bg=this.bg,t.extended=this.extended.clone(),t}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},Ji=class Tf{constructor(t=0,r=0){this._ext=0,this._urlId=0,this._ext=t,this._urlId=r}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(t){this._ext=t}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(t){this._ext&=-469762049,this._ext|=t<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(t){this._ext&=-67108864,this._ext|=t&67108863}get urlId(){return this._urlId}set urlId(t){this._urlId=t}get underlineVariantOffset(){let t=(this._ext&3758096384)>>29;return t<0?t^4294967288:t}set underlineVariantOffset(t){this._ext&=536870911,this._ext|=t<<29&3758096384}clone(){return new Tf(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},dt=class Lf extends Gr{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new Ji,this.combinedData=""}static fromCharData(t){let r=new Lf;return r.setFromCharData(t),r}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?Qt(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(t){this.fg=t[0],this.bg=0;let r=!1;if(t[1].length>2)r=!0;else if(t[1].length===2){let i=t[1].charCodeAt(0);if(55296<=i&&i<=56319){let s=t[1].charCodeAt(1);56320<=s&&s<=57343?this.content=(i-55296)*1024+s-56320+65536|t[2]<<22:r=!0}else r=!0}else this.content=t[1].charCodeAt(0)|t[2]<<22;r&&(this.combinedData=t[1],this.content=2097152|t[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},su="di$target",Uo="di$dependencies",Ho=new Map;function pg(e){return e[Uo]||[]}function Ue(e){if(Ho.has(e))return Ho.get(e);let t=function(r,i,s){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");_g(t,r,s)};return t._id=e,Ho.set(e,t),t}function _g(e,t,r){t[su]===t?t[Uo].push({id:e,index:r}):(t[Uo]=[{id:e,index:r}],t[su]=t)}var Ge=Ue("BufferService"),nu=Ue("CoreMouseService"),fr=Ue("CoreService"),gg=Ue("CharsetService"),Wo=Ue("InstantiationService"),ou=Ue("LogService"),Ye=Ue("OptionsService"),au=Ue("OscLinkService"),vg=Ue("UnicodeService"),Yr=Ue("DecorationService"),zo=class{constructor(e,t,r){this._bufferService=e,this._optionsService=t,this._oscLinkService=r}provideLinks(e,t){var c;let r=this._bufferService.buffer.lines.get(e-1);if(!r){t(void 0);return}let i=[],s=this._optionsService.rawOptions.linkHandler,n=new dt,o=r.getTrimmedLength(),a=-1,h=-1,l=!1;for(let u=0;u<o;u++)if(!(h===-1&&!r.hasContent(u))){if(r.loadCell(u,n),n.hasExtendedAttrs()&&n.extended.urlId)if(h===-1){h=u,a=n.extended.urlId;continue}else l=n.extended.urlId!==a;else h!==-1&&(l=!0);if(l||h!==-1&&u===o-1){let p=(c=this._oscLinkService.getLinkData(a))==null?void 0:c.uri;if(p){let _={start:{x:h+1,y:e},end:{x:u+(!l&&u===o-1?1:0),y:e}},m=!1;if(!(s!=null&&s.allowNonHttpProtocols))try{let g=new URL(p);["http:","https:"].includes(g.protocol)||(m=!0)}catch{m=!0}m||i.push({text:p,range:_,activate:(g,w)=>s?s.activate(g,w,_):mg(g,w),hover:(g,w)=>{var y;return(y=s==null?void 0:s.hover)==null?void 0:y.call(s,g,w,_)},leave:(g,w)=>{var y;return(y=s==null?void 0:s.leave)==null?void 0:y.call(s,g,w,_)}})}l=!1,n.hasExtendedAttrs()&&n.extended.urlId?(h=u,a=n.extended.urlId):(h=-1,a=-1)}}t(i)}};zo=Be([re(0,Ge),re(1,Ye),re(2,au)],zo);function mg(e,t){if(confirm(`Do you want to navigate to ${t}?

WARNING: This link could potentially be dangerous`)){let r=window.open();if(r){try{r.opener=null}catch{}r.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}}var Zi=Ue("CharSizeService"),Ht=Ue("CoreBrowserService"),qo=Ue("MouseService"),Wt=Ue("RenderService"),yg=Ue("SelectionService"),lu=Ue("CharacterJoinerService"),Or=Ue("ThemeService"),hu=Ue("LinkProviderService"),bg=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?cu.isErrorNoTelemetry(e)?new cu(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},wg=new bg;function Qi(e){Sg(e)||wg.onUnexpectedError(e)}var jo="Canceled";function Sg(e){return e instanceof Cg?!0:e instanceof Error&&e.name===jo&&e.message===jo}var Cg=class extends Error{constructor(){super(jo),this.name=this.message}};function Eg(e){return new Error(`Illegal argument: ${e}`)}var cu=class Ia extends Error{constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof Ia)return t;let r=new Ia;return r.message=t.message,r.stack=t.stack,r}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}},$o=class Pf extends Error{constructor(t){super(t||"An unexpected bug occurred."),Object.setPrototypeOf(this,Pf.prototype)}};function ot(e,t=0){return e[e.length-(1+t)]}var xg;(e=>{function t(n){return n<0}e.isLessThan=t;function r(n){return n<=0}e.isLessThanOrEqual=r;function i(n){return n>0}e.isGreaterThan=i;function s(n){return n===0}e.isNeitherLessOrGreaterThan=s,e.greaterThan=1,e.lessThan=-1,e.neitherLessOrGreaterThan=0})(xg||(xg={}));function kg(e,t){let r=this,i=!1,s;return function(){return i||(i=!0,t||(s=e.apply(r,arguments))),s}}var uu;(e=>{function t(v){return v&&typeof v=="object"&&typeof v[Symbol.iterator]=="function"}e.is=t;let r=Object.freeze([]);function i(){return r}e.empty=i;function*s(v){yield v}e.single=s;function n(v){return t(v)?v:s(v)}e.wrap=n;function o(v){return v||r}e.from=o;function*a(v){for(let k=v.length-1;k>=0;k--)yield v[k]}e.reverse=a;function h(v){return!v||v[Symbol.iterator]().next().done===!0}e.isEmpty=h;function l(v){return v[Symbol.iterator]().next().value}e.first=l;function c(v,k){let R=0;for(let O of v)if(k(O,R++))return!0;return!1}e.some=c;function u(v,k){for(let R of v)if(k(R))return R}e.find=u;function*p(v,k){for(let R of v)k(R)&&(yield R)}e.filter=p;function*_(v,k){let R=0;for(let O of v)yield k(O,R++)}e.map=_;function*m(v,k){let R=0;for(let O of v)yield*k(O,R++)}e.flatMap=m;function*g(...v){for(let k of v)yield*k}e.concat=g;function w(v,k,R){let O=R;for(let N of v)O=k(O,N);return O}e.reduce=w;function*y(v,k,R=v.length){for(k<0&&(k+=v.length),R<0?R+=v.length:R>v.length&&(R=v.length);k<R;k++)yield v[k]}e.slice=y;function E(v,k=Number.POSITIVE_INFINITY){let R=[];if(k===0)return[R,v];let O=v[Symbol.iterator]();for(let N=0;N<k;N++){let W=O.next();if(W.done)return[R,e.empty()];R.push(W.value)}return[R,{[Symbol.iterator](){return O}}]}e.consume=E;async function S(v){let k=[];for await(let R of v)k.push(R);return Promise.resolve(k)}e.asyncToArray=S})(uu||(uu={}));function Mm(e){return e}function Om(e,t){}function Im(e){return e}function dr(e){if(uu.is(e)){let t=[];for(let r of e)if(r)try{r.dispose()}catch(i){t.push(i)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function Bg(...e){return Se(()=>dr(e))}function Se(e){return{dispose:kg(()=>{e()})}}var fu=class Mf{constructor(){this._toDispose=new Set,this._isDisposed=!1}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{dr(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?Mf.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),void 0)}};fu.DISABLE_DISPOSED_WARNING=!1;var tr=fu,ue=class{constructor(){this._store=new tr,this._store}dispose(){this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};ue.None=Object.freeze({dispose(){}});var Ir=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(e){var t;this._isDisposed||e===this._value||((t=this._value)==null||t.dispose(),this._value=e)}clear(){this.value=void 0}dispose(){var e;this._isDisposed=!0,(e=this._value)==null||e.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e}},zt=typeof window=="object"?window:globalThis,Ko=class Na{constructor(t){this.element=t,this.next=Na.Undefined,this.prev=Na.Undefined}};Ko.Undefined=new Ko(void 0);var Ee=Ko,du=class{constructor(){this._first=Ee.Undefined,this._last=Ee.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===Ee.Undefined}clear(){let e=this._first;for(;e!==Ee.Undefined;){let t=e.next;e.prev=Ee.Undefined,e.next=Ee.Undefined,e=t}this._first=Ee.Undefined,this._last=Ee.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,t){let r=new Ee(e);if(this._first===Ee.Undefined)this._first=r,this._last=r;else if(t){let s=this._last;this._last=r,r.prev=s,s.next=r}else{let s=this._first;this._first=r,r.next=s,s.prev=r}this._size+=1;let i=!1;return()=>{i||(i=!0,this._remove(r))}}shift(){if(this._first!==Ee.Undefined){let e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==Ee.Undefined){let e=this._last.element;return this._remove(this._last),e}}_remove(e){if(e.prev!==Ee.Undefined&&e.next!==Ee.Undefined){let t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===Ee.Undefined&&e.next===Ee.Undefined?(this._first=Ee.Undefined,this._last=Ee.Undefined):e.next===Ee.Undefined?(this._last=this._last.prev,this._last.next=Ee.Undefined):e.prev===Ee.Undefined&&(this._first=this._first.next,this._first.prev=Ee.Undefined);this._size-=1}*[Symbol.iterator](){let e=this._first;for(;e!==Ee.Undefined;)yield e.element,e=e.next}},Rg=globalThis.performance&&typeof globalThis.performance.now=="function",Ag=class Of{static create(t){return new Of(t)}constructor(t){this._now=Rg&&t===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},je;(e=>{e.None=()=>ue.None;function t(K,H){return u(K,()=>{},0,void 0,!0,void 0,H)}e.defer=t;function r(K){return(H,G=null,J)=>{let ee=!1,se;return se=K(Y=>{if(!ee)return se?se.dispose():ee=!0,H.call(G,Y)},null,J),ee&&se.dispose(),se}}e.once=r;function i(K,H,G){return l((J,ee=null,se)=>K(Y=>J.call(ee,H(Y)),null,se),G)}e.map=i;function s(K,H,G){return l((J,ee=null,se)=>K(Y=>{H(Y),J.call(ee,Y)},null,se),G)}e.forEach=s;function n(K,H,G){return l((J,ee=null,se)=>K(Y=>H(Y)&&J.call(ee,Y),null,se),G)}e.filter=n;function o(K){return K}e.signal=o;function a(...K){return(H,G=null,J)=>{let ee=Bg(...K.map(se=>se(Y=>H.call(G,Y))));return c(ee,J)}}e.any=a;function h(K,H,G,J){let ee=G;return i(K,se=>(ee=H(ee,se),ee),J)}e.reduce=h;function l(K,H){let G,J={onWillAddFirstListener(){G=K(ee.fire,ee)},onDidRemoveLastListener(){G==null||G.dispose()}},ee=new Z(J);return H==null||H.add(ee),ee.event}function c(K,H){return H instanceof Array?H.push(K):H&&H.add(K),K}function u(K,H,G=100,J=!1,ee=!1,se,Y){let le,me,ke,L=0,I,U={leakWarningThreshold:se,onWillAddFirstListener(){le=K(A=>{L++,me=H(me,A),J&&!ke&&(te.fire(me),me=void 0),I=()=>{let D=me;me=void 0,ke=void 0,(!J||L>1)&&te.fire(D),L=0},typeof G=="number"?(clearTimeout(ke),ke=setTimeout(I,G)):ke===void 0&&(ke=0,queueMicrotask(I))})},onWillRemoveListener(){ee&&L>0&&(I==null||I())},onDidRemoveLastListener(){I=void 0,le.dispose()}},te=new Z(U);return Y==null||Y.add(te),te.event}e.debounce=u;function p(K,H=0,G){return e.debounce(K,(J,ee)=>J?(J.push(ee),J):[ee],H,void 0,!0,void 0,G)}e.accumulate=p;function _(K,H=(J,ee)=>J===ee,G){let J=!0,ee;return n(K,se=>{let Y=J||!H(se,ee);return J=!1,ee=se,Y},G)}e.latch=_;function m(K,H,G){return[e.filter(K,H,G),e.filter(K,J=>!H(J),G)]}e.split=m;function g(K,H=!1,G=[],J){let ee=G.slice(),se=K(me=>{ee?ee.push(me):le.fire(me)});J&&J.add(se);let Y=()=>{ee==null||ee.forEach(me=>le.fire(me)),ee=null},le=new Z({onWillAddFirstListener(){se||(se=K(me=>le.fire(me)),J&&J.add(se))},onDidAddFirstListener(){ee&&(H?setTimeout(Y):Y())},onDidRemoveLastListener(){se&&se.dispose(),se=null}});return J&&J.add(le),le.event}e.buffer=g;function w(K,H){return(G,J,ee)=>{let se=H(new E);return K(function(Y){let le=se.evaluate(Y);le!==y&&G.call(J,le)},void 0,ee)}}e.chain=w;let y=Symbol("HaltChainable");class E{constructor(){this.steps=[]}map(H){return this.steps.push(H),this}forEach(H){return this.steps.push(G=>(H(G),G)),this}filter(H){return this.steps.push(G=>H(G)?G:y),this}reduce(H,G){let J=G;return this.steps.push(ee=>(J=H(J,ee),J)),this}latch(H=(G,J)=>G===J){let G=!0,J;return this.steps.push(ee=>{let se=G||!H(ee,J);return G=!1,J=ee,se?ee:y}),this}evaluate(H){for(let G of this.steps)if(H=G(H),H===y)break;return H}}function S(K,H,G=J=>J){let J=(...le)=>Y.fire(G(...le)),ee=()=>K.on(H,J),se=()=>K.removeListener(H,J),Y=new Z({onWillAddFirstListener:ee,onDidRemoveLastListener:se});return Y.event}e.fromNodeEventEmitter=S;function v(K,H,G=J=>J){let J=(...le)=>Y.fire(G(...le)),ee=()=>K.addEventListener(H,J),se=()=>K.removeEventListener(H,J),Y=new Z({onWillAddFirstListener:ee,onDidRemoveLastListener:se});return Y.event}e.fromDOMEventEmitter=v;function k(K){return new Promise(H=>r(K)(H))}e.toPromise=k;function R(K){let H=new Z;return K.then(G=>{H.fire(G)},()=>{H.fire(void 0)}).finally(()=>{H.dispose()}),H.event}e.fromPromise=R;function O(K,H){return K(G=>H.fire(G))}e.forward=O;function N(K,H,G){return H(G),K(J=>H(J))}e.runAndSubscribe=N;class W{constructor(H,G){this._observable=H,this._counter=0,this._hasChanged=!1;let J={onWillAddFirstListener:()=>{H.addObserver(this)},onDidRemoveLastListener:()=>{H.removeObserver(this)}};this.emitter=new Z(J),G&&G.add(this.emitter)}beginUpdate(H){this._counter++}handlePossibleChange(H){}handleChange(H,G){this._hasChanged=!0}endUpdate(H){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function Q(K,H){return new W(K,H).emitter.event}e.fromObservable=Q;function ie(K){return(H,G,J)=>{let ee=0,se=!1,Y={beginUpdate(){ee++},endUpdate(){ee--,ee===0&&(K.reportChanges(),se&&(se=!1,H.call(G)))},handlePossibleChange(){},handleChange(){se=!0}};K.addObserver(Y),K.reportChanges();let le={dispose(){K.removeObserver(Y)}};return J instanceof tr?J.add(le):Array.isArray(J)&&J.push(le),le}}e.fromObservableLight=ie})(je||(je={}));var Vo=class Fa{constructor(t){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${t}_${Fa._idPool++}`,Fa.all.add(this)}start(t){this._stopWatch=new Ag,this.listenerCount=t}stop(){if(this._stopWatch){let t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}};Vo.all=new Set,Vo._idPool=0;var Dg=Vo,Tg=-1,pu=class If{constructor(t,r,i=(If._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t,this.threshold=r,this.name=i,this._warnCountdown=0}dispose(){var t;(t=this._stacks)==null||t.clear()}check(t,r){let i=this.threshold;if(i<=0||r<i)return;this._stacks||(this._stacks=new Map);let s=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,s+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=i*.5;let[n,o]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${r} listeners already. MOST frequent listener (${o}):`;console.warn(a),console.warn(n);let h=new Mg(a,n);this._errorHandler(h)}return()=>{let n=this._stacks.get(t.value)||0;this._stacks.set(t.value,n-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,r=0;for(let[i,s]of this._stacks)(!t||r<s)&&(t=[i,s],r=s);return t}};pu._idPool=1;var Lg=pu,Pg=class Nf{constructor(t){this.value=t}static create(){let t=new Error;return new Nf(t.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},Mg=class extends Error{constructor(e,t){super(e),this.name="ListenerLeakError",this.stack=t}},Og=class extends Error{constructor(e,t){super(e),this.name="ListenerRefusalError",this.stack=t}},Ig=0,Go=class{constructor(e){this.value=e,this.id=Ig++}},Ng=2,Fg,Z=class{constructor(t){var r,i,s,n;this._size=0,this._options=t,this._leakageMon=(r=this._options)!=null&&r.leakWarningThreshold?new Lg((t==null?void 0:t.onListenerError)??Qi,((i=this._options)==null?void 0:i.leakWarningThreshold)??Tg):void 0,this._perfMon=(s=this._options)!=null&&s._profName?new Dg(this._options._profName):void 0,this._deliveryQueue=(n=this._options)==null?void 0:n.deliveryQueue}dispose(){var t,r,i,s;this._disposed||(this._disposed=!0,((t=this._deliveryQueue)==null?void 0:t.current)===this&&this._deliveryQueue.reset(),this._listeners&&(this._listeners=void 0,this._size=0),(i=(r=this._options)==null?void 0:r.onDidRemoveLastListener)==null||i.call(r),(s=this._leakageMon)==null||s.dispose())}get event(){return this._event??(this._event=(t,r,i)=>{var a,h,l,c,u;if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let p=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(p);let _=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],m=new Og(`${p}. HINT: Stack shows most frequent listener (${_[1]}-times)`,_[0]);return(((a=this._options)==null?void 0:a.onListenerError)||Qi)(m),ue.None}if(this._disposed)return ue.None;r&&(t=t.bind(r));let s=new Go(t),n;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(s.stack=Pg.create(),n=this._leakageMon.check(s.stack,this._size+1)),this._listeners?this._listeners instanceof Go?(this._deliveryQueue??(this._deliveryQueue=new Ug),this._listeners=[this._listeners,s]):this._listeners.push(s):((l=(h=this._options)==null?void 0:h.onWillAddFirstListener)==null||l.call(h,this),this._listeners=s,(u=(c=this._options)==null?void 0:c.onDidAddFirstListener)==null||u.call(c,this)),this._size++;let o=Se(()=>{n==null||n(),this._removeListener(s)});return i instanceof tr?i.add(o):Array.isArray(i)&&i.push(o),o}),this._event}_removeListener(t){var n,o,a,h;if((o=(n=this._options)==null?void 0:n.onWillRemoveListener)==null||o.call(n,this),!this._listeners)return;if(this._size===1){this._listeners=void 0,(h=(a=this._options)==null?void 0:a.onDidRemoveLastListener)==null||h.call(a,this),this._size=0;return}let r=this._listeners,i=r.indexOf(t);if(i===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,r[i]=void 0;let s=this._deliveryQueue.current===this;if(this._size*Ng<=r.length){let l=0;for(let c=0;c<r.length;c++)r[c]?r[l++]=r[c]:s&&(this._deliveryQueue.end--,l<this._deliveryQueue.i&&this._deliveryQueue.i--);r.length=l}}_deliver(t,r){var s;if(!t)return;let i=((s=this._options)==null?void 0:s.onListenerError)||Qi;if(!i){t.value(r);return}try{t.value(r)}catch(n){i(n)}}_deliverQueue(t){let r=t.current._listeners;for(;t.i<t.end;)this._deliver(r[t.i++],t.value);t.reset()}fire(t){var r,i,s,n;if((r=this._deliveryQueue)!=null&&r.current&&(this._deliverQueue(this._deliveryQueue),(i=this._perfMon)==null||i.stop()),(s=this._perfMon)==null||s.start(this._size),this._listeners)if(this._listeners instanceof Go)this._deliver(this._listeners,t);else{let o=this._deliveryQueue;o.enqueue(this,t,this._listeners.length),this._deliverQueue(o)}(n=this._perfMon)==null||n.stop()}hasListeners(){return this._size>0}},Ug=class{constructor(){this.i=-1,this.end=0}enqueue(e,t,r){this.i=0,this.end=r,this.current=e,this.value=t}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},Yo=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new Z,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new Z,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(t){return this.mapWindowIdToZoomLevel.get(this.getWindowId(t))??0}setZoomLevel(t,r){if(this.getZoomLevel(r)===t)return;let i=this.getWindowId(r);this.mapWindowIdToZoomLevel.set(i,t),this._onDidChangeZoomLevel.fire(i)}getZoomFactor(t){return this.mapWindowIdToZoomFactor.get(this.getWindowId(t))??1}setZoomFactor(t,r){this.mapWindowIdToZoomFactor.set(this.getWindowId(r),t)}setFullscreen(t,r){if(this.isFullscreen(r)===t)return;let i=this.getWindowId(r);this.mapWindowIdToFullScreen.set(i,t),this._onDidChangeFullscreen.fire(i)}isFullscreen(t){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(t))}getWindowId(t){return t.vscodeWindowId}};Yo.INSTANCE=new Yo;var Xo=Yo;function Hg(e,t,r){typeof t=="string"&&(t=e.matchMedia(t)),t.addEventListener("change",r)}Xo.INSTANCE.onDidChangeZoomLevel;function Wg(e){return Xo.INSTANCE.getZoomFactor(e)}Xo.INSTANCE.onDidChangeFullscreen;var Nr=typeof navigator=="object"?navigator.userAgent:"",Jo=Nr.indexOf("Firefox")>=0,zg=Nr.indexOf("AppleWebKit")>=0,Zo=Nr.indexOf("Chrome")>=0,qg=!Zo&&Nr.indexOf("Safari")>=0;Nr.indexOf("Electron/")>=0,Nr.indexOf("Android")>=0;var Qo=!1;if(typeof zt.matchMedia=="function"){let e=zt.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),t=zt.matchMedia("(display-mode: fullscreen)");Qo=e.matches,Hg(zt,e,({matches:r})=>{Qo&&t.matches||(Qo=r)})}var Fr="en",ea=!1,ta=!1,es=!1,_u=!1,ts,rs=Fr,gu=Fr,jg,vt,pr=globalThis,$e;typeof pr.vscode<"u"&&typeof pr.vscode.process<"u"?$e=pr.vscode.process:typeof ae<"u"&&typeof((kf=ae==null?void 0:ae.versions)==null?void 0:kf.node)=="string"&&($e=ae);var $g=typeof((Bf=$e==null?void 0:$e.versions)==null?void 0:Bf.electron)=="string",Kg=$g&&($e==null?void 0:$e.type)==="renderer";if(typeof $e=="object"){ea=$e.platform==="win32",ta=$e.platform==="darwin",es=$e.platform==="linux",es&&$e.env.SNAP&&$e.env.SNAP_REVISION,$e.env.CI||$e.env.BUILD_ARTIFACTSTAGINGDIRECTORY,ts=Fr,rs=Fr;let e=$e.env.VSCODE_NLS_CONFIG;if(e)try{let t=JSON.parse(e);ts=t.userLocale,gu=t.osLocale,rs=t.resolvedLanguage||Fr,jg=(Rf=t.languagePack)==null?void 0:Rf.translationsConfigFile}catch{}_u=!0}else typeof navigator=="object"&&!Kg?(vt=navigator.userAgent,ea=vt.indexOf("Windows")>=0,ta=vt.indexOf("Macintosh")>=0,(vt.indexOf("Macintosh")>=0||vt.indexOf("iPad")>=0||vt.indexOf("iPhone")>=0)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0,es=vt.indexOf("Linux")>=0,(vt==null?void 0:vt.indexOf("Mobi"))>=0,rs=globalThis._VSCODE_NLS_LANGUAGE||Fr,ts=navigator.language.toLowerCase(),gu=ts):console.error("Unable to resolve platform.");var vu=ea,xt=ta,Vg=es,mu=_u,kt=vt,rr=rs,Gg;(e=>{function t(){return rr}e.value=t;function r(){return rr.length===2?rr==="en":rr.length>=3?rr[0]==="e"&&rr[1]==="n"&&rr[2]==="-":!1}e.isDefaultVariant=r;function i(){return rr==="en"}e.isDefault=i})(Gg||(Gg={}));var Yg=typeof pr.postMessage=="function"&&!pr.importScripts;(()=>{if(Yg){let e=[];pr.addEventListener("message",r=>{if(r.data&&r.data.vscodeScheduleAsyncWork)for(let i=0,s=e.length;i<s;i++){let n=e[i];if(n.id===r.data.vscodeScheduleAsyncWork){e.splice(i,1),n.callback();return}}});let t=0;return r=>{let i=++t;e.push({id:i,callback:r}),pr.postMessage({vscodeScheduleAsyncWork:i},"*")}}return e=>setTimeout(e)})();var Xg=!!(kt&&kt.indexOf("Chrome")>=0);kt&&kt.indexOf("Firefox")>=0,!Xg&&kt&&kt.indexOf("Safari")>=0,kt&&kt.indexOf("Edg/")>=0,kt&&kt.indexOf("Android")>=0;var Ur=typeof navigator=="object"?navigator:{};mu||document.queryCommandSupported&&document.queryCommandSupported("copy")||Ur&&Ur.clipboard&&Ur.clipboard.writeText,mu||Ur&&Ur.clipboard&&Ur.clipboard.readText;var ra=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(e,t){this._keyCodeToStr[e]=t,this._strToKeyCode[t.toLowerCase()]=e}keyCodeToStr(e){return this._keyCodeToStr[e]}strToKeyCode(e){return this._strToKeyCode[e.toLowerCase()]||0}},ia=new ra,yu=new ra,bu=new ra,Jg=new Array(230),wu;(e=>{function t(a){return ia.keyCodeToStr(a)}e.toString=t;function r(a){return ia.strToKeyCode(a)}e.fromString=r;function i(a){return yu.keyCodeToStr(a)}e.toUserSettingsUS=i;function s(a){return bu.keyCodeToStr(a)}e.toUserSettingsGeneral=s;function n(a){return yu.strToKeyCode(a)||bu.strToKeyCode(a)}e.fromUserSettings=n;function o(a){if(a>=98&&a<=113)return null;switch(a){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return ia.keyCodeToStr(a)}e.toElectronAccelerator=o})(wu||(wu={}));var Zg=class Ff{constructor(t,r,i,s,n){this.ctrlKey=t,this.shiftKey=r,this.altKey=i,this.metaKey=s,this.keyCode=n}equals(t){return t instanceof Ff&&this.ctrlKey===t.ctrlKey&&this.shiftKey===t.shiftKey&&this.altKey===t.altKey&&this.metaKey===t.metaKey&&this.keyCode===t.keyCode}getHashCode(){let t=this.ctrlKey?"1":"0",r=this.shiftKey?"1":"0",i=this.altKey?"1":"0",s=this.metaKey?"1":"0";return`K${t}${r}${i}${s}${this.keyCode}`}isModifierKey(){return this.keyCode===0||this.keyCode===5||this.keyCode===57||this.keyCode===6||this.keyCode===4}toKeybinding(){return new Qg([this])}isDuplicateModifierCase(){return this.ctrlKey&&this.keyCode===5||this.shiftKey&&this.keyCode===4||this.altKey&&this.keyCode===6||this.metaKey&&this.keyCode===57}},Qg=class{constructor(e){if(e.length===0)throw Eg("chords");this.chords=e}getHashCode(){let e="";for(let t=0,r=this.chords.length;t<r;t++)t!==0&&(e+=";"),e+=this.chords[t].getHashCode();return e}equals(e){if(e===null||this.chords.length!==e.chords.length)return!1;for(let t=0;t<this.chords.length;t++)if(!this.chords[t].equals(e.chords[t]))return!1;return!0}};function ev(e){if(e.charCode){let r=String.fromCharCode(e.charCode).toUpperCase();return wu.fromString(r)}let t=e.keyCode;if(t===3)return 7;if(Jo)switch(t){case 59:return 85;case 60:if(Vg)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(xt)return 57;break}else if(zg&&(xt&&t===93||!xt&&t===92))return 57;return Jg[t]||0}var tv=xt?256:2048,rv=512,iv=1024,sv=xt?2048:256,Su=class{constructor(e){var r;this._standardKeyboardEventBrand=!0;let t=e;this.browserEvent=t,this.target=t.target,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.altGraphKey=(r=t.getModifierState)==null?void 0:r.call(t,"AltGraph"),this.keyCode=ev(t),this.code=t.code,this.ctrlKey=this.ctrlKey||this.keyCode===5,this.altKey=this.altKey||this.keyCode===6,this.shiftKey=this.shiftKey||this.keyCode===4,this.metaKey=this.metaKey||this.keyCode===57,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeyCodeChord(){return this._asKeyCodeChord}equals(e){return this._asKeybinding===e}_computeKeybinding(){let e=0;this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(e=this.keyCode);let t=0;return this.ctrlKey&&(t|=tv),this.altKey&&(t|=rv),this.shiftKey&&(t|=iv),this.metaKey&&(t|=sv),t|=e,t}_computeKeyCodeChord(){let e=0;return this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(e=this.keyCode),new Zg(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,e)}},Cu=new WeakMap;function nv(e){if(!e.parent||e.parent===e)return null;try{let t=e.location,r=e.parent.location;if(t.origin!=="null"&&r.origin!=="null"&&t.origin!==r.origin)return null}catch{return null}return e.parent}var ov=class{static getSameOriginWindowChain(e){let t=Cu.get(e);if(!t){t=[],Cu.set(e,t);let r=e,i;do i=nv(r),i?t.push({window:new WeakRef(r),iframeElement:r.frameElement||null}):t.push({window:new WeakRef(r),iframeElement:null}),r=i;while(r)}return t.slice(0)}static getPositionOfChildWindowRelativeToAncestorWindow(e,t){if(!t||e===t)return{top:0,left:0};let r=0,i=0,s=this.getSameOriginWindowChain(e);for(let n of s){let o=n.window.deref();if(r+=(o==null?void 0:o.scrollY)??0,i+=(o==null?void 0:o.scrollX)??0,o===t||!n.iframeElement)break;let a=n.iframeElement.getBoundingClientRect();r+=a.top,i+=a.left}return{top:r,left:i}}},is=class{constructor(e,t){this.timestamp=Date.now(),this.browserEvent=t,this.leftButton=t.button===0,this.middleButton=t.button===1,this.rightButton=t.button===2,this.buttons=t.buttons,this.target=t.target,this.detail=t.detail||1,t.type==="dblclick"&&(this.detail=2),this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,typeof t.pageX=="number"?(this.posx=t.pageX,this.posy=t.pageY):(this.posx=t.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=t.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);let r=ov.getPositionOfChildWindowRelativeToAncestorWindow(e,t.view);this.posx-=r.left,this.posy-=r.top}preventDefault(){this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent.stopPropagation()}},Eu=class{constructor(e,t=0,r=0){var s;this.browserEvent=e||null,this.target=e?e.target||e.targetNode||e.srcElement:null,this.deltaY=r,this.deltaX=t;let i=!1;if(Zo){let n=navigator.userAgent.match(/Chrome\/(\d+)/);i=(n?parseInt(n[1]):123)<=122}if(e){let n=e,o=e,a=((s=e.view)==null?void 0:s.devicePixelRatio)||1;if(typeof n.wheelDeltaY<"u")i?this.deltaY=n.wheelDeltaY/(120*a):this.deltaY=n.wheelDeltaY/120;else if(typeof o.VERTICAL_AXIS<"u"&&o.axis===o.VERTICAL_AXIS)this.deltaY=-o.detail/3;else if(e.type==="wheel"){let h=e;h.deltaMode===h.DOM_DELTA_LINE?Jo&&!xt?this.deltaY=-e.deltaY/3:this.deltaY=-e.deltaY:this.deltaY=-e.deltaY/40}if(typeof n.wheelDeltaX<"u")qg&&vu?this.deltaX=-(n.wheelDeltaX/120):i?this.deltaX=n.wheelDeltaX/(120*a):this.deltaX=n.wheelDeltaX/120;else if(typeof o.HORIZONTAL_AXIS<"u"&&o.axis===o.HORIZONTAL_AXIS)this.deltaX=-e.detail/3;else if(e.type==="wheel"){let h=e;h.deltaMode===h.DOM_DELTA_LINE?Jo&&!xt?this.deltaX=-e.deltaX/3:this.deltaX=-e.deltaX:this.deltaX=-e.deltaX/40}this.deltaY===0&&this.deltaX===0&&e.wheelDelta&&(i?this.deltaY=e.wheelDelta/(120*a):this.deltaY=e.wheelDelta/120)}}preventDefault(){var e;(e=this.browserEvent)==null||e.preventDefault()}stopPropagation(){var e;(e=this.browserEvent)==null||e.stopPropagation()}},xu=Object.freeze(function(e,t){let r=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(r)}}}),av;(e=>{function t(r){return r===e.None||r===e.Cancelled||r instanceof lv?!0:!r||typeof r!="object"?!1:typeof r.isCancellationRequested=="boolean"&&typeof r.onCancellationRequested=="function"}e.isCancellationToken=t,e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:je.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:xu})})(av||(av={}));var lv=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?xu:(this._emitter||(this._emitter=new Z),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},sa=class{constructor(e,t){this._isDisposed=!1,this._token=-1,typeof e=="function"&&typeof t=="number"&&this.setIfNotSet(e,t)}dispose(){this.cancel(),this._isDisposed=!0}cancel(){this._token!==-1&&(clearTimeout(this._token),this._token=-1)}cancelAndSet(e,t){if(this._isDisposed)throw new $o("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(()=>{this._token=-1,e()},t)}setIfNotSet(e,t){if(this._isDisposed)throw new $o("Calling 'setIfNotSet' on a disposed TimeoutTimer");this._token===-1&&(this._token=setTimeout(()=>{this._token=-1,e()},t))}},hv=class{constructor(){this.disposable=void 0,this.isDisposed=!1}cancel(){var e;(e=this.disposable)==null||e.dispose(),this.disposable=void 0}cancelAndSet(e,t,r=globalThis){if(this.isDisposed)throw new $o("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();let i=r.setInterval(()=>{e()},t);this.disposable=Se(()=>{r.clearInterval(i),this.disposable=void 0})}dispose(){this.cancel(),this.isDisposed=!0}},cv;(e=>{async function t(i){let s,n=await Promise.all(i.map(o=>o.then(a=>a,a=>{s||(s=a)})));if(typeof s<"u")throw s;return n}e.settled=t;function r(i){return new Promise(async(s,n)=>{try{await i(s,n)}catch(o){n(o)}})}e.withAsyncBody=r})(cv||(cv={}));var ku=class gt{static fromArray(t){return new gt(r=>{r.emitMany(t)})}static fromPromise(t){return new gt(async r=>{r.emitMany(await t)})}static fromPromises(t){return new gt(async r=>{await Promise.all(t.map(async i=>r.emitOne(await i)))})}static merge(t){return new gt(async r=>{await Promise.all(t.map(async i=>{for await(let s of i)r.emitOne(s)}))})}constructor(t,r){this._state=0,this._results=[],this._error=null,this._onReturn=r,this._onStateChanged=new Z,queueMicrotask(async()=>{let i={emitOne:s=>this.emitOne(s),emitMany:s=>this.emitMany(s),reject:s=>this.reject(s)};try{await Promise.resolve(t(i)),this.resolve()}catch(s){this.reject(s)}finally{i.emitOne=void 0,i.emitMany=void 0,i.reject=void 0}})}[Symbol.asyncIterator](){let t=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(t<this._results.length)return{done:!1,value:this._results[t++]};if(this._state===1)return{done:!0,value:void 0};await je.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>{var r;return(r=this._onReturn)==null||r.call(this),{done:!0,value:void 0}}}}static map(t,r){return new gt(async i=>{for await(let s of t)i.emitOne(r(s))})}map(t){return gt.map(this,t)}static filter(t,r){return new gt(async i=>{for await(let s of t)r(s)&&i.emitOne(s)})}filter(t){return gt.filter(this,t)}static coalesce(t){return gt.filter(t,r=>!!r)}coalesce(){return gt.coalesce(this)}static async toPromise(t){let r=[];for await(let i of t)r.push(i);return r}toPromise(){return gt.toPromise(this)}emitOne(t){this._state===0&&(this._results.push(t),this._onStateChanged.fire())}emitMany(t){this._state===0&&(this._results=this._results.concat(t),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(t){this._state===0&&(this._state=2,this._error=t,this._onStateChanged.fire())}};ku.EMPTY=ku.fromArray([]);var{getWindow:Bt,getWindowId:uv,onDidRegisterWindow:fv}=function(){let e=new Map,t={window:zt,disposables:new tr};e.set(zt.vscodeWindowId,t);let r=new Z,i=new Z,s=new Z;function n(o,a){return(typeof o=="number"?e.get(o):void 0)??(a?t:void 0)}return{onDidRegisterWindow:r.event,onWillUnregisterWindow:s.event,onDidUnregisterWindow:i.event,registerWindow(o){if(e.has(o.vscodeWindowId))return ue.None;let a=new tr,h={window:o,disposables:a.add(new tr)};return e.set(o.vscodeWindowId,h),a.add(Se(()=>{e.delete(o.vscodeWindowId),i.fire(o)})),a.add(he(o,He.BEFORE_UNLOAD,()=>{s.fire(o)})),r.fire(h),a},getWindows(){return e.values()},getWindowsCount(){return e.size},getWindowId(o){return o.vscodeWindowId},hasWindow(o){return e.has(o)},getWindowById:n,getWindow(o){var l;let a=o;if((l=a==null?void 0:a.ownerDocument)!=null&&l.defaultView)return a.ownerDocument.defaultView.window;let h=o;return h!=null&&h.view?h.view.window:zt},getDocument(o){return Bt(o).document}}}(),dv=class{constructor(e,t,r,i){this._node=e,this._type=t,this._handler=r,this._options=i||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function he(e,t,r,i){return new dv(e,t,r,i)}var Bu=function(e,t,r,i){return he(e,t,r,i)},na,pv=class extends hv{constructor(e){super(),this.defaultTarget=e&&Bt(e)}cancelAndSet(e,t,r){return super.cancelAndSet(e,t,r??this.defaultTarget)}},Ru=class{constructor(e,t=0){this._runner=e,this.priority=t,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch(e){Qi(e)}}static sort(e,t){return t.priority-e.priority}};(function(){let e=new Map,t=new Map,r=new Map,i=new Map,s=n=>{r.set(n,!1);let o=e.get(n)??[];for(t.set(n,o),e.set(n,[]),i.set(n,!0);o.length>0;)o.sort(Ru.sort),o.shift().execute();i.set(n,!1)};na=(n,o,a=0)=>{let h=uv(n),l=new Ru(o,a),c=e.get(h);return c||(c=[],e.set(h,c)),c.push(l),r.get(h)||(r.set(h,!0),n.requestAnimationFrame(()=>s(h))),l}})();function _v(e){let t=e.getBoundingClientRect(),r=Bt(e);return{left:t.left+r.scrollX,top:t.top+r.scrollY,width:t.width,height:t.height}}var He={CLICK:"click",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",KEY_DOWN:"keydown",KEY_UP:"keyup",BEFORE_UNLOAD:"beforeunload",CHANGE:"change",FOCUS:"focus",BLUR:"blur",INPUT:"input"},gv=class{constructor(e){this.domNode=e,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingTop="",this._paddingLeft="",this._paddingBottom="",this._paddingRight="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}setMaxWidth(e){let t=et(e);this._maxWidth!==t&&(this._maxWidth=t,this.domNode.style.maxWidth=this._maxWidth)}setWidth(e){let t=et(e);this._width!==t&&(this._width=t,this.domNode.style.width=this._width)}setHeight(e){let t=et(e);this._height!==t&&(this._height=t,this.domNode.style.height=this._height)}setTop(e){let t=et(e);this._top!==t&&(this._top=t,this.domNode.style.top=this._top)}setLeft(e){let t=et(e);this._left!==t&&(this._left=t,this.domNode.style.left=this._left)}setBottom(e){let t=et(e);this._bottom!==t&&(this._bottom=t,this.domNode.style.bottom=this._bottom)}setRight(e){let t=et(e);this._right!==t&&(this._right=t,this.domNode.style.right=this._right)}setPaddingTop(e){let t=et(e);this._paddingTop!==t&&(this._paddingTop=t,this.domNode.style.paddingTop=this._paddingTop)}setPaddingLeft(e){let t=et(e);this._paddingLeft!==t&&(this._paddingLeft=t,this.domNode.style.paddingLeft=this._paddingLeft)}setPaddingBottom(e){let t=et(e);this._paddingBottom!==t&&(this._paddingBottom=t,this.domNode.style.paddingBottom=this._paddingBottom)}setPaddingRight(e){let t=et(e);this._paddingRight!==t&&(this._paddingRight=t,this.domNode.style.paddingRight=this._paddingRight)}setFontFamily(e){this._fontFamily!==e&&(this._fontFamily=e,this.domNode.style.fontFamily=this._fontFamily)}setFontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.domNode.style.fontWeight=this._fontWeight)}setFontSize(e){let t=et(e);this._fontSize!==t&&(this._fontSize=t,this.domNode.style.fontSize=this._fontSize)}setFontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.domNode.style.fontStyle=this._fontStyle)}setFontFeatureSettings(e){this._fontFeatureSettings!==e&&(this._fontFeatureSettings=e,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}setFontVariationSettings(e){this._fontVariationSettings!==e&&(this._fontVariationSettings=e,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}setTextDecoration(e){this._textDecoration!==e&&(this._textDecoration=e,this.domNode.style.textDecoration=this._textDecoration)}setLineHeight(e){let t=et(e);this._lineHeight!==t&&(this._lineHeight=t,this.domNode.style.lineHeight=this._lineHeight)}setLetterSpacing(e){let t=et(e);this._letterSpacing!==t&&(this._letterSpacing=t,this.domNode.style.letterSpacing=this._letterSpacing)}setClassName(e){this._className!==e&&(this._className=e,this.domNode.className=this._className)}toggleClassName(e,t){this.domNode.classList.toggle(e,t),this._className=this.domNode.className}setDisplay(e){this._display!==e&&(this._display=e,this.domNode.style.display=this._display)}setPosition(e){this._position!==e&&(this._position=e,this.domNode.style.position=this._position)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this.domNode.style.visibility=this._visibility)}setColor(e){this._color!==e&&(this._color=e,this.domNode.style.color=this._color)}setBackgroundColor(e){this._backgroundColor!==e&&(this._backgroundColor=e,this.domNode.style.backgroundColor=this._backgroundColor)}setLayerHinting(e){this._layerHint!==e&&(this._layerHint=e,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}setBoxShadow(e){this._boxShadow!==e&&(this._boxShadow=e,this.domNode.style.boxShadow=e)}setContain(e){this._contain!==e&&(this._contain=e,this.domNode.style.contain=this._contain)}setAttribute(e,t){this.domNode.setAttribute(e,t)}removeAttribute(e){this.domNode.removeAttribute(e)}appendChild(e){this.domNode.appendChild(e.domNode)}removeChild(e){this.domNode.removeChild(e.domNode)}};function et(e){return typeof e=="number"?`${e}px`:e}function Xr(e){return new gv(e)}var Au=class{constructor(){this._hooks=new tr,this._pointerMoveCallback=null,this._onStopCallback=null}dispose(){this.stopMonitoring(!1),this._hooks.dispose()}stopMonitoring(e,t){if(!this.isMonitoring())return;this._hooks.clear(),this._pointerMoveCallback=null;let r=this._onStopCallback;this._onStopCallback=null,e&&r&&r(t)}isMonitoring(){return!!this._pointerMoveCallback}startMonitoring(e,t,r,i,s){this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=i,this._onStopCallback=s;let n=e;try{e.setPointerCapture(t),this._hooks.add(Se(()=>{try{e.releasePointerCapture(t)}catch{}}))}catch{n=Bt(e)}this._hooks.add(he(n,He.POINTER_MOVE,o=>{if(o.buttons!==r){this.stopMonitoring(!0);return}o.preventDefault(),this._pointerMoveCallback(o)})),this._hooks.add(he(n,He.POINTER_UP,o=>this.stopMonitoring(!0)))}};function vv(e,t,r){let i=null,s=null;if(typeof r.value=="function"?(i="value",s=r.value,s.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof r.get=="function"&&(i="get",s=r.get),!s)throw new Error("not supported");let n=`$memoize$${t}`;r[i]=function(...o){return this.hasOwnProperty(n)||Object.defineProperty(this,n,{configurable:!1,enumerable:!1,writable:!1,value:s.apply(this,o)}),this[n]}}var Rt;(e=>(e.Tap="-xterm-gesturetap",e.Change="-xterm-gesturechange",e.Start="-xterm-gesturestart",e.End="-xterm-gesturesend",e.Contextmenu="-xterm-gesturecontextmenu"))(Rt||(Rt={}));var Jr=class Ve extends ue{constructor(){super(),this.dispatched=!1,this.targets=new du,this.ignoreTargets=new du,this.activeTouches={},this.handle=null,this._lastSetTapCountTime=0,this._register(je.runAndSubscribe(fv,({window:t,disposables:r})=>{r.add(he(t.document,"touchstart",i=>this.onTouchStart(i),{passive:!1})),r.add(he(t.document,"touchend",i=>this.onTouchEnd(t,i))),r.add(he(t.document,"touchmove",i=>this.onTouchMove(i),{passive:!1}))},{window:zt,disposables:this._store}))}static addTarget(t){if(!Ve.isTouchDevice())return ue.None;Ve.INSTANCE||(Ve.INSTANCE=new Ve);let r=Ve.INSTANCE.targets.push(t);return Se(r)}static ignoreTarget(t){if(!Ve.isTouchDevice())return ue.None;Ve.INSTANCE||(Ve.INSTANCE=new Ve);let r=Ve.INSTANCE.ignoreTargets.push(t);return Se(r)}static isTouchDevice(){return"ontouchstart"in zt||navigator.maxTouchPoints>0}dispose(){this.handle&&(this.handle.dispose(),this.handle=null),super.dispose()}onTouchStart(t){let r=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(let i=0,s=t.targetTouches.length;i<s;i++){let n=t.targetTouches.item(i);this.activeTouches[n.identifier]={id:n.identifier,initialTarget:n.target,initialTimeStamp:r,initialPageX:n.pageX,initialPageY:n.pageY,rollingTimestamps:[r],rollingPageX:[n.pageX],rollingPageY:[n.pageY]};let o=this.newGestureEvent(Rt.Start,n.target);o.pageX=n.pageX,o.pageY=n.pageY,this.dispatchEvent(o)}this.dispatched&&(t.preventDefault(),t.stopPropagation(),this.dispatched=!1)}onTouchEnd(t,r){let i=Date.now(),s=Object.keys(this.activeTouches).length;for(let n=0,o=r.changedTouches.length;n<o;n++){let a=r.changedTouches.item(n);if(!this.activeTouches.hasOwnProperty(String(a.identifier))){console.warn("move of an UNKNOWN touch",a);continue}let h=this.activeTouches[a.identifier],l=Date.now()-h.initialTimeStamp;if(l<Ve.HOLD_DELAY&&Math.abs(h.initialPageX-ot(h.rollingPageX))<30&&Math.abs(h.initialPageY-ot(h.rollingPageY))<30){let c=this.newGestureEvent(Rt.Tap,h.initialTarget);c.pageX=ot(h.rollingPageX),c.pageY=ot(h.rollingPageY),this.dispatchEvent(c)}else if(l>=Ve.HOLD_DELAY&&Math.abs(h.initialPageX-ot(h.rollingPageX))<30&&Math.abs(h.initialPageY-ot(h.rollingPageY))<30){let c=this.newGestureEvent(Rt.Contextmenu,h.initialTarget);c.pageX=ot(h.rollingPageX),c.pageY=ot(h.rollingPageY),this.dispatchEvent(c)}else if(s===1){let c=ot(h.rollingPageX),u=ot(h.rollingPageY),p=ot(h.rollingTimestamps)-h.rollingTimestamps[0],_=c-h.rollingPageX[0],m=u-h.rollingPageY[0],g=[...this.targets].filter(w=>h.initialTarget instanceof Node&&w.contains(h.initialTarget));this.inertia(t,g,i,Math.abs(_)/p,_>0?1:-1,c,Math.abs(m)/p,m>0?1:-1,u)}this.dispatchEvent(this.newGestureEvent(Rt.End,h.initialTarget)),delete this.activeTouches[a.identifier]}this.dispatched&&(r.preventDefault(),r.stopPropagation(),this.dispatched=!1)}newGestureEvent(t,r){let i=document.createEvent("CustomEvent");return i.initEvent(t,!1,!0),i.initialTarget=r,i.tapCount=0,i}dispatchEvent(t){if(t.type===Rt.Tap){let r=new Date().getTime(),i=0;r-this._lastSetTapCountTime>Ve.CLEAR_TAP_COUNT_TIME?i=1:i=2,this._lastSetTapCountTime=r,t.tapCount=i}else(t.type===Rt.Change||t.type===Rt.Contextmenu)&&(this._lastSetTapCountTime=0);if(t.initialTarget instanceof Node){for(let i of this.ignoreTargets)if(i.contains(t.initialTarget))return;let r=[];for(let i of this.targets)if(i.contains(t.initialTarget)){let s=0,n=t.initialTarget;for(;n&&n!==i;)s++,n=n.parentElement;r.push([s,i])}r.sort((i,s)=>i[0]-s[0]);for(let[i,s]of r)s.dispatchEvent(t),this.dispatched=!0}}inertia(t,r,i,s,n,o,a,h,l){this.handle=na(t,()=>{let c=Date.now(),u=c-i,p=0,_=0,m=!0;s+=Ve.SCROLL_FRICTION*u,a+=Ve.SCROLL_FRICTION*u,s>0&&(m=!1,p=n*s*u),a>0&&(m=!1,_=h*a*u);let g=this.newGestureEvent(Rt.Change);g.translationX=p,g.translationY=_,r.forEach(w=>w.dispatchEvent(g)),m||this.inertia(t,r,c,s,n,o+p,a,h,l+_)})}onTouchMove(t){let r=Date.now();for(let i=0,s=t.changedTouches.length;i<s;i++){let n=t.changedTouches.item(i);if(!this.activeTouches.hasOwnProperty(String(n.identifier))){console.warn("end of an UNKNOWN touch",n);continue}let o=this.activeTouches[n.identifier],a=this.newGestureEvent(Rt.Change,o.initialTarget);a.translationX=n.pageX-ot(o.rollingPageX),a.translationY=n.pageY-ot(o.rollingPageY),a.pageX=n.pageX,a.pageY=n.pageY,this.dispatchEvent(a),o.rollingPageX.length>3&&(o.rollingPageX.shift(),o.rollingPageY.shift(),o.rollingTimestamps.shift()),o.rollingPageX.push(n.pageX),o.rollingPageY.push(n.pageY),o.rollingTimestamps.push(r)}this.dispatched&&(t.preventDefault(),t.stopPropagation(),this.dispatched=!1)}};Jr.SCROLL_FRICTION=-.005,Jr.HOLD_DELAY=700,Jr.CLEAR_TAP_COUNT_TIME=400,Be([vv],Jr,"isTouchDevice",1);var mv=Jr,oa=class extends ue{onclick(e,t){this._register(he(e,He.CLICK,r=>t(new is(Bt(e),r))))}onmousedown(e,t){this._register(he(e,He.MOUSE_DOWN,r=>t(new is(Bt(e),r))))}onmouseover(e,t){this._register(he(e,He.MOUSE_OVER,r=>t(new is(Bt(e),r))))}onmouseleave(e,t){this._register(he(e,He.MOUSE_LEAVE,r=>t(new is(Bt(e),r))))}onkeydown(e,t){this._register(he(e,He.KEY_DOWN,r=>t(new Su(r))))}onkeyup(e,t){this._register(he(e,He.KEY_UP,r=>t(new Su(r))))}oninput(e,t){this._register(he(e,He.INPUT,t))}onblur(e,t){this._register(he(e,He.BLUR,t))}onfocus(e,t){this._register(he(e,He.FOCUS,t))}onchange(e,t){this._register(he(e,He.CHANGE,t))}ignoreGesture(e){return mv.ignoreTarget(e)}},Du=11,yv=class extends oa{constructor(e){super(),this._onActivate=e.onActivate,this.bgDomNode=document.createElement("div"),this.bgDomNode.className="arrow-background",this.bgDomNode.style.position="absolute",this.bgDomNode.style.width=e.bgWidth+"px",this.bgDomNode.style.height=e.bgHeight+"px",typeof e.top<"u"&&(this.bgDomNode.style.top="0px"),typeof e.left<"u"&&(this.bgDomNode.style.left="0px"),typeof e.bottom<"u"&&(this.bgDomNode.style.bottom="0px"),typeof e.right<"u"&&(this.bgDomNode.style.right="0px"),this.domNode=document.createElement("div"),this.domNode.className=e.className,this.domNode.style.position="absolute",this.domNode.style.width=Du+"px",this.domNode.style.height=Du+"px",typeof e.top<"u"&&(this.domNode.style.top=e.top+"px"),typeof e.left<"u"&&(this.domNode.style.left=e.left+"px"),typeof e.bottom<"u"&&(this.domNode.style.bottom=e.bottom+"px"),typeof e.right<"u"&&(this.domNode.style.right=e.right+"px"),this._pointerMoveMonitor=this._register(new Au),this._register(Bu(this.bgDomNode,He.POINTER_DOWN,t=>this._arrowPointerDown(t))),this._register(Bu(this.domNode,He.POINTER_DOWN,t=>this._arrowPointerDown(t))),this._pointerdownRepeatTimer=this._register(new pv),this._pointerdownScheduleRepeatTimer=this._register(new sa)}_arrowPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let t=()=>{this._pointerdownRepeatTimer.cancelAndSet(()=>this._onActivate(),1e3/24,Bt(e))};this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(t,200),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,r=>{},()=>{this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancel()}),e.preventDefault()}},bv=class Ua{constructor(t,r,i,s,n,o,a){this._forceIntegerValues=t,this._scrollStateBrand=void 0,this._forceIntegerValues&&(r=r|0,i=i|0,s=s|0,n=n|0,o=o|0,a=a|0),this.rawScrollLeft=s,this.rawScrollTop=a,r<0&&(r=0),s+r>i&&(s=i-r),s<0&&(s=0),n<0&&(n=0),a+n>o&&(a=o-n),a<0&&(a=0),this.width=r,this.scrollWidth=i,this.scrollLeft=s,this.height=n,this.scrollHeight=o,this.scrollTop=a}equals(t){return this.rawScrollLeft===t.rawScrollLeft&&this.rawScrollTop===t.rawScrollTop&&this.width===t.width&&this.scrollWidth===t.scrollWidth&&this.scrollLeft===t.scrollLeft&&this.height===t.height&&this.scrollHeight===t.scrollHeight&&this.scrollTop===t.scrollTop}withScrollDimensions(t,r){return new Ua(this._forceIntegerValues,typeof t.width<"u"?t.width:this.width,typeof t.scrollWidth<"u"?t.scrollWidth:this.scrollWidth,r?this.rawScrollLeft:this.scrollLeft,typeof t.height<"u"?t.height:this.height,typeof t.scrollHeight<"u"?t.scrollHeight:this.scrollHeight,r?this.rawScrollTop:this.scrollTop)}withScrollPosition(t){return new Ua(this._forceIntegerValues,this.width,this.scrollWidth,typeof t.scrollLeft<"u"?t.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,typeof t.scrollTop<"u"?t.scrollTop:this.rawScrollTop)}createScrollEvent(t,r){let i=this.width!==t.width,s=this.scrollWidth!==t.scrollWidth,n=this.scrollLeft!==t.scrollLeft,o=this.height!==t.height,a=this.scrollHeight!==t.scrollHeight,h=this.scrollTop!==t.scrollTop;return{inSmoothScrolling:r,oldWidth:t.width,oldScrollWidth:t.scrollWidth,oldScrollLeft:t.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:t.height,oldScrollHeight:t.scrollHeight,oldScrollTop:t.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:i,scrollWidthChanged:s,scrollLeftChanged:n,heightChanged:o,scrollHeightChanged:a,scrollTopChanged:h}}},wv=class extends ue{constructor(e){super(),this._scrollableBrand=void 0,this._onScroll=this._register(new Z),this.onScroll=this._onScroll.event,this._smoothScrollDuration=e.smoothScrollDuration,this._scheduleAtNextAnimationFrame=e.scheduleAtNextAnimationFrame,this._state=new bv(e.forceIntegerValues,0,0,0,0,0,0),this._smoothScrolling=null}dispose(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),super.dispose()}setSmoothScrollDuration(e){this._smoothScrollDuration=e}validateScrollPosition(e){return this._state.withScrollPosition(e)}getScrollDimensions(){return this._state}setScrollDimensions(e,t){var i;let r=this._state.withScrollDimensions(e,t);this._setState(r,!!this._smoothScrolling),(i=this._smoothScrolling)==null||i.acceptScrollDimensions(this._state)}getFutureScrollPosition(){return this._smoothScrolling?this._smoothScrolling.to:this._state}getCurrentScrollPosition(){return this._state}setScrollPositionNow(e){let t=this._state.withScrollPosition(e);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(t,!1)}setScrollPositionSmooth(e,t){if(this._smoothScrollDuration===0)return this.setScrollPositionNow(e);if(this._smoothScrolling){e={scrollLeft:typeof e.scrollLeft>"u"?this._smoothScrolling.to.scrollLeft:e.scrollLeft,scrollTop:typeof e.scrollTop>"u"?this._smoothScrolling.to.scrollTop:e.scrollTop};let r=this._state.withScrollPosition(e);if(this._smoothScrolling.to.scrollLeft===r.scrollLeft&&this._smoothScrolling.to.scrollTop===r.scrollTop)return;let i;t?i=new Lu(this._smoothScrolling.from,r,this._smoothScrolling.startTime,this._smoothScrolling.duration):i=this._smoothScrolling.combine(this._state,r,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=i}else{let r=this._state.withScrollPosition(e);this._smoothScrolling=Lu.start(this._state,r,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}hasPendingScrollAnimation(){return!!this._smoothScrolling}_performSmoothScrolling(){if(!this._smoothScrolling)return;let e=this._smoothScrolling.tick(),t=this._state.withScrollPosition(e);if(this._setState(t,!0),!!this._smoothScrolling){if(e.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}}_setState(e,t){let r=this._state;r.equals(e)||(this._state=e,this._onScroll.fire(this._state.createScrollEvent(r,t)))}},Tu=class{constructor(e,t,r){this.scrollLeft=e,this.scrollTop=t,this.isDone=r}};function aa(e,t){let r=t-e;return function(i){return e+r*Ev(i)}}function Sv(e,t,r){return function(i){return i<r?e(i/r):t((i-r)/(1-r))}}var Lu=class Ha{constructor(t,r,i,s){this.from=t,this.to=r,this.duration=s,this.startTime=i,this.animationFrameDisposable=null,this._initAnimations()}_initAnimations(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}_initAnimation(t,r,i){if(Math.abs(t-r)>2.5*i){let s,n;return t<r?(s=t+.75*i,n=r-.75*i):(s=t-.75*i,n=r+.75*i),Sv(aa(t,s),aa(n,r),.33)}return aa(t,r)}dispose(){this.animationFrameDisposable!==null&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}acceptScrollDimensions(t){this.to=t.withScrollPosition(this.to),this._initAnimations()}tick(){return this._tick(Date.now())}_tick(t){let r=(t-this.startTime)/this.duration;if(r<1){let i=this.scrollLeft(r),s=this.scrollTop(r);return new Tu(i,s,!1)}return new Tu(this.to.scrollLeft,this.to.scrollTop,!0)}combine(t,r,i){return Ha.start(t,r,i)}static start(t,r,i){i=i+10;let s=Date.now()-10;return new Ha(t,r,s,i)}};function Cv(e){return Math.pow(e,3)}function Ev(e){return 1-Cv(1-e)}var xv=class extends ue{constructor(e,t,r){super(),this._visibility=e,this._visibleClassName=t,this._invisibleClassName=r,this._domNode=null,this._isVisible=!1,this._isNeeded=!1,this._rawShouldBeVisible=!1,this._shouldBeVisible=!1,this._revealTimer=this._register(new sa)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this._updateShouldBeVisible())}setShouldBeVisible(e){this._rawShouldBeVisible=e,this._updateShouldBeVisible()}_applyVisibilitySetting(){return this._visibility===2?!1:this._visibility===3?!0:this._rawShouldBeVisible}_updateShouldBeVisible(){let e=this._applyVisibilitySetting();this._shouldBeVisible!==e&&(this._shouldBeVisible=e,this.ensureVisibility())}setIsNeeded(e){this._isNeeded!==e&&(this._isNeeded=e,this.ensureVisibility())}setDomNode(e){this._domNode=e,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}ensureVisibility(){if(!this._isNeeded){this._hide(!1);return}this._shouldBeVisible?this._reveal():this._hide(!0)}_reveal(){this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(()=>{var e;(e=this._domNode)==null||e.setClassName(this._visibleClassName)},0))}_hide(e){var t;this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,(t=this._domNode)==null||t.setClassName(this._invisibleClassName+(e?" fade":"")))}},kv=140,Pu=class extends oa{constructor(e){super(),this._lazyRender=e.lazyRender,this._host=e.host,this._scrollable=e.scrollable,this._scrollByPage=e.scrollByPage,this._scrollbarState=e.scrollbarState,this._visibilityController=this._register(new xv(e.visibility,"visible scrollbar "+e.extraScrollbarClassName,"invisible scrollbar "+e.extraScrollbarClassName)),this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._pointerMoveMonitor=this._register(new Au),this._shouldRender=!0,this.domNode=Xr(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this._visibilityController.setDomNode(this.domNode),this.domNode.setPosition("absolute"),this._register(he(this.domNode.domNode,He.POINTER_DOWN,t=>this._domNodePointerDown(t)))}_createArrow(e){let t=this._register(new yv(e));this.domNode.domNode.appendChild(t.bgDomNode),this.domNode.domNode.appendChild(t.domNode)}_createSlider(e,t,r,i){this.slider=Xr(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop(e),this.slider.setLeft(t),typeof r=="number"&&this.slider.setWidth(r),typeof i=="number"&&this.slider.setHeight(i),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register(he(this.slider.domNode,He.POINTER_DOWN,s=>{s.button===0&&(s.preventDefault(),this._sliderPointerDown(s))})),this.onclick(this.slider.domNode,s=>{s.leftButton&&s.stopPropagation()})}_onElementSize(e){return this._scrollbarState.setVisibleSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollSize(e){return this._scrollbarState.setScrollSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollPosition(e){return this._scrollbarState.setScrollPosition(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}beginReveal(){this._visibilityController.setShouldBeVisible(!0)}beginHide(){this._visibilityController.setShouldBeVisible(!1)}render(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}_domNodePointerDown(e){e.target===this.domNode.domNode&&this._onPointerDown(e)}delegatePointerDown(e){let t=this.domNode.domNode.getClientRects()[0].top,r=t+this._scrollbarState.getSliderPosition(),i=t+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),s=this._sliderPointerPosition(e);r<=s&&s<=i?e.button===0&&(e.preventDefault(),this._sliderPointerDown(e)):this._onPointerDown(e)}_onPointerDown(e){let t,r;if(e.target===this.domNode.domNode&&typeof e.offsetX=="number"&&typeof e.offsetY=="number")t=e.offsetX,r=e.offsetY;else{let s=_v(this.domNode.domNode);t=e.pageX-s.left,r=e.pageY-s.top}let i=this._pointerDownRelativePosition(t,r);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(i):this._scrollbarState.getDesiredScrollPositionFromOffset(i)),e.button===0&&(e.preventDefault(),this._sliderPointerDown(e))}_sliderPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let t=this._sliderPointerPosition(e),r=this._sliderOrthogonalPointerPosition(e),i=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,s=>{let n=this._sliderOrthogonalPointerPosition(s),o=Math.abs(n-r);if(vu&&o>kv){this._setDesiredScrollPositionNow(i.getScrollPosition());return}let a=this._sliderPointerPosition(s)-t;this._setDesiredScrollPositionNow(i.getDesiredScrollPositionFromDelta(a))},()=>{this.slider.toggleClassName("active",!1),this._host.onDragEnd()}),this._host.onDragStart()}_setDesiredScrollPositionNow(e){let t={};this.writeScrollPosition(t,e),this._scrollable.setScrollPositionNow(t)}updateScrollbarSize(e){this._updateScrollbarSize(e),this._scrollbarState.setScrollbarSize(e),this._shouldRender=!0,this._lazyRender||this.render()}isNeeded(){return this._scrollbarState.isNeeded()}},Mu=class Wa{constructor(t,r,i,s,n,o){this._scrollbarSize=Math.round(r),this._oppositeScrollbarSize=Math.round(i),this._arrowSize=Math.round(t),this._visibleSize=s,this._scrollSize=n,this._scrollPosition=o,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}clone(){return new Wa(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}setVisibleSize(t){let r=Math.round(t);return this._visibleSize!==r?(this._visibleSize=r,this._refreshComputedValues(),!0):!1}setScrollSize(t){let r=Math.round(t);return this._scrollSize!==r?(this._scrollSize=r,this._refreshComputedValues(),!0):!1}setScrollPosition(t){let r=Math.round(t);return this._scrollPosition!==r?(this._scrollPosition=r,this._refreshComputedValues(),!0):!1}setScrollbarSize(t){this._scrollbarSize=Math.round(t)}setOppositeScrollbarSize(t){this._oppositeScrollbarSize=Math.round(t)}static _computeValues(t,r,i,s,n){let o=Math.max(0,i-t),a=Math.max(0,o-2*r),h=s>0&&s>i;if(!h)return{computedAvailableSize:Math.round(o),computedIsNeeded:h,computedSliderSize:Math.round(a),computedSliderRatio:0,computedSliderPosition:0};let l=Math.round(Math.max(20,Math.floor(i*a/s))),c=(a-l)/(s-i),u=n*c;return{computedAvailableSize:Math.round(o),computedIsNeeded:h,computedSliderSize:Math.round(l),computedSliderRatio:c,computedSliderPosition:Math.round(u)}}_refreshComputedValues(){let t=Wa._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=t.computedAvailableSize,this._computedIsNeeded=t.computedIsNeeded,this._computedSliderSize=t.computedSliderSize,this._computedSliderRatio=t.computedSliderRatio,this._computedSliderPosition=t.computedSliderPosition}getArrowSize(){return this._arrowSize}getScrollPosition(){return this._scrollPosition}getRectangleLargeSize(){return this._computedAvailableSize}getRectangleSmallSize(){return this._scrollbarSize}isNeeded(){return this._computedIsNeeded}getSliderSize(){return this._computedSliderSize}getSliderPosition(){return this._computedSliderPosition}getDesiredScrollPositionFromOffset(t){if(!this._computedIsNeeded)return 0;let r=t-this._arrowSize-this._computedSliderSize/2;return Math.round(r/this._computedSliderRatio)}getDesiredScrollPositionFromOffsetPaged(t){if(!this._computedIsNeeded)return 0;let r=t-this._arrowSize,i=this._scrollPosition;return r<this._computedSliderPosition?i-=this._visibleSize:i+=this._visibleSize,i}getDesiredScrollPositionFromDelta(t){if(!this._computedIsNeeded)return 0;let r=this._computedSliderPosition+t;return Math.round(r/this._computedSliderRatio)}},Bv=class extends Pu{constructor(e,t,r){let i=e.getScrollDimensions(),s=e.getCurrentScrollPosition();if(super({lazyRender:t.lazyRender,host:r,scrollbarState:new Mu(t.horizontalHasArrows?t.arrowSize:0,t.horizontal===2?0:t.horizontalScrollbarSize,t.vertical===2?0:t.verticalScrollbarSize,i.width,i.scrollWidth,s.scrollLeft),visibility:t.horizontal,extraScrollbarClassName:"horizontal",scrollable:e,scrollByPage:t.scrollByPage}),t.horizontalHasArrows)throw new Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(Math.floor((t.horizontalScrollbarSize-t.horizontalSliderSize)/2),0,void 0,t.horizontalSliderSize)}_updateSlider(e,t){this.slider.setWidth(e),this.slider.setLeft(t)}_renderDomNode(e,t){this.domNode.setWidth(e),this.domNode.setHeight(t),this.domNode.setLeft(0),this.domNode.setBottom(0)}onDidScroll(e){return this._shouldRender=this._onElementScrollSize(e.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize(e.width)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(e,t){return e}_sliderPointerPosition(e){return e.pageX}_sliderOrthogonalPointerPosition(e){return e.pageY}_updateScrollbarSize(e){this.slider.setHeight(e)}writeScrollPosition(e,t){e.scrollLeft=t}updateOptions(e){this.updateScrollbarSize(e.horizontal===2?0:e.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(e.vertical===2?0:e.verticalScrollbarSize),this._visibilityController.setVisibility(e.horizontal),this._scrollByPage=e.scrollByPage}},Rv=class extends Pu{constructor(e,t,r){let i=e.getScrollDimensions(),s=e.getCurrentScrollPosition();if(super({lazyRender:t.lazyRender,host:r,scrollbarState:new Mu(t.verticalHasArrows?t.arrowSize:0,t.vertical===2?0:t.verticalScrollbarSize,0,i.height,i.scrollHeight,s.scrollTop),visibility:t.vertical,extraScrollbarClassName:"vertical",scrollable:e,scrollByPage:t.scrollByPage}),t.verticalHasArrows)throw new Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(0,Math.floor((t.verticalScrollbarSize-t.verticalSliderSize)/2),t.verticalSliderSize,void 0)}_updateSlider(e,t){this.slider.setHeight(e),this.slider.setTop(t)}_renderDomNode(e,t){this.domNode.setWidth(t),this.domNode.setHeight(e),this.domNode.setRight(0),this.domNode.setTop(0)}onDidScroll(e){return this._shouldRender=this._onElementScrollSize(e.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize(e.height)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(e,t){return t}_sliderPointerPosition(e){return e.pageY}_sliderOrthogonalPointerPosition(e){return e.pageX}_updateScrollbarSize(e){this.slider.setWidth(e)}writeScrollPosition(e,t){e.scrollTop=t}updateOptions(e){this.updateScrollbarSize(e.vertical===2?0:e.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility(e.vertical),this._scrollByPage=e.scrollByPage}},Av=500,Ou=50,Dv=class{constructor(e,t,r){this.timestamp=e,this.deltaX=t,this.deltaY=r,this.score=0}},la=class{constructor(){this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}isPhysicalMouseWheel(){if(this._front===-1&&this._rear===-1)return!1;let t=1,r=0,i=1,s=this._rear;do{let n=s===this._front?t:Math.pow(2,-i);if(t-=n,r+=this._memory[s].score*n,s===this._front)break;s=(this._capacity+s-1)%this._capacity,i++}while(!0);return r<=.5}acceptStandardWheelEvent(t){if(Zo){let r=Bt(t.browserEvent),i=Wg(r);this.accept(Date.now(),t.deltaX*i,t.deltaY*i)}else this.accept(Date.now(),t.deltaX,t.deltaY)}accept(t,r,i){let s=null,n=new Dv(t,r,i);this._front===-1&&this._rear===-1?(this._memory[0]=n,this._front=0,this._rear=0):(s=this._memory[this._rear],this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=n),n.score=this._computeScore(n,s)}_computeScore(t,r){if(Math.abs(t.deltaX)>0&&Math.abs(t.deltaY)>0)return 1;let i=.5;if((!this._isAlmostInt(t.deltaX)||!this._isAlmostInt(t.deltaY))&&(i+=.25),r){let s=Math.abs(t.deltaX),n=Math.abs(t.deltaY),o=Math.abs(r.deltaX),a=Math.abs(r.deltaY),h=Math.max(Math.min(s,o),1),l=Math.max(Math.min(n,a),1),c=Math.max(s,o),u=Math.max(n,a);c%h===0&&u%l===0&&(i-=.5)}return Math.min(Math.max(i,0),1)}_isAlmostInt(t){return Math.abs(Math.round(t)-t)<.01}};la.INSTANCE=new la;var Tv=la,Lv=class extends oa{constructor(e,t,r){super(),this._onScroll=this._register(new Z),this.onScroll=this._onScroll.event,this._onWillScroll=this._register(new Z),this.onWillScroll=this._onWillScroll.event,this._options=Mv(t),this._scrollable=r,this._register(this._scrollable.onScroll(s=>{this._onWillScroll.fire(s),this._onDidScroll(s),this._onScroll.fire(s)}));let i={onMouseWheel:s=>this._onMouseWheel(s),onDragStart:()=>this._onDragStart(),onDragEnd:()=>this._onDragEnd()};this._verticalScrollbar=this._register(new Rv(this._scrollable,this._options,i)),this._horizontalScrollbar=this._register(new Bv(this._scrollable,this._options,i)),this._domNode=document.createElement("div"),this._domNode.className="xterm-scrollable-element "+this._options.className,this._domNode.setAttribute("role","presentation"),this._domNode.style.position="relative",this._domNode.appendChild(e),this._domNode.appendChild(this._horizontalScrollbar.domNode.domNode),this._domNode.appendChild(this._verticalScrollbar.domNode.domNode),this._options.useShadows?(this._leftShadowDomNode=Xr(document.createElement("div")),this._leftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._leftShadowDomNode.domNode),this._topShadowDomNode=Xr(document.createElement("div")),this._topShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topShadowDomNode.domNode),this._topLeftShadowDomNode=Xr(document.createElement("div")),this._topLeftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topLeftShadowDomNode.domNode)):(this._leftShadowDomNode=null,this._topShadowDomNode=null,this._topLeftShadowDomNode=null),this._listenOnDomNode=this._options.listenOnDomNode||this._domNode,this._mouseWheelToDispose=[],this._setListeningToMouseWheel(this._options.handleMouseWheel),this.onmouseover(this._listenOnDomNode,s=>this._onMouseOver(s)),this.onmouseleave(this._listenOnDomNode,s=>this._onMouseLeave(s)),this._hideTimeout=this._register(new sa),this._isDragging=!1,this._mouseIsOver=!1,this._shouldRender=!0,this._revealOnScroll=!0}get options(){return this._options}dispose(){this._mouseWheelToDispose=dr(this._mouseWheelToDispose),super.dispose()}getDomNode(){return this._domNode}getOverviewRulerLayoutInfo(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}delegateVerticalScrollbarPointerDown(e){this._verticalScrollbar.delegatePointerDown(e)}getScrollDimensions(){return this._scrollable.getScrollDimensions()}setScrollDimensions(e){this._scrollable.setScrollDimensions(e,!1)}updateClassName(e){this._options.className=e,xt&&(this._options.className+=" mac"),this._domNode.className="xterm-scrollable-element "+this._options.className}updateOptions(e){typeof e.handleMouseWheel<"u"&&(this._options.handleMouseWheel=e.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),typeof e.mouseWheelScrollSensitivity<"u"&&(this._options.mouseWheelScrollSensitivity=e.mouseWheelScrollSensitivity),typeof e.fastScrollSensitivity<"u"&&(this._options.fastScrollSensitivity=e.fastScrollSensitivity),typeof e.scrollPredominantAxis<"u"&&(this._options.scrollPredominantAxis=e.scrollPredominantAxis),typeof e.horizontal<"u"&&(this._options.horizontal=e.horizontal),typeof e.vertical<"u"&&(this._options.vertical=e.vertical),typeof e.horizontalScrollbarSize<"u"&&(this._options.horizontalScrollbarSize=e.horizontalScrollbarSize),typeof e.verticalScrollbarSize<"u"&&(this._options.verticalScrollbarSize=e.verticalScrollbarSize),typeof e.scrollByPage<"u"&&(this._options.scrollByPage=e.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}setRevealOnScroll(e){this._revealOnScroll=e}delegateScrollFromMouseWheelEvent(e){this._onMouseWheel(new Eu(e))}_setListeningToMouseWheel(e){if(this._mouseWheelToDispose.length>0!==e&&(this._mouseWheelToDispose=dr(this._mouseWheelToDispose),e)){let t=r=>{this._onMouseWheel(new Eu(r))};this._mouseWheelToDispose.push(he(this._listenOnDomNode,He.MOUSE_WHEEL,t,{passive:!1}))}}_onMouseWheel(e){var s;if((s=e.browserEvent)!=null&&s.defaultPrevented)return;let t=Tv.INSTANCE;t.acceptStandardWheelEvent(e);let r=!1;if(e.deltaY||e.deltaX){let n=e.deltaY*this._options.mouseWheelScrollSensitivity,o=e.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&o+n===0?o=n=0:Math.abs(n)>=Math.abs(o)?o=0:n=0),this._options.flipAxes&&([n,o]=[o,n]);let a=!xt&&e.browserEvent&&e.browserEvent.shiftKey;(this._options.scrollYToX||a)&&!o&&(o=n,n=0),e.browserEvent&&e.browserEvent.altKey&&(o=o*this._options.fastScrollSensitivity,n=n*this._options.fastScrollSensitivity);let h=this._scrollable.getFutureScrollPosition(),l={};if(n){let c=Ou*n,u=h.scrollTop-(c<0?Math.floor(c):Math.ceil(c));this._verticalScrollbar.writeScrollPosition(l,u)}if(o){let c=Ou*o,u=h.scrollLeft-(c<0?Math.floor(c):Math.ceil(c));this._horizontalScrollbar.writeScrollPosition(l,u)}l=this._scrollable.validateScrollPosition(l),(h.scrollLeft!==l.scrollLeft||h.scrollTop!==l.scrollTop)&&(this._options.mouseWheelSmoothScroll&&t.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(l):this._scrollable.setScrollPositionNow(l),r=!0)}let i=r;!i&&this._options.alwaysConsumeMouseWheel&&(i=!0),!i&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(i=!0),i&&(e.preventDefault(),e.stopPropagation())}_onDidScroll(e){this._shouldRender=this._horizontalScrollbar.onDidScroll(e)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll(e)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}renderNow(){if(!this._options.lazyRender)throw new Error("Please use `lazyRender` together with `renderNow`!");this._render()}_render(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){let e=this._scrollable.getCurrentScrollPosition(),t=e.scrollTop>0,r=e.scrollLeft>0,i=r?" left":"",s=t?" top":"",n=r||t?" top-left-corner":"";this._leftShadowDomNode.setClassName(`shadow${i}`),this._topShadowDomNode.setClassName(`shadow${s}`),this._topLeftShadowDomNode.setClassName(`shadow${n}${s}${i}`)}}_onDragStart(){this._isDragging=!0,this._reveal()}_onDragEnd(){this._isDragging=!1,this._hide()}_onMouseLeave(e){this._mouseIsOver=!1,this._hide()}_onMouseOver(e){this._mouseIsOver=!0,this._reveal()}_reveal(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}_hide(){!this._mouseIsOver&&!this._isDragging&&(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}_scheduleHide(){!this._mouseIsOver&&!this._isDragging&&this._hideTimeout.cancelAndSet(()=>this._hide(),Av)}},Pv=class extends Lv{constructor(e,t,r){super(e,t,r)}setScrollPosition(e){e.reuseAnimation?this._scrollable.setScrollPositionSmooth(e,e.reuseAnimation):this._scrollable.setScrollPositionNow(e)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}};function Mv(e){let t={lazyRender:typeof e.lazyRender<"u"?e.lazyRender:!1,className:typeof e.className<"u"?e.className:"",useShadows:typeof e.useShadows<"u"?e.useShadows:!0,handleMouseWheel:typeof e.handleMouseWheel<"u"?e.handleMouseWheel:!0,flipAxes:typeof e.flipAxes<"u"?e.flipAxes:!1,consumeMouseWheelIfScrollbarIsNeeded:typeof e.consumeMouseWheelIfScrollbarIsNeeded<"u"?e.consumeMouseWheelIfScrollbarIsNeeded:!1,alwaysConsumeMouseWheel:typeof e.alwaysConsumeMouseWheel<"u"?e.alwaysConsumeMouseWheel:!1,scrollYToX:typeof e.scrollYToX<"u"?e.scrollYToX:!1,mouseWheelScrollSensitivity:typeof e.mouseWheelScrollSensitivity<"u"?e.mouseWheelScrollSensitivity:1,fastScrollSensitivity:typeof e.fastScrollSensitivity<"u"?e.fastScrollSensitivity:5,scrollPredominantAxis:typeof e.scrollPredominantAxis<"u"?e.scrollPredominantAxis:!0,mouseWheelSmoothScroll:typeof e.mouseWheelSmoothScroll<"u"?e.mouseWheelSmoothScroll:!0,arrowSize:typeof e.arrowSize<"u"?e.arrowSize:11,listenOnDomNode:typeof e.listenOnDomNode<"u"?e.listenOnDomNode:null,horizontal:typeof e.horizontal<"u"?e.horizontal:1,horizontalScrollbarSize:typeof e.horizontalScrollbarSize<"u"?e.horizontalScrollbarSize:10,horizontalSliderSize:typeof e.horizontalSliderSize<"u"?e.horizontalSliderSize:0,horizontalHasArrows:typeof e.horizontalHasArrows<"u"?e.horizontalHasArrows:!1,vertical:typeof e.vertical<"u"?e.vertical:1,verticalScrollbarSize:typeof e.verticalScrollbarSize<"u"?e.verticalScrollbarSize:10,verticalHasArrows:typeof e.verticalHasArrows<"u"?e.verticalHasArrows:!1,verticalSliderSize:typeof e.verticalSliderSize<"u"?e.verticalSliderSize:0,scrollByPage:typeof e.scrollByPage<"u"?e.scrollByPage:!1};return t.horizontalSliderSize=typeof e.horizontalSliderSize<"u"?e.horizontalSliderSize:t.horizontalScrollbarSize,t.verticalSliderSize=typeof e.verticalSliderSize<"u"?e.verticalSliderSize:t.verticalScrollbarSize,xt&&(t.className+=" mac"),t}var ha=class extends ue{constructor(e,t,r,i,s,n,o,a){super(),this._bufferService=r,this._optionsService=o,this._renderService=a,this._onRequestScrollLines=this._register(new Z),this.onRequestScrollLines=this._onRequestScrollLines.event,this._isSyncing=!1,this._isHandlingScroll=!1,this._suppressOnScrollHandler=!1;let h=this._register(new wv({forceIntegerValues:!1,smoothScrollDuration:this._optionsService.rawOptions.smoothScrollDuration,scheduleAtNextAnimationFrame:l=>na(i.window,l)}));this._register(this._optionsService.onSpecificOptionChange("smoothScrollDuration",()=>{h.setSmoothScrollDuration(this._optionsService.rawOptions.smoothScrollDuration)})),this._scrollableElement=this._register(new Pv(t,{vertical:1,horizontal:2,useShadows:!1,mouseWheelSmoothScroll:!0,...this._getChangeOptions()},h)),this._register(this._optionsService.onMultipleOptionChange(["scrollSensitivity","fastScrollSensitivity","overviewRuler"],()=>this._scrollableElement.updateOptions(this._getChangeOptions()))),this._register(s.onProtocolChange(l=>{this._scrollableElement.updateOptions({handleMouseWheel:!(l&16)})})),this._scrollableElement.setScrollDimensions({height:0,scrollHeight:0}),this._register(je.runAndSubscribe(n.onChangeColors,()=>{this._scrollableElement.getDomNode().style.backgroundColor=n.colors.background.css})),e.appendChild(this._scrollableElement.getDomNode()),this._register(Se(()=>this._scrollableElement.getDomNode().remove())),this._styleElement=i.mainDocument.createElement("style"),t.appendChild(this._styleElement),this._register(Se(()=>this._styleElement.remove())),this._register(je.runAndSubscribe(n.onChangeColors,()=>{this._styleElement.textContent=[".xterm .xterm-scrollable-element > .scrollbar > .slider {",`  background: ${n.colors.scrollbarSliderBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider:hover {",`  background: ${n.colors.scrollbarSliderHoverBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider.active {",`  background: ${n.colors.scrollbarSliderActiveBackground.css};`,"}"].join(`
`)})),this._register(this._bufferService.onResize(()=>this.queueSync())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._latestYDisp=void 0,this.queueSync()})),this._register(this._bufferService.onScroll(()=>this._sync())),this._register(this._scrollableElement.onScroll(l=>this._handleScroll(l)))}scrollLines(e){let t=this._scrollableElement.getScrollPosition();this._scrollableElement.setScrollPosition({reuseAnimation:!0,scrollTop:t.scrollTop+e*this._renderService.dimensions.css.cell.height})}scrollToLine(e,t){t&&(this._latestYDisp=e),this._scrollableElement.setScrollPosition({reuseAnimation:!t,scrollTop:e*this._renderService.dimensions.css.cell.height})}_getChangeOptions(){var e;return{mouseWheelScrollSensitivity:this._optionsService.rawOptions.scrollSensitivity,fastScrollSensitivity:this._optionsService.rawOptions.fastScrollSensitivity,verticalScrollbarSize:((e=this._optionsService.rawOptions.overviewRuler)==null?void 0:e.width)||14}}queueSync(e){e!==void 0&&(this._latestYDisp=e),this._queuedAnimationFrame===void 0&&(this._queuedAnimationFrame=this._renderService.addRefreshCallback(()=>{this._queuedAnimationFrame=void 0,this._sync(this._latestYDisp)}))}_sync(e=this._bufferService.buffer.ydisp){!this._renderService||this._isSyncing||(this._isSyncing=!0,this._suppressOnScrollHandler=!0,this._scrollableElement.setScrollDimensions({height:this._renderService.dimensions.css.canvas.height,scrollHeight:this._renderService.dimensions.css.cell.height*this._bufferService.buffer.lines.length}),this._suppressOnScrollHandler=!1,e!==this._latestYDisp&&this._scrollableElement.setScrollPosition({scrollTop:e*this._renderService.dimensions.css.cell.height}),this._isSyncing=!1)}_handleScroll(e){if(!this._renderService||this._isHandlingScroll||this._suppressOnScrollHandler)return;this._isHandlingScroll=!0;let t=Math.round(e.scrollTop/this._renderService.dimensions.css.cell.height),r=t-this._bufferService.buffer.ydisp;r!==0&&(this._latestYDisp=t,this._onRequestScrollLines.fire(r)),this._isHandlingScroll=!1}};ha=Be([re(2,Ge),re(3,Ht),re(4,nu),re(5,Or),re(6,Ye),re(7,Wt)],ha);var ca=class extends ue{constructor(e,t,r,i,s){super(),this._screenElement=e,this._bufferService=t,this._coreBrowserService=r,this._decorationService=i,this._renderService=s,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this._register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this._register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this._register(this._decorationService.onDecorationRemoved(n=>this._removeDecoration(n))),this._register(Se(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){var i;let t=this._coreBrowserService.mainDocument.createElement("div");t.classList.add("xterm-decoration"),t.classList.toggle("xterm-decoration-top-layer",((i=e==null?void 0:e.options)==null?void 0:i.layer)==="top"),t.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,t.style.height=`${(e.options.height||1)*this._renderService.dimensions.css.cell.height}px`,t.style.top=`${(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height}px`,t.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let r=e.options.x??0;return r&&r>this._bufferService.cols&&(t.style.display="none"),this._refreshXPosition(e,t),t}_refreshStyle(e){let t=e.marker.line-this._bufferService.buffers.active.ydisp;if(t<0||t>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let r=this._decorationElements.get(e);r||(r=this._createElement(e),e.element=r,this._decorationElements.set(e,r),this._container.appendChild(r),e.onDispose(()=>{this._decorationElements.delete(e),r.remove()})),r.style.display=this._altBufferIsActive?"none":"block",this._altBufferIsActive||(r.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,r.style.height=`${(e.options.height||1)*this._renderService.dimensions.css.cell.height}px`,r.style.top=`${t*this._renderService.dimensions.css.cell.height}px`,r.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`),e.onRenderEmitter.fire(r)}}_refreshXPosition(e,t=e.element){if(!t)return;let r=e.options.x??0;(e.options.anchor||"left")==="right"?t.style.right=r?`${r*this._renderService.dimensions.css.cell.width}px`:"":t.style.left=r?`${r*this._renderService.dimensions.css.cell.width}px`:""}_removeDecoration(e){var t;(t=this._decorationElements.get(e))==null||t.remove(),this._decorationElements.delete(e),e.dispose()}};ca=Be([re(1,Ge),re(2,Ht),re(3,Yr),re(4,Wt)],ca);var Ov=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(e){if(e.options.overviewRulerOptions){for(let t of this._zones)if(t.color===e.options.overviewRulerOptions.color&&t.position===e.options.overviewRulerOptions.position){if(this._lineIntersectsZone(t,e.marker.line))return;if(this._lineAdjacentToZone(t,e.marker.line,e.options.overviewRulerOptions.position)){this._addLineToZone(t,e.marker.line);return}}if(this._zonePoolIndex<this._zonePool.length){this._zonePool[this._zonePoolIndex].color=e.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=e.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=e.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=e.marker.line,this._zones.push(this._zonePool[this._zonePoolIndex++]);return}this._zones.push({color:e.options.overviewRulerOptions.color,position:e.options.overviewRulerOptions.position,startBufferLine:e.marker.line,endBufferLine:e.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(e){this._linePadding=e}_lineIntersectsZone(e,t){return t>=e.startBufferLine&&t<=e.endBufferLine}_lineAdjacentToZone(e,t,r){return t>=e.startBufferLine-this._linePadding[r||"full"]&&t<=e.endBufferLine+this._linePadding[r||"full"]}_addLineToZone(e,t){e.startBufferLine=Math.min(e.startBufferLine,t),e.endBufferLine=Math.max(e.endBufferLine,t)}},At={full:0,left:0,center:0,right:0},ir={full:0,left:0,center:0,right:0},Zr={full:0,left:0,center:0,right:0},ss=class extends ue{constructor(e,t,r,i,s,n,o,a){var l;super(),this._viewportElement=e,this._screenElement=t,this._bufferService=r,this._decorationService=i,this._renderService=s,this._optionsService=n,this._themeService=o,this._coreBrowserService=a,this._colorZoneStore=new Ov,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(l=this._viewportElement.parentElement)==null||l.insertBefore(this._canvas,this._viewportElement),this._register(Se(()=>{var c;return(c=this._canvas)==null?void 0:c.remove()}));let h=this._canvas.getContext("2d");if(h)this._ctx=h;else throw new Error("Ctx cannot be null");this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this._register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0))),this._register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this._register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})),this._register(this._renderService.onRender(()=>{(!this._containerHeight||this._containerHeight!==this._screenElement.clientHeight)&&(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._register(this._optionsService.onSpecificOptionChange("overviewRuler",()=>this._queueRefresh(!0))),this._register(this._themeService.onChangeColors(()=>this._queueRefresh())),this._queueRefresh(!0)}get _width(){var e;return((e=this._optionsService.options.overviewRuler)==null?void 0:e.width)||0}_refreshDrawConstants(){let e=Math.floor((this._canvas.width-1)/3),t=Math.ceil((this._canvas.width-1)/3);ir.full=this._canvas.width,ir.left=e,ir.center=t,ir.right=e,this._refreshDrawHeightConstants(),Zr.full=1,Zr.left=1,Zr.center=1+ir.left,Zr.right=1+ir.left+ir.center}_refreshDrawHeightConstants(){At.full=Math.round(2*this._coreBrowserService.dpr);let e=this._canvas.height/this._bufferService.buffer.lines.length,t=Math.round(Math.max(Math.min(e,12),6)*this._coreBrowserService.dpr);At.left=t,At.center=t,At.right=t}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*At.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*At.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*At.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*At.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let t of this._decorationService.decorations)this._colorZoneStore.addDecoration(t);this._ctx.lineWidth=1,this._renderRulerOutline();let e=this._colorZoneStore.zones;for(let t of e)t.position!=="full"&&this._renderColorZone(t);for(let t of e)t.position==="full"&&this._renderColorZone(t);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderRulerOutline(){this._ctx.fillStyle=this._themeService.colors.overviewRulerBorder.css,this._ctx.fillRect(0,0,1,this._canvas.height),this._optionsService.rawOptions.overviewRuler.showTopBorder&&this._ctx.fillRect(1,0,this._canvas.width-1,1),this._optionsService.rawOptions.overviewRuler.showBottomBorder&&this._ctx.fillRect(1,this._canvas.height-1,this._canvas.width-1,this._canvas.height)}_renderColorZone(e){this._ctx.fillStyle=e.color,this._ctx.fillRect(Zr[e.position||"full"],Math.round((this._canvas.height-1)*(e.startBufferLine/this._bufferService.buffers.active.lines.length)-At[e.position||"full"]/2),ir[e.position||"full"],Math.round((this._canvas.height-1)*((e.endBufferLine-e.startBufferLine)/this._bufferService.buffers.active.lines.length)+At[e.position||"full"]))}_queueRefresh(e,t){this._shouldUpdateDimensions=e||this._shouldUpdateDimensions,this._shouldUpdateAnchor=t||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};ss=Be([re(2,Ge),re(3,Yr),re(4,Wt),re(5,Ye),re(6,Or),re(7,Ht)],ss);var q;(e=>(e.NUL="\0",e.SOH="",e.STX="",e.ETX="",e.EOT="",e.ENQ="",e.ACK="",e.BEL="\x07",e.BS="\b",e.HT="	",e.LF=`
`,e.VT="\v",e.FF="\f",e.CR="\r",e.SO="",e.SI="",e.DLE="",e.DC1="",e.DC2="",e.DC3="",e.DC4="",e.NAK="",e.SYN="",e.ETB="",e.CAN="",e.EM="",e.SUB="",e.ESC="\x1B",e.FS="",e.GS="",e.RS="",e.US="",e.SP=" ",e.DEL=""))(q||(q={}));var ns;(e=>(e.PAD="",e.HOP="",e.BPH="",e.NBH="",e.IND="",e.NEL="",e.SSA="",e.ESA="",e.HTS="",e.HTJ="",e.VTS="",e.PLD="",e.PLU="",e.RI="",e.SS2="",e.SS3="",e.DCS="",e.PU1="",e.PU2="",e.STS="",e.CCH="",e.MW="",e.SPA="",e.EPA="",e.SOS="",e.SGCI="",e.SCI="",e.CSI="",e.ST="",e.OSC="",e.PM="",e.APC=""))(ns||(ns={}));var Iu;(e=>e.ST=`${q.ESC}\\`)(Iu||(Iu={}));var ua=class{constructor(e,t,r,i,s,n){this._textarea=e,this._compositionView=t,this._bufferService=r,this._optionsService=i,this._coreService=s,this._renderService=n,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(e){this._compositionView.textContent=e.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(e){if(this._isComposing||this._isSendingComposition){if(e.keyCode===20||e.keyCode===229||e.keyCode===16||e.keyCode===17||e.keyCode===18)return!1;this._finalizeComposition(!1)}return e.keyCode===229?(this._handleAnyTextareaChanges(),!1):!0}_finalizeComposition(e){if(this._compositionView.classList.remove("active"),this._isComposing=!1,e){let t={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){this._isSendingComposition=!1;let r;t.start+=this._dataAlreadySent.length,this._isComposing?r=this._textarea.value.substring(t.start,this._compositionPosition.start):r=this._textarea.value.substring(t.start),r.length>0&&this._coreService.triggerDataEvent(r,!0)}},0)}else{this._isSendingComposition=!1;let t=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(t,!0)}}_handleAnyTextareaChanges(){let e=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let t=this._textarea.value,r=t.replace(e,"");this._dataAlreadySent=r,t.length>e.length?this._coreService.triggerDataEvent(r,!0):t.length<e.length?this._coreService.triggerDataEvent(`${q.DEL}`,!0):t.length===e.length&&t!==e&&this._coreService.triggerDataEvent(t,!0)}},0)}updateCompositionElements(e){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let t=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),r=this._renderService.dimensions.css.cell.height,i=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,s=t*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=s+"px",this._compositionView.style.top=i+"px",this._compositionView.style.height=r+"px",this._compositionView.style.lineHeight=r+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let n=this._compositionView.getBoundingClientRect();this._textarea.style.left=s+"px",this._textarea.style.top=i+"px",this._textarea.style.width=Math.max(n.width,1)+"px",this._textarea.style.height=Math.max(n.height,1)+"px",this._textarea.style.lineHeight=n.height+"px"}e||setTimeout(()=>this.updateCompositionElements(!0),0)}}};ua=Be([re(2,Ge),re(3,Ye),re(4,fr),re(5,Wt)],ua);var We=0,ze=0,qe=0,Re=0,Nu={css:"#00000000",rgba:0},Pe;(e=>{function t(s,n,o,a){return a!==void 0?`#${_r(s)}${_r(n)}${_r(o)}${_r(a)}`:`#${_r(s)}${_r(n)}${_r(o)}`}e.toCss=t;function r(s,n,o,a=255){return(s<<24|n<<16|o<<8|a)>>>0}e.toRgba=r;function i(s,n,o,a){return{css:e.toCss(s,n,o,a),rgba:e.toRgba(s,n,o,a)}}e.toColor=i})(Pe||(Pe={}));var we;(e=>{function t(h,l){if(Re=(l.rgba&255)/255,Re===1)return{css:l.css,rgba:l.rgba};let c=l.rgba>>24&255,u=l.rgba>>16&255,p=l.rgba>>8&255,_=h.rgba>>24&255,m=h.rgba>>16&255,g=h.rgba>>8&255;We=_+Math.round((c-_)*Re),ze=m+Math.round((u-m)*Re),qe=g+Math.round((p-g)*Re);let w=Pe.toCss(We,ze,qe),y=Pe.toRgba(We,ze,qe);return{css:w,rgba:y}}e.blend=t;function r(h){return(h.rgba&255)===255}e.isOpaque=r;function i(h,l,c){let u=os.ensureContrastRatio(h.rgba,l.rgba,c);if(u)return Pe.toColor(u>>24&255,u>>16&255,u>>8&255)}e.ensureContrastRatio=i;function s(h){let l=(h.rgba|255)>>>0;return[We,ze,qe]=os.toChannels(l),{css:Pe.toCss(We,ze,qe),rgba:l}}e.opaque=s;function n(h,l){return Re=Math.round(l*255),[We,ze,qe]=os.toChannels(h.rgba),{css:Pe.toCss(We,ze,qe,Re),rgba:Pe.toRgba(We,ze,qe,Re)}}e.opacity=n;function o(h,l){return Re=h.rgba&255,n(h,Re*l/255)}e.multiplyOpacity=o;function a(h){return[h.rgba>>24&255,h.rgba>>16&255,h.rgba>>8&255]}e.toColorRGB=a})(we||(we={}));var xe;(e=>{let t,r;try{let s=document.createElement("canvas");s.width=1,s.height=1;let n=s.getContext("2d",{willReadFrequently:!0});n&&(t=n,t.globalCompositeOperation="copy",r=t.createLinearGradient(0,0,1,1))}catch{}function i(s){if(s.match(/#[\da-f]{3,8}/i))switch(s.length){case 4:return We=parseInt(s.slice(1,2).repeat(2),16),ze=parseInt(s.slice(2,3).repeat(2),16),qe=parseInt(s.slice(3,4).repeat(2),16),Pe.toColor(We,ze,qe);case 5:return We=parseInt(s.slice(1,2).repeat(2),16),ze=parseInt(s.slice(2,3).repeat(2),16),qe=parseInt(s.slice(3,4).repeat(2),16),Re=parseInt(s.slice(4,5).repeat(2),16),Pe.toColor(We,ze,qe,Re);case 7:return{css:s,rgba:(parseInt(s.slice(1),16)<<8|255)>>>0};case 9:return{css:s,rgba:parseInt(s.slice(1),16)>>>0}}let n=s.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(n)return We=parseInt(n[1]),ze=parseInt(n[2]),qe=parseInt(n[3]),Re=Math.round((n[5]===void 0?1:parseFloat(n[5]))*255),Pe.toColor(We,ze,qe,Re);if(!t||!r)throw new Error("css.toColor: Unsupported css format");if(t.fillStyle=r,t.fillStyle=s,typeof t.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(t.fillRect(0,0,1,1),[We,ze,qe,Re]=t.getImageData(0,0,1,1).data,Re!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:Pe.toRgba(We,ze,qe,Re),css:s}}e.toColor=i})(xe||(xe={}));var Xe;(e=>{function t(i){return r(i>>16&255,i>>8&255,i&255)}e.relativeLuminance=t;function r(i,s,n){let o=i/255,a=s/255,h=n/255,l=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4),c=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),u=h<=.03928?h/12.92:Math.pow((h+.055)/1.055,2.4);return l*.2126+c*.7152+u*.0722}e.relativeLuminance2=r})(Xe||(Xe={}));var os;(e=>{function t(o,a){if(Re=(a&255)/255,Re===1)return a;let h=a>>24&255,l=a>>16&255,c=a>>8&255,u=o>>24&255,p=o>>16&255,_=o>>8&255;return We=u+Math.round((h-u)*Re),ze=p+Math.round((l-p)*Re),qe=_+Math.round((c-_)*Re),Pe.toRgba(We,ze,qe)}e.blend=t;function r(o,a,h){let l=Xe.relativeLuminance(o>>8),c=Xe.relativeLuminance(a>>8);if(qt(l,c)<h){if(c<l){let _=i(o,a,h),m=qt(l,Xe.relativeLuminance(_>>8));if(m<h){let g=s(o,a,h),w=qt(l,Xe.relativeLuminance(g>>8));return m>w?_:g}return _}let u=s(o,a,h),p=qt(l,Xe.relativeLuminance(u>>8));if(p<h){let _=i(o,a,h),m=qt(l,Xe.relativeLuminance(_>>8));return p>m?u:_}return u}}e.ensureContrastRatio=r;function i(o,a,h){let l=o>>24&255,c=o>>16&255,u=o>>8&255,p=a>>24&255,_=a>>16&255,m=a>>8&255,g=qt(Xe.relativeLuminance2(p,_,m),Xe.relativeLuminance2(l,c,u));for(;g<h&&(p>0||_>0||m>0);)p-=Math.max(0,Math.ceil(p*.1)),_-=Math.max(0,Math.ceil(_*.1)),m-=Math.max(0,Math.ceil(m*.1)),g=qt(Xe.relativeLuminance2(p,_,m),Xe.relativeLuminance2(l,c,u));return(p<<24|_<<16|m<<8|255)>>>0}e.reduceLuminance=i;function s(o,a,h){let l=o>>24&255,c=o>>16&255,u=o>>8&255,p=a>>24&255,_=a>>16&255,m=a>>8&255,g=qt(Xe.relativeLuminance2(p,_,m),Xe.relativeLuminance2(l,c,u));for(;g<h&&(p<255||_<255||m<255);)p=Math.min(255,p+Math.ceil((255-p)*.1)),_=Math.min(255,_+Math.ceil((255-_)*.1)),m=Math.min(255,m+Math.ceil((255-m)*.1)),g=qt(Xe.relativeLuminance2(p,_,m),Xe.relativeLuminance2(l,c,u));return(p<<24|_<<16|m<<8|255)>>>0}e.increaseLuminance=s;function n(o){return[o>>24&255,o>>16&255,o>>8&255,o&255]}e.toChannels=n})(os||(os={}));function _r(e){let t=e.toString(16);return t.length<2?"0"+t:t}function qt(e,t){return e<t?(t+.05)/(e+.05):(e+.05)/(t+.05)}var Iv=class extends Gr{constructor(e,t,r){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=t,this._width=r}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},as=class{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new dt}register(e){let t={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(t),t.id}deregister(e){for(let t=0;t<this._characterJoiners.length;t++)if(this._characterJoiners[t].id===e)return this._characterJoiners.splice(t,1),!0;return!1}getJoinedCharacters(e){if(this._characterJoiners.length===0)return[];let t=this._bufferService.buffer.lines.get(e);if(!t||t.length===0)return[];let r=[],i=t.translateToString(!0),s=0,n=0,o=0,a=t.getFg(0),h=t.getBg(0);for(let l=0;l<t.getTrimmedLength();l++)if(t.loadCell(l,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==a||this._workCell.bg!==h){if(l-s>1){let c=this._getJoinedRanges(i,o,n,t,s);for(let u=0;u<c.length;u++)r.push(c[u])}s=l,o=n,a=this._workCell.fg,h=this._workCell.bg}n+=this._workCell.getChars().length||er.length}if(this._bufferService.cols-s>1){let l=this._getJoinedRanges(i,o,n,t,s);for(let c=0;c<l.length;c++)r.push(l[c])}return r}_getJoinedRanges(e,t,r,i,s){let n=e.substring(t,r),o=[];try{o=this._characterJoiners[0].handler(n)}catch(a){console.error(a)}for(let a=1;a<this._characterJoiners.length;a++)try{let h=this._characterJoiners[a].handler(n);for(let l=0;l<h.length;l++)as._mergeRanges(o,h[l])}catch(h){console.error(h)}return this._stringRangesToCellRanges(o,i,s),o}_stringRangesToCellRanges(e,t,r){let i=0,s=!1,n=0,o=e[i];if(o){for(let a=r;a<this._bufferService.cols;a++){let h=t.getWidth(a),l=t.getString(a).length||er.length;if(h!==0){if(!s&&o[0]<=n&&(o[0]=a,s=!0),o[1]<=n){if(o[1]=a,o=e[++i],!o)break;o[0]<=n?(o[0]=a,s=!0):s=!1}n+=l}}o&&(o[1]=this._bufferService.cols)}}static _mergeRanges(e,t){let r=!1;for(let i=0;i<e.length;i++){let s=e[i];if(r){if(t[1]<=s[0])return e[i-1][1]=t[1],e;if(t[1]<=s[1])return e[i-1][1]=Math.max(t[1],s[1]),e.splice(i,1),e;e.splice(i,1),i--}else{if(t[1]<=s[0])return e.splice(i,0,t),e;if(t[1]<=s[1])return s[0]=Math.min(t[0],s[0]),e;t[0]<s[1]&&(s[0]=Math.min(t[0],s[0]),r=!0);continue}}return r?e[e.length-1][1]=t[1]:e.push(t),e}};as=Be([re(0,Ge)],as);function Nv(e){return 57508<=e&&e<=57558}function Fv(e){return 9472<=e&&e<=9631}function Uv(e){return Nv(e)||Fv(e)}function Hv(){return{css:{canvas:ls(),cell:ls()},device:{canvas:ls(),cell:ls(),char:{width:0,height:0,left:0,top:0}}}}function ls(){return{width:0,height:0}}var fa=class{constructor(e,t,r,i,s,n,o){this._document=e,this._characterJoinerService=t,this._optionsService=r,this._coreBrowserService=i,this._coreService=s,this._decorationService=n,this._themeService=o,this._workCell=new dt,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(e,t,r){this._selectionStart=e,this._selectionEnd=t,this._columnSelectMode=r}createRow(e,t,r,i,s,n,o,a,h,l,c){let u=[],p=this._characterJoinerService.getJoinedCharacters(t),_=this._themeService.colors,m=e.getNoBgTrimmedLength();r&&m<n+1&&(m=n+1);let g,w=0,y="",E=0,S=0,v=0,k=0,R=!1,O=0,N=!1,W=0,Q=0,ie=[],K=l!==-1&&c!==-1;for(let H=0;H<m;H++){e.loadCell(H,this._workCell);let G=this._workCell.getWidth();if(G===0)continue;let J=!1,ee=H>=Q,se=H,Y=this._workCell;if(p.length>0&&H===p[0][0]&&ee){let P=p.shift(),X=this._isCellInSelection(P[0],t);for(E=P[0]+1;E<P[1];E++)ee&&(ee=X===this._isCellInSelection(E,t));ee&&(ee=!r||n<P[0]||n>=P[1]),ee?(J=!0,Y=new Iv(this._workCell,e.translateToString(!0,P[0],P[1]),P[1]-P[0]),se=P[1]-1,G=Y.getWidth()):Q=P[1]}let le=this._isCellInSelection(H,t),me=r&&H===n,ke=K&&H>=l&&H<=c,L=!1;this._decorationService.forEachDecorationAtCell(H,t,void 0,P=>{L=!0});let I=Y.getChars()||er;if(I===" "&&(Y.isUnderline()||Y.isOverline())&&(I=""),W=G*a-h.get(I,Y.isBold(),Y.isItalic()),!g)g=this._document.createElement("span");else if(w&&(le&&N||!le&&!N&&Y.bg===S)&&(le&&N&&_.selectionForeground||Y.fg===v)&&Y.extended.ext===k&&ke===R&&W===O&&!me&&!J&&!L&&ee){Y.isInvisible()?y+=er:y+=I,w++;continue}else w&&(g.textContent=y),g=this._document.createElement("span"),w=0,y="";if(S=Y.bg,v=Y.fg,k=Y.extended.ext,R=ke,O=W,N=le,J&&n>=H&&n<=se&&(n=H),!this._coreService.isCursorHidden&&me&&this._coreService.isCursorInitialized){if(ie.push("xterm-cursor"),this._coreBrowserService.isFocused)o&&ie.push("xterm-cursor-blink"),ie.push(i==="bar"?"xterm-cursor-bar":i==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(s)switch(s){case"outline":ie.push("xterm-cursor-outline");break;case"block":ie.push("xterm-cursor-block");break;case"bar":ie.push("xterm-cursor-bar");break;case"underline":ie.push("xterm-cursor-underline");break}}if(Y.isBold()&&ie.push("xterm-bold"),Y.isItalic()&&ie.push("xterm-italic"),Y.isDim()&&ie.push("xterm-dim"),Y.isInvisible()?y=er:y=Y.getChars()||er,Y.isUnderline()&&(ie.push(`xterm-underline-${Y.extended.underlineStyle}`),y===" "&&(y=""),!Y.isUnderlineColorDefault()))if(Y.isUnderlineColorRGB())g.style.textDecorationColor=`rgb(${Gr.toColorRGB(Y.getUnderlineColor()).join(",")})`;else{let P=Y.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&Y.isBold()&&P<8&&(P+=8),g.style.textDecorationColor=_.ansi[P].css}Y.isOverline()&&(ie.push("xterm-overline"),y===" "&&(y="")),Y.isStrikethrough()&&ie.push("xterm-strikethrough"),ke&&(g.style.textDecoration="underline");let U=Y.getFgColor(),te=Y.getFgColorMode(),A=Y.getBgColor(),D=Y.getBgColorMode(),F=!!Y.isInverse();if(F){let P=U;U=A,A=P;let X=te;te=D,D=X}let $,V,C=!1;this._decorationService.forEachDecorationAtCell(H,t,void 0,P=>{P.options.layer!=="top"&&C||(P.backgroundColorRGB&&(D=50331648,A=P.backgroundColorRGB.rgba>>8&16777215,$=P.backgroundColorRGB),P.foregroundColorRGB&&(te=50331648,U=P.foregroundColorRGB.rgba>>8&16777215,V=P.foregroundColorRGB),C=P.options.layer==="top")}),!C&&le&&($=this._coreBrowserService.isFocused?_.selectionBackgroundOpaque:_.selectionInactiveBackgroundOpaque,A=$.rgba>>8&16777215,D=50331648,C=!0,_.selectionForeground&&(te=50331648,U=_.selectionForeground.rgba>>8&16777215,V=_.selectionForeground)),C&&ie.push("xterm-decoration-top");let x;switch(D){case 16777216:case 33554432:x=_.ansi[A],ie.push(`xterm-bg-${A}`);break;case 50331648:x=Pe.toColor(A>>16,A>>8&255,A&255),this._addStyle(g,`background-color:#${Fu((A>>>0).toString(16),"0",6)}`);break;case 0:default:F?(x=_.foreground,ie.push("xterm-bg-257")):x=_.background}switch($||Y.isDim()&&($=we.multiplyOpacity(x,.5)),te){case 16777216:case 33554432:Y.isBold()&&U<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(U+=8),this._applyMinimumContrast(g,x,_.ansi[U],Y,$,void 0)||ie.push(`xterm-fg-${U}`);break;case 50331648:let P=Pe.toColor(U>>16&255,U>>8&255,U&255);this._applyMinimumContrast(g,x,P,Y,$,V)||this._addStyle(g,`color:#${Fu(U.toString(16),"0",6)}`);break;case 0:default:this._applyMinimumContrast(g,x,_.foreground,Y,$,V)||F&&ie.push("xterm-fg-257")}ie.length&&(g.className=ie.join(" "),ie.length=0),!me&&!J&&!L&&ee?w++:g.textContent=y,W!==this.defaultSpacing&&(g.style.letterSpacing=`${W}px`),u.push(g),H=se}return g&&w&&(g.textContent=y),u}_applyMinimumContrast(e,t,r,i,s,n){if(this._optionsService.rawOptions.minimumContrastRatio===1||Uv(i.getCode()))return!1;let o=this._getContrastCache(i),a;if(!s&&!n&&(a=o.getColor(t.rgba,r.rgba)),a===void 0){let h=this._optionsService.rawOptions.minimumContrastRatio/(i.isDim()?2:1);a=we.ensureContrastRatio(s||t,n||r,h),o.setColor((s||t).rgba,(n||r).rgba,a??null)}return a?(this._addStyle(e,`color:${a.css}`),!0):!1}_getContrastCache(e){return e.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(e,t){e.setAttribute("style",`${e.getAttribute("style")||""}${t};`)}_isCellInSelection(e,t){let r=this._selectionStart,i=this._selectionEnd;return!r||!i?!1:this._columnSelectMode?r[0]<=i[0]?e>=r[0]&&t>=r[1]&&e<i[0]&&t<=i[1]:e<r[0]&&t>=r[1]&&e>=i[0]&&t<=i[1]:t>r[1]&&t<i[1]||r[1]===i[1]&&t===r[1]&&e>=r[0]&&e<i[0]||r[1]<i[1]&&t===i[1]&&e<i[0]||r[1]<i[1]&&t===r[1]&&e>=r[0]}};fa=Be([re(1,lu),re(2,Ye),re(3,Ht),re(4,fr),re(5,Yr),re(6,Or)],fa);function Fu(e,t,r){for(;e.length<r;)e=t+e;return e}var Wv=class{constructor(e,t){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=e.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let r=e.createElement("span");r.classList.add("xterm-char-measure-element");let i=e.createElement("span");i.classList.add("xterm-char-measure-element"),i.style.fontWeight="bold";let s=e.createElement("span");s.classList.add("xterm-char-measure-element"),s.style.fontStyle="italic";let n=e.createElement("span");n.classList.add("xterm-char-measure-element"),n.style.fontWeight="bold",n.style.fontStyle="italic",this._measureElements=[r,i,s,n],this._container.appendChild(r),this._container.appendChild(i),this._container.appendChild(s),this._container.appendChild(n),t.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(e,t,r,i){e===this._font&&t===this._fontSize&&r===this._weight&&i===this._weightBold||(this._font=e,this._fontSize=t,this._weight=r,this._weightBold=i,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${r}`,this._measureElements[1].style.fontWeight=`${i}`,this._measureElements[2].style.fontWeight=`${r}`,this._measureElements[3].style.fontWeight=`${i}`,this.clear())}get(e,t,r){let i=0;if(!t&&!r&&e.length===1&&(i=e.charCodeAt(0))<256){if(this._flat[i]!==-9999)return this._flat[i];let o=this._measure(e,0);return o>0&&(this._flat[i]=o),o}let s=e;t&&(s+="B"),r&&(s+="I");let n=this._holey.get(s);if(n===void 0){let o=0;t&&(o|=1),r&&(o|=2),n=this._measure(e,o),n>0&&this._holey.set(s,n)}return n}_measure(e,t){let r=this._measureElements[t];return r.textContent=e.repeat(32),r.offsetWidth/32}},zv=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(e,t,r,i=!1){if(this.selectionStart=t,this.selectionEnd=r,!t||!r||t[0]===r[0]&&t[1]===r[1]){this.clear();return}let s=e.buffers.active.ydisp,n=t[1]-s,o=r[1]-s,a=Math.max(n,0),h=Math.min(o,e.rows-1);if(a>=e.rows||h<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=i,this.viewportStartRow=n,this.viewportEndRow=o,this.viewportCappedStartRow=a,this.viewportCappedEndRow=h,this.startCol=t[0],this.endCol=r[0]}isCellSelected(e,t,r){return this.hasSelection?(r-=e.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?t>=this.startCol&&r>=this.viewportCappedStartRow&&t<this.endCol&&r<=this.viewportCappedEndRow:t<this.startCol&&r>=this.viewportCappedStartRow&&t>=this.endCol&&r<=this.viewportCappedEndRow:r>this.viewportStartRow&&r<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&r===this.viewportStartRow&&t>=this.startCol&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&r===this.viewportEndRow&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&r===this.viewportStartRow&&t>=this.startCol):!1}};function qv(){return new zv}var da="xterm-dom-renderer-owner-",pt="xterm-rows",hs="xterm-fg-",Uu="xterm-bg-",Qr="xterm-focus",cs="xterm-selection",jv=1,pa=class extends ue{constructor(e,t,r,i,s,n,o,a,h,l,c,u,p,_){super(),this._terminal=e,this._document=t,this._element=r,this._screenElement=i,this._viewportElement=s,this._helperContainer=n,this._linkifier2=o,this._charSizeService=h,this._optionsService=l,this._bufferService=c,this._coreService=u,this._coreBrowserService=p,this._themeService=_,this._terminalClass=jv++,this._rowElements=[],this._selectionRenderModel=qv(),this.onRequestRedraw=this._register(new Z).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(pt),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(cs),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=Hv(),this._updateDimensions(),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._themeService.onChangeColors(m=>this._injectCss(m))),this._injectCss(this._themeService.colors),this._rowFactory=a.createInstance(fa,document),this._element.classList.add(da+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this._register(this._linkifier2.onShowLinkUnderline(m=>this._handleLinkHover(m))),this._register(this._linkifier2.onHideLinkUnderline(m=>this._handleLinkLeave(m))),this._register(Se(()=>{this._element.classList.remove(da+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new Wv(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let e=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*e,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*e),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/e),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/e),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let r of this._rowElements)r.style.width=`${this.dimensions.css.canvas.width}px`,r.style.height=`${this.dimensions.css.cell.height}px`,r.style.lineHeight=`${this.dimensions.css.cell.height}px`,r.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let t=`${this._terminalSelector} .${pt} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=t,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(e){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let t=`${this._terminalSelector} .${pt} { pointer-events: none; color: ${e.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;t+=`${this._terminalSelector} .${pt} .xterm-dim { color: ${we.multiplyOpacity(e.foreground,.5).css};}`,t+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;let r=`blink_underline_${this._terminalClass}`,i=`blink_bar_${this._terminalClass}`,s=`blink_block_${this._terminalClass}`;t+=`@keyframes ${r} { 50% {  border-bottom-style: hidden; }}`,t+=`@keyframes ${i} { 50% {  box-shadow: none; }}`,t+=`@keyframes ${s} { 0% {  background-color: ${e.cursor.css};  color: ${e.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${e.cursor.css}; }}`,t+=`${this._terminalSelector} .${pt}.${Qr} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${r} 1s step-end infinite;}${this._terminalSelector} .${pt}.${Qr} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${i} 1s step-end infinite;}${this._terminalSelector} .${pt}.${Qr} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${s} 1s step-end infinite;}${this._terminalSelector} .${pt} .xterm-cursor.xterm-cursor-block { background-color: ${e.cursor.css}; color: ${e.cursorAccent.css};}${this._terminalSelector} .${pt} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${e.cursor.css} !important; color: ${e.cursorAccent.css} !important;}${this._terminalSelector} .${pt} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${e.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${pt} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${e.cursor.css} inset;}${this._terminalSelector} .${pt} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${e.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,t+=`${this._terminalSelector} .${cs} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${cs} div { position: absolute; background-color: ${e.selectionBackgroundOpaque.css};}${this._terminalSelector} .${cs} div { position: absolute; background-color: ${e.selectionInactiveBackgroundOpaque.css};}`;for(let[n,o]of e.ansi.entries())t+=`${this._terminalSelector} .${hs}${n} { color: ${o.css}; }${this._terminalSelector} .${hs}${n}.xterm-dim { color: ${we.multiplyOpacity(o,.5).css}; }${this._terminalSelector} .${Uu}${n} { background-color: ${o.css}; }`;t+=`${this._terminalSelector} .${hs}257 { color: ${we.opaque(e.background).css}; }${this._terminalSelector} .${hs}257.xterm-dim { color: ${we.multiplyOpacity(we.opaque(e.background),.5).css}; }${this._terminalSelector} .${Uu}257 { background-color: ${e.foreground.css}; }`,this._themeStyleElement.textContent=t}_setDefaultSpacing(){let e=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${e}px`,this._rowFactory.defaultSpacing=e}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(e,t){for(let r=this._rowElements.length;r<=t;r++){let i=this._document.createElement("div");this._rowContainer.appendChild(i),this._rowElements.push(i)}for(;this._rowElements.length>t;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(e,t){this._refreshRowElements(e,t),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(Qr),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(Qr),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(e,t,r){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(e,t,r),this.renderRows(0,this._bufferService.rows-1),!e||!t||(this._selectionRenderModel.update(this._terminal,e,t,r),!this._selectionRenderModel.hasSelection))return;let i=this._selectionRenderModel.viewportStartRow,s=this._selectionRenderModel.viewportEndRow,n=this._selectionRenderModel.viewportCappedStartRow,o=this._selectionRenderModel.viewportCappedEndRow,a=this._document.createDocumentFragment();if(r){let h=e[0]>t[0];a.appendChild(this._createSelectionElement(n,h?t[0]:e[0],h?e[0]:t[0],o-n+1))}else{let h=i===n?e[0]:0,l=n===s?t[0]:this._bufferService.cols;a.appendChild(this._createSelectionElement(n,h,l));let c=o-n-1;if(a.appendChild(this._createSelectionElement(n+1,0,this._bufferService.cols,c)),n!==o){let u=s===o?t[0]:this._bufferService.cols;a.appendChild(this._createSelectionElement(o,0,u))}}this._selectionContainer.appendChild(a)}_createSelectionElement(e,t,r,i=1){let s=this._document.createElement("div"),n=t*this.dimensions.css.cell.width,o=this.dimensions.css.cell.width*(r-t);return n+o>this.dimensions.css.canvas.width&&(o=this.dimensions.css.canvas.width-n),s.style.height=`${i*this.dimensions.css.cell.height}px`,s.style.top=`${e*this.dimensions.css.cell.height}px`,s.style.left=`${n}px`,s.style.width=`${o}px`,s}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let e of this._rowElements)e.replaceChildren()}renderRows(e,t){let r=this._bufferService.buffer,i=r.ybase+r.y,s=Math.min(r.x,this._bufferService.cols-1),n=this._coreService.decPrivateModes.cursorBlink??this._optionsService.rawOptions.cursorBlink,o=this._coreService.decPrivateModes.cursorStyle??this._optionsService.rawOptions.cursorStyle,a=this._optionsService.rawOptions.cursorInactiveStyle;for(let h=e;h<=t;h++){let l=h+r.ydisp,c=this._rowElements[h],u=r.lines.get(l);if(!c||!u)break;c.replaceChildren(...this._rowFactory.createRow(u,l,l===i,o,a,s,n,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${da}${this._terminalClass}`}_handleLinkHover(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!0)}_handleLinkLeave(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!1)}_setCellUnderline(e,t,r,i,s,n){r<0&&(e=0),i<0&&(t=0);let o=this._bufferService.rows-1;r=Math.max(Math.min(r,o),0),i=Math.max(Math.min(i,o),0),s=Math.min(s,this._bufferService.cols);let a=this._bufferService.buffer,h=a.ybase+a.y,l=Math.min(a.x,s-1),c=this._optionsService.rawOptions.cursorBlink,u=this._optionsService.rawOptions.cursorStyle,p=this._optionsService.rawOptions.cursorInactiveStyle;for(let _=r;_<=i;++_){let m=_+a.ydisp,g=this._rowElements[_],w=a.lines.get(m);if(!g||!w)break;g.replaceChildren(...this._rowFactory.createRow(w,m,m===h,u,p,l,c,this.dimensions.css.cell.width,this._widthCache,n?_===r?e:0:-1,n?(_===i?t:s)-1:-1))}}};pa=Be([re(7,Wo),re(8,Zi),re(9,Ye),re(10,Ge),re(11,fr),re(12,Ht),re(13,Or)],pa);var _a=class extends ue{constructor(e,t,r){super(),this._optionsService=r,this.width=0,this.height=0,this._onCharSizeChange=this._register(new Z),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this._register(new Kv(this._optionsService))}catch{this._measureStrategy=this._register(new $v(e,t,this._optionsService))}this._register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){let e=this._measureStrategy.measure();(e.width!==this.width||e.height!==this.height)&&(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};_a=Be([re(2,Ye)],_a);var Hu=class extends ue{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(e,t){e!==void 0&&e>0&&t!==void 0&&t>0&&(this._result.width=e,this._result.height=t)}},$v=class extends Hu{constructor(e,t,r){super(),this._document=e,this._parentElement=t,this._optionsService=r,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}},Kv=class extends Hu{constructor(e){super(),this._optionsService=e,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");let t=this._ctx.measureText("W");if(!("width"in t&&"fontBoundingBoxAscent"in t&&"fontBoundingBoxDescent"in t))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;let e=this._ctx.measureText("W");return this._validateAndSet(e.width,e.fontBoundingBoxAscent+e.fontBoundingBoxDescent),this._result}},Vv=class extends ue{constructor(e,t,r){super(),this._textarea=e,this._window=t,this.mainDocument=r,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=this._register(new Gv(this._window)),this._onDprChange=this._register(new Z),this.onDprChange=this._onDprChange.event,this._onWindowChange=this._register(new Z),this.onWindowChange=this._onWindowChange.event,this._register(this.onWindowChange(i=>this._screenDprMonitor.setWindow(i))),this._register(je.forward(this._screenDprMonitor.onDprChange,this._onDprChange)),this._register(he(this._textarea,"focus",()=>this._isFocused=!0)),this._register(he(this._textarea,"blur",()=>this._isFocused=!1))}get window(){return this._window}set window(e){this._window!==e&&(this._window=e,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}},Gv=class extends ue{constructor(e){super(),this._parentWindow=e,this._windowResizeListener=this._register(new Ir),this._onDprChange=this._register(new Z),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this._register(Se(()=>this.clearListener()))}setWindow(e){this._parentWindow=e,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=he(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){var e;this._outerListener&&((e=this._resolutionMediaMatchList)==null||e.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){!this._resolutionMediaMatchList||!this._outerListener||(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}},Yv=class extends ue{constructor(){super(),this.linkProviders=[],this._register(Se(()=>this.linkProviders.length=0))}registerLinkProvider(e){return this.linkProviders.push(e),{dispose:()=>{let t=this.linkProviders.indexOf(e);t!==-1&&this.linkProviders.splice(t,1)}}}};function ga(e,t,r){let i=r.getBoundingClientRect(),s=e.getComputedStyle(r),n=parseInt(s.getPropertyValue("padding-left")),o=parseInt(s.getPropertyValue("padding-top"));return[t.clientX-i.left-n,t.clientY-i.top-o]}function Xv(e,t,r,i,s,n,o,a,h){if(!n)return;let l=ga(e,t,r);if(l)return l[0]=Math.ceil((l[0]+(h?o/2:0))/o),l[1]=Math.ceil(l[1]/a),l[0]=Math.min(Math.max(l[0],1),i+(h?1:0)),l[1]=Math.min(Math.max(l[1],1),s),l}var va=class{constructor(e,t){this._renderService=e,this._charSizeService=t}getCoords(e,t,r,i,s){return Xv(window,e,t,r,i,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,s)}getMouseReportCoords(e,t){let r=ga(window,e,t);if(this._charSizeService.hasValidSize)return r[0]=Math.min(Math.max(r[0],0),this._renderService.dimensions.css.canvas.width-1),r[1]=Math.min(Math.max(r[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(r[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(r[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(r[0]),y:Math.floor(r[1])}}};va=Be([re(0,Wt),re(1,Zi)],va);var Jv=class{constructor(e,t){this._renderCallback=e,this._coreBrowserService=t,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(e){return this._refreshCallbacks.push(e),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(e,t,r){this._rowCount=r,e=e!==void 0?e:0,t=t!==void 0?t:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,e):e,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,t):t,!this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0){this._runRefreshCallbacks();return}let e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let e of this._refreshCallbacks)e(0);this._refreshCallbacks=[]}},Wu={};ag(Wu,{getSafariVersion:()=>Qv,isChromeOS:()=>$u,isFirefox:()=>zu,isIpad:()=>e1,isIphone:()=>t1,isLegacyEdge:()=>Zv,isLinux:()=>ma,isMac:()=>fs,isNode:()=>us,isSafari:()=>qu,isWindows:()=>ju});var us=typeof ae<"u"&&"title"in ae,ei=us?"node":navigator.userAgent,ti=us?"node":navigator.platform,zu=ei.includes("Firefox"),Zv=ei.includes("Edge"),qu=/^((?!chrome|android).)*safari/i.test(ei);function Qv(){if(!qu)return 0;let e=ei.match(/Version\/(\d+)/);return e===null||e.length<2?0:parseInt(e[1])}var fs=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(ti),e1=ti==="iPad",t1=ti==="iPhone",ju=["Windows","Win16","Win32","WinCE"].includes(ti),ma=ti.indexOf("Linux")>=0,$u=/\bCrOS\b/.test(ei),Ku=class{constructor(){this._tasks=[],this._i=0}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let t=0,r=0,i=e.timeRemaining(),s=0;for(;this._i<this._tasks.length;){if(t=performance.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,performance.now()-t),r=Math.max(t,r),s=e.timeRemaining(),r*1.5>s){i-t<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(i-t))}ms`),this._start();return}i=s}this.clear()}},r1=class extends Ku{_requestCallback(e){return setTimeout(()=>e(this._createDeadline(16)))}_cancelCallback(e){clearTimeout(e)}_createDeadline(e){let t=performance.now()+e;return{timeRemaining:()=>Math.max(0,t-performance.now())}}},i1=class extends Ku{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}},ds=!us&&"requestIdleCallback"in window?i1:r1,s1=class{constructor(){this._queue=new ds}set(e){this._queue.clear(),this._queue.enqueue(e)}flush(){this._queue.flush()}},ya=class extends ue{constructor(e,t,r,i,s,n,o,a,h){super(),this._rowCount=e,this._optionsService=r,this._charSizeService=i,this._coreService=s,this._coreBrowserService=a,this._renderer=this._register(new Ir),this._pausedResizeTask=new s1,this._observerDisposable=this._register(new Ir),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this._register(new Z),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this._register(new Z),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this._register(new Z),this.onRender=this._onRender.event,this._onRefreshRequest=this._register(new Z),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new Jv((l,c)=>this._renderRows(l,c),this._coreBrowserService),this._register(this._renderDebouncer),this._syncOutputHandler=new n1(this._coreBrowserService,this._coreService,()=>this._fullRefresh()),this._register(Se(()=>this._syncOutputHandler.dispose())),this._register(this._coreBrowserService.onDprChange(()=>this.handleDevicePixelRatioChange())),this._register(o.onResize(()=>this._fullRefresh())),this._register(o.buffers.onBufferActivate(()=>{var l;return(l=this._renderer.value)==null?void 0:l.clear()})),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this._register(n.onDecorationRegistered(()=>this._fullRefresh())),this._register(n.onDecorationRemoved(()=>this._fullRefresh())),this._register(this._optionsService.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(o.cols,o.rows),this._fullRefresh()})),this._register(this._optionsService.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(o.buffer.y,o.buffer.y,!0))),this._register(h.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(this._coreBrowserService.window,t),this._register(this._coreBrowserService.onWindowChange(l=>this._registerIntersectionObserver(l,t)))}get dimensions(){return this._renderer.value.dimensions}_registerIntersectionObserver(e,t){if("IntersectionObserver"in e){let r=new e.IntersectionObserver(i=>this._handleIntersectionChange(i[i.length-1]),{threshold:0});r.observe(t),this._observerDisposable.value=Se(()=>r.disconnect())}}_handleIntersectionChange(e){this._isPaused=e.isIntersecting===void 0?e.intersectionRatio===0:!e.isIntersecting,!this._isPaused&&!this._charSizeService.hasValidSize&&this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(e,t,r=!1){if(this._isPaused){this._needsFullRefresh=!0;return}if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(e,t);return}let i=this._syncOutputHandler.flush();i&&(e=Math.min(e,i.start),t=Math.max(t,i.end)),r||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,t,this._rowCount)}_renderRows(e,t){if(this._renderer.value){if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(e,t);return}e=Math.min(e,this._rowCount-1),t=Math.min(t,this._rowCount-1),this._renderer.value.renderRows(e,t),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:t}),this._onRender.fire({start:e,end:t}),this._isNextRenderRedrawOnly=!0}}resize(e,t){this._rowCount=t,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(e){this._renderer.value=e,this._renderer.value&&(this._renderer.value.onRequestRedraw(t=>this.refreshRows(t.start,t.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(e){return this._renderDebouncer.addRefreshCallback(e)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var e,t;this._renderer.value&&((t=(e=this._renderer.value).clearTextureAtlas)==null||t.call(e),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(e,t){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>{var r;return(r=this._renderer.value)==null?void 0:r.handleResize(e,t)}):this._renderer.value.handleResize(e,t),this._fullRefresh())}handleCharSizeChanged(){var e;(e=this._renderer.value)==null||e.handleCharSizeChanged()}handleBlur(){var e;(e=this._renderer.value)==null||e.handleBlur()}handleFocus(){var e;(e=this._renderer.value)==null||e.handleFocus()}handleSelectionChanged(e,t,r){var i;this._selectionState.start=e,this._selectionState.end=t,this._selectionState.columnSelectMode=r,(i=this._renderer.value)==null||i.handleSelectionChanged(e,t,r)}handleCursorMove(){var e;(e=this._renderer.value)==null||e.handleCursorMove()}clear(){var e;(e=this._renderer.value)==null||e.clear()}};ya=Be([re(2,Ye),re(3,Zi),re(4,fr),re(5,Yr),re(6,Ge),re(7,Ht),re(8,Or)],ya);var n1=class{constructor(e,t,r){this._coreBrowserService=e,this._coreService=t,this._onTimeout=r,this._start=0,this._end=0,this._isBuffering=!1}bufferRows(e,t){this._isBuffering?(this._start=Math.min(this._start,e),this._end=Math.max(this._end,t)):(this._start=e,this._end=t,this._isBuffering=!0),this._timeout===void 0&&(this._timeout=this._coreBrowserService.window.setTimeout(()=>{this._timeout=void 0,this._coreService.decPrivateModes.synchronizedOutput=!1,this._onTimeout()},1e3))}flush(){if(this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0),!this._isBuffering)return;let e={start:this._start,end:this._end};return this._isBuffering=!1,e}dispose(){this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0)}};function o1(e,t,r,i){let s=r.buffer.x,n=r.buffer.y;if(!r.buffer.hasScrollback)return h1(s,n,e,t,r,i)+ps(n,t,r,i)+c1(s,n,e,t,r,i);let o;if(n===t)return o=s>e?"D":"C",ii(Math.abs(s-e),ri(o,i));o=n>t?"D":"C";let a=Math.abs(n-t),h=l1(n>t?e:s,r)+(a-1)*r.cols+1+a1(n>t?s:e);return ii(h,ri(o,i))}function a1(e,t){return e-1}function l1(e,t){return t.cols-e}function h1(e,t,r,i,s,n){return ps(t,i,s,n).length===0?"":ii(Gu(e,t,e,t-gr(t,s),!1,s).length,ri("D",n))}function ps(e,t,r,i){let s=e-gr(e,r),n=t-gr(t,r),o=Math.abs(s-n)-u1(e,t,r);return ii(o,ri(Vu(e,t),i))}function c1(e,t,r,i,s,n){let o;ps(t,i,s,n).length>0?o=i-gr(i,s):o=t;let a=i,h=f1(e,t,r,i,s,n);return ii(Gu(e,o,r,a,h==="C",s).length,ri(h,n))}function u1(e,t,r){var o;let i=0,s=e-gr(e,r),n=t-gr(t,r);for(let a=0;a<Math.abs(s-n);a++){let h=Vu(e,t)==="A"?-1:1;(o=r.buffer.lines.get(s+h*a))!=null&&o.isWrapped&&i++}return i}function gr(e,t){let r=0,i=t.buffer.lines.get(e),s=i==null?void 0:i.isWrapped;for(;s&&e>=0&&e<t.rows;)r++,i=t.buffer.lines.get(--e),s=i==null?void 0:i.isWrapped;return r}function f1(e,t,r,i,s,n){let o;return ps(r,i,s,n).length>0?o=i-gr(i,s):o=t,e<r&&o<=i||e>=r&&o<i?"C":"D"}function Vu(e,t){return e>t?"A":"B"}function Gu(e,t,r,i,s,n){let o=e,a=t,h="";for(;(o!==r||a!==i)&&a>=0&&a<n.buffer.lines.length;)o+=s?1:-1,s&&o>n.cols-1?(h+=n.buffer.translateBufferLineToString(a,!1,e,o),o=0,e=0,a++):!s&&o<0&&(h+=n.buffer.translateBufferLineToString(a,!1,0,e+1),o=n.cols-1,e=o,a--);return h+n.buffer.translateBufferLineToString(a,!1,e,o)}function ri(e,t){let r=t?"O":"[";return q.ESC+r+e}function ii(e,t){e=Math.floor(e);let r="";for(let i=0;i<e;i++)r+=t;return r}var d1=class{constructor(e){this._bufferService=e,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:!this.selectionEnd||!this.selectionStart?this.selectionStart:this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?e%this._bufferService.cols===0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)-1]:[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[e,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[Math.max(e,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let e=this.selectionStart,t=this.selectionEnd;return!e||!t?!1:e[1]>t[1]||e[1]===t[1]&&e[0]>t[0]}handleTrim(e){return this.selectionStart&&(this.selectionStart[1]-=e),this.selectionEnd&&(this.selectionEnd[1]-=e),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}};function Yu(e,t){if(e.start.y>e.end.y)throw new Error(`Buffer range end (${e.end.x}, ${e.end.y}) cannot be before start (${e.start.x}, ${e.start.y})`);return t*(e.end.y-e.start.y)+(e.end.x-e.start.x+1)}var ba=50,p1=15,_1=50,g1=500,v1="",m1=new RegExp(v1,"g"),wa=class extends ue{constructor(e,t,r,i,s,n,o,a,h){super(),this._element=e,this._screenElement=t,this._linkifier=r,this._bufferService=i,this._coreService=s,this._mouseService=n,this._optionsService=o,this._renderService=a,this._coreBrowserService=h,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new dt,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this._register(new Z),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this._register(new Z),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this._register(new Z),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this._register(new Z),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=l=>this._handleMouseMove(l),this._mouseUpListener=l=>this._handleMouseUp(l),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(l=>this._handleTrim(l)),this._register(this._bufferService.buffers.onBufferActivate(l=>this._handleBufferActivate(l))),this.enable(),this._model=new d1(this._bufferService),this._activeSelectionMode=0,this._register(Se(()=>{this._removeMouseDownListeners()})),this._register(this._bufferService.onResize(l=>{l.rowsChanged&&this.clearSelection()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;return!e||!t?!1:e[0]!==t[0]||e[1]!==t[1]}get selectionText(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;if(!e||!t)return"";let r=this._bufferService.buffer,i=[];if(this._activeSelectionMode===3){if(e[0]===t[0])return"";let s=e[0]<t[0]?e[0]:t[0],n=e[0]<t[0]?t[0]:e[0];for(let o=e[1];o<=t[1];o++){let a=r.translateBufferLineToString(o,!0,s,n);i.push(a)}}else{let s=e[1]===t[1]?t[0]:void 0;i.push(r.translateBufferLineToString(e[1],!0,e[0],s));for(let n=e[1]+1;n<=t[1]-1;n++){let o=r.lines.get(n),a=r.translateBufferLineToString(n,!0);o!=null&&o.isWrapped?i[i.length-1]+=a:i.push(a)}if(e[1]!==t[1]){let n=r.lines.get(t[1]),o=r.translateBufferLineToString(t[1],!0,0,t[0]);n&&n.isWrapped?i[i.length-1]+=o:i.push(o)}}return i.map(s=>s.replace(m1," ")).join(ju?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(e){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),ma&&e&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(e){let t=this._getMouseBufferCoords(e),r=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;return!r||!i||!t?!1:this._areCoordsInSelection(t,r,i)}isCellInSelection(e,t){let r=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;return!r||!i?!1:this._areCoordsInSelection([e,t],r,i)}_areCoordsInSelection(e,t,r){return e[1]>t[1]&&e[1]<r[1]||t[1]===r[1]&&e[1]===t[1]&&e[0]>=t[0]&&e[0]<r[0]||t[1]<r[1]&&e[1]===r[1]&&e[0]<r[0]||t[1]<r[1]&&e[1]===t[1]&&e[0]>=t[0]}_selectWordAtCursor(e,t){var s,n;let r=(n=(s=this._linkifier.currentLink)==null?void 0:s.link)==null?void 0:n.range;if(r)return this._model.selectionStart=[r.start.x-1,r.start.y-1],this._model.selectionStartLength=Yu(r,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let i=this._getMouseBufferCoords(e);return i?(this._selectWordAt(i,t),this._model.selectionEnd=void 0,!0):!1}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(e,t){this._model.clearSelection(),e=Math.max(e,0),t=Math.min(t,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,e],this._model.selectionEnd=[this._bufferService.cols,t],this.refresh(),this._onSelectionChange.fire()}_handleTrim(e){this._model.handleTrim(e)&&this.refresh()}_getMouseBufferCoords(e){let t=this._mouseService.getCoords(e,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(t)return t[0]--,t[1]--,t[1]+=this._bufferService.buffer.ydisp,t}_getMouseEventScrollAmount(e){let t=ga(this._coreBrowserService.window,e,this._screenElement)[1],r=this._renderService.dimensions.css.canvas.height;return t>=0&&t<=r?0:(t>r&&(t-=r),t=Math.min(Math.max(t,-ba),ba),t/=ba,t/Math.abs(t)+Math.round(t*(p1-1)))}shouldForceSelection(e){return fs?e.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:e.shiftKey}handleMouseDown(e){if(this._mouseDownTimeStamp=e.timeStamp,!(e.button===2&&this.hasSelection)&&e.button===0){if(!this._enabled){if(!this.shouldForceSelection(e))return;e.stopPropagation()}e.preventDefault(),this._dragScrollAmount=0,this._enabled&&e.shiftKey?this._handleIncrementalClick(e):e.detail===1?this._handleSingleClick(e):e.detail===2?this._handleDoubleClick(e):e.detail===3&&this._handleTripleClick(e),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),_1)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(e){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(e))}_handleSingleClick(e){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(e)?3:0,this._model.selectionStart=this._getMouseBufferCoords(e),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let t=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);t&&t.length!==this._model.selectionStart[0]&&t.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(e){this._selectWordAtCursor(e,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(e){let t=this._getMouseBufferCoords(e);t&&(this._activeSelectionMode=2,this._selectLineAt(t[1]))}shouldColumnSelect(e){return e.altKey&&!(fs&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(e){if(e.stopImmediatePropagation(),!this._model.selectionStart)return;let t=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(e),!this._model.selectionEnd){this.refresh(!0);return}this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(e),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let r=this._bufferService.buffer;if(this._model.selectionEnd[1]<r.lines.length){let i=r.lines.get(this._model.selectionEnd[1]);i&&i.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}(!t||t[0]!==this._model.selectionEnd[0]||t[1]!==this._model.selectionEnd[1])&&this.refresh(!0)}_dragScroll(){if(!(!this._model.selectionEnd||!this._model.selectionStart)&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let e=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(e.ydisp+this._bufferService.rows,e.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=e.ydisp),this.refresh()}}_handleMouseUp(e){let t=e.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&t<g1&&e.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let r=this._mouseService.getCoords(e,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(r&&r[0]!==void 0&&r[1]!==void 0){let i=o1(r[0]-1,r[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(i,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd,r=!!e&&!!t&&(e[0]!==t[0]||e[1]!==t[1]);if(!r){this._oldHasSelection&&this._fireOnSelectionChange(e,t,r);return}!e||!t||(!this._oldSelectionStart||!this._oldSelectionEnd||e[0]!==this._oldSelectionStart[0]||e[1]!==this._oldSelectionStart[1]||t[0]!==this._oldSelectionEnd[0]||t[1]!==this._oldSelectionEnd[1])&&this._fireOnSelectionChange(e,t,r)}_fireOnSelectionChange(e,t,r){this._oldSelectionStart=e,this._oldSelectionEnd=t,this._oldHasSelection=r,this._onSelectionChange.fire()}_handleBufferActivate(e){this.clearSelection(),this._trimListener.dispose(),this._trimListener=e.activeBuffer.lines.onTrim(t=>this._handleTrim(t))}_convertViewportColToCharacterIndex(e,t){let r=t;for(let i=0;t>=i;i++){let s=e.loadCell(i,this._workCell).getChars().length;this._workCell.getWidth()===0?r--:s>1&&t!==i&&(r+=s-1)}return r}setSelection(e,t,r){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[e,t],this._model.selectionStartLength=r,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(e){this._isClickInSelection(e)||(this._selectWordAtCursor(e,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(e,t,r=!0,i=!0){if(e[0]>=this._bufferService.cols)return;let s=this._bufferService.buffer,n=s.lines.get(e[1]);if(!n)return;let o=s.translateBufferLineToString(e[1],!1),a=this._convertViewportColToCharacterIndex(n,e[0]),h=a,l=e[0]-a,c=0,u=0,p=0,_=0;if(o.charAt(a)===" "){for(;a>0&&o.charAt(a-1)===" ";)a--;for(;h<o.length&&o.charAt(h+1)===" ";)h++}else{let w=e[0],y=e[0];n.getWidth(w)===0&&(c++,w--),n.getWidth(y)===2&&(u++,y++);let E=n.getString(y).length;for(E>1&&(_+=E-1,h+=E-1);w>0&&a>0&&!this._isCharWordSeparator(n.loadCell(w-1,this._workCell));){n.loadCell(w-1,this._workCell);let S=this._workCell.getChars().length;this._workCell.getWidth()===0?(c++,w--):S>1&&(p+=S-1,a-=S-1),a--,w--}for(;y<n.length&&h+1<o.length&&!this._isCharWordSeparator(n.loadCell(y+1,this._workCell));){n.loadCell(y+1,this._workCell);let S=this._workCell.getChars().length;this._workCell.getWidth()===2?(u++,y++):S>1&&(_+=S-1,h+=S-1),h++,y++}}h++;let m=a+l-c+p,g=Math.min(this._bufferService.cols,h-a+c+u-p-_);if(!(!t&&o.slice(a,h).trim()==="")){if(r&&m===0&&n.getCodePoint(0)!==32){let w=s.lines.get(e[1]-1);if(w&&n.isWrapped&&w.getCodePoint(this._bufferService.cols-1)!==32){let y=this._getWordAt([this._bufferService.cols-1,e[1]-1],!1,!0,!1);if(y){let E=this._bufferService.cols-y.start;m-=E,g+=E}}}if(i&&m+g===this._bufferService.cols&&n.getCodePoint(this._bufferService.cols-1)!==32){let w=s.lines.get(e[1]+1);if(w!=null&&w.isWrapped&&w.getCodePoint(0)!==32){let y=this._getWordAt([0,e[1]+1],!1,!1,!0);y&&(g+=y.length)}}return{start:m,length:g}}}_selectWordAt(e,t){let r=this._getWordAt(e,t);if(r){for(;r.start<0;)r.start+=this._bufferService.cols,e[1]--;this._model.selectionStart=[r.start,e[1]],this._model.selectionStartLength=r.length}}_selectToWordAt(e){let t=this._getWordAt(e,!0);if(t){let r=e[1];for(;t.start<0;)t.start+=this._bufferService.cols,r--;if(!this._model.areSelectionValuesReversed())for(;t.start+t.length>this._bufferService.cols;)t.length-=this._bufferService.cols,r++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?t.start:t.start+t.length,r]}}_isCharWordSeparator(e){return e.getWidth()===0?!1:this._optionsService.rawOptions.wordSeparator.indexOf(e.getChars())>=0}_selectLineAt(e){let t=this._bufferService.buffer.getWrappedRangeForLine(e),r={start:{x:0,y:t.first},end:{x:this._bufferService.cols-1,y:t.last}};this._model.selectionStart=[0,t.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=Yu(r,this._bufferService.cols)}};wa=Be([re(3,Ge),re(4,fr),re(5,qo),re(6,Ye),re(7,Wt),re(8,Ht)],wa);var Xu=class{constructor(){this._data={}}set(e,t,r){this._data[e]||(this._data[e]={}),this._data[e][t]=r}get(e,t){return this._data[e]?this._data[e][t]:void 0}clear(){this._data={}}},Ju=class{constructor(){this._color=new Xu,this._css=new Xu}setCss(e,t,r){this._css.set(e,t,r)}getCss(e,t){return this._css.get(e,t)}setColor(e,t,r){this._color.set(e,t,r)}getColor(e,t){return this._color.get(e,t)}clear(){this._color.clear(),this._css.clear()}},Ie=Object.freeze((()=>{let e=[xe.toColor("#2e3436"),xe.toColor("#cc0000"),xe.toColor("#4e9a06"),xe.toColor("#c4a000"),xe.toColor("#3465a4"),xe.toColor("#75507b"),xe.toColor("#06989a"),xe.toColor("#d3d7cf"),xe.toColor("#555753"),xe.toColor("#ef2929"),xe.toColor("#8ae234"),xe.toColor("#fce94f"),xe.toColor("#729fcf"),xe.toColor("#ad7fa8"),xe.toColor("#34e2e2"),xe.toColor("#eeeeec")],t=[0,95,135,175,215,255];for(let r=0;r<216;r++){let i=t[r/36%6|0],s=t[r/6%6|0],n=t[r%6];e.push({css:Pe.toCss(i,s,n),rgba:Pe.toRgba(i,s,n)})}for(let r=0;r<24;r++){let i=8+r*10;e.push({css:Pe.toCss(i,i,i),rgba:Pe.toRgba(i,i,i)})}return e})()),vr=xe.toColor("#ffffff"),si=xe.toColor("#000000"),Zu=xe.toColor("#ffffff"),Qu=si,ni={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117},y1=vr,Sa=class extends ue{constructor(e){super(),this._optionsService=e,this._contrastCache=new Ju,this._halfContrastCache=new Ju,this._onChangeColors=this._register(new Z),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:vr,background:si,cursor:Zu,cursorAccent:Qu,selectionForeground:void 0,selectionBackgroundTransparent:ni,selectionBackgroundOpaque:we.blend(si,ni),selectionInactiveBackgroundTransparent:ni,selectionInactiveBackgroundOpaque:we.blend(si,ni),scrollbarSliderBackground:we.opacity(vr,.2),scrollbarSliderHoverBackground:we.opacity(vr,.4),scrollbarSliderActiveBackground:we.opacity(vr,.5),overviewRulerBorder:vr,ansi:Ie.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this._register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this._register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme(e={}){let t=this._colors;if(t.foreground=ye(e.foreground,vr),t.background=ye(e.background,si),t.cursor=we.blend(t.background,ye(e.cursor,Zu)),t.cursorAccent=we.blend(t.background,ye(e.cursorAccent,Qu)),t.selectionBackgroundTransparent=ye(e.selectionBackground,ni),t.selectionBackgroundOpaque=we.blend(t.background,t.selectionBackgroundTransparent),t.selectionInactiveBackgroundTransparent=ye(e.selectionInactiveBackground,t.selectionBackgroundTransparent),t.selectionInactiveBackgroundOpaque=we.blend(t.background,t.selectionInactiveBackgroundTransparent),t.selectionForeground=e.selectionForeground?ye(e.selectionForeground,Nu):void 0,t.selectionForeground===Nu&&(t.selectionForeground=void 0),we.isOpaque(t.selectionBackgroundTransparent)&&(t.selectionBackgroundTransparent=we.opacity(t.selectionBackgroundTransparent,.3)),we.isOpaque(t.selectionInactiveBackgroundTransparent)&&(t.selectionInactiveBackgroundTransparent=we.opacity(t.selectionInactiveBackgroundTransparent,.3)),t.scrollbarSliderBackground=ye(e.scrollbarSliderBackground,we.opacity(t.foreground,.2)),t.scrollbarSliderHoverBackground=ye(e.scrollbarSliderHoverBackground,we.opacity(t.foreground,.4)),t.scrollbarSliderActiveBackground=ye(e.scrollbarSliderActiveBackground,we.opacity(t.foreground,.5)),t.overviewRulerBorder=ye(e.overviewRulerBorder,y1),t.ansi=Ie.slice(),t.ansi[0]=ye(e.black,Ie[0]),t.ansi[1]=ye(e.red,Ie[1]),t.ansi[2]=ye(e.green,Ie[2]),t.ansi[3]=ye(e.yellow,Ie[3]),t.ansi[4]=ye(e.blue,Ie[4]),t.ansi[5]=ye(e.magenta,Ie[5]),t.ansi[6]=ye(e.cyan,Ie[6]),t.ansi[7]=ye(e.white,Ie[7]),t.ansi[8]=ye(e.brightBlack,Ie[8]),t.ansi[9]=ye(e.brightRed,Ie[9]),t.ansi[10]=ye(e.brightGreen,Ie[10]),t.ansi[11]=ye(e.brightYellow,Ie[11]),t.ansi[12]=ye(e.brightBlue,Ie[12]),t.ansi[13]=ye(e.brightMagenta,Ie[13]),t.ansi[14]=ye(e.brightCyan,Ie[14]),t.ansi[15]=ye(e.brightWhite,Ie[15]),e.extendedAnsi){let r=Math.min(t.ansi.length-16,e.extendedAnsi.length);for(let i=0;i<r;i++)t.ansi[i+16]=ye(e.extendedAnsi[i],Ie[i+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(e){this._restoreColor(e),this._onChangeColors.fire(this.colors)}_restoreColor(e){if(e===void 0){for(let t=0;t<this._restoreColors.ansi.length;++t)this._colors.ansi[t]=this._restoreColors.ansi[t];return}switch(e){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[e]=this._restoreColors.ansi[e]}}modifyColors(e){e(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};Sa=Be([re(0,Ye)],Sa);function ye(e,t){if(e!==void 0)try{return xe.toColor(e)}catch{}return t}var b1=class{constructor(...e){this._entries=new Map;for(let[t,r]of e)this.set(t,r)}set(e,t){let r=this._entries.get(e);return this._entries.set(e,t),r}forEach(e){for(let[t,r]of this._entries.entries())e(t,r)}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}},w1=class{constructor(){this._services=new b1,this._services.set(Wo,this)}setService(e,t){this._services.set(e,t)}getService(e){return this._services.get(e)}createInstance(e,...t){let r=pg(e).sort((n,o)=>n.index-o.index),i=[];for(let n of r){let o=this._services.get(n.id);if(!o)throw new Error(`[createInstance] ${e.name} depends on UNKNOWN service ${n.id._id}.`);i.push(o)}let s=r.length>0?r[0].index:t.length;if(t.length!==s)throw new Error(`[createInstance] First service dependency of ${e.name} at position ${s+1} conflicts with ${t.length} static arguments`);return new e(...t,...i)}},S1={trace:0,debug:1,info:2,warn:3,error:4,off:5},C1="xterm.js: ",Ca=class extends ue{constructor(e){super(),this._optionsService=e,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel()))}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=S1[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let t=0;t<e.length;t++)typeof e[t]=="function"&&(e[t]=e[t]())}_log(e,t,r){this._evalLazyOptionalParams(r),e.call(console,(this._optionsService.options.logger?"":C1)+t,...r)}trace(e,...t){var r;this._logLevel<=0&&this._log(((r=this._optionsService.options.logger)==null?void 0:r.trace.bind(this._optionsService.options.logger))??console.log,e,t)}debug(e,...t){var r;this._logLevel<=1&&this._log(((r=this._optionsService.options.logger)==null?void 0:r.debug.bind(this._optionsService.options.logger))??console.log,e,t)}info(e,...t){var r;this._logLevel<=2&&this._log(((r=this._optionsService.options.logger)==null?void 0:r.info.bind(this._optionsService.options.logger))??console.info,e,t)}warn(e,...t){var r;this._logLevel<=3&&this._log(((r=this._optionsService.options.logger)==null?void 0:r.warn.bind(this._optionsService.options.logger))??console.warn,e,t)}error(e,...t){var r;this._logLevel<=4&&this._log(((r=this._optionsService.options.logger)==null?void 0:r.error.bind(this._optionsService.options.logger))??console.error,e,t)}};Ca=Be([re(0,Ye)],Ca);var ef=class extends ue{constructor(e){super(),this._maxLength=e,this.onDeleteEmitter=this._register(new Z),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this._register(new Z),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this._register(new Z),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(e){if(this._maxLength===e)return;let t=new Array(e);for(let r=0;r<Math.min(e,this.length);r++)t[r]=this._array[this._getCyclicIndex(r)];this._array=t,this._maxLength=e,this._startIndex=0}get length(){return this._length}set length(e){if(e>this._length)for(let t=this._length;t<e;t++)this._array[t]=void 0;this._length=e}get(e){return this._array[this._getCyclicIndex(e)]}set(e,t){this._array[this._getCyclicIndex(e)]=t}push(e){this._array[this._getCyclicIndex(this._length)]=e,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(e,t,...r){if(t){for(let i=e;i<this._length-t;i++)this._array[this._getCyclicIndex(i)]=this._array[this._getCyclicIndex(i+t)];this._length-=t,this.onDeleteEmitter.fire({index:e,amount:t})}for(let i=this._length-1;i>=e;i--)this._array[this._getCyclicIndex(i+r.length)]=this._array[this._getCyclicIndex(i)];for(let i=0;i<r.length;i++)this._array[this._getCyclicIndex(e+i)]=r[i];if(r.length&&this.onInsertEmitter.fire({index:e,amount:r.length}),this._length+r.length>this._maxLength){let i=this._length+r.length-this._maxLength;this._startIndex+=i,this._length=this._maxLength,this.onTrimEmitter.fire(i)}else this._length+=r.length}trimStart(e){e>this._length&&(e=this._length),this._startIndex+=e,this._length-=e,this.onTrimEmitter.fire(e)}shiftElements(e,t,r){if(!(t<=0)){if(e<0||e>=this._length)throw new Error("start argument out of range");if(e+r<0)throw new Error("Cannot shift elements in list beyond index 0");if(r>0){for(let s=t-1;s>=0;s--)this.set(e+s+r,this.get(e+s));let i=e+t+r-this._length;if(i>0)for(this._length+=i;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let i=0;i<t;i++)this.set(e+i+r,this.get(e+i))}}_getCyclicIndex(e){return(this._startIndex+e)%this._maxLength}},fe=3,Me=Object.freeze(new Gr),_s=0,Ea=2,oi=class Uf{constructor(t,r,i=!1){this.isWrapped=i,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(t*fe);let s=r||dt.fromCharData([0,iu,1,0]);for(let n=0;n<t;++n)this.setCell(n,s);this.length=t}get(t){let r=this._data[t*fe+0],i=r&2097151;return[this._data[t*fe+1],r&2097152?this._combined[t]:i?Qt(i):"",r>>22,r&2097152?this._combined[t].charCodeAt(this._combined[t].length-1):i]}set(t,r){this._data[t*fe+1]=r[0],r[1].length>1?(this._combined[t]=r[1],this._data[t*fe+0]=t|2097152|r[2]<<22):this._data[t*fe+0]=r[1].charCodeAt(0)|r[2]<<22}getWidth(t){return this._data[t*fe+0]>>22}hasWidth(t){return this._data[t*fe+0]&12582912}getFg(t){return this._data[t*fe+1]}getBg(t){return this._data[t*fe+2]}hasContent(t){return this._data[t*fe+0]&4194303}getCodePoint(t){let r=this._data[t*fe+0];return r&2097152?this._combined[t].charCodeAt(this._combined[t].length-1):r&2097151}isCombined(t){return this._data[t*fe+0]&2097152}getString(t){let r=this._data[t*fe+0];return r&2097152?this._combined[t]:r&2097151?Qt(r&2097151):""}isProtected(t){return this._data[t*fe+2]&536870912}loadCell(t,r){return _s=t*fe,r.content=this._data[_s+0],r.fg=this._data[_s+1],r.bg=this._data[_s+2],r.content&2097152&&(r.combinedData=this._combined[t]),r.bg&268435456&&(r.extended=this._extendedAttrs[t]),r}setCell(t,r){r.content&2097152&&(this._combined[t]=r.combinedData),r.bg&268435456&&(this._extendedAttrs[t]=r.extended),this._data[t*fe+0]=r.content,this._data[t*fe+1]=r.fg,this._data[t*fe+2]=r.bg}setCellFromCodepoint(t,r,i,s){s.bg&268435456&&(this._extendedAttrs[t]=s.extended),this._data[t*fe+0]=r|i<<22,this._data[t*fe+1]=s.fg,this._data[t*fe+2]=s.bg}addCodepointToCell(t,r,i){let s=this._data[t*fe+0];s&2097152?this._combined[t]+=Qt(r):s&2097151?(this._combined[t]=Qt(s&2097151)+Qt(r),s&=-2097152,s|=2097152):s=r|1<<22,i&&(s&=-12582913,s|=i<<22),this._data[t*fe+0]=s}insertCells(t,r,i){if(t%=this.length,t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,i),r<this.length-t){let s=new dt;for(let n=this.length-t-r-1;n>=0;--n)this.setCell(t+r+n,this.loadCell(t+n,s));for(let n=0;n<r;++n)this.setCell(t+n,i)}else for(let s=t;s<this.length;++s)this.setCell(s,i);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,i)}deleteCells(t,r,i){if(t%=this.length,r<this.length-t){let s=new dt;for(let n=0;n<this.length-t-r;++n)this.setCell(t+n,this.loadCell(t+r+n,s));for(let n=this.length-r;n<this.length;++n)this.setCell(n,i)}else for(let s=t;s<this.length;++s)this.setCell(s,i);t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,i),this.getWidth(t)===0&&!this.hasContent(t)&&this.setCellFromCodepoint(t,0,1,i)}replaceCells(t,r,i,s=!1){if(s){for(t&&this.getWidth(t-1)===2&&!this.isProtected(t-1)&&this.setCellFromCodepoint(t-1,0,1,i),r<this.length&&this.getWidth(r-1)===2&&!this.isProtected(r)&&this.setCellFromCodepoint(r,0,1,i);t<r&&t<this.length;)this.isProtected(t)||this.setCell(t,i),t++;return}for(t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,i),r<this.length&&this.getWidth(r-1)===2&&this.setCellFromCodepoint(r,0,1,i);t<r&&t<this.length;)this.setCell(t++,i)}resize(t,r){if(t===this.length)return this._data.length*4*Ea<this._data.buffer.byteLength;let i=t*fe;if(t>this.length){if(this._data.buffer.byteLength>=i*4)this._data=new Uint32Array(this._data.buffer,0,i);else{let s=new Uint32Array(i);s.set(this._data),this._data=s}for(let s=this.length;s<t;++s)this.setCell(s,r)}else{this._data=this._data.subarray(0,i);let s=Object.keys(this._combined);for(let o=0;o<s.length;o++){let a=parseInt(s[o],10);a>=t&&delete this._combined[a]}let n=Object.keys(this._extendedAttrs);for(let o=0;o<n.length;o++){let a=parseInt(n[o],10);a>=t&&delete this._extendedAttrs[a]}}return this.length=t,i*4*Ea<this._data.buffer.byteLength}cleanupMemory(){if(this._data.length*4*Ea<this._data.buffer.byteLength){let t=new Uint32Array(this._data.length);return t.set(this._data),this._data=t,1}return 0}fill(t,r=!1){if(r){for(let i=0;i<this.length;++i)this.isProtected(i)||this.setCell(i,t);return}this._combined={},this._extendedAttrs={};for(let i=0;i<this.length;++i)this.setCell(i,t)}copyFrom(t){this.length!==t.length?this._data=new Uint32Array(t._data):this._data.set(t._data),this.length=t.length,this._combined={};for(let r in t._combined)this._combined[r]=t._combined[r];this._extendedAttrs={};for(let r in t._extendedAttrs)this._extendedAttrs[r]=t._extendedAttrs[r];this.isWrapped=t.isWrapped}clone(){let t=new Uf(0);t._data=new Uint32Array(this._data),t.length=this.length;for(let r in this._combined)t._combined[r]=this._combined[r];for(let r in this._extendedAttrs)t._extendedAttrs[r]=this._extendedAttrs[r];return t.isWrapped=this.isWrapped,t}getTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(this._data[t*fe+0]&4194303)return t+(this._data[t*fe+0]>>22);return 0}getNoBgTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(this._data[t*fe+0]&4194303||this._data[t*fe+2]&50331648)return t+(this._data[t*fe+0]>>22);return 0}copyCellsFrom(t,r,i,s,n){let o=t._data;if(n)for(let h=s-1;h>=0;h--){for(let l=0;l<fe;l++)this._data[(i+h)*fe+l]=o[(r+h)*fe+l];o[(r+h)*fe+2]&268435456&&(this._extendedAttrs[i+h]=t._extendedAttrs[r+h])}else for(let h=0;h<s;h++){for(let l=0;l<fe;l++)this._data[(i+h)*fe+l]=o[(r+h)*fe+l];o[(r+h)*fe+2]&268435456&&(this._extendedAttrs[i+h]=t._extendedAttrs[r+h])}let a=Object.keys(t._combined);for(let h=0;h<a.length;h++){let l=parseInt(a[h],10);l>=r&&(this._combined[l-r+i]=t._combined[l])}}translateToString(t,r,i,s){r=r??0,i=i??this.length,t&&(i=Math.min(i,this.getTrimmedLength())),s&&(s.length=0);let n="";for(;r<i;){let o=this._data[r*fe+0],a=o&2097151,h=o&2097152?this._combined[r]:a?Qt(a):er;if(n+=h,s)for(let l=0;l<h.length;++l)s.push(r);r+=o>>22||1}return s&&s.push(r),n}};function E1(e,t,r,i,s,n){let o=[];for(let a=0;a<e.length-1;a++){let h=a,l=e.get(++h);if(!l.isWrapped)continue;let c=[e.get(a)];for(;h<e.length&&l.isWrapped;)c.push(l),l=e.get(++h);if(!n&&i>=a&&i<h){a+=c.length-1;continue}let u=0,p=ai(c,u,t),_=1,m=0;for(;_<c.length;){let w=ai(c,_,t),y=w-m,E=r-p,S=Math.min(y,E);c[u].copyCellsFrom(c[_],m,p,S,!1),p+=S,p===r&&(u++,p=0),m+=S,m===w&&(_++,m=0),p===0&&u!==0&&c[u-1].getWidth(r-1)===2&&(c[u].copyCellsFrom(c[u-1],r-1,p++,1,!1),c[u-1].setCell(r-1,s))}c[u].replaceCells(p,r,s);let g=0;for(let w=c.length-1;w>0&&(w>u||c[w].getTrimmedLength()===0);w--)g++;g>0&&(o.push(a+c.length-g),o.push(g)),a+=c.length-1}return o}function x1(e,t){let r=[],i=0,s=t[i],n=0;for(let o=0;o<e.length;o++)if(s===o){let a=t[++i];e.onDeleteEmitter.fire({index:o-n,amount:a}),o+=a-1,n+=a,s=t[++i]}else r.push(o);return{layout:r,countRemoved:n}}function k1(e,t){let r=[];for(let i=0;i<t.length;i++)r.push(e.get(t[i]));for(let i=0;i<r.length;i++)e.set(i,r[i]);e.length=t.length}function B1(e,t,r){let i=[],s=e.map((h,l)=>ai(e,l,t)).reduce((h,l)=>h+l),n=0,o=0,a=0;for(;a<s;){if(s-a<r){i.push(s-a);break}n+=r;let h=ai(e,o,t);n>h&&(n-=h,o++);let l=e[o].getWidth(n-1)===2;l&&n--;let c=l?r-1:r;i.push(c),a+=c}return i}function ai(e,t,r){if(t===e.length-1)return e[t].getTrimmedLength();let i=!e[t].hasContent(r-1)&&e[t].getWidth(r-1)===1,s=e[t+1].getWidth(0)===2;return i&&s?r-1:r}var tf=class Hf{constructor(t){this.line=t,this.isDisposed=!1,this._disposables=[],this._id=Hf._nextId++,this._onDispose=this.register(new Z),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),dr(this._disposables),this._disposables.length=0)}register(t){return this._disposables.push(t),t}};tf._nextId=1;var R1=tf,Ne={},mr=Ne.B;Ne[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""},Ne.A={"#":""},Ne.B=void 0,Ne[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""},Ne.C=Ne[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},Ne.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},Ne.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},Ne.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},Ne.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""},Ne.E=Ne[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},Ne.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""},Ne.H=Ne[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},Ne["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""};var rf=4294967295,sf=class{constructor(e,t,r){this._hasScrollback=e,this._optionsService=t,this._bufferService=r,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=Me.clone(),this.savedCharset=mr,this.markers=[],this._nullCell=dt.fromCharData([0,iu,1,0]),this._whitespaceCell=dt.fromCharData([0,er,1,32]),this._isClearing=!1,this._memoryCleanupQueue=new ds,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new ef(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new Ji),this._nullCell}getWhitespaceCell(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new Ji),this._whitespaceCell}getBlankLine(e,t){return new oi(this._bufferService.cols,this.getNullCell(e),t)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}_getCorrectBufferLength(e){if(!this._hasScrollback)return e;let t=e+this._optionsService.rawOptions.scrollback;return t>rf?rf:t}fillViewportRows(e){if(this.lines.length===0){e===void 0&&(e=Me);let t=this._rows;for(;t--;)this.lines.push(this.getBlankLine(e))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new ef(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(e,t){let r=this.getNullCell(Me),i=0,s=this._getCorrectBufferLength(t);if(s>this.lines.maxLength&&(this.lines.maxLength=s),this.lines.length>0){if(this._cols<e)for(let o=0;o<this.lines.length;o++)i+=+this.lines.get(o).resize(e,r);let n=0;if(this._rows<t)for(let o=this._rows;o<t;o++)this.lines.length<t+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new oi(e,r)):this.ybase>0&&this.lines.length<=this.ybase+this.y+n+1?(this.ybase--,n++,this.ydisp>0&&this.ydisp--):this.lines.push(new oi(e,r)));else for(let o=this._rows;o>t;o--)this.lines.length>t+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(s<this.lines.maxLength){let o=this.lines.length-s;o>0&&(this.lines.trimStart(o),this.ybase=Math.max(this.ybase-o,0),this.ydisp=Math.max(this.ydisp-o,0),this.savedY=Math.max(this.savedY-o,0)),this.lines.maxLength=s}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,t-1),n&&(this.y+=n),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=t-1,this._isReflowEnabled&&(this._reflow(e,t),this._cols>e))for(let n=0;n<this.lines.length;n++)i+=+this.lines.get(n).resize(e,r);this._cols=e,this._rows=t,this._memoryCleanupQueue.clear(),i>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);let t=0;for(;this._memoryCleanupPosition<this.lines.length;)if(t+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),t>100)return!0;return e}get _isReflowEnabled(){let e=this._optionsService.rawOptions.windowsPty;return e&&e.buildNumber?this._hasScrollback&&e.backend==="conpty"&&e.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(e,t){this._cols!==e&&(e>this._cols?this._reflowLarger(e,t):this._reflowSmaller(e,t))}_reflowLarger(e,t){let r=this._optionsService.rawOptions.reflowCursorLine,i=E1(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(Me),r);if(i.length>0){let s=x1(this.lines,i);k1(this.lines,s.layout),this._reflowLargerAdjustViewport(e,t,s.countRemoved)}}_reflowLargerAdjustViewport(e,t,r){let i=this.getNullCell(Me),s=r;for(;s-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<t&&this.lines.push(new oi(e,i))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-r,0)}_reflowSmaller(e,t){let r=this._optionsService.rawOptions.reflowCursorLine,i=this.getNullCell(Me),s=[],n=0;for(let o=this.lines.length-1;o>=0;o--){let a=this.lines.get(o);if(!a||!a.isWrapped&&a.getTrimmedLength()<=e)continue;let h=[a];for(;a.isWrapped&&o>0;)a=this.lines.get(--o),h.unshift(a);if(!r){let S=this.ybase+this.y;if(S>=o&&S<o+h.length)continue}let l=h[h.length-1].getTrimmedLength(),c=B1(h,this._cols,e),u=c.length-h.length,p;this.ybase===0&&this.y!==this.lines.length-1?p=Math.max(0,this.y-this.lines.maxLength+u):p=Math.max(0,this.lines.length-this.lines.maxLength+u);let _=[];for(let S=0;S<u;S++){let v=this.getBlankLine(Me,!0);_.push(v)}_.length>0&&(s.push({start:o+h.length+n,newLines:_}),n+=_.length),h.push(..._);let m=c.length-1,g=c[m];g===0&&(m--,g=c[m]);let w=h.length-u-1,y=l;for(;w>=0;){let S=Math.min(y,g);if(h[m]===void 0)break;if(h[m].copyCellsFrom(h[w],y-S,g-S,S,!0),g-=S,g===0&&(m--,g=c[m]),y-=S,y===0){w--;let v=Math.max(w,0);y=ai(h,v,this._cols)}}for(let S=0;S<h.length;S++)c[S]<e&&h[S].setCell(c[S],i);let E=u-p;for(;E-- >0;)this.ybase===0?this.y<t-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+n)-t&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+u,this.ybase+t-1)}if(s.length>0){let o=[],a=[];for(let g=0;g<this.lines.length;g++)a.push(this.lines.get(g));let h=this.lines.length,l=h-1,c=0,u=s[c];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+n);let p=0;for(let g=Math.min(this.lines.maxLength-1,h+n-1);g>=0;g--)if(u&&u.start>l+p){for(let w=u.newLines.length-1;w>=0;w--)this.lines.set(g--,u.newLines[w]);g++,o.push({index:l+1,amount:u.newLines.length}),p+=u.newLines.length,u=s[++c]}else this.lines.set(g,a[l--]);let _=0;for(let g=o.length-1;g>=0;g--)o[g].index+=_,this.lines.onInsertEmitter.fire(o[g]),_+=o[g].amount;let m=Math.max(0,h+n-this.lines.maxLength);m>0&&this.lines.onTrimEmitter.fire(m)}}translateBufferLineToString(e,t,r=0,i){let s=this.lines.get(e);return s?s.translateToString(t,r,i):""}getWrappedRangeForLine(e){let t=e,r=e;for(;t>0&&this.lines.get(t).isWrapped;)t--;for(;r+1<this.lines.length&&this.lines.get(r+1).isWrapped;)r++;return{first:t,last:r}}setupTabStops(e){for(e!=null?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}prevStop(e){for(e==null&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}nextStop(e){for(e==null&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}clearMarkers(e){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].line===e&&(this.markers[t].dispose(),this.markers.splice(t--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].dispose();this.markers.length=0,this._isClearing=!1}addMarker(e){let t=new R1(e);return this.markers.push(t),t.register(this.lines.onTrim(r=>{t.line-=r,t.line<0&&t.dispose()})),t.register(this.lines.onInsert(r=>{t.line>=r.index&&(t.line+=r.amount)})),t.register(this.lines.onDelete(r=>{t.line>=r.index&&t.line<r.index+r.amount&&t.dispose(),t.line>r.index&&(t.line-=r.amount)})),t.register(t.onDispose(()=>this._removeMarker(t))),t}_removeMarker(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}},A1=class extends ue{constructor(e,t){super(),this._optionsService=e,this._bufferService=t,this._onBufferActivate=this._register(new Z),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this._register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this._register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new sf(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new sf(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(e){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(e),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(e,t){this._normal.resize(e,t),this._alt.resize(e,t),this.setupTabStops(e)}setupTabStops(e){this._normal.setupTabStops(e),this._alt.setupTabStops(e)}},nf=2,of=1,xa=class extends ue{constructor(e){super(),this.isUserScrolling=!1,this._onResize=this._register(new Z),this.onResize=this._onResize.event,this._onScroll=this._register(new Z),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,nf),this.rows=Math.max(e.rawOptions.rows||0,of),this.buffers=this._register(new A1(e,this)),this._register(this.buffers.onBufferActivate(t=>{this._onScroll.fire(t.activeBuffer.ydisp)}))}get buffer(){return this.buffers.active}resize(e,t){let r=this.cols!==e,i=this.rows!==t;this.cols=e,this.rows=t,this.buffers.resize(e,t),this._onResize.fire({cols:e,rows:t,colsChanged:r,rowsChanged:i})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,t=!1){let r=this.buffer,i;i=this._cachedBlankLine,(!i||i.length!==this.cols||i.getFg(0)!==e.fg||i.getBg(0)!==e.bg)&&(i=r.getBlankLine(e,t),this._cachedBlankLine=i),i.isWrapped=t;let s=r.ybase+r.scrollTop,n=r.ybase+r.scrollBottom;if(r.scrollTop===0){let o=r.lines.isFull;n===r.lines.length-1?o?r.lines.recycle().copyFrom(i):r.lines.push(i.clone()):r.lines.splice(n+1,0,i.clone()),o?this.isUserScrolling&&(r.ydisp=Math.max(r.ydisp-1,0)):(r.ybase++,this.isUserScrolling||r.ydisp++)}else{let o=n-s+1;r.lines.shiftElements(s+1,o-1,-1),r.lines.set(n,i.clone())}this.isUserScrolling||(r.ydisp=r.ybase),this._onScroll.fire(r.ydisp)}scrollLines(e,t){let r=this.buffer;if(e<0){if(r.ydisp===0)return;this.isUserScrolling=!0}else e+r.ydisp>=r.ybase&&(this.isUserScrolling=!1);let i=r.ydisp;r.ydisp=Math.max(Math.min(r.ydisp+e,r.ybase),0),i!==r.ydisp&&(t||this._onScroll.fire(r.ydisp))}};xa=Be([re(0,Ye)],xa);var Hr={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnEraseInDisplay:!1,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},reflowCursorLine:!1,rescaleOverlappingGlyphs:!1,rightClickSelectsWord:fs,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRuler:{}},D1=["normal","bold","100","200","300","400","500","600","700","800","900"],T1=class extends ue{constructor(e){super(),this._onOptionChange=this._register(new Z),this.onOptionChange=this._onOptionChange.event;let t={...Hr};for(let r in e)if(r in t)try{let i=e[r];t[r]=this._sanitizeAndValidateOption(r,i)}catch(i){console.error(i)}this.rawOptions=t,this.options={...t},this._setupOptions(),this._register(Se(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(e,t){return this.onOptionChange(r=>{r===e&&t(this.rawOptions[e])})}onMultipleOptionChange(e,t){return this.onOptionChange(r=>{e.indexOf(r)!==-1&&t()})}_setupOptions(){let e=r=>{if(!(r in Hr))throw new Error(`No option with key "${r}"`);return this.rawOptions[r]},t=(r,i)=>{if(!(r in Hr))throw new Error(`No option with key "${r}"`);i=this._sanitizeAndValidateOption(r,i),this.rawOptions[r]!==i&&(this.rawOptions[r]=i,this._onOptionChange.fire(r))};for(let r in this.rawOptions){let i={get:e.bind(this,r),set:t.bind(this,r)};Object.defineProperty(this.options,r,i)}}_sanitizeAndValidateOption(e,t){switch(e){case"cursorStyle":if(t||(t=Hr[e]),!L1(t))throw new Error(`"${t}" is not a valid value for ${e}`);break;case"wordSeparator":t||(t=Hr[e]);break;case"fontWeight":case"fontWeightBold":if(typeof t=="number"&&1<=t&&t<=1e3)break;t=D1.includes(t)?t:Hr[e];break;case"cursorWidth":t=Math.floor(t);case"lineHeight":case"tabStopWidth":if(t<1)throw new Error(`${e} cannot be less than 1, value: ${t}`);break;case"minimumContrastRatio":t=Math.max(1,Math.min(21,Math.round(t*10)/10));break;case"scrollback":if(t=Math.min(t,4294967295),t<0)throw new Error(`${e} cannot be less than 0, value: ${t}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(t<=0)throw new Error(`${e} cannot be less than or equal to 0, value: ${t}`);break;case"rows":case"cols":if(!t&&t!==0)throw new Error(`${e} must be numeric, value: ${t}`);break;case"windowsPty":t=t??{};break}return t}};function L1(e){return e==="block"||e==="underline"||e==="bar"}function li(e,t=5){if(typeof e!="object")return e;let r=Array.isArray(e)?[]:{};for(let i in e)r[i]=t<=1?e[i]:e[i]&&li(e[i],t-1);return r}var af=Object.freeze({insertMode:!1}),lf=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,cursorBlink:void 0,cursorStyle:void 0,origin:!1,reverseWraparound:!1,sendFocus:!1,synchronizedOutput:!1,wraparound:!0}),ka=class extends ue{constructor(e,t,r){super(),this._bufferService=e,this._logService=t,this._optionsService=r,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this._register(new Z),this.onData=this._onData.event,this._onUserInput=this._register(new Z),this.onUserInput=this._onUserInput.event,this._onBinary=this._register(new Z),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this._register(new Z),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=li(af),this.decPrivateModes=li(lf)}reset(){this.modes=li(af),this.decPrivateModes=li(lf)}triggerDataEvent(e,t=!1){if(this._optionsService.rawOptions.disableStdin)return;let r=this._bufferService.buffer;t&&this._optionsService.rawOptions.scrollOnUserInput&&r.ybase!==r.ydisp&&this._onRequestScrollToBottom.fire(),t&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`),this._logService.trace("sending data (codes)",()=>e.split("").map(i=>i.charCodeAt(0))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`),this._logService.trace("sending binary (codes)",()=>e.split("").map(t=>t.charCodeAt(0))),this._onBinary.fire(e))}};ka=Be([re(0,Ge),re(1,ou),re(2,Ye)],ka);var hf={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:e=>e.button===4||e.action!==1?!1:(e.ctrl=!1,e.alt=!1,e.shift=!1,!0)},VT200:{events:19,restrict:e=>e.action!==32},DRAG:{events:23,restrict:e=>!(e.action===32&&e.button===3)},ANY:{events:31,restrict:e=>!0}};function Ba(e,t){let r=(e.ctrl?16:0)|(e.shift?4:0)|(e.alt?8:0);return e.button===4?(r|=64,r|=e.action):(r|=e.button&3,e.button&4&&(r|=64),e.button&8&&(r|=128),e.action===32?r|=32:e.action===0&&!t&&(r|=3)),r}var Ra=String.fromCharCode,cf={DEFAULT:e=>{let t=[Ba(e,!1)+32,e.col+32,e.row+32];return t[0]>255||t[1]>255||t[2]>255?"":`\x1B[M${Ra(t[0])}${Ra(t[1])}${Ra(t[2])}`},SGR:e=>{let t=e.action===0&&e.button!==4?"m":"M";return`\x1B[<${Ba(e,!0)};${e.col};${e.row}${t}`},SGR_PIXELS:e=>{let t=e.action===0&&e.button!==4?"m":"M";return`\x1B[<${Ba(e,!0)};${e.x};${e.y}${t}`}},Aa=class extends ue{constructor(e,t,r){super(),this._bufferService=e,this._coreService=t,this._optionsService=r,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._wheelPartialScroll=0,this._onProtocolChange=this._register(new Z),this.onProtocolChange=this._onProtocolChange.event;for(let i of Object.keys(hf))this.addProtocol(i,hf[i]);for(let i of Object.keys(cf))this.addEncoding(i,cf[i]);this.reset()}addProtocol(e,t){this._protocols[e]=t}addEncoding(e,t){this._encodings[e]=t}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(e){if(!this._protocols[e])throw new Error(`unknown protocol "${e}"`);this._activeProtocol=e,this._onProtocolChange.fire(this._protocols[e].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(e){if(!this._encodings[e])throw new Error(`unknown encoding "${e}"`);this._activeEncoding=e}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null,this._wheelPartialScroll=0}consumeWheelEvent(e,t,r){if(e.deltaY===0||e.shiftKey||t===void 0||r===void 0)return 0;let i=t/r,s=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(s/=i+0,Math.abs(e.deltaY)<50&&(s*=.3),this._wheelPartialScroll+=s,s=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(s*=this._bufferService.rows),s}_applyScrollModifier(e,t){return t.altKey||t.ctrlKey||t.shiftKey?e*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:e*this._optionsService.rawOptions.scrollSensitivity}triggerMouseEvent(e){if(e.col<0||e.col>=this._bufferService.cols||e.row<0||e.row>=this._bufferService.rows||e.button===4&&e.action===32||e.button===3&&e.action!==32||e.button!==4&&(e.action===2||e.action===3)||(e.col++,e.row++,e.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,e,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(e))return!1;let t=this._encodings[this._activeEncoding](e);return t&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(t):this._coreService.triggerDataEvent(t,!0)),this._lastEvent=e,!0}explainEvents(e){return{down:!!(e&1),up:!!(e&2),drag:!!(e&4),move:!!(e&8),wheel:!!(e&16)}}_equalEvents(e,t,r){if(r){if(e.x!==t.x||e.y!==t.y)return!1}else if(e.col!==t.col||e.row!==t.row)return!1;return!(e.button!==t.button||e.action!==t.action||e.ctrl!==t.ctrl||e.alt!==t.alt||e.shift!==t.shift)}};Aa=Be([re(0,Ge),re(1,fr),re(2,Ye)],Aa);var Da=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],P1=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],Fe;function M1(e,t){let r=0,i=t.length-1,s;if(e<t[0][0]||e>t[i][1])return!1;for(;i>=r;)if(s=r+i>>1,e>t[s][1])r=s+1;else if(e<t[s][0])i=s-1;else return!0;return!1}var O1=class{constructor(){if(this.version="6",!Fe){Fe=new Uint8Array(65536),Fe.fill(1),Fe[0]=0,Fe.fill(0,1,32),Fe.fill(0,127,160),Fe.fill(2,4352,4448),Fe[9001]=2,Fe[9002]=2,Fe.fill(2,11904,42192),Fe[12351]=1,Fe.fill(2,44032,55204),Fe.fill(2,63744,64256),Fe.fill(2,65040,65050),Fe.fill(2,65072,65136),Fe.fill(2,65280,65377),Fe.fill(2,65504,65511);for(let e=0;e<Da.length;++e)Fe.fill(0,Da[e][0],Da[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?Fe[e]:M1(e,P1)?0:e>=131072&&e<=196605||e>=196608&&e<=262141?2:1}charProperties(e,t){let r=this.wcwidth(e),i=r===0&&t!==0;if(i){let s=yr.extractWidth(t);s===0?i=!1:s>r&&(r=s)}return yr.createPropertyValue(0,r,i)}},yr=class vs{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new Z,this.onChange=this._onChange.event;let t=new O1;this.register(t),this._active=t.version,this._activeProvider=t}static extractShouldJoin(t){return(t&1)!==0}static extractWidth(t){return t>>1&3}static extractCharKind(t){return t>>3}static createPropertyValue(t,r,i=!1){return(t&16777215)<<3|(r&3)<<1|(i?1:0)}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(t){if(!this._providers[t])throw new Error(`unknown Unicode version "${t}"`);this._active=t,this._activeProvider=this._providers[t],this._onChange.fire(t)}register(t){this._providers[t.version]=t}wcwidth(t){return this._activeProvider.wcwidth(t)}getStringCellWidth(t){let r=0,i=0,s=t.length;for(let n=0;n<s;++n){let o=t.charCodeAt(n);if(55296<=o&&o<=56319){if(++n>=s)return r+this.wcwidth(o);let l=t.charCodeAt(n);56320<=l&&l<=57343?o=(o-55296)*1024+l-56320+65536:r+=this.wcwidth(l)}let a=this.charProperties(o,i),h=vs.extractWidth(a);vs.extractShouldJoin(a)&&(h-=vs.extractWidth(i)),r+=h,i=a}return r}charProperties(t,r){return this._activeProvider.charProperties(t,r)}},I1=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(e){this.glevel=e,this.charset=this._charsets[e]}setgCharset(e,t){this._charsets[e]=t,this.glevel===e&&(this.charset=t)}};function uf(e){var i;let t=(i=e.buffer.lines.get(e.buffer.ybase+e.buffer.y-1))==null?void 0:i.get(e.cols-1),r=e.buffer.lines.get(e.buffer.ybase+e.buffer.y);r&&t&&(r.isWrapped=t[3]!==0&&t[3]!==32)}var hi=2147483647,N1=256,ff=class za{constructor(t=32,r=32){if(this.maxLength=t,this.maxSubParamsLength=r,r>N1)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(t),this.length=0,this._subParams=new Int32Array(r),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(t),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(t){let r=new za;if(!t.length)return r;for(let i=Array.isArray(t[0])?1:0;i<t.length;++i){let s=t[i];if(Array.isArray(s))for(let n=0;n<s.length;++n)r.addSubParam(s[n]);else r.addParam(s)}return r}clone(){let t=new za(this.maxLength,this.maxSubParamsLength);return t.params.set(this.params),t.length=this.length,t._subParams.set(this._subParams),t._subParamsLength=this._subParamsLength,t._subParamsIdx.set(this._subParamsIdx),t._rejectDigits=this._rejectDigits,t._rejectSubDigits=this._rejectSubDigits,t._digitIsSub=this._digitIsSub,t}toArray(){let t=[];for(let r=0;r<this.length;++r){t.push(this.params[r]);let i=this._subParamsIdx[r]>>8,s=this._subParamsIdx[r]&255;s-i>0&&t.push(Array.prototype.slice.call(this._subParams,i,s))}return t}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(t){if(this._digitIsSub=!1,this.length>=this.maxLength){this._rejectDigits=!0;return}if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=t>hi?hi:t}addSubParam(t){if(this._digitIsSub=!0,!!this.length){if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength){this._rejectSubDigits=!0;return}if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=t>hi?hi:t,this._subParamsIdx[this.length-1]++}}hasSubParams(t){return(this._subParamsIdx[t]&255)-(this._subParamsIdx[t]>>8)>0}getSubParams(t){let r=this._subParamsIdx[t]>>8,i=this._subParamsIdx[t]&255;return i-r>0?this._subParams.subarray(r,i):null}getSubParamsAll(){let t={};for(let r=0;r<this.length;++r){let i=this._subParamsIdx[r]>>8,s=this._subParamsIdx[r]&255;s-i>0&&(t[r]=this._subParams.slice(i,s))}return t}addDigit(t){let r;if(this._rejectDigits||!(r=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let i=this._digitIsSub?this._subParams:this.params,s=i[r-1];i[r-1]=~s?Math.min(s*10+t,hi):t}},ci=[],F1=class{constructor(){this._state=0,this._active=ci,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(e,t){this._handlers[e]===void 0&&(this._handlers[e]=[]);let r=this._handlers[e];return r.push(t),{dispose:()=>{let i=r.indexOf(t);i!==-1&&r.splice(i,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=ci}reset(){if(this._state===2)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].end(!1);this._stack.paused=!1,this._active=ci,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||ci,!this._active.length)this._handlerFb(this._id,"START");else for(let e=this._active.length-1;e>=0;e--)this._active[e].start()}_put(e,t,r){if(!this._active.length)this._handlerFb(this._id,"PUT",Xi(e,t,r));else for(let i=this._active.length-1;i>=0;i--)this._active[i].put(e,t,r)}start(){this.reset(),this._state=1}put(e,t,r){if(this._state!==3){if(this._state===1)for(;t<r;){let i=e[t++];if(i===59){this._state=2,this._start();break}if(i<48||57<i){this._state=3;return}this._id===-1&&(this._id=0),this._id=this._id*10+i-48}this._state===2&&r-t>0&&this._put(e,t,r)}}end(e,t=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),!this._active.length)this._handlerFb(this._id,"END",e);else{let r=!1,i=this._active.length-1,s=!1;if(this._stack.paused&&(i=this._stack.loopPosition-1,r=t,s=this._stack.fallThrough,this._stack.paused=!1),!s&&r===!1){for(;i>=0&&(r=this._active[i].end(e),r!==!0);i--)if(r instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!1,r;i--}for(;i>=0;i--)if(r=this._active[i].end(!1),r instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!0,r}this._active=ci,this._id=-1,this._state=0}}},at=class{constructor(e){this._handler=e,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(e,t,r){this._hitLimit||(this._data+=Xi(e,t,r),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}end(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data),t instanceof Promise))return t.then(r=>(this._data="",this._hitLimit=!1,r));return this._data="",this._hitLimit=!1,t}},ui=[],U1=class{constructor(){this._handlers=Object.create(null),this._active=ui,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=ui}registerHandler(e,t){this._handlers[e]===void 0&&(this._handlers[e]=[]);let r=this._handlers[e];return r.push(t),{dispose:()=>{let i=r.indexOf(t);i!==-1&&r.splice(i,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}reset(){if(this._active.length)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].unhook(!1);this._stack.paused=!1,this._active=ui,this._ident=0}hook(e,t){if(this.reset(),this._ident=e,this._active=this._handlers[e]||ui,!this._active.length)this._handlerFb(this._ident,"HOOK",t);else for(let r=this._active.length-1;r>=0;r--)this._active[r].hook(t)}put(e,t,r){if(!this._active.length)this._handlerFb(this._ident,"PUT",Xi(e,t,r));else for(let i=this._active.length-1;i>=0;i--)this._active[i].put(e,t,r)}unhook(e,t=!0){if(!this._active.length)this._handlerFb(this._ident,"UNHOOK",e);else{let r=!1,i=this._active.length-1,s=!1;if(this._stack.paused&&(i=this._stack.loopPosition-1,r=t,s=this._stack.fallThrough,this._stack.paused=!1),!s&&r===!1){for(;i>=0&&(r=this._active[i].unhook(e),r!==!0);i--)if(r instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!1,r;i--}for(;i>=0;i--)if(r=this._active[i].unhook(!1),r instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!0,r}this._active=ui,this._ident=0}},fi=new ff;fi.addParam(0);var df=class{constructor(e){this._handler=e,this._data="",this._params=fi,this._hitLimit=!1}hook(e){this._params=e.length>1||e.params[0]?e.clone():fi,this._data="",this._hitLimit=!1}put(e,t,r){this._hitLimit||(this._data+=Xi(e,t,r),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}unhook(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data,this._params),t instanceof Promise))return t.then(r=>(this._params=fi,this._data="",this._hitLimit=!1,r));return this._params=fi,this._data="",this._hitLimit=!1,t}},H1=class{constructor(e){this.table=new Uint8Array(e)}setDefault(e,t){this.table.fill(e<<4|t)}add(e,t,r,i){this.table[t<<8|e]=r<<4|i}addMany(e,t,r,i){for(let s=0;s<e.length;s++)this.table[t<<8|e[s]]=r<<4|i}},_t=160,W1=function(){let e=new H1(4095),t=Array.apply(null,Array(256)).map((a,h)=>h),r=(a,h)=>t.slice(a,h),i=r(32,127),s=r(0,24);s.push(25),s.push.apply(s,r(28,32));let n=r(0,14),o;e.setDefault(1,0),e.addMany(i,0,2,0);for(o in n)e.addMany([24,26,153,154],o,3,0),e.addMany(r(128,144),o,3,0),e.addMany(r(144,152),o,3,0),e.add(156,o,0,0),e.add(27,o,11,1),e.add(157,o,4,8),e.addMany([152,158,159],o,0,7),e.add(155,o,11,3),e.add(144,o,11,9);return e.addMany(s,0,3,0),e.addMany(s,1,3,1),e.add(127,1,0,1),e.addMany(s,8,0,8),e.addMany(s,3,3,3),e.add(127,3,0,3),e.addMany(s,4,3,4),e.add(127,4,0,4),e.addMany(s,6,3,6),e.addMany(s,5,3,5),e.add(127,5,0,5),e.addMany(s,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(i,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(r(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(i,7,0,7),e.addMany(s,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(r(64,127),3,7,0),e.addMany(r(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(r(48,60),4,8,4),e.addMany(r(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(r(32,64),6,0,6),e.add(127,6,0,6),e.addMany(r(64,127),6,0,0),e.addMany(r(32,48),3,9,5),e.addMany(r(32,48),5,9,5),e.addMany(r(48,64),5,0,6),e.addMany(r(64,127),5,7,0),e.addMany(r(32,48),4,9,5),e.addMany(r(32,48),1,9,2),e.addMany(r(32,48),2,9,2),e.addMany(r(48,127),2,10,0),e.addMany(r(48,80),1,10,0),e.addMany(r(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(r(96,127),1,10,0),e.add(80,1,11,9),e.addMany(s,9,0,9),e.add(127,9,0,9),e.addMany(r(28,32),9,0,9),e.addMany(r(32,48),9,9,12),e.addMany(r(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(s,11,0,11),e.addMany(r(32,128),11,0,11),e.addMany(r(28,32),11,0,11),e.addMany(s,10,0,10),e.add(127,10,0,10),e.addMany(r(28,32),10,0,10),e.addMany(r(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(r(32,48),10,9,12),e.addMany(s,12,0,12),e.add(127,12,0,12),e.addMany(r(28,32),12,0,12),e.addMany(r(32,48),12,9,12),e.addMany(r(48,64),12,0,11),e.addMany(r(64,127),12,12,13),e.addMany(r(64,127),10,12,13),e.addMany(r(64,127),9,12,13),e.addMany(s,13,13,13),e.addMany(i,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(_t,0,2,0),e.add(_t,8,5,8),e.add(_t,6,0,6),e.add(_t,11,0,11),e.add(_t,13,13,13),e}(),z1=class extends ue{constructor(e=W1){super(),this._transitions=e,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new ff,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(t,r,i)=>{},this._executeHandlerFb=t=>{},this._csiHandlerFb=(t,r)=>{},this._escHandlerFb=t=>{},this._errorHandlerFb=t=>t,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this._register(Se(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this._register(new F1),this._dcsParser=this._register(new U1),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(e,t=[64,126]){let r=0;if(e.prefix){if(e.prefix.length>1)throw new Error("only one byte as prefix supported");if(r=e.prefix.charCodeAt(0),r&&60>r||r>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(e.intermediates){if(e.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let s=0;s<e.intermediates.length;++s){let n=e.intermediates.charCodeAt(s);if(32>n||n>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");r<<=8,r|=n}}if(e.final.length!==1)throw new Error("final must be a single byte");let i=e.final.charCodeAt(0);if(t[0]>i||i>t[1])throw new Error(`final must be in range ${t[0]} .. ${t[1]}`);return r<<=8,r|=i,r}identToString(e){let t=[];for(;e;)t.push(String.fromCharCode(e&255)),e>>=8;return t.reverse().join("")}setPrintHandler(e){this._printHandler=e}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(e,t){let r=this._identifier(e,[48,126]);this._escHandlers[r]===void 0&&(this._escHandlers[r]=[]);let i=this._escHandlers[r];return i.push(t),{dispose:()=>{let s=i.indexOf(t);s!==-1&&i.splice(s,1)}}}clearEscHandler(e){this._escHandlers[this._identifier(e,[48,126])]&&delete this._escHandlers[this._identifier(e,[48,126])]}setEscHandlerFallback(e){this._escHandlerFb=e}setExecuteHandler(e,t){this._executeHandlers[e.charCodeAt(0)]=t}clearExecuteHandler(e){this._executeHandlers[e.charCodeAt(0)]&&delete this._executeHandlers[e.charCodeAt(0)]}setExecuteHandlerFallback(e){this._executeHandlerFb=e}registerCsiHandler(e,t){let r=this._identifier(e);this._csiHandlers[r]===void 0&&(this._csiHandlers[r]=[]);let i=this._csiHandlers[r];return i.push(t),{dispose:()=>{let s=i.indexOf(t);s!==-1&&i.splice(s,1)}}}clearCsiHandler(e){this._csiHandlers[this._identifier(e)]&&delete this._csiHandlers[this._identifier(e)]}setCsiHandlerFallback(e){this._csiHandlerFb=e}registerDcsHandler(e,t){return this._dcsParser.registerHandler(this._identifier(e),t)}clearDcsHandler(e){this._dcsParser.clearHandler(this._identifier(e))}setDcsHandlerFallback(e){this._dcsParser.setHandlerFallback(e)}registerOscHandler(e,t){return this._oscParser.registerHandler(e,t)}clearOscHandler(e){this._oscParser.clearHandler(e)}setOscHandlerFallback(e){this._oscParser.setHandlerFallback(e)}setErrorHandler(e){this._errorHandler=e}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(e,t,r,i,s){this._parseStack.state=e,this._parseStack.handlers=t,this._parseStack.handlerPos=r,this._parseStack.transition=i,this._parseStack.chunkPos=s}parse(e,t,r){let i=0,s=0,n=0,o;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,n=this._parseStack.chunkPos+1;else{if(r===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let a=this._parseStack.handlers,h=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(r===!1&&h>-1){for(;h>=0&&(o=a[h](this._params),o!==!0);h--)if(o instanceof Promise)return this._parseStack.handlerPos=h,o}this._parseStack.handlers=[];break;case 4:if(r===!1&&h>-1){for(;h>=0&&(o=a[h](),o!==!0);h--)if(o instanceof Promise)return this._parseStack.handlerPos=h,o}this._parseStack.handlers=[];break;case 6:if(i=e[this._parseStack.chunkPos],o=this._dcsParser.unhook(i!==24&&i!==26,r),o)return o;i===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(i=e[this._parseStack.chunkPos],o=this._oscParser.end(i!==24&&i!==26,r),o)return o;i===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break}this._parseStack.state=0,n=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=this._parseStack.transition&15}for(let a=n;a<t;++a){switch(i=e[a],s=this._transitions.table[this.currentState<<8|(i<160?i:_t)],s>>4){case 2:for(let p=a+1;;++p){if(p>=t||(i=e[p])<32||i>126&&i<_t){this._printHandler(e,a,p),a=p-1;break}if(++p>=t||(i=e[p])<32||i>126&&i<_t){this._printHandler(e,a,p),a=p-1;break}if(++p>=t||(i=e[p])<32||i>126&&i<_t){this._printHandler(e,a,p),a=p-1;break}if(++p>=t||(i=e[p])<32||i>126&&i<_t){this._printHandler(e,a,p),a=p-1;break}}break;case 3:this._executeHandlers[i]?this._executeHandlers[i]():this._executeHandlerFb(i),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:a,code:i,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let h=this._csiHandlers[this._collect<<8|i],l=h?h.length-1:-1;for(;l>=0&&(o=h[l](this._params),o!==!0);l--)if(o instanceof Promise)return this._preserveStack(3,h,l,s,a),o;l<0&&this._csiHandlerFb(this._collect<<8|i,this._params),this.precedingJoinState=0;break;case 8:do switch(i){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(i-48)}while(++a<t&&(i=e[a])>47&&i<60);a--;break;case 9:this._collect<<=8,this._collect|=i;break;case 10:let c=this._escHandlers[this._collect<<8|i],u=c?c.length-1:-1;for(;u>=0&&(o=c[u](),o!==!0);u--)if(o instanceof Promise)return this._preserveStack(4,c,u,s,a),o;u<0&&this._escHandlerFb(this._collect<<8|i),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|i,this._params);break;case 13:for(let p=a+1;;++p)if(p>=t||(i=e[p])===24||i===26||i===27||i>127&&i<_t){this._dcsParser.put(e,a,p),a=p-1;break}break;case 14:if(o=this._dcsParser.unhook(i!==24&&i!==26),o)return this._preserveStack(6,[],0,s,a),o;i===27&&(s|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let p=a+1;;p++)if(p>=t||(i=e[p])<32||i>127&&i<_t){this._oscParser.put(e,a,p),a=p-1;break}break;case 6:if(o=this._oscParser.end(i!==24&&i!==26),o)return this._preserveStack(5,[],0,s,a),o;i===27&&(s|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break}this.currentState=s&15}}},q1=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,j1=/^[\da-f]+$/;function pf(e){if(!e)return;let t=e.toLowerCase();if(t.indexOf("rgb:")===0){t=t.slice(4);let r=q1.exec(t);if(r){let i=r[1]?15:r[4]?255:r[7]?4095:65535;return[Math.round(parseInt(r[1]||r[4]||r[7]||r[10],16)/i*255),Math.round(parseInt(r[2]||r[5]||r[8]||r[11],16)/i*255),Math.round(parseInt(r[3]||r[6]||r[9]||r[12],16)/i*255)]}}else if(t.indexOf("#")===0&&(t=t.slice(1),j1.exec(t)&&[3,6,9,12].includes(t.length))){let r=t.length/3,i=[0,0,0];for(let s=0;s<3;++s){let n=parseInt(t.slice(r*s,r*s+r),16);i[s]=r===1?n<<4:r===2?n:r===3?n>>4:n>>8}return i}}function Ta(e,t){let r=e.toString(16),i=r.length<2?"0"+r:r;switch(t){case 4:return r[0];case 8:return i;case 12:return(i+i).slice(0,3);default:return i+i}}function $1(e,t=16){let[r,i,s]=e;return`rgb:${Ta(r,t)}/${Ta(i,t)}/${Ta(s,t)}`}var K1={"(":0,")":1,"*":2,"+":3,"-":1,".":2},sr=131072,_f=10;function gf(e,t){if(e>24)return t.setWinLines||!1;switch(e){case 1:return!!t.restoreWin;case 2:return!!t.minimizeWin;case 3:return!!t.setWinPosition;case 4:return!!t.setWinSizePixels;case 5:return!!t.raiseWin;case 6:return!!t.lowerWin;case 7:return!!t.refreshWin;case 8:return!!t.setWinSizeChars;case 9:return!!t.maximizeWin;case 10:return!!t.fullscreenWin;case 11:return!!t.getWinState;case 13:return!!t.getWinPosition;case 14:return!!t.getWinSizePixels;case 15:return!!t.getScreenSizePixels;case 16:return!!t.getCellSizePixels;case 18:return!!t.getWinSizeChars;case 19:return!!t.getScreenSizeChars;case 20:return!!t.getIconTitle;case 21:return!!t.getWinTitle;case 22:return!!t.pushTitle;case 23:return!!t.popTitle;case 24:return!!t.setWinLines}return!1}var vf=5e3,mf=0,V1=class extends ue{constructor(e,t,r,i,s,n,o,a,h=new z1){super(),this._bufferService=e,this._charsetService=t,this._coreService=r,this._logService=i,this._optionsService=s,this._oscLinkService=n,this._coreMouseService=o,this._unicodeService=a,this._parser=h,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new fg,this._utf8Decoder=new dg,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=Me.clone(),this._eraseAttrDataInternal=Me.clone(),this._onRequestBell=this._register(new Z),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this._register(new Z),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this._register(new Z),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this._register(new Z),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this._register(new Z),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this._register(new Z),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this._register(new Z),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this._register(new Z),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this._register(new Z),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this._register(new Z),this.onLineFeed=this._onLineFeed.event,this._onScroll=this._register(new Z),this.onScroll=this._onScroll.event,this._onTitleChange=this._register(new Z),this.onTitleChange=this._onTitleChange.event,this._onColor=this._register(new Z),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this._register(this._parser),this._dirtyRowTracker=new La(this._bufferService),this._activeBuffer=this._bufferService.buffer,this._register(this._bufferService.buffers.onBufferActivate(l=>this._activeBuffer=l.activeBuffer)),this._parser.setCsiHandlerFallback((l,c)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(l),params:c.toArray()})}),this._parser.setEscHandlerFallback(l=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(l)})}),this._parser.setExecuteHandlerFallback(l=>{this._logService.debug("Unknown EXECUTE code: ",{code:l})}),this._parser.setOscHandlerFallback((l,c,u)=>{this._logService.debug("Unknown OSC code: ",{identifier:l,action:c,data:u})}),this._parser.setDcsHandlerFallback((l,c,u)=>{c==="HOOK"&&(u=u.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(l),action:c,payload:u})}),this._parser.setPrintHandler((l,c,u)=>this.print(l,c,u)),this._parser.registerCsiHandler({final:"@"},l=>this.insertChars(l)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},l=>this.scrollLeft(l)),this._parser.registerCsiHandler({final:"A"},l=>this.cursorUp(l)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},l=>this.scrollRight(l)),this._parser.registerCsiHandler({final:"B"},l=>this.cursorDown(l)),this._parser.registerCsiHandler({final:"C"},l=>this.cursorForward(l)),this._parser.registerCsiHandler({final:"D"},l=>this.cursorBackward(l)),this._parser.registerCsiHandler({final:"E"},l=>this.cursorNextLine(l)),this._parser.registerCsiHandler({final:"F"},l=>this.cursorPrecedingLine(l)),this._parser.registerCsiHandler({final:"G"},l=>this.cursorCharAbsolute(l)),this._parser.registerCsiHandler({final:"H"},l=>this.cursorPosition(l)),this._parser.registerCsiHandler({final:"I"},l=>this.cursorForwardTab(l)),this._parser.registerCsiHandler({final:"J"},l=>this.eraseInDisplay(l,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},l=>this.eraseInDisplay(l,!0)),this._parser.registerCsiHandler({final:"K"},l=>this.eraseInLine(l,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},l=>this.eraseInLine(l,!0)),this._parser.registerCsiHandler({final:"L"},l=>this.insertLines(l)),this._parser.registerCsiHandler({final:"M"},l=>this.deleteLines(l)),this._parser.registerCsiHandler({final:"P"},l=>this.deleteChars(l)),this._parser.registerCsiHandler({final:"S"},l=>this.scrollUp(l)),this._parser.registerCsiHandler({final:"T"},l=>this.scrollDown(l)),this._parser.registerCsiHandler({final:"X"},l=>this.eraseChars(l)),this._parser.registerCsiHandler({final:"Z"},l=>this.cursorBackwardTab(l)),this._parser.registerCsiHandler({final:"`"},l=>this.charPosAbsolute(l)),this._parser.registerCsiHandler({final:"a"},l=>this.hPositionRelative(l)),this._parser.registerCsiHandler({final:"b"},l=>this.repeatPrecedingCharacter(l)),this._parser.registerCsiHandler({final:"c"},l=>this.sendDeviceAttributesPrimary(l)),this._parser.registerCsiHandler({prefix:">",final:"c"},l=>this.sendDeviceAttributesSecondary(l)),this._parser.registerCsiHandler({final:"d"},l=>this.linePosAbsolute(l)),this._parser.registerCsiHandler({final:"e"},l=>this.vPositionRelative(l)),this._parser.registerCsiHandler({final:"f"},l=>this.hVPosition(l)),this._parser.registerCsiHandler({final:"g"},l=>this.tabClear(l)),this._parser.registerCsiHandler({final:"h"},l=>this.setMode(l)),this._parser.registerCsiHandler({prefix:"?",final:"h"},l=>this.setModePrivate(l)),this._parser.registerCsiHandler({final:"l"},l=>this.resetMode(l)),this._parser.registerCsiHandler({prefix:"?",final:"l"},l=>this.resetModePrivate(l)),this._parser.registerCsiHandler({final:"m"},l=>this.charAttributes(l)),this._parser.registerCsiHandler({final:"n"},l=>this.deviceStatus(l)),this._parser.registerCsiHandler({prefix:"?",final:"n"},l=>this.deviceStatusPrivate(l)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},l=>this.softReset(l)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},l=>this.setCursorStyle(l)),this._parser.registerCsiHandler({final:"r"},l=>this.setScrollRegion(l)),this._parser.registerCsiHandler({final:"s"},l=>this.saveCursor(l)),this._parser.registerCsiHandler({final:"t"},l=>this.windowOptions(l)),this._parser.registerCsiHandler({final:"u"},l=>this.restoreCursor(l)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},l=>this.insertColumns(l)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},l=>this.deleteColumns(l)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},l=>this.selectProtected(l)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},l=>this.requestMode(l,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},l=>this.requestMode(l,!1)),this._parser.setExecuteHandler(q.BEL,()=>this.bell()),this._parser.setExecuteHandler(q.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(q.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(q.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(q.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(q.BS,()=>this.backspace()),this._parser.setExecuteHandler(q.HT,()=>this.tab()),this._parser.setExecuteHandler(q.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(q.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(ns.IND,()=>this.index()),this._parser.setExecuteHandler(ns.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(ns.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new at(l=>(this.setTitle(l),this.setIconName(l),!0))),this._parser.registerOscHandler(1,new at(l=>this.setIconName(l))),this._parser.registerOscHandler(2,new at(l=>this.setTitle(l))),this._parser.registerOscHandler(4,new at(l=>this.setOrReportIndexedColor(l))),this._parser.registerOscHandler(8,new at(l=>this.setHyperlink(l))),this._parser.registerOscHandler(10,new at(l=>this.setOrReportFgColor(l))),this._parser.registerOscHandler(11,new at(l=>this.setOrReportBgColor(l))),this._parser.registerOscHandler(12,new at(l=>this.setOrReportCursorColor(l))),this._parser.registerOscHandler(104,new at(l=>this.restoreIndexedColor(l))),this._parser.registerOscHandler(110,new at(l=>this.restoreFgColor(l))),this._parser.registerOscHandler(111,new at(l=>this.restoreBgColor(l))),this._parser.registerOscHandler(112,new at(l=>this.restoreCursorColor(l))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let l in Ne)this._parser.registerEscHandler({intermediates:"(",final:l},()=>this.selectCharset("("+l)),this._parser.registerEscHandler({intermediates:")",final:l},()=>this.selectCharset(")"+l)),this._parser.registerEscHandler({intermediates:"*",final:l},()=>this.selectCharset("*"+l)),this._parser.registerEscHandler({intermediates:"+",final:l},()=>this.selectCharset("+"+l)),this._parser.registerEscHandler({intermediates:"-",final:l},()=>this.selectCharset("-"+l)),this._parser.registerEscHandler({intermediates:".",final:l},()=>this.selectCharset("."+l)),this._parser.registerEscHandler({intermediates:"/",final:l},()=>this.selectCharset("/"+l));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(l=>(this._logService.error("Parsing error: ",l),l)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new df((l,c)=>this.requestStatusString(l,c)))}getAttrData(){return this._curAttrData}_preserveStack(e,t,r,i){this._parseStack.paused=!0,this._parseStack.cursorStartX=e,this._parseStack.cursorStartY=t,this._parseStack.decodedLength=r,this._parseStack.position=i}_logSlowResolvingAsync(e){this._logService.logLevel<=3&&Promise.race([e,new Promise((t,r)=>setTimeout(()=>r("#SLOW_TIMEOUT"),vf))]).catch(t=>{if(t!=="#SLOW_TIMEOUT")throw t;console.warn(`async parser handler taking longer than ${vf} ms`)})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(e,t){let r,i=this._activeBuffer.x,s=this._activeBuffer.y,n=0,o=this._parseStack.paused;if(o){if(r=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,t))return this._logSlowResolvingAsync(r),r;i=this._parseStack.cursorStartX,s=this._parseStack.cursorStartY,this._parseStack.paused=!1,e.length>sr&&(n=this._parseStack.position+sr)}if(this._logService.logLevel<=1&&this._logService.debug(`parsing data ${typeof e=="string"?` "${e}"`:` "${Array.prototype.map.call(e,l=>String.fromCharCode(l)).join("")}"`}`),this._logService.logLevel===0&&this._logService.trace("parsing data (codes)",typeof e=="string"?e.split("").map(l=>l.charCodeAt(0)):e),this._parseBuffer.length<e.length&&this._parseBuffer.length<sr&&(this._parseBuffer=new Uint32Array(Math.min(e.length,sr))),o||this._dirtyRowTracker.clearRange(),e.length>sr)for(let l=n;l<e.length;l+=sr){let c=l+sr<e.length?l+sr:e.length,u=typeof e=="string"?this._stringDecoder.decode(e.substring(l,c),this._parseBuffer):this._utf8Decoder.decode(e.subarray(l,c),this._parseBuffer);if(r=this._parser.parse(this._parseBuffer,u))return this._preserveStack(i,s,u,l),this._logSlowResolvingAsync(r),r}else if(!o){let l=typeof e=="string"?this._stringDecoder.decode(e,this._parseBuffer):this._utf8Decoder.decode(e,this._parseBuffer);if(r=this._parser.parse(this._parseBuffer,l))return this._preserveStack(i,s,l,0),this._logSlowResolvingAsync(r),r}(this._activeBuffer.x!==i||this._activeBuffer.y!==s)&&this._onCursorMove.fire();let a=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),h=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);h<this._bufferService.rows&&this._onRequestRefreshRows.fire({start:Math.min(h,this._bufferService.rows-1),end:Math.min(a,this._bufferService.rows-1)})}print(e,t,r){let i,s,n=this._charsetService.charset,o=this._optionsService.rawOptions.screenReaderMode,a=this._bufferService.cols,h=this._coreService.decPrivateModes.wraparound,l=this._coreService.modes.insertMode,c=this._curAttrData,u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&r-t>0&&u.getWidth(this._activeBuffer.x-1)===2&&u.setCellFromCodepoint(this._activeBuffer.x-1,0,1,c);let p=this._parser.precedingJoinState;for(let _=t;_<r;++_){if(i=e[_],i<127&&n){let y=n[String.fromCharCode(i)];y&&(i=y.charCodeAt(0))}let m=this._unicodeService.charProperties(i,p);s=yr.extractWidth(m);let g=yr.extractShouldJoin(m),w=g?yr.extractWidth(p):0;if(p=m,o&&this._onA11yChar.fire(Qt(i)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+s-w>a){if(h){let y=u,E=this._activeBuffer.x-w;for(this._activeBuffer.x=w,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),w>0&&u instanceof oi&&u.copyCellsFrom(y,E,0,w,!1);E<a;)y.setCellFromCodepoint(E++,0,1,c)}else if(this._activeBuffer.x=a-1,s===2)continue}if(g&&this._activeBuffer.x){let y=u.getWidth(this._activeBuffer.x-1)?1:2;u.addCodepointToCell(this._activeBuffer.x-y,i,s);for(let E=s-w;--E>=0;)u.setCellFromCodepoint(this._activeBuffer.x++,0,0,c);continue}if(l&&(u.insertCells(this._activeBuffer.x,s-w,this._activeBuffer.getNullCell(c)),u.getWidth(a-1)===2&&u.setCellFromCodepoint(a-1,0,1,c)),u.setCellFromCodepoint(this._activeBuffer.x++,i,s,c),s>0)for(;--s;)u.setCellFromCodepoint(this._activeBuffer.x++,0,0,c)}this._parser.precedingJoinState=p,this._activeBuffer.x<a&&r-t>0&&u.getWidth(this._activeBuffer.x)===0&&!u.hasContent(this._activeBuffer.x)&&u.setCellFromCodepoint(this._activeBuffer.x,0,1,c),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(e,t){return e.final==="t"&&!e.prefix&&!e.intermediates?this._parser.registerCsiHandler(e,r=>gf(r.params[0],this._optionsService.rawOptions.windowOptions)?t(r):!0):this._parser.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._parser.registerDcsHandler(e,new df(t))}registerEscHandler(e,t){return this._parser.registerEscHandler(e,t)}registerOscHandler(e,t){return this._parser.registerOscHandler(e,new at(t))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var e;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&((e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))!=null&&e.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);t.hasWidth(this._activeBuffer.x)&&!t.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let e=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-e),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(e=this._bufferService.cols-1){this._activeBuffer.x=Math.min(e,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(e,t){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=e,this._activeBuffer.y=this._activeBuffer.scrollTop+t):(this._activeBuffer.x=e,this._activeBuffer.y=t),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(e,t){this._restrictCursor(),this._setCursor(this._activeBuffer.x+e,this._activeBuffer.y+t)}cursorUp(e){let t=this._activeBuffer.y-this._activeBuffer.scrollTop;return t>=0?this._moveCursor(0,-Math.min(t,e.params[0]||1)):this._moveCursor(0,-(e.params[0]||1)),!0}cursorDown(e){let t=this._activeBuffer.scrollBottom-this._activeBuffer.y;return t>=0?this._moveCursor(0,Math.min(t,e.params[0]||1)):this._moveCursor(0,e.params[0]||1),!0}cursorForward(e){return this._moveCursor(e.params[0]||1,0),!0}cursorBackward(e){return this._moveCursor(-(e.params[0]||1),0),!0}cursorNextLine(e){return this.cursorDown(e),this._activeBuffer.x=0,!0}cursorPrecedingLine(e){return this.cursorUp(e),this._activeBuffer.x=0,!0}cursorCharAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(e){return this._setCursor(e.length>=2?(e.params[1]||1)-1:0,(e.params[0]||1)-1),!0}charPosAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(e){return this._moveCursor(e.params[0]||1,0),!0}linePosAbsolute(e){return this._setCursor(this._activeBuffer.x,(e.params[0]||1)-1),!0}vPositionRelative(e){return this._moveCursor(0,e.params[0]||1),!0}hVPosition(e){return this.cursorPosition(e),!0}tabClear(e){let t=e.params[0];return t===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:t===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(e){let t=e.params[0];return t===1&&(this._curAttrData.bg|=536870912),(t===2||t===0)&&(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(e,t,r,i=!1,s=!1){let n=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);n.replaceCells(t,r,this._activeBuffer.getNullCell(this._eraseAttrData()),s),i&&(n.isWrapped=!1)}_resetBufferLine(e,t=!1){let r=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);r&&(r.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),t),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+e),r.isWrapped=!1)}eraseInDisplay(e,t=!1){var i;this._restrictCursor(this._bufferService.cols);let r;switch(e.params[0]){case 0:for(r=this._activeBuffer.y,this._dirtyRowTracker.markDirty(r),this._eraseInBufferLine(r++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,t);r<this._bufferService.rows;r++)this._resetBufferLine(r,t);this._dirtyRowTracker.markDirty(r);break;case 1:for(r=this._activeBuffer.y,this._dirtyRowTracker.markDirty(r),this._eraseInBufferLine(r,0,this._activeBuffer.x+1,!0,t),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(r+1).isWrapped=!1);r--;)this._resetBufferLine(r,t);this._dirtyRowTracker.markDirty(0);break;case 2:if(this._optionsService.rawOptions.scrollOnEraseInDisplay){for(r=this._bufferService.rows,this._dirtyRowTracker.markRangeDirty(0,r-1);r--&&!((i=this._activeBuffer.lines.get(this._activeBuffer.ybase+r))!=null&&i.getTrimmedLength()););for(;r>=0;r--)this._bufferService.scroll(this._eraseAttrData())}else{for(r=this._bufferService.rows,this._dirtyRowTracker.markDirty(r-1);r--;)this._resetBufferLine(r,t);this._dirtyRowTracker.markDirty(0)}break;case 3:let s=this._activeBuffer.lines.length-this._bufferService.rows;s>0&&(this._activeBuffer.lines.trimStart(s),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-s,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-s,0),this._onScroll.fire(0));break}return!0}eraseInLine(e,t=!1){switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,t);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,t);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,t);break}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let r=this._activeBuffer.ybase+this._activeBuffer.y,i=this._bufferService.rows-1-this._activeBuffer.scrollBottom,s=this._bufferService.rows-1+this._activeBuffer.ybase-i+1;for(;t--;)this._activeBuffer.lines.splice(s-1,1),this._activeBuffer.lines.splice(r,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let r=this._activeBuffer.ybase+this._activeBuffer.y,i;for(i=this._bufferService.rows-1-this._activeBuffer.scrollBottom,i=this._bufferService.rows-1+this._activeBuffer.ybase-i;t--;)this._activeBuffer.lines.splice(r,1),this._activeBuffer.lines.splice(i,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.insertCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.deleteCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(Me));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let r=this._activeBuffer.scrollTop;r<=this._activeBuffer.scrollBottom;++r){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+r);i.deleteCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let r=this._activeBuffer.scrollTop;r<=this._activeBuffer.scrollBottom;++r){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+r);i.insertCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let r=this._activeBuffer.scrollTop;r<=this._activeBuffer.scrollBottom;++r){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+r);i.insertCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let r=this._activeBuffer.scrollTop;r<=this._activeBuffer.scrollBottom;++r){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+r);i.deleteCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(e.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(e){let t=this._parser.precedingJoinState;if(!t)return!0;let r=e.params[0]||1,i=yr.extractWidth(t),s=this._activeBuffer.x-i,n=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(s),o=new Uint32Array(n.length*r),a=0;for(let l=0;l<n.length;){let c=n.codePointAt(l)||0;o[a++]=c,l+=c>65535?2:1}let h=a;for(let l=1;l<r;++l)o.copyWithin(h,0,a),h+=a;return this.print(o,0,h),!0}sendDeviceAttributesPrimary(e){return e.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(q.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(q.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(e){return e.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(q.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(q.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(e.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(q.ESC+"[>83;40003;0c")),!0}_is(e){return(this._optionsService.rawOptions.termName+"").indexOf(e)===0}setMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0;break}return!0}setModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,mr),this._charsetService.setgCharset(1,mr),this._charsetService.setgCharset(2,mr),this._charsetService.setgCharset(3,mr);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!0;break}return!0}resetMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1;break}return!0}resetModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),e.params[t]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!1,this._onRequestRefreshRows.fire(void 0);break}return!0}requestMode(e,t){(g=>(g[g.NOT_RECOGNIZED=0]="NOT_RECOGNIZED",g[g.SET=1]="SET",g[g.RESET=2]="RESET",g[g.PERMANENTLY_SET=3]="PERMANENTLY_SET",g[g.PERMANENTLY_RESET=4]="PERMANENTLY_RESET"))(void 0||(r={}));let i=this._coreService.decPrivateModes,{activeProtocol:s,activeEncoding:n}=this._coreMouseService,o=this._coreService,{buffers:a,cols:h}=this._bufferService,{active:l,alt:c}=a,u=this._optionsService.rawOptions,p=(g,w)=>(o.triggerDataEvent(`${q.ESC}[${t?"":"?"}${g};${w}$y`),!0),_=g=>g?1:2,m=e.params[0];return t?m===2?p(m,4):m===4?p(m,_(o.modes.insertMode)):m===12?p(m,3):m===20?p(m,_(u.convertEol)):p(m,0):m===1?p(m,_(i.applicationCursorKeys)):m===3?p(m,u.windowOptions.setWinLines?h===80?2:h===132?1:0:0):m===6?p(m,_(i.origin)):m===7?p(m,_(i.wraparound)):m===8?p(m,3):m===9?p(m,_(s==="X10")):m===12?p(m,_(u.cursorBlink)):m===25?p(m,_(!o.isCursorHidden)):m===45?p(m,_(i.reverseWraparound)):m===66?p(m,_(i.applicationKeypad)):m===67?p(m,4):m===1e3?p(m,_(s==="VT200")):m===1002?p(m,_(s==="DRAG")):m===1003?p(m,_(s==="ANY")):m===1004?p(m,_(i.sendFocus)):m===1005?p(m,4):m===1006?p(m,_(n==="SGR")):m===1015?p(m,4):m===1016?p(m,_(n==="SGR_PIXELS")):m===1048?p(m,1):m===47||m===1047||m===1049?p(m,_(l===c)):m===2004?p(m,_(i.bracketedPasteMode)):m===2026?p(m,_(i.synchronizedOutput)):p(m,0)}_updateAttrColor(e,t,r,i,s){return t===2?(e|=50331648,e&=-16777216,e|=Gr.fromColorRGB([r,i,s])):t===5&&(e&=-50331904,e|=33554432|r&255),e}_extractColor(e,t,r){let i=[0,0,-1,0,0,0],s=0,n=0;do{if(i[n+s]=e.params[t+n],e.hasSubParams(t+n)){let o=e.getSubParams(t+n),a=0;do i[1]===5&&(s=1),i[n+a+1+s]=o[a];while(++a<o.length&&a+n+1+s<i.length);break}if(i[1]===5&&n+s>=2||i[1]===2&&n+s>=5)break;i[1]&&(s=1)}while(++n+t<e.length&&n+s<i.length);for(let o=2;o<i.length;++o)i[o]===-1&&(i[o]=0);switch(i[0]){case 38:r.fg=this._updateAttrColor(r.fg,i[1],i[3],i[4],i[5]);break;case 48:r.bg=this._updateAttrColor(r.bg,i[1],i[3],i[4],i[5]);break;case 58:r.extended=r.extended.clone(),r.extended.underlineColor=this._updateAttrColor(r.extended.underlineColor,i[1],i[3],i[4],i[5])}return n}_processUnderline(e,t){t.extended=t.extended.clone(),(!~e||e>5)&&(e=1),t.extended.underlineStyle=e,t.fg|=268435456,e===0&&(t.fg&=-268435457),t.updateExtended()}_processSGR0(e){e.fg=Me.fg,e.bg=Me.bg,e.extended=e.extended.clone(),e.extended.underlineStyle=0,e.extended.underlineColor&=-67108864,e.updateExtended()}charAttributes(e){if(e.length===1&&e.params[0]===0)return this._processSGR0(this._curAttrData),!0;let t=e.length,r,i=this._curAttrData;for(let s=0;s<t;s++)r=e.params[s],r>=30&&r<=37?(i.fg&=-50331904,i.fg|=16777216|r-30):r>=40&&r<=47?(i.bg&=-50331904,i.bg|=16777216|r-40):r>=90&&r<=97?(i.fg&=-50331904,i.fg|=16777216|r-90|8):r>=100&&r<=107?(i.bg&=-50331904,i.bg|=16777216|r-100|8):r===0?this._processSGR0(i):r===1?i.fg|=134217728:r===3?i.bg|=67108864:r===4?(i.fg|=268435456,this._processUnderline(e.hasSubParams(s)?e.getSubParams(s)[0]:1,i)):r===5?i.fg|=536870912:r===7?i.fg|=67108864:r===8?i.fg|=1073741824:r===9?i.fg|=2147483648:r===2?i.bg|=134217728:r===21?this._processUnderline(2,i):r===22?(i.fg&=-134217729,i.bg&=-134217729):r===23?i.bg&=-67108865:r===24?(i.fg&=-268435457,this._processUnderline(0,i)):r===25?i.fg&=-536870913:r===27?i.fg&=-67108865:r===28?i.fg&=-1073741825:r===29?i.fg&=2147483647:r===39?(i.fg&=-67108864,i.fg|=Me.fg&16777215):r===49?(i.bg&=-67108864,i.bg|=Me.bg&16777215):r===38||r===48||r===58?s+=this._extractColor(e,s,i):r===53?i.bg|=1073741824:r===55?i.bg&=-1073741825:r===59?(i.extended=i.extended.clone(),i.extended.underlineColor=-1,i.updateExtended()):r===100?(i.fg&=-67108864,i.fg|=Me.fg&16777215,i.bg&=-67108864,i.bg|=Me.bg&16777215):this._logService.debug("Unknown SGR attribute: %d.",r);return!0}deviceStatus(e){switch(e.params[0]){case 5:this._coreService.triggerDataEvent(`${q.ESC}[0n`);break;case 6:let t=this._activeBuffer.y+1,r=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${q.ESC}[${t};${r}R`);break}return!0}deviceStatusPrivate(e){switch(e.params[0]){case 6:let t=this._activeBuffer.y+1,r=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${q.ESC}[?${t};${r}R`);break}return!0}softReset(e){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=Me.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(e){let t=e.length===0?1:e.params[0];if(t===0)this._coreService.decPrivateModes.cursorStyle=void 0,this._coreService.decPrivateModes.cursorBlink=void 0;else{switch(t){case 1:case 2:this._coreService.decPrivateModes.cursorStyle="block";break;case 3:case 4:this._coreService.decPrivateModes.cursorStyle="underline";break;case 5:case 6:this._coreService.decPrivateModes.cursorStyle="bar";break}let r=t%2===1;this._coreService.decPrivateModes.cursorBlink=r}return!0}setScrollRegion(e){let t=e.params[0]||1,r;return(e.length<2||(r=e.params[1])>this._bufferService.rows||r===0)&&(r=this._bufferService.rows),r>t&&(this._activeBuffer.scrollTop=t-1,this._activeBuffer.scrollBottom=r-1,this._setCursor(0,0)),!0}windowOptions(e){if(!gf(e.params[0],this._optionsService.rawOptions.windowOptions))return!0;let t=e.length>1?e.params[1]:0;switch(e.params[0]){case 14:t!==2&&this._onRequestWindowsOptionsReport.fire(0);break;case 16:this._onRequestWindowsOptionsReport.fire(1);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${q.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:(t===0||t===2)&&(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>_f&&this._windowTitleStack.shift()),(t===0||t===1)&&(this._iconNameStack.push(this._iconName),this._iconNameStack.length>_f&&this._iconNameStack.shift());break;case 23:(t===0||t===2)&&this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),(t===0||t===1)&&this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop());break}return!0}saveCursor(e){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(e){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(e){return this._windowTitle=e,this._onTitleChange.fire(e),!0}setIconName(e){return this._iconName=e,!0}setOrReportIndexedColor(e){let t=[],r=e.split(";");for(;r.length>1;){let i=r.shift(),s=r.shift();if(/^\d+$/.exec(i)){let n=parseInt(i);if(yf(n))if(s==="?")t.push({type:0,index:n});else{let o=pf(s);o&&t.push({type:1,index:n,color:o})}}}return t.length&&this._onColor.fire(t),!0}setHyperlink(e){let t=e.indexOf(";");if(t===-1)return!0;let r=e.slice(0,t).trim(),i=e.slice(t+1);return i?this._createHyperlink(r,i):r.trim()?!1:this._finishHyperlink()}_createHyperlink(e,t){this._getCurrentLinkId()&&this._finishHyperlink();let r=e.split(":"),i,s=r.findIndex(n=>n.startsWith("id="));return s!==-1&&(i=r[s].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:i,uri:t}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(e,t){let r=e.split(";");for(let i=0;i<r.length&&!(t>=this._specialColors.length);++i,++t)if(r[i]==="?")this._onColor.fire([{type:0,index:this._specialColors[t]}]);else{let s=pf(r[i]);s&&this._onColor.fire([{type:1,index:this._specialColors[t],color:s}])}return!0}setOrReportFgColor(e){return this._setOrReportSpecialColor(e,0)}setOrReportBgColor(e){return this._setOrReportSpecialColor(e,1)}setOrReportCursorColor(e){return this._setOrReportSpecialColor(e,2)}restoreIndexedColor(e){if(!e)return this._onColor.fire([{type:2}]),!0;let t=[],r=e.split(";");for(let i=0;i<r.length;++i)if(/^\d+$/.exec(r[i])){let s=parseInt(r[i]);yf(s)&&t.push({type:2,index:s})}return t.length&&this._onColor.fire(t),!0}restoreFgColor(e){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(e){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(e){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,mr),!0}selectCharset(e){return e.length!==2?(this.selectDefaultCharset(),!0):(e[0]==="/"||this._charsetService.setgCharset(K1[e[0]],Ne[e[1]]||mr),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let e=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,e,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=Me.clone(),this._eraseAttrDataInternal=Me.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=this._curAttrData.bg&67108863,this._eraseAttrDataInternal}setgLevel(e){return this._charsetService.setgLevel(e),!0}screenAlignmentPattern(){let e=new dt;e.content=1<<22|69,e.fg=this._curAttrData.fg,e.bg=this._curAttrData.bg,this._setCursor(0,0);for(let t=0;t<this._bufferService.rows;++t){let r=this._activeBuffer.ybase+this._activeBuffer.y+t,i=this._activeBuffer.lines.get(r);i&&(i.fill(e),i.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(e,t){let r=o=>(this._coreService.triggerDataEvent(`${q.ESC}${o}${q.ESC}\\`),!0),i=this._bufferService.buffer,s=this._optionsService.rawOptions;return r(e==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:e==='"p'?'P1$r61;1"p':e==="r"?`P1$r${i.scrollTop+1};${i.scrollBottom+1}r`:e==="m"?"P1$r0m":e===" q"?`P1$r${{block:2,underline:4,bar:6}[s.cursorStyle]-(s.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(e,t){this._dirtyRowTracker.markRangeDirty(e,t)}},La=class{constructor(e){this._bufferService=e,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(e){e<this.start?this.start=e:e>this.end&&(this.end=e)}markRangeDirty(e,t){e>t&&(mf=e,e=t,t=mf),e<this.start&&(this.start=e),t>this.end&&(this.end=t)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};La=Be([re(0,Ge)],La);function yf(e){return 0<=e&&e<256}var G1=5e7,bf=12,Y1=50,X1=class extends ue{constructor(e){super(),this._action=e,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this._register(new Z),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(e,t){if(t!==void 0&&this._syncCalls>t){this._syncCalls=0;return}if(this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;this._isSyncWriting=!0;let r;for(;r=this._writeBuffer.shift();){this._action(r);let i=this._callbacks.shift();i&&i()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(e,t){if(this._pendingData>G1)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput){this._didUserInput=!1,this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t),this._innerWrite();return}setTimeout(()=>this._innerWrite())}this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t)}_innerWrite(e=0,t=!0){let r=e||performance.now();for(;this._writeBuffer.length>this._bufferOffset;){let i=this._writeBuffer[this._bufferOffset],s=this._action(i,t);if(s){let o=a=>performance.now()-r>=bf?setTimeout(()=>this._innerWrite(0,a)):this._innerWrite(r,a);s.catch(a=>(queueMicrotask(()=>{throw a}),Promise.resolve(!1))).then(o);return}let n=this._callbacks[this._bufferOffset];if(n&&n(),this._bufferOffset++,this._pendingData-=i.length,performance.now()-r>=bf)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>Y1&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}},Pa=class{constructor(e){this._bufferService=e,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(e){let t=this._bufferService.buffer;if(e.id===void 0){let a=t.addMarker(t.ybase+t.y),h={data:e,id:this._nextId++,lines:[a]};return a.onDispose(()=>this._removeMarkerFromLink(h,a)),this._dataByLinkId.set(h.id,h),h.id}let r=e,i=this._getEntryIdKey(r),s=this._entriesWithId.get(i);if(s)return this.addLineToLink(s.id,t.ybase+t.y),s.id;let n=t.addMarker(t.ybase+t.y),o={id:this._nextId++,key:this._getEntryIdKey(r),data:r,lines:[n]};return n.onDispose(()=>this._removeMarkerFromLink(o,n)),this._entriesWithId.set(o.key,o),this._dataByLinkId.set(o.id,o),o.id}addLineToLink(e,t){let r=this._dataByLinkId.get(e);if(r&&r.lines.every(i=>i.line!==t)){let i=this._bufferService.buffer.addMarker(t);r.lines.push(i),i.onDispose(()=>this._removeMarkerFromLink(r,i))}}getLinkData(e){var t;return(t=this._dataByLinkId.get(e))==null?void 0:t.data}_getEntryIdKey(e){return`${e.id};;${e.uri}`}_removeMarkerFromLink(e,t){let r=e.lines.indexOf(t);r!==-1&&(e.lines.splice(r,1),e.lines.length===0&&(e.data.id!==void 0&&this._entriesWithId.delete(e.key),this._dataByLinkId.delete(e.id)))}};Pa=Be([re(0,Ge)],Pa);var wf=!1,J1=class extends ue{constructor(e){super(),this._windowsWrappingHeuristics=this._register(new Ir),this._onBinary=this._register(new Z),this.onBinary=this._onBinary.event,this._onData=this._register(new Z),this.onData=this._onData.event,this._onLineFeed=this._register(new Z),this.onLineFeed=this._onLineFeed.event,this._onResize=this._register(new Z),this.onResize=this._onResize.event,this._onWriteParsed=this._register(new Z),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this._register(new Z),this._instantiationService=new w1,this.optionsService=this._register(new T1(e)),this._instantiationService.setService(Ye,this.optionsService),this._bufferService=this._register(this._instantiationService.createInstance(xa)),this._instantiationService.setService(Ge,this._bufferService),this._logService=this._register(this._instantiationService.createInstance(Ca)),this._instantiationService.setService(ou,this._logService),this.coreService=this._register(this._instantiationService.createInstance(ka)),this._instantiationService.setService(fr,this.coreService),this.coreMouseService=this._register(this._instantiationService.createInstance(Aa)),this._instantiationService.setService(nu,this.coreMouseService),this.unicodeService=this._register(this._instantiationService.createInstance(yr)),this._instantiationService.setService(vg,this.unicodeService),this._charsetService=this._instantiationService.createInstance(I1),this._instantiationService.setService(gg,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(Pa),this._instantiationService.setService(au,this._oscLinkService),this._inputHandler=this._register(new V1(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this._register(je.forward(this._inputHandler.onLineFeed,this._onLineFeed)),this._register(this._inputHandler),this._register(je.forward(this._bufferService.onResize,this._onResize)),this._register(je.forward(this.coreService.onData,this._onData)),this._register(je.forward(this.coreService.onBinary,this._onBinary)),this._register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom(!0))),this._register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this._register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this._register(this._bufferService.onScroll(()=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this._register(new X1((t,r)=>this._inputHandler.parse(t,r))),this._register(je.forward(this._writeBuffer.onWriteParsed,this._onWriteParsed))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this._register(new Z),this._onScroll.event(e=>{var t;(t=this._onScrollApi)==null||t.fire(e.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(e){for(let t in e)this.optionsService.options[t]=e[t]}write(e,t){this._writeBuffer.write(e,t)}writeSync(e,t){this._logService.logLevel<=3&&!wf&&(this._logService.warn("writeSync is unreliable and will be removed soon."),wf=!0),this._writeBuffer.writeSync(e,t)}input(e,t=!0){this.coreService.triggerDataEvent(e,t)}resize(e,t){isNaN(e)||isNaN(t)||(e=Math.max(e,nf),t=Math.max(t,of),this._bufferService.resize(e,t))}scroll(e,t=!1){this._bufferService.scroll(e,t)}scrollLines(e,t){this._bufferService.scrollLines(e,t)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(e){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){let t=e-this._bufferService.buffer.ydisp;t!==0&&this.scrollLines(t)}registerEscHandler(e,t){return this._inputHandler.registerEscHandler(e,t)}registerDcsHandler(e,t){return this._inputHandler.registerDcsHandler(e,t)}registerCsiHandler(e,t){return this._inputHandler.registerCsiHandler(e,t)}registerOscHandler(e,t){return this._inputHandler.registerOscHandler(e,t)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let e=!1,t=this.optionsService.rawOptions.windowsPty;t&&t.buildNumber!==void 0&&t.buildNumber!==void 0?e=t.backend==="conpty"&&t.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(e=!0),e?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let e=[];e.push(this.onLineFeed(uf.bind(null,this._bufferService))),e.push(this.registerCsiHandler({final:"H"},()=>(uf(this._bufferService),!1))),this._windowsWrappingHeuristics.value=Se(()=>{for(let t of e)t.dispose()})}}},Z1={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};function Q1(e,t,r,i){var o;let s={type:0,cancel:!1,key:void 0},n=(e.shiftKey?1:0)|(e.altKey?2:0)|(e.ctrlKey?4:0)|(e.metaKey?8:0);switch(e.keyCode){case 0:e.key==="UIKeyInputUpArrow"?t?s.key=q.ESC+"OA":s.key=q.ESC+"[A":e.key==="UIKeyInputLeftArrow"?t?s.key=q.ESC+"OD":s.key=q.ESC+"[D":e.key==="UIKeyInputRightArrow"?t?s.key=q.ESC+"OC":s.key=q.ESC+"[C":e.key==="UIKeyInputDownArrow"&&(t?s.key=q.ESC+"OB":s.key=q.ESC+"[B");break;case 8:s.key=e.ctrlKey?"\b":q.DEL,e.altKey&&(s.key=q.ESC+s.key);break;case 9:if(e.shiftKey){s.key=q.ESC+"[Z";break}s.key=q.HT,s.cancel=!0;break;case 13:s.key=e.altKey?q.ESC+q.CR:q.CR,s.cancel=!0;break;case 27:s.key=q.ESC,e.altKey&&(s.key=q.ESC+q.ESC),s.cancel=!0;break;case 37:if(e.metaKey)break;n?s.key=q.ESC+"[1;"+(n+1)+"D":t?s.key=q.ESC+"OD":s.key=q.ESC+"[D";break;case 39:if(e.metaKey)break;n?s.key=q.ESC+"[1;"+(n+1)+"C":t?s.key=q.ESC+"OC":s.key=q.ESC+"[C";break;case 38:if(e.metaKey)break;n?s.key=q.ESC+"[1;"+(n+1)+"A":t?s.key=q.ESC+"OA":s.key=q.ESC+"[A";break;case 40:if(e.metaKey)break;n?s.key=q.ESC+"[1;"+(n+1)+"B":t?s.key=q.ESC+"OB":s.key=q.ESC+"[B";break;case 45:!e.shiftKey&&!e.ctrlKey&&(s.key=q.ESC+"[2~");break;case 46:n?s.key=q.ESC+"[3;"+(n+1)+"~":s.key=q.ESC+"[3~";break;case 36:n?s.key=q.ESC+"[1;"+(n+1)+"H":t?s.key=q.ESC+"OH":s.key=q.ESC+"[H";break;case 35:n?s.key=q.ESC+"[1;"+(n+1)+"F":t?s.key=q.ESC+"OF":s.key=q.ESC+"[F";break;case 33:e.shiftKey?s.type=2:e.ctrlKey?s.key=q.ESC+"[5;"+(n+1)+"~":s.key=q.ESC+"[5~";break;case 34:e.shiftKey?s.type=3:e.ctrlKey?s.key=q.ESC+"[6;"+(n+1)+"~":s.key=q.ESC+"[6~";break;case 112:n?s.key=q.ESC+"[1;"+(n+1)+"P":s.key=q.ESC+"OP";break;case 113:n?s.key=q.ESC+"[1;"+(n+1)+"Q":s.key=q.ESC+"OQ";break;case 114:n?s.key=q.ESC+"[1;"+(n+1)+"R":s.key=q.ESC+"OR";break;case 115:n?s.key=q.ESC+"[1;"+(n+1)+"S":s.key=q.ESC+"OS";break;case 116:n?s.key=q.ESC+"[15;"+(n+1)+"~":s.key=q.ESC+"[15~";break;case 117:n?s.key=q.ESC+"[17;"+(n+1)+"~":s.key=q.ESC+"[17~";break;case 118:n?s.key=q.ESC+"[18;"+(n+1)+"~":s.key=q.ESC+"[18~";break;case 119:n?s.key=q.ESC+"[19;"+(n+1)+"~":s.key=q.ESC+"[19~";break;case 120:n?s.key=q.ESC+"[20;"+(n+1)+"~":s.key=q.ESC+"[20~";break;case 121:n?s.key=q.ESC+"[21;"+(n+1)+"~":s.key=q.ESC+"[21~";break;case 122:n?s.key=q.ESC+"[23;"+(n+1)+"~":s.key=q.ESC+"[23~";break;case 123:n?s.key=q.ESC+"[24;"+(n+1)+"~":s.key=q.ESC+"[24~";break;default:if(e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey)e.keyCode>=65&&e.keyCode<=90?s.key=String.fromCharCode(e.keyCode-64):e.keyCode===32?s.key=q.NUL:e.keyCode>=51&&e.keyCode<=55?s.key=String.fromCharCode(e.keyCode-51+27):e.keyCode===56?s.key=q.DEL:e.keyCode===219?s.key=q.ESC:e.keyCode===220?s.key=q.FS:e.keyCode===221&&(s.key=q.GS);else if((!r||i)&&e.altKey&&!e.metaKey){let a=(o=Z1[e.keyCode])==null?void 0:o[e.shiftKey?1:0];if(a)s.key=q.ESC+a;else if(e.keyCode>=65&&e.keyCode<=90){let h=e.ctrlKey?e.keyCode-64:e.keyCode+32,l=String.fromCharCode(h);e.shiftKey&&(l=l.toUpperCase()),s.key=q.ESC+l}else if(e.keyCode===32)s.key=q.ESC+(e.ctrlKey?q.NUL:" ");else if(e.key==="Dead"&&e.code.startsWith("Key")){let h=e.code.slice(3,4);e.shiftKey||(h=h.toLowerCase()),s.key=q.ESC+h,s.cancel=!0}}else r&&!e.altKey&&!e.ctrlKey&&!e.shiftKey&&e.metaKey?e.keyCode===65&&(s.type=1):e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.keyCode>=48&&e.key.length===1?s.key=e.key:e.key&&e.ctrlKey&&(e.key==="_"&&(s.key=q.US),e.key==="@"&&(s.key=q.NUL));break}return s}var Le=0,em=class{constructor(e){this._getKey=e,this._array=[],this._insertedValues=[],this._flushInsertedTask=new ds,this._isFlushingInserted=!1,this._deletedIndices=[],this._flushDeletedTask=new ds,this._isFlushingDeleted=!1}clear(){this._array.length=0,this._insertedValues.length=0,this._flushInsertedTask.clear(),this._isFlushingInserted=!1,this._deletedIndices.length=0,this._flushDeletedTask.clear(),this._isFlushingDeleted=!1}insert(e){this._flushCleanupDeleted(),this._insertedValues.length===0&&this._flushInsertedTask.enqueue(()=>this._flushInserted()),this._insertedValues.push(e)}_flushInserted(){let e=this._insertedValues.sort((s,n)=>this._getKey(s)-this._getKey(n)),t=0,r=0,i=new Array(this._array.length+this._insertedValues.length);for(let s=0;s<i.length;s++)r>=this._array.length||this._getKey(e[t])<=this._getKey(this._array[r])?(i[s]=e[t],t++):i[s]=this._array[r++];this._array=i,this._insertedValues.length=0}_flushCleanupInserted(){!this._isFlushingInserted&&this._insertedValues.length>0&&this._flushInsertedTask.flush()}delete(e){if(this._flushCleanupInserted(),this._array.length===0)return!1;let t=this._getKey(e);if(t===void 0||(Le=this._search(t),Le===-1)||this._getKey(this._array[Le])!==t)return!1;do if(this._array[Le]===e)return this._deletedIndices.length===0&&this._flushDeletedTask.enqueue(()=>this._flushDeleted()),this._deletedIndices.push(Le),!0;while(++Le<this._array.length&&this._getKey(this._array[Le])===t);return!1}_flushDeleted(){this._isFlushingDeleted=!0;let e=this._deletedIndices.sort((s,n)=>s-n),t=0,r=new Array(this._array.length-e.length),i=0;for(let s=0;s<this._array.length;s++)e[t]===s?t++:r[i++]=this._array[s];this._array=r,this._deletedIndices.length=0,this._isFlushingDeleted=!1}_flushCleanupDeleted(){!this._isFlushingDeleted&&this._deletedIndices.length>0&&this._flushDeletedTask.flush()}*getKeyIterator(e){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(Le=this._search(e),!(Le<0||Le>=this._array.length)&&this._getKey(this._array[Le])===e))do yield this._array[Le];while(++Le<this._array.length&&this._getKey(this._array[Le])===e)}forEachByKey(e,t){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(Le=this._search(e),!(Le<0||Le>=this._array.length)&&this._getKey(this._array[Le])===e))do t(this._array[Le]);while(++Le<this._array.length&&this._getKey(this._array[Le])===e)}values(){return this._flushCleanupInserted(),this._flushCleanupDeleted(),[...this._array].values()}_search(e){let t=0,r=this._array.length-1;for(;r>=t;){let i=t+r>>1,s=this._getKey(this._array[i]);if(s>e)r=i-1;else if(s<e)t=i+1;else{for(;i>0&&this._getKey(this._array[i-1])===e;)i--;return i}}return t}},Ma=0,Sf=0,tm=class extends ue{constructor(){super(),this._decorations=new em(e=>e==null?void 0:e.marker.line),this._onDecorationRegistered=this._register(new Z),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this._register(new Z),this.onDecorationRemoved=this._onDecorationRemoved.event,this._register(Se(()=>this.reset()))}get decorations(){return this._decorations.values()}registerDecoration(e){if(e.marker.isDisposed)return;let t=new rm(e);if(t){let r=t.marker.onDispose(()=>t.dispose()),i=t.onDispose(()=>{i.dispose(),t&&(this._decorations.delete(t)&&this._onDecorationRemoved.fire(t),r.dispose())});this._decorations.insert(t),this._onDecorationRegistered.fire(t)}return t}reset(){for(let e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,t,r){let i=0,s=0;for(let n of this._decorations.getKeyIterator(t))i=n.options.x??0,s=i+(n.options.width??1),e>=i&&e<s&&(!r||(n.options.layer??"bottom")===r)&&(yield n)}forEachDecorationAtCell(e,t,r,i){this._decorations.forEachByKey(t,s=>{Ma=s.options.x??0,Sf=Ma+(s.options.width??1),e>=Ma&&e<Sf&&(!r||(s.options.layer??"bottom")===r)&&i(s)})}},rm=class extends tr{constructor(e){super(),this.options=e,this.onRenderEmitter=this.add(new Z),this.onRender=this.onRenderEmitter.event,this._onDispose=this.add(new Z),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=xe.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=xe.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}},im=1e3,sm=class{constructor(e,t=im){this._renderCallback=e,this._debounceThresholdMS=t,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(e,t,r){this._rowCount=r,e=e!==void 0?e:0,t=t!==void 0?t:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,e):e,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,t):t;let i=performance.now();if(i-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=i,this._innerRefresh();else if(!this._additionalRefreshRequested){let s=i-this._lastRefreshMs,n=this._debounceThresholdMS-s;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=performance.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},n)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t)}},Cf=20,gs=class extends ue{constructor(e,t,r,i){super(),this._terminal=e,this._coreBrowserService=r,this._renderService=i,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="";let s=this._coreBrowserService.mainDocument;this._accessibilityContainer=s.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=s.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let n=0;n<this._terminal.rows;n++)this._rowElements[n]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[n]);if(this._topBoundaryFocusListener=n=>this._handleBoundaryFocus(n,0),this._bottomBoundaryFocusListener=n=>this._handleBoundaryFocus(n,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=s.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this._register(new sm(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this._register(this._terminal.onResize(n=>this._handleResize(n.rows))),this._register(this._terminal.onRender(n=>this._refreshRows(n.start,n.end))),this._register(this._terminal.onScroll(()=>this._refreshRows())),this._register(this._terminal.onA11yChar(n=>this._handleChar(n))),this._register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this._register(this._terminal.onA11yTab(n=>this._handleTab(n))),this._register(this._terminal.onKey(n=>this._handleKey(n.key))),this._register(this._terminal.onBlur(()=>this._clearLiveRegion())),this._register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._register(he(s,"selectionchange",()=>this._handleSelectionChange())),this._register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRowsDimensions(),this._refreshRows(),this._register(Se(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(e){for(let t=0;t<e;t++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<Cf+1&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,e===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===Cf+1&&(this._liveRegion.textContent+=Fo.get())))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(e){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(e)||this._charsToConsume.push(e)}_refreshRows(e,t){this._liveRegionDebouncer.refresh(e,t,this._terminal.rows)}_renderRows(e,t){let r=this._terminal.buffer,i=r.lines.length.toString();for(let s=e;s<=t;s++){let n=r.lines.get(r.ydisp+s),o=[],a=(n==null?void 0:n.translateToString(!0,void 0,void 0,o))||"",h=(r.ydisp+s+1).toString(),l=this._rowElements[s];l&&(a.length===0?(l.textContent="",this._rowColumns.set(l,[0,1])):(l.textContent=a,this._rowColumns.set(l,o)),l.setAttribute("aria-posinset",h),l.setAttribute("aria-setsize",i),this._alignRowWidth(l))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(e,t){let r=e.target,i=this._rowElements[t===0?1:this._rowElements.length-2],s=r.getAttribute("aria-posinset"),n=t===0?"1":`${this._terminal.buffer.lines.length}`;if(s===n||e.relatedTarget!==i)return;let o,a;if(t===0?(o=r,a=this._rowElements.pop(),this._rowContainer.removeChild(a)):(o=this._rowElements.shift(),a=r,this._rowContainer.removeChild(o)),o.removeEventListener("focus",this._topBoundaryFocusListener),a.removeEventListener("focus",this._bottomBoundaryFocusListener),t===0){let h=this._createAccessibilityTreeNode();this._rowElements.unshift(h),this._rowContainer.insertAdjacentElement("afterbegin",h)}else{let h=this._createAccessibilityTreeNode();this._rowElements.push(h),this._rowContainer.appendChild(h)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(t===0?-1:1),this._rowElements[t===0?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleSelectionChange(){var a;if(this._rowElements.length===0)return;let e=this._coreBrowserService.mainDocument.getSelection();if(!e)return;if(e.isCollapsed){this._rowContainer.contains(e.anchorNode)&&this._terminal.clearSelection();return}if(!e.anchorNode||!e.focusNode){console.error("anchorNode and/or focusNode are null");return}let t={node:e.anchorNode,offset:e.anchorOffset},r={node:e.focusNode,offset:e.focusOffset};if((t.node.compareDocumentPosition(r.node)&Node.DOCUMENT_POSITION_PRECEDING||t.node===r.node&&t.offset>r.offset)&&([t,r]=[r,t]),t.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(t={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(t.node))return;let i=this._rowElements.slice(-1)[0];if(r.node.compareDocumentPosition(i)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(r={node:i,offset:((a=i.textContent)==null?void 0:a.length)??0}),!this._rowContainer.contains(r.node))return;let s=({node:h,offset:l})=>{let c=h instanceof Text?h.parentNode:h,u=parseInt(c==null?void 0:c.getAttribute("aria-posinset"),10)-1;if(isNaN(u))return console.warn("row is invalid. Race condition?"),null;let p=this._rowColumns.get(c);if(!p)return console.warn("columns is null. Race condition?"),null;let _=l<p.length?p[l]:p.slice(-1)[0]+1;return _>=this._terminal.cols&&(++u,_=0),{row:u,column:_}},n=s(t),o=s(r);if(!(!n||!o)){if(n.row>o.row||n.row===o.row&&n.column>=o.column)throw new Error("invalid range");this._terminal.select(n.column,n.row,(o.row-n.row)*this._terminal.cols-n.column+o.column)}}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let t=this._rowContainer.children.length;t<this._terminal.rows;t++)this._rowElements[t]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[t]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){Object.assign(this._accessibilityContainer.style,{width:`${this._renderService.dimensions.css.canvas.width}px`,fontSize:`${this._terminal.options.fontSize}px`}),this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e]),this._alignRowWidth(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}_alignRowWidth(e){var s,n;e.style.transform="";let t=e.getBoundingClientRect().width,r=(n=(s=this._rowColumns.get(e))==null?void 0:s.slice(-1))==null?void 0:n[0];if(!r)return;let i=r*this._renderService.dimensions.css.cell.width;e.style.transform=`scaleX(${i/t})`}};gs=Be([re(1,Wo),re(2,Ht),re(3,Wt)],gs);var Oa=class extends ue{constructor(e,t,r,i,s){super(),this._element=e,this._mouseService=t,this._renderService=r,this._bufferService=i,this._linkProviderService=s,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this._register(new Z),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this._register(new Z),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this._register(Se(()=>{var n;dr(this._linkCacheDisposables),this._linkCacheDisposables.length=0,this._lastMouseEvent=void 0,(n=this._activeProviderReplies)==null||n.clear()})),this._register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this._register(he(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this._register(he(this._element,"mousemove",this._handleMouseMove.bind(this))),this._register(he(this._element,"mousedown",this._handleMouseDown.bind(this))),this._register(he(this._element,"mouseup",this._handleMouseUp.bind(this)))}get currentLink(){return this._currentLink}_handleMouseMove(e){this._lastMouseEvent=e;let t=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!t)return;this._isMouseOut=!1;let r=e.composedPath();for(let i=0;i<r.length;i++){let s=r[i];if(s.classList.contains("xterm"))break;if(s.classList.contains("xterm-hover"))return}(!this._lastBufferCell||t.x!==this._lastBufferCell.x||t.y!==this._lastBufferCell.y)&&(this._handleHover(t),this._lastBufferCell=t)}_handleHover(e){if(this._activeLine!==e.y||this._wasResized){this._clearCurrentLink(),this._askForLink(e,!1),this._wasResized=!1;return}this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,t){var i,s;(!this._activeProviderReplies||!t)&&((i=this._activeProviderReplies)==null||i.forEach(n=>{n==null||n.forEach(o=>{o.link.dispose&&o.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=e.y);let r=!1;for(let[n,o]of this._linkProviderService.linkProviders.entries())t?(s=this._activeProviderReplies)!=null&&s.get(n)&&(r=this._checkLinkProviderResult(n,e,r)):o.provideLinks(e.y,a=>{var l,c;if(this._isMouseOut)return;let h=a==null?void 0:a.map(u=>({link:u}));(l=this._activeProviderReplies)==null||l.set(n,h),r=this._checkLinkProviderResult(n,e,r),((c=this._activeProviderReplies)==null?void 0:c.size)===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)})}_removeIntersectingLinks(e,t){let r=new Set;for(let i=0;i<t.size;i++){let s=t.get(i);if(s)for(let n=0;n<s.length;n++){let o=s[n],a=o.link.range.start.y<e?0:o.link.range.start.x,h=o.link.range.end.y>e?this._bufferService.cols:o.link.range.end.x;for(let l=a;l<=h;l++){if(r.has(l)){s.splice(n--,1);break}r.add(l)}}}}_checkLinkProviderResult(e,t,r){var n;if(!this._activeProviderReplies)return r;let i=this._activeProviderReplies.get(e),s=!1;for(let o=0;o<e;o++)(!this._activeProviderReplies.has(o)||this._activeProviderReplies.get(o))&&(s=!0);if(!s&&i){let o=i.find(a=>this._linkAtPosition(a.link,t));o&&(r=!0,this._handleNewLink(o))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!r)for(let o=0;o<this._activeProviderReplies.size;o++){let a=(n=this._activeProviderReplies.get(o))==null?void 0:n.find(h=>this._linkAtPosition(h.link,t));if(a){r=!0,this._handleNewLink(a);break}}return r}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._currentLink)return;let t=this._positionFromMouseEvent(e,this._element,this._mouseService);t&&this._mouseDownLink&&nm(this._mouseDownLink.link,this._currentLink.link)&&this._linkAtPosition(this._currentLink.link,t)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,t){!this._currentLink||!this._lastMouseEvent||(!e||!t||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=t)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,dr(this._linkCacheDisposables),this._linkCacheDisposables.length=0)}_handleNewLink(e){if(!this._lastMouseEvent)return;let t=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);t&&this._linkAtPosition(e.link,t)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:e.link.decorations===void 0?!0:e.link.decorations.underline,pointerCursor:e.link.decorations===void 0?!0:e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>{var r,i;return(i=(r=this._currentLink)==null?void 0:r.state)==null?void 0:i.decorations.pointerCursor},set:r=>{var i;(i=this._currentLink)!=null&&i.state&&this._currentLink.state.decorations.pointerCursor!==r&&(this._currentLink.state.decorations.pointerCursor=r,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",r))}},underline:{get:()=>{var r,i;return(i=(r=this._currentLink)==null?void 0:r.state)==null?void 0:i.decorations.underline},set:r=>{var i,s,n;(i=this._currentLink)!=null&&i.state&&((n=(s=this._currentLink)==null?void 0:s.state)==null?void 0:n.decorations.underline)!==r&&(this._currentLink.state.decorations.underline=r,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,r))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(r=>{if(!this._currentLink)return;let i=r.start===0?0:r.start+1+this._bufferService.buffer.ydisp,s=this._bufferService.buffer.ydisp+1+r.end;if(this._currentLink.link.range.start.y>=i&&this._currentLink.link.range.end.y<=s&&(this._clearCurrentLink(i,s),this._lastMouseEvent)){let n=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);n&&this._askForLink(n,!1)}})))}_linkHover(e,t,r){var i;(i=this._currentLink)!=null&&i.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),t.hover&&t.hover(r,t.text)}_fireUnderlineEvent(e,t){let r=e.range,i=this._bufferService.buffer.ydisp,s=this._createLinkUnderlineEvent(r.start.x-1,r.start.y-i-1,r.end.x,r.end.y-i-1,void 0);(t?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(s)}_linkLeave(e,t,r){var i;(i=this._currentLink)!=null&&i.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),t.leave&&t.leave(r,t.text)}_linkAtPosition(e,t){let r=e.range.start.y*this._bufferService.cols+e.range.start.x,i=e.range.end.y*this._bufferService.cols+e.range.end.x,s=t.y*this._bufferService.cols+t.x;return r<=s&&s<=i}_positionFromMouseEvent(e,t,r){let i=r.getCoords(e,t,this._bufferService.cols,this._bufferService.rows);if(i)return{x:i[0],y:i[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,t,r,i,s){return{x1:e,y1:t,x2:r,y2:i,cols:this._bufferService.cols,fg:s}}};Oa=Be([re(1,qo),re(2,Wt),re(3,Ge),re(4,hu)],Oa);function nm(e,t){return e.text===t.text&&e.range.start.x===t.range.start.x&&e.range.start.y===t.range.start.y&&e.range.end.x===t.range.end.x&&e.range.end.y===t.range.end.y}var om=class extends J1{constructor(e={}){super(e),this._linkifier=this._register(new Ir),this.browser=Wu,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this._register(new Ir),this._onCursorMove=this._register(new Z),this.onCursorMove=this._onCursorMove.event,this._onKey=this._register(new Z),this.onKey=this._onKey.event,this._onRender=this._register(new Z),this.onRender=this._onRender.event,this._onSelectionChange=this._register(new Z),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this._register(new Z),this.onTitleChange=this._onTitleChange.event,this._onBell=this._register(new Z),this.onBell=this._onBell.event,this._onFocus=this._register(new Z),this._onBlur=this._register(new Z),this._onA11yCharEmitter=this._register(new Z),this._onA11yTabEmitter=this._register(new Z),this._onWillOpen=this._register(new Z),this._setup(),this._decorationService=this._instantiationService.createInstance(tm),this._instantiationService.setService(Yr,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(Yv),this._instantiationService.setService(hu,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(zo)),this._register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this._register(this._inputHandler.onRequestRefreshRows(t=>this.refresh((t==null?void 0:t.start)??0,(t==null?void 0:t.end)??this.rows-1))),this._register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this._register(this._inputHandler.onRequestReset(()=>this.reset())),this._register(this._inputHandler.onRequestWindowsOptionsReport(t=>this._reportWindowsOptions(t))),this._register(this._inputHandler.onColor(t=>this._handleColorEvent(t))),this._register(je.forward(this._inputHandler.onCursorMove,this._onCursorMove)),this._register(je.forward(this._inputHandler.onTitleChange,this._onTitleChange)),this._register(je.forward(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this._register(je.forward(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this._register(this._bufferService.onResize(t=>this._afterResize(t.cols,t.rows))),this._register(Se(()=>{var t,r;this._customKeyEventHandler=void 0,(r=(t=this.element)==null?void 0:t.parentNode)==null||r.removeChild(this.element)}))}get linkifier(){return this._linkifier.value}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(e){if(this._themeService)for(let t of e){let r,i="";switch(t.index){case 256:r="foreground",i="10";break;case 257:r="background",i="11";break;case 258:r="cursor",i="12";break;default:r="ansi",i="4;"+t.index}switch(t.type){case 0:let s=we.toColorRGB(r==="ansi"?this._themeService.colors.ansi[t.index]:this._themeService.colors[r]);this.coreService.triggerDataEvent(`${q.ESC}]${i};${$1(s)}${Iu.ST}`);break;case 1:if(r==="ansi")this._themeService.modifyColors(n=>n.ansi[t.index]=Pe.toColor(...t.color));else{let n=r;this._themeService.modifyColors(o=>o[n]=Pe.toColor(...t.color))}break;case 2:this._themeService.restoreColor(t.index);break}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(e){e?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(gs,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(e){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(q.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var e;return(e=this.textarea)==null?void 0:e.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(q.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let e=this.buffer.ybase+this.buffer.y,t=this.buffer.lines.get(e);if(!t)return;let r=Math.min(this.buffer.x,this.cols-1),i=this._renderService.dimensions.css.cell.height,s=t.getWidth(r),n=this._renderService.dimensions.css.cell.width*s,o=this.buffer.y*this._renderService.dimensions.css.cell.height,a=r*this._renderService.dimensions.css.cell.width;this.textarea.style.left=a+"px",this.textarea.style.top=o+"px",this.textarea.style.width=n+"px",this.textarea.style.height=i+"px",this.textarea.style.lineHeight=i+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this._register(he(this.element,"copy",t=>{this.hasSelection()&&cg(t,this._selectionService)}));let e=t=>ug(t,this.textarea,this.coreService,this.optionsService);this._register(he(this.textarea,"paste",e)),this._register(he(this.element,"paste",e)),zu?this._register(he(this.element,"mousedown",t=>{t.button===2&&ru(t,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this._register(he(this.element,"contextmenu",t=>{ru(t,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),ma&&this._register(he(this.element,"auxclick",t=>{t.button===1&&tu(t,this.textarea,this.screenElement)}))}_bindKeys(){this._register(he(this.textarea,"keyup",e=>this._keyUp(e),!0)),this._register(he(this.textarea,"keydown",e=>this._keyDown(e),!0)),this._register(he(this.textarea,"keypress",e=>this._keyPress(e),!0)),this._register(he(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this._register(he(this.textarea,"compositionupdate",e=>this._compositionHelper.compositionupdate(e))),this._register(he(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this._register(he(this.textarea,"input",e=>this._inputEvent(e),!0)),this._register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(e){var s;if(!e)throw new Error("Terminal requires a parent element.");if(e.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),((s=this.element)==null?void 0:s.ownerDocument.defaultView)&&this._coreBrowserService){this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView);return}this._document=e.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),e.appendChild(this.element);let t=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),t.appendChild(this._viewportElement),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._register(he(this.screenElement,"mousemove",n=>this.updateCursorStyle(n))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),t.appendChild(this.screenElement);let r=this.textarea=this._document.createElement("textarea");this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",No.get()),$u||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._register(this.optionsService.onSpecificOptionChange("disableStdin",()=>r.readOnly=this.optionsService.rawOptions.disableStdin)),this.textarea.readOnly=this.optionsService.rawOptions.disableStdin,this._coreBrowserService=this._register(this._instantiationService.createInstance(Vv,this.textarea,e.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(Ht,this._coreBrowserService),this._register(he(this.textarea,"focus",n=>this._handleTextAreaFocus(n))),this._register(he(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(_a,this._document,this._helperContainer),this._instantiationService.setService(Zi,this._charSizeService),this._themeService=this._instantiationService.createInstance(Sa),this._instantiationService.setService(Or,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(as),this._instantiationService.setService(lu,this._characterJoinerService),this._renderService=this._register(this._instantiationService.createInstance(ya,this.rows,this.screenElement)),this._instantiationService.setService(Wt,this._renderService),this._register(this._renderService.onRenderedViewportChange(n=>this._onRender.fire(n))),this.onResize(n=>this._renderService.resize(n.cols,n.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(ua,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(va),this._instantiationService.setService(qo,this._mouseService);let i=this._linkifier.value=this._register(this._instantiationService.createInstance(Oa,this.screenElement));this.element.appendChild(t);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this._register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this._register(this.onBlur(()=>this._renderService.handleBlur())),this._register(this.onFocus(()=>this._renderService.handleFocus())),this._viewport=this._register(this._instantiationService.createInstance(ha,this.element,this.screenElement)),this._register(this._viewport.onRequestScrollLines(n=>{super.scrollLines(n,!1),this.refresh(0,this.rows-1)})),this._selectionService=this._register(this._instantiationService.createInstance(wa,this.element,this.screenElement,i)),this._instantiationService.setService(yg,this._selectionService),this._register(this._selectionService.onRequestScrollLines(n=>this.scrollLines(n.amount,n.suppressScrollEvent))),this._register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this._register(this._selectionService.onRequestRedraw(n=>this._renderService.handleSelectionChanged(n.start,n.end,n.columnSelectMode))),this._register(this._selectionService.onLinuxMouseSelection(n=>{this.textarea.value=n,this.textarea.focus(),this.textarea.select()})),this._register(je.any(this._onScroll.event,this._inputHandler.onScroll)(()=>{var n;this._selectionService.refresh(),(n=this._viewport)==null||n.queueSync()})),this._register(this._instantiationService.createInstance(ca,this.screenElement)),this._register(he(this.element,"mousedown",n=>this._selectionService.handleMouseDown(n))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(gs,this)),this._register(this.optionsService.onSpecificOptionChange("screenReaderMode",n=>this._handleScreenReaderModeOptionChange(n))),this.options.overviewRuler.width&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(ss,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRuler",n=>{!this._overviewRulerRenderer&&n&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(ss,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(pa,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){let e=this,t=this.element;function r(n){var l,c,u,p,_;let o=e._mouseService.getMouseReportCoords(n,e.screenElement);if(!o)return!1;let a,h;switch(n.overrideType||n.type){case"mousemove":h=32,n.buttons===void 0?(a=3,n.button!==void 0&&(a=n.button<3?n.button:3)):a=n.buttons&1?0:n.buttons&4?1:n.buttons&2?2:3;break;case"mouseup":h=0,a=n.button<3?n.button:3;break;case"mousedown":h=1,a=n.button<3?n.button:3;break;case"wheel":if(e._customWheelEventHandler&&e._customWheelEventHandler(n)===!1)return!1;let m=n.deltaY;if(m===0||e.coreMouseService.consumeWheelEvent(n,(p=(u=(c=(l=e._renderService)==null?void 0:l.dimensions)==null?void 0:c.device)==null?void 0:u.cell)==null?void 0:p.height,(_=e._coreBrowserService)==null?void 0:_.dpr)===0)return!1;h=m<0?0:1,a=4;break;default:return!1}return h===void 0||a===void 0||a>4?!1:e.coreMouseService.triggerMouseEvent({col:o.col,row:o.row,x:o.x,y:o.y,button:a,action:h,ctrl:n.ctrlKey,alt:n.altKey,shift:n.shiftKey})}let i={mouseup:null,wheel:null,mousedrag:null,mousemove:null},s={mouseup:n=>(r(n),n.buttons||(this._document.removeEventListener("mouseup",i.mouseup),i.mousedrag&&this._document.removeEventListener("mousemove",i.mousedrag)),this.cancel(n)),wheel:n=>(r(n),this.cancel(n,!0)),mousedrag:n=>{n.buttons&&r(n)},mousemove:n=>{n.buttons||r(n)}};this._register(this.coreMouseService.onProtocolChange(n=>{n?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(n)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),n&8?i.mousemove||(t.addEventListener("mousemove",s.mousemove),i.mousemove=s.mousemove):(t.removeEventListener("mousemove",i.mousemove),i.mousemove=null),n&16?i.wheel||(t.addEventListener("wheel",s.wheel,{passive:!1}),i.wheel=s.wheel):(t.removeEventListener("wheel",i.wheel),i.wheel=null),n&2?i.mouseup||(i.mouseup=s.mouseup):(this._document.removeEventListener("mouseup",i.mouseup),i.mouseup=null),n&4?i.mousedrag||(i.mousedrag=s.mousedrag):(this._document.removeEventListener("mousemove",i.mousedrag),i.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this._register(he(t,"mousedown",n=>{if(n.preventDefault(),this.focus(),!(!this.coreMouseService.areMouseEventsActive||this._selectionService.shouldForceSelection(n)))return r(n),i.mouseup&&this._document.addEventListener("mouseup",i.mouseup),i.mousedrag&&this._document.addEventListener("mousemove",i.mousedrag),this.cancel(n)})),this._register(he(t,"wheel",n=>{var o,a,h,l,c;if(!i.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(n)===!1)return!1;if(!this.buffer.hasScrollback){if(n.deltaY===0)return!1;if(e.coreMouseService.consumeWheelEvent(n,(l=(h=(a=(o=e._renderService)==null?void 0:o.dimensions)==null?void 0:a.device)==null?void 0:h.cell)==null?void 0:l.height,(c=e._coreBrowserService)==null?void 0:c.dpr)===0)return this.cancel(n,!0);let u=q.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(n.deltaY<0?"A":"B");return this.coreService.triggerDataEvent(u,!0),this.cancel(n,!0)}}},{passive:!1}))}refresh(e,t){var r;(r=this._renderService)==null||r.refreshRows(e,t)}updateCursorStyle(e){var t;(t=this._selectionService)!=null&&t.shouldColumnSelect(e)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(e,t){this._viewport?this._viewport.scrollLines(e):super.scrollLines(e,t),this.refresh(0,this.rows-1)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(e){e&&this._viewport?this._viewport.scrollToLine(this.buffer.ybase,!0):this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){let t=e-this._bufferService.buffer.ydisp;t!==0&&this.scrollLines(t)}paste(e){eu(e,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(e){this._customKeyEventHandler=e}attachCustomWheelEventHandler(e){this._customWheelEventHandler=e}registerLinkProvider(e){return this._linkProviderService.registerLinkProvider(e)}registerCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");let t=this._characterJoinerService.register(e);return this.refresh(0,this.rows-1),t}deregisterCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(e)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(e){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+e)}registerDecoration(e){return this._decorationService.registerDecoration(e)}hasSelection(){return this._selectionService?this._selectionService.hasSelection:!1}select(e,t,r){this._selectionService.setSelection(e,t,r)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(!(!this._selectionService||!this._selectionService.hasSelection))return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var e;(e=this._selectionService)==null||e.clearSelection()}selectAll(){var e;(e=this._selectionService)==null||e.selectAll()}selectLines(e,t){var r;(r=this._selectionService)==null||r.selectLines(e,t)}_keyDown(e){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)return!1;let t=this.browser.isMac&&this.options.macOptionIsMeta&&e.altKey;if(!t&&!this._compositionHelper.keydown(e))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(!0),!1;!t&&(e.key==="Dead"||e.key==="AltGraph")&&(this._unprocessedDeadKey=!0);let r=Q1(e,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(e),r.type===3||r.type===2){let i=this.rows-1;return this.scrollLines(r.type===2?-i:i),this.cancel(e,!0)}if(r.type===1&&this.selectAll(),this._isThirdLevelShift(this.browser,e)||(r.cancel&&this.cancel(e,!0),!r.key)||e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.key.length===1&&e.key.charCodeAt(0)>=65&&e.key.charCodeAt(0)<=90)return!0;if(this._unprocessedDeadKey)return this._unprocessedDeadKey=!1,!0;if((r.key===q.ETX||r.key===q.CR)&&(this.textarea.value=""),this._onKey.fire({key:r.key,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(r.key,!0),!this.optionsService.rawOptions.screenReaderMode||e.altKey||e.ctrlKey)return this.cancel(e,!0);this._keyDownHandled=!0}_isThirdLevelShift(e,t){let r=e.isMac&&!this.options.macOptionIsMeta&&t.altKey&&!t.ctrlKey&&!t.metaKey||e.isWindows&&t.altKey&&t.ctrlKey&&!t.metaKey||e.isWindows&&t.getModifierState("AltGraph");return t.type==="keypress"?r:r&&(!t.keyCode||t.keyCode>47)}_keyUp(e){this._keyDownSeen=!1,!(this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)&&(am(e)||this.focus(),this.updateCursorStyle(e),this._keyPressHandled=!1)}_keyPress(e){let t;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)return!1;if(this.cancel(e),e.charCode)t=e.charCode;else if(e.which===null||e.which===void 0)t=e.keyCode;else if(e.which!==0&&e.charCode!==0)t=e.which;else return!1;return!t||(e.altKey||e.ctrlKey||e.metaKey)&&!this._isThirdLevelShift(this.browser,e)?!1:(t=String.fromCharCode(t),this._onKey.fire({key:t,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(t,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,!0)}_inputEvent(e){if(e.data&&e.inputType==="insertText"&&(!e.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let t=e.data;return this.coreService.triggerDataEvent(t,!0),this.cancel(e),!0}return!1}resize(e,t){if(e===this.cols&&t===this.rows){this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure();return}super.resize(e,t)}_afterResize(e,t){var r;(r=this._charSizeService)==null||r.measure()}clear(){if(!(this.buffer.ybase===0&&this.buffer.y===0)){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let e=1;e<this.rows;e++)this.buffer.lines.push(this.buffer.getBlankLine(Me));this._onScroll.fire({position:this.buffer.ydisp}),this.refresh(0,this.rows-1)}}reset(){var t;this.options.rows=this.rows,this.options.cols=this.cols;let e=this._customKeyEventHandler;this._setup(),super.reset(),(t=this._selectionService)==null||t.reset(),this._decorationService.reset(),this._customKeyEventHandler=e,this.refresh(0,this.rows-1)}clearTextureAtlas(){var e;(e=this._renderService)==null||e.clearTextureAtlas()}_reportFocus(){var e;(e=this.element)!=null&&e.classList.contains("focus")?this.coreService.triggerDataEvent(q.ESC+"[I"):this.coreService.triggerDataEvent(q.ESC+"[O")}_reportWindowsOptions(e){if(this._renderService)switch(e){case 0:let t=this._renderService.dimensions.css.canvas.width.toFixed(0),r=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${q.ESC}[4;${r};${t}t`);break;case 1:let i=this._renderService.dimensions.css.cell.width.toFixed(0),s=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${q.ESC}[6;${s};${i}t`);break}}cancel(e,t){if(!(!this.options.cancelEvents&&!t))return e.preventDefault(),e.stopPropagation(),!1}};function am(e){return e.keyCode===16||e.keyCode===17||e.keyCode===18}var lm=class{constructor(){this._addons=[]}dispose(){for(let e=this._addons.length-1;e>=0;e--)this._addons[e].instance.dispose()}loadAddon(e,t){let r={instance:t,dispose:t.dispose,isDisposed:!1};this._addons.push(r),t.dispose=()=>this._wrappedAddonDispose(r),t.activate(e)}_wrappedAddonDispose(e){if(e.isDisposed)return;let t=-1;for(let r=0;r<this._addons.length;r++)if(this._addons[r]===e){t=r;break}if(t===-1)throw new Error("Could not dispose an addon that has not been loaded");e.isDisposed=!0,e.dispose.apply(e.instance),this._addons.splice(t,1)}},hm=class{constructor(e){this._line=e}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(e,t){if(!(e<0||e>=this._line.length))return t?(this._line.loadCell(e,t),t):this._line.loadCell(e,new dt)}translateToString(e,t,r){return this._line.translateToString(e,t,r)}},Ef=class{constructor(e,t){this._buffer=e,this.type=t}init(e){return this._buffer=e,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(e){let t=this._buffer.lines.get(e);if(t)return new hm(t)}getNullCell(){return new dt}},cm=class extends ue{constructor(e){super(),this._core=e,this._onBufferChange=this._register(new Z),this.onBufferChange=this._onBufferChange.event,this._normal=new Ef(this._core.buffers.normal,"normal"),this._alternate=new Ef(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}},um=class{constructor(e){this._core=e}registerCsiHandler(e,t){return this._core.registerCsiHandler(e,r=>t(r.toArray()))}addCsiHandler(e,t){return this.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._core.registerDcsHandler(e,(r,i)=>t(r,i.toArray()))}addDcsHandler(e,t){return this.registerDcsHandler(e,t)}registerEscHandler(e,t){return this._core.registerEscHandler(e,t)}addEscHandler(e,t){return this.registerEscHandler(e,t)}registerOscHandler(e,t){return this._core.registerOscHandler(e,t)}addOscHandler(e,t){return this.registerOscHandler(e,t)}},fm=class{constructor(e){this._core=e}register(e){this._core.unicodeService.register(e)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(e){this._core.unicodeService.activeVersion=e}},dm=["cols","rows"],Dt=0,pm=class extends ue{constructor(e){super(),this._core=this._register(new om(e)),this._addonManager=this._register(new lm),this._publicOptions={...this._core.options};let t=i=>this._core.options[i],r=(i,s)=>{this._checkReadonlyOptions(i),this._core.options[i]=s};for(let i in this._core.options){let s={get:t.bind(this,i),set:r.bind(this,i)};Object.defineProperty(this._publicOptions,i,s)}}_checkReadonlyOptions(e){if(dm.includes(e))throw new Error(`Option "${e}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new um(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new fm(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this._register(new cm(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let e=this._core.coreService.decPrivateModes,t="none";switch(this._core.coreMouseService.activeProtocol){case"X10":t="x10";break;case"VT200":t="vt200";break;case"DRAG":t="drag";break;case"ANY":t="any";break}return{applicationCursorKeysMode:e.applicationCursorKeys,applicationKeypadMode:e.applicationKeypad,bracketedPasteMode:e.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:t,originMode:e.origin,reverseWraparoundMode:e.reverseWraparound,sendFocusMode:e.sendFocus,synchronizedOutputMode:e.synchronizedOutput,wraparoundMode:e.wraparound}}get options(){return this._publicOptions}set options(e){for(let t in e)this._publicOptions[t]=e[t]}blur(){this._core.blur()}focus(){this._core.focus()}input(e,t=!0){this._core.input(e,t)}resize(e,t){this._verifyIntegers(e,t),this._core.resize(e,t)}open(e){this._core.open(e)}attachCustomKeyEventHandler(e){this._core.attachCustomKeyEventHandler(e)}attachCustomWheelEventHandler(e){this._core.attachCustomWheelEventHandler(e)}registerLinkProvider(e){return this._core.registerLinkProvider(e)}registerCharacterJoiner(e){return this._checkProposedApi(),this._core.registerCharacterJoiner(e)}deregisterCharacterJoiner(e){this._checkProposedApi(),this._core.deregisterCharacterJoiner(e)}registerMarker(e=0){return this._verifyIntegers(e),this._core.registerMarker(e)}registerDecoration(e){return this._checkProposedApi(),this._verifyPositiveIntegers(e.x??0,e.width??0,e.height??0),this._core.registerDecoration(e)}hasSelection(){return this._core.hasSelection()}select(e,t,r){this._verifyIntegers(e,t,r),this._core.select(e,t,r)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(e,t){this._verifyIntegers(e,t),this._core.selectLines(e,t)}dispose(){super.dispose()}scrollLines(e){this._verifyIntegers(e),this._core.scrollLines(e)}scrollPages(e){this._verifyIntegers(e),this._core.scrollPages(e)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(e){this._verifyIntegers(e),this._core.scrollToLine(e)}clear(){this._core.clear()}write(e,t){this._core.write(e,t)}writeln(e,t){this._core.write(e),this._core.write(`\r
`,t)}paste(e){this._core.paste(e)}refresh(e,t){this._verifyIntegers(e,t),this._core.refresh(e,t)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(e){this._addonManager.loadAddon(this,e)}static get strings(){return{get promptLabel(){return No.get()},set promptLabel(e){No.set(e)},get tooMuchOutput(){return Fo.get()},set tooMuchOutput(e){Fo.set(e)}}}_verifyIntegers(...e){for(Dt of e)if(Dt===1/0||isNaN(Dt)||Dt%1!==0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...e){for(Dt of e)if(Dt&&(Dt===1/0||isNaN(Dt)||Dt%1!==0||Dt<0))throw new Error("This API only accepts positive integers")}};/**
 * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
 * @license MIT
 *
 * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
 * @license MIT
 *
 * Originally forked from (with the author's permission):
 *   Fabrice Bellard's javascript vt100 for jslinux:
 *   http://bellard.org/jslinux/
 *   Copyright (c) 2011 Fabrice Bellard
 */var _m=2,gm=1,vm=class{activate(e){this._terminal=e}dispose(){}fit(){let e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;let t=this._terminal._core;(this._terminal.rows!==e.rows||this._terminal.cols!==e.cols)&&(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){var u;if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let e=this._terminal._core._renderService.dimensions;if(e.css.cell.width===0||e.css.cell.height===0)return;let t=this._terminal.options.scrollback===0?0:((u=this._terminal.options.overviewRuler)==null?void 0:u.width)||14,r=window.getComputedStyle(this._terminal.element.parentElement),i=parseInt(r.getPropertyValue("height")),s=Math.max(0,parseInt(r.getPropertyValue("width"))),n=window.getComputedStyle(this._terminal.element),o={top:parseInt(n.getPropertyValue("padding-top")),bottom:parseInt(n.getPropertyValue("padding-bottom")),right:parseInt(n.getPropertyValue("padding-right")),left:parseInt(n.getPropertyValue("padding-left"))},a=o.top+o.bottom,h=o.right+o.left,l=i-a,c=s-h-t;return{cols:Math.max(_m,Math.floor(c/e.css.cell.width)),rows:Math.max(gm,Math.floor(l/e.css.cell.height))}}};/**
 * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
 * @license MIT
 *
 * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
 * @license MIT
 *
 * Originally forked from (with the author's permission):
 *   Fabrice Bellard's javascript vt100 for jslinux:
 *   http://bellard.org/jslinux/
 *   Copyright (c) 2011 Fabrice Bellard
 */var mm=class{constructor(e,t,r,i={}){this._terminal=e,this._regex=t,this._handler=r,this._options=i}provideLinks(e,t){let r=bm.computeLink(e,this._regex,this._terminal,this._handler);t(this._addCallbacks(r))}_addCallbacks(e){return e.map(t=>(t.leave=this._options.leave,t.hover=(r,i)=>{if(this._options.hover){let{range:s}=t;this._options.hover(r,i,s)}},t))}};function ym(e){try{let t=new URL(e),r=t.password&&t.username?`${t.protocol}//${t.username}:${t.password}@${t.host}`:t.username?`${t.protocol}//${t.username}@${t.host}`:`${t.protocol}//${t.host}`;return e.toLocaleLowerCase().startsWith(r.toLocaleLowerCase())}catch{return!1}}var bm=class ms{static computeLink(t,r,i,s){let n=new RegExp(r.source,(r.flags||"")+"g"),[o,a]=ms._getWindowedLineStrings(t-1,i),h=o.join(""),l,c=[];for(;l=n.exec(h);){let u=l[0];if(!ym(u))continue;let[p,_]=ms._mapStrIdx(i,a,0,l.index),[m,g]=ms._mapStrIdx(i,p,_,u.length);if(p===-1||_===-1||m===-1||g===-1)continue;let w={start:{x:_+1,y:p+1},end:{x:g,y:m+1}};c.push({range:w,text:u,activate:s})}return c}static _getWindowedLineStrings(t,r){let i,s=t,n=t,o=0,a="",h=[];if(i=r.buffer.active.getLine(t)){let l=i.translateToString(!0);if(i.isWrapped&&l[0]!==" "){for(o=0;(i=r.buffer.active.getLine(--s))&&o<2048&&(a=i.translateToString(!0),o+=a.length,h.push(a),!(!i.isWrapped||a.indexOf(" ")!==-1)););h.reverse()}for(h.push(l),o=0;(i=r.buffer.active.getLine(++n))&&i.isWrapped&&o<2048&&(a=i.translateToString(!0),o+=a.length,h.push(a),a.indexOf(" ")===-1););}return[h,s]}static _mapStrIdx(t,r,i,s){let n=t.buffer.active,o=n.getNullCell(),a=i;for(;s;){let h=n.getLine(r);if(!h)return[-1,-1];for(let l=a;l<h.length;++l){h.getCell(l,o);let c=o.getChars();if(o.getWidth()&&(s-=c.length||1,l===h.length-1&&c==="")){let u=n.getLine(r+1);u&&u.isWrapped&&(u.getCell(0,o),o.getWidth()===2&&(s+=1))}if(s<0)return[r,l]}r++,a=0}return[r,a]}},wm=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function Sm(e,t){let r=window.open();if(r){try{r.opener=null}catch{}r.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}var Cm=class{constructor(e=Sm,t={}){this._handler=e,this._options=t}activate(e){this._terminal=e;let t=this._options,r=t.urlRegex||wm;this._linkProvider=this._terminal.registerLinkProvider(new mm(this._terminal,r,this._handler,t))}dispose(){var e;(e=this._linkProvider)==null||e.dispose()}};const Em=(e,t)=>{const r=e.__vccOpts||e;for(const[i,s]of t)r[i]=s;return r},xm={key:0,class:"ssh-terminal-overlay"},km={key:0,class:"ssh-terminal-error"},Bm={key:1,class:"ssh-terminal-connecting"},xf=Em({__name:"SshTerminal",props:{backendUrl:{type:String,required:!0},host:{type:String,required:!0},username:{type:String,required:!0},password:{type:String,required:!0}},emits:["connected","disconnected","error","status-change"],setup(e,{expose:t,emit:r}){const i=e,s=r;t({connect:w,disconnect:y,fit:()=>c==null?void 0:c.fit()});const n=new ng,o=pe.ref(null),a=pe.ref(`ssh-${Date.now()}-${Math.random()}`),h=pe.ref(0);let l=null,c=null,u=null;const p=pe.computed(()=>(h.value,n.getSessionState(a.value))),_=pe.computed(()=>(h.value,n.getSessionStatus(a.value))),m=pe.computed(()=>(h.value,n.getSessionError(a.value)));function g(){l&&l.dispose(),l=new pm({allowProposedApi:!0,cursorBlink:!0,cursorStyle:"block",fontFamily:'"Cascadia Code", "Fira Code", "Hack", monospace',fontSize:14,letterSpacing:1,lineHeight:1.2,theme:{background:"#1a1a2e"}}),c=new vm,l.loadAddon(c),l.loadAddon(new Cm),l.open(o.value),pe.nextTick(()=>{c.fit()}),l.onData(v=>{n.sendData(a.value,v)}),l.onBinary(v=>{n.sendBinary(a.value,v)});let S=null;l.onResize(v=>{!v.cols||!v.rows||(clearTimeout(S),S=setTimeout(()=>{n.resize(a.value,v.rows,v.cols)},300))}),u&&u.disconnect(),u=new ResizeObserver(()=>{c&&p.value==="connected"&&c.fit()}),u.observe(o.value)}async function w(){try{n.createSession(a.value,{backendUrl:i.backendUrl,host:i.host,username:i.username,password:i.password,privateKey:"",authMethod:"Password",sharedKey:"",encoding:"utf-8",acceptFingerprint:!0}),n.registerStateChangeCallback(a.value,()=>{h.value++}),n.registerDataCallback(a.value,S=>{l&&l.write(S)}),await n.connect(a.value)}catch(S){s("error",String(S))}}async function y(){await n.disconnect(a.value),s("disconnected","manual")}function E(){w()}return pe.watch(p,(S,v)=>{S==="connected"&&v!=="connected"?(pe.nextTick(()=>{c==null||c.fit(),l==null||l.focus()}),s("connected",{name:a.value})):S==="error"&&v!=="error"&&s("error",m.value),s("status-change",{state:S,status:_.value})}),pe.watch(_,(S,v)=>{s("status-change",{state:p.value,status:S})}),pe.onMounted(()=>{g(),w()}),pe.onBeforeUnmount(()=>{u&&(u.disconnect(),u=null),l&&(l.dispose(),l=null),n.destroySession(a.value)}),(S,v)=>(pe.openBlock(),pe.createElementBlock("div",{ref_key:"containerRef",ref:o,class:"ssh-terminal"},[p.value!=="connected"?(pe.openBlock(),pe.createElementBlock("div",xm,[p.value==="error"?(pe.openBlock(),pe.createElementBlock("div",km,[pe.createTextVNode(pe.toDisplayString(m.value)+" ",1),pe.createElementVNode("button",{onClick:v[0]||(v[0]=k=>E())},"Reconnect")])):(pe.openBlock(),pe.createElementBlock("div",Bm,pe.toDisplayString(_.value),1))])):pe.createCommentVNode("",!0)],512))}},[["__scopeId","data-v-a02afb8c"]]),Rm={install(e){e.component("SshTerminal",xf)}};Ze.SshTerminal=xf,Ze.default=Rm,Object.defineProperties(Ze,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
